<!DOCTYPE html>
<!-- saved from url=(0081)https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Megabox</title>
<link rel="stylesheet" href="./megabox(1).min.css" media="all"><style type="text/css">
	/* FDK 결제용 CSS */
	/* table { margin: 1em; border-collapse: collapse; }
	td, th { padding: .3em; border: 1px #ccc solid; font-size:12px; }
	thead { background: #fc9; }
	thead .white { background: #fff; }
	input { background-color: #ffffff; border: #bbbbbb 1px solid; font-size: 9pt; height: 20px; width: 250px;}
	select { background-color: #ffffff; border-bottom: #a5a4a4 1px solid; border-left: #a5a4a4  1px solid; border-right: #a5a4a4  1px solid; border-top: #a5a4a4 1px solid; font-size: 9pt; height: 20px } */

	/* LAYER POPUP STYLE START */
	.fdLayer {display:none; position: absolute; top: 50%; left: 50%; height:auto;  background-color:#fff; border: 5px solid rgb(0, 66, 101); z-index: 12;}
	.fdLayer .fdContainer {padding: 3px;}
	.fdLayer .fdBtn {width: 100%; margin:10px 0 0; padding-top: 10px; border-top: 1px solid #DDD; text-align:right;}
	a.closeBtn {display:inline-block; height:25px; padding:0 14px 0; border:1px solid #304a8a; background-color:rgb(0, 32, 61); font-size:13px; color:#fff; line-height:25px;}
	a.closeBtn:hover {border: 1px solid #091940; background-color:#1f326a; color:#fff;}
	#mask { position:absolute; left:0; top:0; z-index:11; background-color:#000; display:none;}
	/* LAYER POPUP STYLE END */

	/* 할인수단 FONT size 변경처리 (기본15px;)*/
	span.txt{ font-size : 13px;}
</style><script src="./jquery-1.12.4.js.다운로드"></script><script src="./jquery-ui.1.12.1.js.다운로드"></script><script src="./gsaps.js.다운로드"></script><script src="./megaboxCom.js.다운로드"></script><script src="./mega.prototype.js.다운로드"></script><script src="./commons.js.다운로드"></script><script src="./joongAngPayPc.js.다운로드"></script><script src="./bootstrap-custom.js.다운로드"></script><script src="./bootstrap-select.js.다운로드"></script><script type="text/javascript" src="./netfunnel.js.다운로드" charset="UTF-8"></script><script type="text/javascript" src="./netfunnel_skin.js.다운로드" charset="UTF-8"></script><script type="text/javascript" src="./netfunnel_frm.js.다운로드" charset="UTF-8"></script><script type="text/javascript" src="./swiper.min.js.다운로드"></script><script type="text/javascript">
	var _init = {
		cache	: Date.now(),
		path	: '/static/pc/js/'
	};
	var sysCd = 'ON';

  	//넷퍼넬 스킨 타입 지정
	//NetfunnelChk.setting( sysCd, MegaboxUtil.Common.isApp() );
</script><script type="text/javascript">
	//예매 사용 카드번호 체크
	$.fn.megaBoxCardNumberCheck = function() {
	    $(this).on("keypress",function(e){
	        if ( !e.key.isNumber() && e.key != '-') return false;
	    })
	    $(this).on("focus",function(e){
	    	$(this).val($('#'+$(this).attr('id')+'_hid').val());
	    })
	    $(this).on("focusout",function(e){
	    	var val = $(this).val().replace(/[^0-9]+/g, '');
	        $(this).val(val);
	        $('#'+$(this).attr('id')+'_hid').val(val);

			var makNo = $(this).val().maskCardNo();
			var varArr = makNo.split('-');
			if (varArr.length > 3) {
				varArr[2] = varArr[2].replaceAll(/[0-9]/g, '*');
			}

			$(this).val(varArr.join("-"));
	    })
	};

	//예매 사용 카드번호 체크
	$.fn.megaBoxCvcNumberCheck = function() {
		$(this).on("keypress",function(e){
			if ( !e.key.isNumber() && e.key != '-') return false;
		})
		$(this).on("focus",function(e){
			$(this).val($('#'+$(this).attr('id')+'_hid').val());
		})
		$(this).on("focusout",function(e){
			var val = $(this).val().replace(/[^0-9]+/g, '');
			$(this).val(val);
			$('#'+$(this).attr('id')+'_hid').val(val);

			//cvc번호 마스킹처리
			var makNo = $(this).val().maskCardNo();
			var varArr = makNo.split('-');
			if (varArr.length >= 2) {
				varArr[1] = varArr[1].replaceAll(/[0-9]/g, '*');
			}

			$(this).val(varArr.join(""));
		})
	};

	//예매 금액 체크
	$.fn.megaBoxCommaNumberCheck  = function() {
	    $(this).on("keypress",function(e){
	        if ( !e.key.isNumber() && e.key != ',') return false;
	    })
	    $(this).on("focusout",function(e){
	        $(this).val($(this).val().replace(/[^0-9]+/g, ''));
	        $(this).val($(this).val().maskNumber() );
	    })
	};

    var _init = {
        cache	: Date.now(),
        path	: '/static/pc/js/'
    };


    document.write(
        '<script src="'+_init.path+'ui.common.js?v='+_init.cache+'"><\/script>'+
        '<script src="'+_init.path+'front.js?v='+_init.cache+'"><\/script>'
    );

    var arrEasypay = ['naverpay','kakaopay','payco','chai', 'tosspay', 'kbpay'];
    var selEasypay = '';
	var today = parseInt("20240923");
	var cardControl = false;		//카드사 제약 적용 확인 flag
	var minTotalAmt = 0;		//제휴서비스 최소결제금액
	var shinhanUseAble = false;
	let annusGiftAmt = 0; //아너스카드 적용금액
	let useUplusYn = true; //유플러스 정책 사용true /비사용 false
	var dcCnt = 0;        // 할인쿠폰 갯수
	var vipCnt = 0;        // vip쿠폰 갯수
	var localCmbndCnt = 0;        // 메가박스관람권 갯수
	var storeCmbndCnt = 0;        // 스토어교환권 갯수

	$(function() {

		// 체크 활성화
		/*
		$(document).on('click', '.discout-setting .discout-list .item a', function(){
			$(this).closest('.item').addClass('on');
		});

		// 체크 해제 == 취소
		$(document).on('click', '.discout-setting .discout-list .item .btn-cancel', function(){
			$(this).closest('.item').removeClass('on');
		});
		*/

		$(window).on('load', function(){

			
		});


		//페이지 나가는 경우 선점 취소(윈도우창 닫기에만 실행)
		$(window).on("beforeunload", function (e){
			var transNo = $("#transNo").val();
			var paramData = { transNo:transNo };
			if ($("#completeYn").val() != "Y" && $("#prepareYn").val() == "Y" && $("#goBackYn").val() != "Y") {  //예매완료로 이동시는 제외, 결제 준비 완료시에만, 뒤로가기 제외(자체 버튼 클릭시 초기화)
				$.ajax({
			        url: "/on/oh/ohz/PayBooking/initOccupSeat.do",
			        type: "POST",
			        contentType: "application/json;charset=UTF-8",
			        dataType: "json",
					data: JSON.stringify(paramData),
			        success: function (data, textStatus, jqXHR) {
			        },
			        error: function(xhr,status,error){
			        }
				});
			}
		});

		//중앙 패밀리 포인트 클릭 이벤트
		$('#btn_pay_jfamily').on('click', function() {
			if (!$(this).hasClass('disabled')) {
				if ($('#btn_cancel_apply_jfamily').css('display') == 'none') {
					searchChkJfamily();
				}
			}
		});

		//다음에도 이 결제수단 사용 클릭
		$("#same_use_payment").on('click', function() {
			savePaymentSelect();
		});

		
		$('#neTab a').on('click', function(e) {
			if($(this).hasClass('disab')) {
				return;
			}

			if($(this).index() == 0){
				$('#neTab').children().eq(0).addClass('act')
				$('#neTab').children().eq(1).removeClass('act');

				if($('#dcTab').hasClass('display-none')){
					$('#dcTab').removeClass('display-none');
					$('#pointTab').addClass('display-none');
				}

			} else {
				$('#neTab').children().eq(0).removeClass('act');
				$('#neTab').children().eq(1).addClass('act');

				if($('#pointTab').hasClass('display-none')){
					$('#pointTab').removeClass('display-none');
					$('#dcTab').addClass('display-none');
				}
			}

			parent.calcFrameHeight($('#bokdMPayBooking', parent.document), $('#framePayBooking', parent.document));
		});

		
		$('#paySelect div.pays').on('click', function() {

			// 중앙페이 백그라운드 색상 변경
			if($('.joongPay').hasClass('act')){
				$('.joongPay').removeClass('act');
				$('.joongPay').addClass('none');
			}

			var $this = $(this);
			if(!$this.hasClass('disab')){
				var payDcMeanCd = $this.attr('paydcmeancd');
				var methodName = $this.attr('data-type');

				if(methodName.indexOf('-') > -1){
					methodName = methodName.split('-')[0];
				}

				/*if(methodName.indexOf('-') > -1){
                    methodName = methodName.split('-')[0];
                }*/

				// 간편결제인 경우 해당 선택수단으로..(닫기 버튼만 누르는 경우가 있어서 주석처리)
				/*if(methodName != 'easy'){
                    $('#lastPayMethod').val(methodName);
                }*/

				$('#lastPayMethod').val(methodName);

				if(methodName != 'easy' && nvl($('#terms').css('display')) != 'none') {
					initTerms();
					$('#terms').hide();
				}
				// 간편결제, 신용카드 경우 작업 필요..
				if(methodName == 'credit'){
					// $('#banner_layer').removeClass('display-none');
					$('#credit-display').removeClass('display-none');
					$('#easy-display').addClass('display-none');

				} else if (methodName == 'easy') {
					var paymentVal = $(':radio[name="easy_radio_payment"]:checked').val();
					if(paymentVal == undefined) {
						$('#paymentInfo ul').each(function(){
							$(this).addClass('display-none');
						});
					}

					$('#easy-display').removeClass('display-none');
					$('#credit-display').addClass('display-none');

					if($('#selectPayMean').hasClass('display-none')){
						$('#selectPayMean').removeClass('display-none')
					}

					if($('#terms').css('display') == 'none') {
						$('#terms').show();
					}

					$(':radio[name="easy_radio_payment"][value="'+ paymentVal +'"]').trigger("click");
				} else {

					if(!$('#credit-display').hasClass('display-none')){
						$('#credit-display').addClass('display-none');
					}

					// 휴대폰 내통장 안내문구 처리

					$("#lastPayMethod").val(methodName);

					//fn_payMsgPopup(payDcMeanCd);
					$('#credit-display').addClass('display-none');
					$('#easy-display').addClass('display-none');
				}

				//결제수단 안내 문구 노출
				if(methodName != 'easy') {
					var $liTxt = $('ul[content-paydcmeancd="'+payDcMeanCd+'"]');
					$('#paymentInfo ul').each(function(){
						var contentPayDcMeanCd = $(this).attr('content-paydcmeancd');
						if(contentPayDcMeanCd == payDcMeanCd && $liTxt.find('li').length > 0){
							$liTxt.removeClass('display-none');
						} else {
							$(this).addClass('display-none');
						}
					});
				}

				$('#paySelect div.pays').each(function(){

					if($this.attr('data-type') == $(this).attr('data-type')){
						if(!$(this).hasClass('act')){
							$(this).addClass('act');
						}
					} else {
						if($(this).hasClass('act')){
							$(this).removeClass('act');
						}
					}
				});

				parent.calcFrameHeight($('#bokdMPayBooking', parent.document), $('#framePayBooking', parent.document));

				if ( methodName == 'credit' && $(':radio[name="rdo_card_select"]:checked').val() == '00' ){
					$('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
				} else {
					$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
				}

				if(!$this.hasClass('disab') && $this.hasClass('act')){

					savePaymentSelect();
				}
				changePaymentName();
			}
		});

		//카드선택
		$('#card_select').on('change', function() {
			var selVal = $("#card_select option:selected").val();
			var isNotUseSpecial = selVal.indexOf("B")==0?true:false;	// B로 시작하는 카드는 즉시할인 영역을 보여주지 않는다.

			if(selVal.indexOf("B")==0){
				
				selVal = "01";
			}else if(selVal.indexOf("S")==0){
				
				selVal = "03";
			}

			if(selVal == '00'){
				$('#rdo_credit_method').addClass('display-none');
			} else {
				$('#rdo_credit_method').removeClass('display-none');
			}

			if (selVal == "01" || (selVal == "02" && shinhanUseAble) || selVal == "03" ||  selVal == "27" || (selVal == "90" && today <= 20220731) || selVal == "23") {	//비씨, 삼성, 하나 선택시
				$('#special_rdo').removeClass('display-none');
				var selText = "";

				// 상영스케쥴 제어조건 있는 경우 선할인 사용 못하도록 추가
				if($('#payPolicCtrl').val() == 'Y'){
					cardControl = true;
				}

				if (selVal == "01" || selVal == "90"  || selVal == "23") {
					selText = "즉시할인";<!-- BC 즉시할인카드 -->
					if(cardControl){
						$('#special_rdo').addClass('display-none');
					}
				} else if (selVal == "02") {
					selText = "아침愛 조조할인 ";<!-- 신한 조조  -->
				} else if (selVal == "03") {
					selText = "포인트사용";<!-- 삼성카드 보너스포인트 -->
				} else if (selVal == "27") {
					selText = "하나머니";<!-- 하나머니 -->
				}
				$('#label_special_card').text(selText);
			} else {
				$('#special_rdo').addClass('display-none');
			}

			// B로 시작하는 카드는 즉시할인 영역을 보여주지 않는다.
			if(isNotUseSpecial){
				$('#special_rdo').addClass('display-none');
			}

			// 항목 변경 시 첫번째 항목 선택처리, 최초에는 DB에서 조회된 값을 설정
			var initVal = $(this).data('init');
			if(initVal){
				$(this).data('init', '');
				$(':radio[name="rdo_card_select"]:input[value="'+initVal+'"]').prop('checked', true);
			}else{
				$(':radio[name="rdo_card_select"]:input[value="01"]').prop('checked', true);
			}

			
			if ( selVal == '07' || selVal == '02' || selVal == '03' || selVal == '05' || selVal == '12'
					|| selVal == '04' ||selVal == '13' ||selVal == '14' || selVal == '27'){
				$('#label_app_card').text('앱카드'); //앱카드
			} else { 
				$('#label_app_card').text('ISP'); //ISP
			}

			if ( $('#paySelect div[data-type="credit"]') == 'credit' && $(':radio[name="rdo_card_select"]:checked').val() == '00' ){
				$('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
			} else {
				$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
			}

			// 국방부 회원은 즉시할인 사용 못하도록 수정
			if($('#tkeYn').val() == 'Y' && $('#entrpMbCd').val() == 'MND'){
				var cardSelectValue = $('#card_select option:selected').val();

				if(cardSelectValue == '01' || cardSelectValue == '90'){
					$('#special_rdo').addClass('display-none');
				}
			}

			// if(selVal == '02') {
			// 	if($(':radio[name="rdo_card_select"]:checked').val() == '02'){
			// 		$("#select-shinhan-info").show();
			// 	} else {
			// 		$("#select-shinhan-info").hide();
			// 	}
			// } else {
			// 	$("#select-shinhan-info").hide();
			// }

			if(!shinhanUseAble && selVal == "02"){
				$('#ord_card > .newRadio_1').eq(2).addClass('display-none');
				if($(':radio[name="rdo_card_select"]:checked').val() == '02'){
					$(':radio[name="rdo_card_select"]:input[value="01"]').prop('checked', true);
				}
			}
			savePaymentSelect();
		});

		$(':radio[name*="easy_radio_payment"]').on('click', function() {
			var payDcMeanCd = $(this).attr('paydcmeancd');
			$('#lastPayMethod').val($(this).val());
			initTerms();

			if($('#terms').css('display') == 'none') {
				$('#terms').show();
				parent.calcFrameHeight($('#bokdMPayBooking', parent.document), $('#framePayBooking', parent.document));
			}
			selEasypay = $(this).val();

			if ($(this).val() != 'easypay'){
				savePaymentSelect();  //결제수단 저장
			}

			changePaymentName();

			var $liTxt = $('ul[content-paydcmeancd="'+payDcMeanCd+'"]');
			$('#paymentInfo ul').each(function(){
				var contentPayDcMeanCd = $(this).attr('content-paydcmeancd');
				if(contentPayDcMeanCd == payDcMeanCd && $liTxt.find('li').length > 0){
					$liTxt.removeClass('display-none');
				} else {
					$(this).addClass('display-none');
				}
			});
			//fn_dispPayAlertMsg(); //알림 문구 노출
		});

		//리아결제버튼 클릭
		// $('#btn_booking_ria_pay').on('click', function(e) {
		// 	teller_init();
		//
		// 	var chkRemainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
		// 	if (parseInt(chkRemainAmt) == 0) {
		// 		$('#btn_booking_ria_pay').addClass('disabled');  //리아결제 팝업 오픈 방지
		// 		chkLastPayAmt();
		// 	}
		// });

		//구인증 클릭
		$('#btn_booking_favor_credit_pay').click(function() {
			favorCreditCard_init();

			var chkRemainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
			if (parseInt(chkRemainAmt) == 0) {
				$('#btn_booking_ria_pay').addClass('disabled');  //리아결제 팝업 오픈 방지
				chkLastPayAmt();
			}
		});


		//초기화 버튼 클릭
		$('#btn_booking_init').on('click', function() {
			payRefresh();	//2019.07.24 화면 reload 가 아닌 적용수단 해제
		});

		//삭제 버튼 이벤트 적용(공통)
		$('.btn-delete').on('click', function() {
			var sMethodName   = $(this).attr('method');
			var options       = {};
			options.msg       = '적용 내역을 취소하시겠습니까?';
			options.confirmFn = delApplyMethod;
			options.param     = {confirm:sMethodName} ;
			options.minWidth  = 400;
			options.minHeight = 300;
			gfn_confirmMsgBox(options);
		});

		//이전버튼 클릭
		$('#btn_booking_back').on('click', function() {
			initOccupSeat('back');
		});

		//특수카드 선택
		$(':radio[name="rdo_card_select"]').on('change', function() {
			savePaymentSelect();

			var totalAmt      = $('.receipt .row.total span').text().replaceAll(',', '').nvlNum(0);
			// 구인증 결제 팝업 기능
			if ( $('#paySelect div[data-type="credit"]').hasClass('act') && $(':radio[name="rdo_card_select"]:checked').val() == '00' && parseInt(totalAmt) >= parseInt(String(minTotalAmt).nvlNum(0))){
				$('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
			} else {
				$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
			}
		});

		

		//5분 연장하기
		$('#delayFiveMin').on('click', function() {
			var transNo   = $("#transNo").val();
			var paramData = {transNo:transNo};

			$.ajax({
		        url: "/on/oh/ohz/PayBooking/appendPayBookingTime.do",
		        type: "POST",
		        contentType: "application/json;charset=UTF-8",
		        dataType: "json",
				data: JSON.stringify(paramData),
		        success: function (data, textStatus, jqXHR) {
		        	//알림메시지 노출
		        	if (data.msg != null && data.msg !="") {
		        		gfn_alertMsgBox(data.msg);
		        	}

		        	if (!msgBookingLoginChk(data)) {
		        		return;
		        	}

		        	$('#delayFiveMinClose').click();
		        },
		        error: function(xhr,status,error){
		        	var err = JSON.parse(xhr.responseText);
		        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
		        	errBookingChk(err.msg);
		        }
			});
		});

		
		
	});

	function openDcCponPopup(){
		if($('#dcCponDiv a.rt').hasClass('disab')) {
			return;
		}

		if($('li[payDcMeancd="popup_202001"]').hasClass('act') && $('#dcCponApply').attr('paydcmeancd') == '202001'){
			$('#layer_202001 .wrap').css('width', '600');
			$('#layer_202001 .wrap').css('height', '550');
			searchVipCpon('checked');

			$modal('layer_202001');
		} else if($('li[payDcMeancd="popup_202002"]').hasClass('act') && $('#dcCponApply').attr('paydcmeancd') == '202002'){
			$('#layer_202002 .wrap').css('width', '600');
			$('#layer_202002 .wrap').css('height', '550');
			searchDcouponChg('checked');

			$modal('layer_202002');
		}
	}

	//약관 동의
	function agreeTerms() {
		$('#agree').prop('checked', true);
	}

	function initTerms() {
		$('#agree').prop('checked', false);
	}

	//결제 버튼 클릭
	function startPay() {
		var lastPayMethod = $('#lastPayMethod').val();

		if(arrEasypay.indexOf(lastPayMethod) >= 0 || lastPayMethod == "joongangpay") {

			if(!$('#agree').prop('checked')) {
				var sMethodName   = $(this).attr('method');
				var options       = {};
				options.msg       = '결제대행 서비스 약관에 동의하시겠습니까?';
				options.confirmFn = agreeTerms;
				options.param     = {confirm:sMethodName} ;
				options.minWidth  = 400;
				options.minHeight = 300;
				gfn_confirmMsgBox(options);
				return false;
			}
		}

		chkBookingPay();
	}

	function btnEvent(status){
        
        //$("#btn_booking_pay").off('click');
        $("#btn_booking_pay").removeAttr("onclick");

        if( status == 'error' ){
			//$("#btn_booking_pay").on('click');

			$("#btn_booking_pay").attr("onclick","startPay()");

			/*$('#btn_booking_pay').on('click', function() {
				chkBookingPay();
			});*/
        }
    }

    function chkBookingPay(){
        var selCard       = $("#card_select option:selected").val();
        var selSpCard     = $(':radio[name="rdo_card_select"]:checked').val();
        var lastPayMethod = $('#lastPayMethod').val();
		var totalAmt      = $('.receipt .row.total span').text().replaceAll(',', '').nvlNum(0);
		var minAmt 		  = parseInt(String(minTotalAmt).nvlNum(0));

		if(minAmt > 0 && parseInt(totalAmt) < minAmt) {
			gfn_alertMsgBox('선택한 쿠폰사용 조건이 맞지 않아 쿠폰을 사용할 수 없습니다. 최종결제금액이 ['+ String(minTotalAmt).maskNumber() +'] 이상시 결제가능합니다.');
			btnEvent('error');
			return;
		}

        //내통장결제(세틀뱅크)는 은행마다 상이하나 매일 23:30 ~ 00:30 시간에는 은행시스템 작업으로 결제가 안될 수 있음
        if(lastPayMethod == 'settlebank') {
        	var chkDe = new Date().formatDate('hhmi');
        	if(chkDe <= '0030' || '2330' <= chkDe) {
    			gfn_alertMsgBox('매일 23:30 ~ 00:30 시간에는 은행시스템작업으로 내통장결제가 불가합니다.\n다른 결제수단을 이용바랍니다.');
				btnEvent('error');
    			return;
        	}
        }
        /*
        if(lastPayMethod == 'naverpay') {
        	var chkDe = new Date().formatDate('yyyymmddhhmi');
        	if(chkDe <= '202112190600' && '202112190000' <= chkDe) {
    			gfn_alertMsgBox('6시까지 결제시스템 변경작업으로 네이버페이결제가 불가합니다.\n다른 결제수단을 이용바랍니다.');
				btnEvent('error');
    			return;
        	}
        }
		*/
        $('#preDisc').val('');
        $('#discType').val('');

//            if($('#rdo_pay_credit').is(":disabled")){
//                $('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
//            } else {
//                $('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
//            }

        //현대M포인트 사용
		if ($('#pointBtnList li[dispname="hydm-display"]').hasClass('act') && $('#btn_cancel_apply_hydm6p').length > 0 && $('#btn_cancel_apply_hydm6p').css('display') != "none"){
			$('#preDisc').val('Y');
			$('#discType').val('HYUNM');
			payHyM6Point();

			return;
		}

        //문화누리 사용
		if ($('#pointBtnList li[dispname="culturenuri"]').hasClass('act') && $('#btn_cancel_apply_culturenuri').length > 0 && $('#btn_cancel_apply_culturenuri').css('display') != "none"){
			let naverPayYn = $('#cultNaverYn').val();
			if(naverPayYn != null && naverPayYn == 'Y') {
				payCulturenuri();
			} else {
				$('#preDisc').val('Y');
				$('#discType').val('CULTURE');
				payCulturenuri();
			}
			return;
		}

        // 카카오뱅크 할인
        if ( selCard == "90" && selSpCard == "02" && lastPayMethod == 'credit') {
            $('#preDisc').val('Y');
            $('#discType').val('KAKAOPRE');
            chkPrePayAmt();
            return;
        }

        //bc 선할인
        if (selCard == "01" && selSpCard == "02" && lastPayMethod == 'credit') {
            //bc 결제화면 팝업
            $('#preDisc').val('Y');
            $('#discType').val('BCPRE');
            $('#pre_disc_pop').click();
            return;
        }

		//광주카드 선할인
		if (selCard == "23" && selSpCard == "02" && lastPayMethod == 'credit') {
			//bc 결제화면 팝업
			$('#preDisc').val('Y');
			$('#discType').val('KJPRE');
			$('#pre_disc_pop').click();
			return;
		}

		//신한 조조
		if (selCard == "02" && selSpCard == "02" && lastPayMethod == 'credit') {
			//bc 결제화면 팝업
			$('#preDisc').val('Y');
			$('#discType').val('SHINHAN');
			$('#shinhan_pop').click();
			shinhan_disc_init();
			return;
		}

		// 구인증
        if(selSpCard == "00" && lastPayMethod == 'credit') {
            favorCreditCard_init();

            var chkRemainAmt = $('.receipt .row.total span').text().replaceAll(',', '');
            if (parseInt(chkRemainAmt) == 0) {
                $('#btn_booking_ria_pay').addClass('disabled');  //리아결제 팝업 오픈 방지
                chkLastPayAmt();
            }
            return;
        }

        // 모바일 결제시 상영월과 결제 월이 다른경우 결제 못하도록
        if($('#paySelect div[data-type="mobile"]').hasClass('act')) {
            var playDe = $('#playDe').text().replaceAll('.', '').substr(4,2);

            var date = new Date();
            var month = date.getMonth()+1; //January is 0!
            if(month < 10){
                month = '0'+month;
            }

            if(playDe != month){

                // 익월 예매건은 휴대폰결제가 불가합니다.\\n다른 결제수단을 이용바랍니다.
                gfn_alertMsgBox('익월 예매건은 휴대폰결제가 불가합니다.\n다른 결제수단을 이용바랍니다.');
                return false;
            }
        }

      	//사파리보안정책에 의해 미리 팝업을 띄운다(사용자 액션스크립트내에서만 호출가능).
     	if((lastPayMethod == 'naverpay' || lastPayMethod == 'chai' || lastPayMethod == 'settlebank') && dS.browser.brwIsSafari() && !dS.browser.brwIsChrome()){
     		openFdkPop();
     	}

        //최종 금액 점검
        chkLastPayAmt();
    }

	//중앙패밀리 조회
	function searchChkJfamily() {
		var transNo    = $("#transNo").val();

		//추후 중앙 그룹ID 적용 필요
		var paramData  = {transNo:transNo, usrId:parent.usrId};

		$.ajax({
	      url: "/on/oh/ohz/PayBooking/searchJoongAngFamily.do",
	      type: "POST",
	      contentType: "application/json;charset=UTF-8",
	      dataType: "json",
		  data: JSON.stringify(paramData),
	      success: function (data, textStatus, jqXHR) {
	      	//console.log(data);
	    	if (!msgBookingLoginChk(data)) {
	    		return;
	    	}

	    	var jfamilyUseAbleAmt = data.jfamilyInfo.useAbleAmt;
			var chkRemainAmt = parseInt($('.receipt .row.total span').text().replaceAll(',', '').nvlNum(0));
			if (jfamilyUseAbleAmt < chkRemainAmt) {
				$('#btn_pay_jfamily').addClass("no-event");
				gfn_alertMsgBox("보유하신 포인트가 결제금액보다 적습니다.");
			} else {

				if ($('#btn_pay_jfamily').hasClass("no-event")) {
					$('#btn_pay_jfamily').removeClass("no-event");
					$('#btn_pay_jfamily').click();
				} else {
					searchJfamily();
				}
			}
	      },
	      error: function(xhr,status,error){
	      	var err = JSON.parse(xhr.responseText);
	      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	      	errBookingChk(err.msg);
	      }
		});
	}


	//결제수단 명칭 세팅
	function changePaymentName(policyList) {
		var text_payment = "";
		var chk_payment  = $('#paySelect .pays.act');

		text_payment = chk_payment.text();

		if (text_payment == null || text_payment == '') {
			text_payment = "JoongAng PAY";
		}

		if(text_payment.indexOf('혜택') > -1){
			text_payment = text_payment.substring(0, text_payment.length-2);
		}


		
			//전체금액
			var allSumAmt = parseInt($('.innerBox > .grayArea').eq(0).find('.last .rt').find('span').text().replaceAll(',', '').nvlNum(0));

			//할인금액
			var allDiscAmt = parseInt($('.innerBox > .grayArea').eq(1).find('.last .rt').find('span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0));

			//추가금액
			var allAddAmt = parseInt($('.receipt .ltrtBox .row.add .rt span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0).replaceAll('+', '').nvlNum(0));
			//최종결제금액
			var remainAmt = allSumAmt + allAddAmt - allDiscAmt;

			//현대M포인트, 문화누리 사용시 별도표기

			//현대 M 포인트, 문화누리 사용시 결제수단 disabled
			var hyCultApply = '';
			var hyCultName  = '';
			if (policyList != null && policyList != undefined) {
				for(var i=0;i<policyList.length;i++) {
					if (('hydm' == policyList[i].methodName || 'culturenuri' == policyList[i].methodName || 'hydm5p' == policyList[i].methodName || 'hydm6p' == policyList[i].methodName)
							&& policyList[i].applyAmt > 0) {
						hyCultApply = policyList[i].methodName;
						break;
					}
				}
			}

		//금액이 0인 경우
		if (remainAmt == 0) {
			$('.receipt .cont .ltrtBox').eq(2).find('.last').hide();
			
			if($('#terms').css('display') != 'none') {
				$('#terms').hide();
			}
		} else {
			$('.receipt .cont .ltrtBox').eq(2).find('.last').show();
			$('.receipt .cont .ltrtBox').eq(2).find('.last .rt').text(text_payment);
		}
		

		

		


		// 국방부 회원은 즉시할인 사용 못하도록 수정
		if($('#tkeYn').val() == 'Y' && $('#entrpMbCd').val() == 'MND'){

			var cardSelectValue = $('#card_select option:selected').val();

			if(cardSelectValue == '01' || cardSelectValue == '90'){
				$('#special_rdo').addClass('display-none');
			}
		}
	}


	//기본 결제 수단 선택 : 2019.11.06 쿠키저장 -> db 저장 방식으로 변경
	function savePaymentSelect() {
		var selectCard  = $("#card_select option:selected").val();
		var selSpCard   = $(':radio[name="rdo_card_select"]:checked').val();

		// if(selectCard == '02' && selSpCard == '02'){
		// 	$(".select-shinhan-info").show();
		// } else {
		// 	$(".select-shinhan-info").hide();
		// }

		if ($("#prepareFavorYn").val() == "Y" && $("#mbIdntfcDivCd").val() == "MEMID01" ) {  // 비회원 예매시 호출 필요없음으로 처리 최초 세팅시는 제외
			//메가박스만 대상
			

			var use_payment = $('#paySelect .pays.act').attr('data-type');

			if(typeof use_payment == 'undefined'){
				// 중앙페이 선택시
				if($('.receipt .cont .ltrtBox').eq(2).find('.last .rt').text() == 'JoongAng PAY'){
					use_payment = 'joongangpay';
				}
			}

			if(use_payment == 'easy') {
				use_payment = $(':radio[name="easy_radio_payment"]:checked').val();
			}

			var favorPayMeanCd;
			var favorCardcmCd;
			var favorCardDiv;

			favorPayMeanCd = use_payment;
			if (use_payment == 'credit') {

				favorCardcmCd = selectCard;
				favorCardDiv  = selSpCard;
			}

			switch (favorPayMeanCd){
		      case "mobile" :
		    	  favorPayMeanCd = "FPM02";
		          break;
		      case "kakaopay" :
		    	  favorPayMeanCd = "FPM03";
		          break;
		      case "payco" :
		    	  favorPayMeanCd = "FPM04";
		          break;
		      case "credit" :
		    	  favorPayMeanCd = "FPM01";
		          break;
		      case "naverpay" :
		    	  favorPayMeanCd = "FPM05";
		          break;
		      case "chai" :
		    	  favorPayMeanCd = "FPM06";
		          break;
		      case "settlebank" :
		    	  favorPayMeanCd = "FPM07";
		          break;
			  case "tosspay" :
				  favorPayMeanCd = "FPM08";
				  break;
			  case "kbpay" :
				  favorPayMeanCd = "FPM09";
				  break;
			  case "joongangpay" :
				  favorPayMeanCd = "FPM10";
				  break;
		      default :
		    	  favorPayMeanCd = "";
		    }

			var paramData  = {favorPayMeanCd:favorPayMeanCd, favorCardcmCd:favorCardcmCd, favorCardDiv:favorCardDiv};

			$.ajax({
		        url: "/on/oh/ohz/PayBooking/saveFavorPayMean.do",
		        type: "POST",
		        contentType: "application/json;charset=UTF-8",
		        dataType: "json",
				data: JSON.stringify(paramData),
		        success: function (data, textStatus, jqXHR) {
		        	//console.log(data);
		        	if (!msgBookingLoginChk(data)) {
		        		return;
		        	}
		        },
		        error: function(xhr,status,error){
		        	var err = JSON.parse(xhr.responseText);
		        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
		        	errBookingChk(err.msg);
		        }
			});
		}
	}


	//화면 초기화(전체 수단 삭제)
	function payRefresh() {
		//적용수단 일괄삭제
		$('#dcBtnList li.act, #pointBtnList li.act').each(function(idx) {
			if (idx == 0) {  //순차적으로 호출
				var sMethodName   = $(this).attr('dispname');
				cancelMbxSellCpInfoAll(sMethodName);
			}
		});

		$("#cashBillYn").val("");
		$("#cashrecIssueCd").val("");
	}


	//적용 할인 결제 수단 일괄 초기화
	function cancelMbxSellCpInfoAll(sMethodName) {
		var transNo       = $("#transNo").val();
		var paramData     = {transNo:transNo, methodName:sMethodName};

		if (sMethodName == "") {
			return;
		}

		//초기화시 순차적용을 위해 sync 처리
		$.ajax({
	        url: "/on/oh/ohz/PayBooking/cancelMbxSellCpInfo.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

				setTicketInfo(data.ticketList);	//베네피아 때문에 티켓정보 수정
				//할인내역 갱신
				if(cardControl && sMethodName=='dcoupon') {
					setMovieDcInfo(data.policyList, '');
				} else {
					setMovieDcInfo(data.policyList);
				}

	        	//각 수단별 팝업 초기화(모든 팝업 공통)
	        	try {
					if(sMethodName == 'happ-display') {	//해피포인트 화면 통합취소
						sMethodName = 'happ';
					} else if(sMethodName == 'hydm-display') {	//해피포인트 화면 통합취소
						sMethodName = 'hyd6m';
					} else if(sMethodName == 'uplus-display') {
						sMethodName = 'uplus';
					} else if(sMethodName == 'hyoil-display') {
						sMethodName = 'hyoil';
					} else if(sMethodName == 'm-cpon-display') {
						sMethodName = 'mgfcard';
					}

					eval(sMethodName+'_init()');
					//삭제버튼 숨김
		        	$('#btn_cancel_'+sMethodName).hide();
					//레이어내 적용취소버튼 숨김
		        	if ($('#btn_cancel_apply_'+sMethodName).length > 0) {
		        		$('#btn_cancel_apply_'+sMethodName).hide();
		        	}

	        	} catch(e){
					//console.log("초기화 대상 없음.....");
	        	}

	        	payRefresh();  //재귀호출
	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);
	        }
		});
	}


	//좌석선택 완료
	function completeSeat() {
		var playSchdlNo   = $("#playSchdlNo").val();
		var seatOccupText = $("#seatOccupText").val();
		var totalAmt      = $("#totalAmt").val();
		var paramData     = {playSchdlNo:playSchdlNo, seatOccupText:seatOccupText, totalAmt:totalAmt};

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/preCompleteSeat.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

	        	$("#transNo").val(data.transNo);

	        	$("#prepareYn").val("Y");  //결제 준비여부세팅

	        	prepareBooking();
	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	errBookingChk(err.msg);
	        }
		});
	}

	//예매 결제 페이지 하단 배너 스와이퍼 기능
	function payBottomBannerSwiper() {
		let mainPayBannerSwiper = new Swiper('.payBannerSwiper', {
			loop: true,
			autoplay: {
				delay: 3000,
				disableOnInteraction: true,
			},
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			}
		});
	}

	//결제 준비
	function prepareBooking() {
		var playSchdlNo   = $("#playSchdlNo").val();
		var seatOccupText = $("#seatOccupText").val();
		var totalAmt      = $("#totalAmt").val();
		var transNo       = $("#transNo").val();
		var entrpMbCd     = $("#entrpMbCd").val();
		var tkeYn         = $("#tkeYn").val();
		var paramData     = {playSchdlNo:playSchdlNo, seatOccupText:seatOccupText, totalAmt:totalAmt, transNo:transNo, entrpMbCd:entrpMbCd, tkeYn:tkeYn};

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/prepareBooking.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);

	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

				if("ERYM" == data.movieMap.timesDivCd && data.ticketList.length <= 2){
					shinhanUseAble = true;
				}

				//베네피아 금액 추가
				$('#benepiaTotalAmt').val(data.returnMap.benepiaTotalAmt);

	        	//블랙리스트 결과 체크
	        	var dataBlackListAt = data.blackMap.result;
				if(dataBlackListAt  == "Y"){
					//블랙리스트 안내 메세지 표시
					var blackListParam = { bokdAbleBrch: data.blackMap.bokdAbleBrch
										 , bokdAbleCnt: data.blackMap.bokdAbleCnt
										 , bokdAbleQty: data.blackMap.bokdAbleQty
										 }

					parent.fn_altBlackgoPrePagePayBooking(blackListParam);  //좌석도로 이동
					return;
				}
				// 기업회원 매수제한 체크
				if (data.entrpMap.entrpBookingLimit == "Y") {
					var entrpParam = { limitTpye: data.entrpMap.limitTpye
									 , entrpBookingLimitMsg: data.entrpMap.entrpBookingLimitMsg
									 , limitCnt: data.entrpMap.limitCnt
									 , type : "entpr"
					}
					parent.fn_altBlackgoPrePagePayBooking(entrpParam);  //좌석도로 이동
					return;
                }

	        	//메가박스 회원인 경우에만 노출
	        	var exist = data.returnMap.mbIdntfcDivCd;
				$('#mbIdntfcDivCd').val(exist);

				// 영화컨텐츠유형
				$('#payPolicCtrl').val(data.returnMap.payPolicCtrl);
				
				if (data.returnMap.mbIdntfcDivCd == "MEMID01") {
					var favorMap = data.favorMap;
					var favorPayMeanCd = "";
					var favorCardcmCd  = "";
					var favorCardDiv   = "";

					if (favorMap != null && favorMap != undefined) {

						switch (favorMap.favorPayMeanCd){
							case "FPM02" :
								favorPayMeanCd = "mobile";
								break;
							case "FPM03" :
								favorPayMeanCd = "kakaopay";
								break;
							case "FPM04" :
								favorPayMeanCd = "payco";
								break;
							case "FPM01" :
								favorPayMeanCd = "credit";
								break;
							case "FPM05" :
								favorPayMeanCd = "naverpay";
								break;
							// case "FPM06" :
							// 	favorPayMeanCd = "chai";
							// 	break;
							case "FPM07" :
								favorPayMeanCd = "settlebank";
								break;
							case "FPM08" :
								favorPayMeanCd = "tosspay";
								break;
							case "FPM09" :
								favorPayMeanCd = "kbpay";
								break;
							case "FPM10" :
								if($('#joongAngPayList').hasClass('nullAdd')){
									favorPayMeanCd = "credit";
								}else{
									favorPayMeanCd = "joongangpay";
								}
								break;
							default :
								favorPayMeanCd = "";
						}

						favorCardcmCd  = favorMap.favorCardcmCd;
						favorCardDiv   = favorMap.favorCardDiv;
					}

					if (data.returnMap.payPolicCtrl == "Y") {
						var bttnOn = false;
						for(var i=0;i<data.policyList.length;i++) {
							var policyMethodName = data.policyList[i].methodName;
							var policyApplyYn = data.policyList[i].useAbleAt;
							var orgAbleAt = data.policyList[i].orgAbleAt;

							if(policyApplyYn == 'Y' && orgAbleAt == 'Y'){
								if(!bttnOn && (policyMethodName == 'credit' || policyMethodName == 'mobile' || policyMethodName == 'settlebank'
										|| arrEasypay.indexOf(policyMethodName) > -1)){
									bttnOn = true;
									$('#lastPayMethod').val(policyMethodName);

									if(arrEasypay.indexOf(policyMethodName) > -1){
										$('#paySelect div[data-type="easy"]').addClass('act');
										$(':radio[name="easy_radio_payment"][value="' + policyMethodName + '"]').prop('checked', true);
									} else {
										$('#paySelect div[data-type="'+ policyMethodName +'"]').addClass('act');
									}

									if(policyMethodName != 'credit'){
										$('#credit-display').addClass('display-none');
									}
								}
							} else {
								if(arrEasypay.indexOf(policyMethodName) == 0 && !$('#paySelect div[data-type="easy"]').hasClass('disab')){
									$('#paySelect div[data-type="easy"]').addClass('disab');
								}

								$('#paySelect div[data-type="'+ policyMethodName +'"]').addClass('disab');
							}
						}
					} else {
						//다음에도 이결제 수단 사용 자동 체크
						if (favorPayMeanCd == null || favorPayMeanCd == '') {
							//기본 신용카드
							$('#paySelect div[data-type="credit"]').addClass('act');
							$('#lastPayMethod').val('credit');
							$('#credit-display').removeClass('display-none');
							$('#rdo_credit_method').addClass('display-none');
						} else {
							var use_payment = favorPayMeanCd;

							if (arrEasypay.indexOf(use_payment) >= 0) {
								$('#paySelect div[data-type="easy"]').addClass('act');
								selEasypay = use_payment;
								$('#credit-display').addClass('display-none');
								$('#easy-display').removeClass('display-none');
								$('#terms').show();
							}

							$(':radio[name="easy_radio_payment"][value="'+use_payment+'"]').prop('checked', true);
							$('#lastPayMethod').val(use_payment);

							if (use_payment == 'credit') {
								var selectCard = favorCardcmCd;
								var selSpCard  = favorCardDiv;

								$("#card_select").val(selectCard);
								// $('.selectpicker').selectpicker('refresh');

								// 변경전 초기화 되었다는 것을 알려준다
								$('#card_select').data('init', selSpCard);
								$('#card_select').trigger('change');

								// 전체카드인경우 라디오버튼 비노출
								if(selectCard == '00'){
									$('#easy-display').addClass('display-none');
									$('#credit-display').removeClass('display-none');
									$('#rdo_credit_method').addClass('display-none');
								} else {
									$('#easy-display').addClass('display-none');
									$('#credit-display').removeClass('display-none');
									$('#rdo_credit_method').removeClass('display-none');
								}

							} else if(use_payment == 'joongangpay'){
								$('.receipt .cont .ltrtBox').eq(2).find('.last .rt').text("JoongAng PAY");
							}
							var totalAmt      = $('.receipt .row.total span').text().replaceAll(',', '').nvlNum(0);
							// 구인증 결제 팝업 기능
							if ( $('#paySelect div[data-type="credit"]').hasClass('act') && $(':radio[name="rdo_card_select"]:checked').val() == '00' && parseInt(totalAmt) >= parseInt(String(minTotalAmt).nvlNum(0))){
								$('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
							} else {
								$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
							}
						}
					}

				} else {
					$('#discount').parent().addClass('display-none');

					$('#paySelect div[data-type="credit"]').addClass('act');
					$('#lastPayMethod').val('credit');
				}

				// 국방부 회원은 즉시할인 사용 못하도록 수정
				if($('#tkeYn').val() == 'Y' && $('#entrpMbCd').val() == 'MND'){

					var cardSelectValue = $('#card_select option:selected').val();

					if(cardSelectValue == '01' || cardSelectValue == '90'){
						$('#special_rdo').addClass('display-none');
					}
				}
				

				$("#prepareFavorYn").val("Y");  //결제 준비여부세팅
				$("#getToday").val(data.getToday);  // 서버날짜
				dcCnt = data.dcCnt;        // 할인쿠폰 갯수
				vipCnt = data.vipCnt;        // vip쿠폰 갯수
				localCmbndCnt = data.localCmbndCnt;        // 메가박스관람권 갯수
				storeCmbndCnt = data.storeCmbndCnt;        // 스토어교환권 갯수
				var promtList = data.promtList;
				var badgeInfo = data.badgeInfo;
				var utilGuideList = data.utilGuideList;

				
				if(badgeInfo.length > 0){
					if(!$('div.pays[data-type="easy"]').hasClass('disab')){
						$('#imgTag').removeClass('display-none');
					}
				}

				
				if(utilGuideList.length > 0){
					$.each(utilGuideList, function(idx, item){
						$('ul[content-paydcmeancd="'+item.payDcMeanCd+'"]').append('<li>' + item.payMeanAtentCn + '</li>');
					});
				}

				//결제수단 안내문구 노출
				if(typeof favorPayMeanCd != 'undefined') {
					var $liTxt = $('ul[value="'+favorPayMeanCd+'"]');
					$('#paymentInfo ul').each(function(){
						var contentPayDcMeanCd = $(this).attr('value');
						if(contentPayDcMeanCd == favorPayMeanCd && $liTxt.hasClass('display-none') && $liTxt.find('li').length > 0){
							$liTxt.removeClass('display-none');
						} else {
							$(this).addClass('display-none');
						}
					});
				}

				
				if(promtList.length > 0){
					var imgPath = 'https://img.megabox.co.kr';
					var html = '';
					$.each(promtList, function(idx, item){
						html += '<div class="item"><div class="img"><img src="'+imgPath+item.imgPathNm+'"></div><div class="txt">'+item.promtCn+'</div></div>';
					});

					$('#promt .inbox').append(html);
					parent.calcFrameHeight($('#bokdMPayBooking', parent.document), $('#framePayBooking', parent.document));
				} else {
					$('#promt').addClass('display-none');
				}


				
				
	        	//영화정보 세팅
	        	setMoiveInfo(data.movieMap);

	        	//좌석정보 세팅 (베네피아 적용시 금액 변경처리 필요)
	        	setTicketInfo(data.ticketList);

	        	//버튼별 정책그룹(할인수단) 사용가능여부 세팅
	        	setButtonPolicyInfo(data.policyList, 'Y');

	        	//최종 결제 금액 적용
	        	setLastPayAmt(data.policyList);

	        	//수단별 알림 문구 노출
	        	fn_dispPayAlertMsg();

				//결제 하단배너 스와이퍼 슬라이딩
				payBottomBannerSwiper();

				parent.calcFrameHeight($('#bokdMPayBooking', parent.document), $('#framePayBooking', parent.document));
	        	

	        	
	        },
			beforeSend: function(){
				gfn_logdingModal();
			},
			complete: function(){
				gfn_logdingModal();
				if($('.receipt .cont .ltrtBox').eq(2).find('.last .rt').text() == 'JoongAng PAY'){
					fn_joongAngPayClick($(".card ")[0]);
				}
			},
	        error: function(xhr,status,error){
				gfn_logdingModal();
	        	var err = JSON.parse(xhr.responseText);
	        	errBookingChk(err.msg);
	        }
		});
	}


	//영화정보 세팅
	function setMoiveInfo(movieInfo) {
		//영화명
		$('#movieNm').html(movieInfo.movieNm);
		$("#movieInfo .movImg img").attr({'src': nvl(movieInfo.atchFileUrl).posterFormat('_150'),'alt': movieInfo.movieNm});

		//관람등급 아이콘
		var admisClassCd = '';
		if (movieInfo.admisClassCd == 'AD01') {
			admisClassCd = 'age-all';
		} else if (movieInfo.admisClassCd == 'AD02') {
			admisClassCd = 'age-12';
		} else if (movieInfo.admisClassCd == 'AD03') {
			admisClassCd = 'age-15';
		} else if (movieInfo.admisClassCd == 'AD04') {
			if(fn_displayAfterPeriod(2024,5,1,'after')) {
				admisClassCd = 'age-19';
			} else {
				admisClassCd = 'age-18';
			}
		} else if (movieInfo.admisClassCd == 'AD05') {
			admisClassCd = 'age-no';
		} else  {
			admisClassCd = 'age-no';
		}

		$('#admisClassNm').addClass(admisClassCd);
		//관람등급
		// $('#admisClassNm').text(movieInfo.admisClassNm);

		//상영종류
		if (movieInfo.movieEventTyNm != undefined && movieInfo.movieEventTyNm != '') {
			$('#playKindNm').html(movieInfo.playKindNm + '/' + movieInfo.movieEventTyNm);
		} else {
			$('#playKindNm').html(movieInfo.playKindNm);
		}
		//지점명
		$('#brchNm').text(gfn_charToHtml(movieInfo.brchNm) + '/' + gfn_charToHtml(movieInfo.theabExpoNm));

		// 지점코드 임시 저장
		$('#brchNo').val(movieInfo.brchNo);

		//상영일자
		$('#playDe').text(movieInfo.playDe.maskDate());
		//상영요일
		$('#dowNm').text('('+movieInfo.dowNm+')');
		//상영요일_CD
		$('#dowCd').text(movieInfo.dowCd);
		//상영시간
		$('#playTime').html('<i class="iconset ico-clock-white"></i>' + movieInfo.playStartTime.maskTime() + '~' + movieInfo.playEndTime.maskTime());

		//지점그룹코드
		$('#areaCd').val(movieInfo.areaCd);

		// 영진위 쿠폰을 위해...
        var playDe = parseInt(movieInfo.playDe);

        if ( playDe >= 20211101 && playDe <= 20211205){
	        $('#movieWonLi').addClass('on');
	        $('#movieWonEm').removeClass('hidden');
        }
	}


	//티켓정보 세팅
	function setTicketInfo(ticketInfo) {
		var sumPlayAmt = 0;	//전체금액
		var dispTicketList = new Array();
		var totalAmt = $("#totalAmt").val();
		$('#ticketCnt').val(ticketInfo.length);        // 티켓갯수
		for(var i=0;i<ticketInfo.length;i++) {
			//console.log("ticket : " + ticketInfo[i]);
			var exist = false;  //기존재여부
			var idx   = 0; 		//기존재순번
			var tempTicketMap;  //티켓정보
			for(var j=0;j<dispTicketList.length;j++) {
				if (dispTicketList[j].ticketKindCd == ticketInfo[i].ticketKindCd) {
					tempTicketMap = dispTicketList[j];
					exist = true;
					idx = j;
					break;
				}
			}

			if (exist) {
				tempTicketMap.playAmt = tempTicketMap.playAmt +  ticketInfo[i].playAmt;
				tempTicketMap.count = tempTicketMap.count +  Number(ticketInfo[i].paySeatToCnt);
				dispTicketList[idx] = tempTicketMap;
			} else {
				var order = 9;
				switch(ticketInfo[i].ticketKindCd) {
					case 'TKA' : order = 1;
					break;
					case 'TKY' : order = 2;
					break;
					case 'TKC' : order = 3;
					break;
					case 'TKO' : order = 4;
					break;
					case 'TKS' : order = 5;
					break;
				}

				tempTicketMap = new Object();
				tempTicketMap.playAmt = ticketInfo[i].playAmt;
				tempTicketMap.ticketKindCd = ticketInfo[i].ticketKindCd;
				tempTicketMap.ticketKindNm = ticketInfo[i].ticketKindNm;
				tempTicketMap.count = Number(ticketInfo[i].paySeatToCnt);
				tempTicketMap.order = order;
				tempTicketMap.benepiaYn = ticketInfo[i].benepiaYn;				// 베네피아 추가
				tempTicketMap.benepiaPlayAmt = ticketInfo[i].benepiaPlayAmt;	// 베네피아 추가
				dispTicketList.push(tempTicketMap);

				if(tempTicketMap.benepiaYn == 'Y'){
					totalAmt = $("#benepiaTotalAmt").val();
				}
			}

			sumPlayAmt += ticketInfo[i].playAmt;
		}	//end of for

		if (totalAmt != sumPlayAmt) {
			gfn_alertMsgBox('999:티켓금액이 일치하지 않습니다.'); //티켓금액이 일치하지 않습니다.
			parent.fn_goPrePagePayBooking();  //좌석도로 이동
		}

		//권종별 sort
		dispTicketList.sort(function(a, b) {
			return b.order - a.order;
		});

		//티켓 권종 영역 삭제
		$('.innerBox > .grayArea').eq(0).find('.row.data').remove();
		$('.movInfo .list > li').eq(3).text('');

		//티켓 권종 영역 추가
		var prependText = "";
		for(var i=0;i<dispTicketList.length;i++) {
			var tickAmt = String(dispTicketList[i].playAmt).maskNumber();
			var rowText = "";

			if($('#tkeYn').val() == "Y"){
				prependText = '<div class="row data"><div class="lt">' + "군인";
				rowText = '군인';
			}else{
				prependText = '<div class="row data"><div class="lt">' + dispTicketList[i].ticketKindNm;
				rowText = dispTicketList[i].ticketKindNm;
			}
			prependText += ' ' + dispTicketList[i].count + '</div>';
			prependText += '<div class="rt"><span>' + tickAmt + '</span></div></div>';
			rowText += ' ' + dispTicketList[i].count;
			if(i!=0) {
				rowText += ('<span class="dotblci"></span>');
			}

			$('.innerBox > .grayArea').eq(0).find('.ltrtBox').prepend(prependText);
			$('.movInfo .list > li').eq(3).prepend(rowText);
		}


		
		
		

		//전체 금액 추가
		$('.innerBox > .grayArea').eq(0).find('.last .rt').find('span').text(String(totalAmt).maskNumber());

		//할인금액 영역 삭제
		$('.innerBox > .grayArea').eq(1).find('.row.data').remove();
		$('.innerBox > .grayArea').eq(1).find('.last .rt').find('span').text(0);

		$('.receipt .ltrtBox .row.total .rt span').text(0);
		$('.receipt .ltrtBox .row.add .rt span').text(0);

	}

	function setButtonPolicyInfo(policyList, gubun) {
		var dcBtnHtml = '';
		var pointBtnHtml = '';
		var cnt = 0;
		var cntHtml = '';

		if(gubun == 'Y') {
			$.each(policyList, function(i, v){
				var disabled = '';
				var cssAct = '';

				if (v.useAbleAt == 'N'){
					disabled = 'disab';

					if(v.payDcMeanCd == '205003' || v.payDcMeanCd == '103003'){
						$('#joongangFamily-display button[data-layer="layer_'+v.payDcMeanCd+'"]').addClass(disabled);
					}
				}

				if((v.meanGrpCd == 'DC' || v.meanGrpCd == 'POINT') && v.scnExpoAt == 'Y'){
					if(v.mappTyCd == 'GRP' && v.lvl == 1){
						if(i == 0){
							$('#neTab').children('a:eq(0)').text(v.expoNm);
						} else {
							$('#neTab').children('a:eq(1)').text(v.expoNm);
						}
						return;
					}

					if (v.payDcMeanCd == '202002' || v.payDcMeanCd == '202001'){
						cnt = v.payDcMeanCd == '202002' ? dcCnt : vipCnt;
						cntHtml = '('+cnt+')';
					} else if (v.payDcMeanCd == '201006' || v.payDcMeanCd == '201003'){
						cnt = v.payDcMeanCd == '201006' ? localCmbndCnt : storeCmbndCnt;
						cntHtml = '('+cnt+')';
					} else if (v.payDcMeanCd == '103001'){
						if(v.useAbleAt == 'Y'){
							$('#giftCardSection').removeClass('display-none');
						} else {
							$('#giftcardBtn').addClass(disabled);
						}
					} else {
						cnt = 0;
						cntHtml = '';
					}

					if(cnt == 0){
						cntHtml = '';
					}

					if(v.meanGrpCd == 'DC' && v.lvl == 3){
						$('#joongangFamily-display button').eq((v.sortOrd-1)).attr('paydcmeancd', 'popup_'+v.payDcMeanCd);
						$('#joongangFamily-display button').eq((v.sortOrd-1)).text(v.expoNm);

						return;
					}

					if(v.meanGrpCd == 'DC'){
						dcBtnHtml += '<li class="btn-modal-open '+disabled+'" paydcmeancd="popup_'+v.payDcMeanCd+'" data-base="'+v.sortOrd+'" data-point="0" dispname="'+v.methodName+'" meanmappid="'+v.meanMappId+'" hrankMeanMappId="'+v.hrankMeanMappId+'" data-layer="layer_'+v.payDcMeanCd+'" w-data="600" h-data="550"><span>' + v.expoNm +'</span><em>'+cntHtml+'</em></li>';
						// if(disabled == 'disab'){
						// 	dcBtnHtml += '<li class="'+disabled+'" paydcmeancd="popup_'+v.payDcMeanCd+'" data-base="'+v.sortOrd+'" data-point="0" dispname="'+v.methodName+'" meanmappid="'+v.meanMappId+'" hrankMeanMappId="'+v.hrankMeanMappId+'"><span></span>' + v.expoNm +'<em>'+cntHtml+'</em></li>';
						// } else {
						// 	dcBtnHtml += '<li class="btn-modal-open '+disabled+'" paydcmeancd="popup_'+v.payDcMeanCd+'" data-base="'+v.sortOrd+'" data-point="0" dispname="'+v.methodName+'" meanmappid="'+v.meanMappId+'" hrankMeanMappId="'+v.hrankMeanMappId+'" data-layer="layer_'+v.methodName+'" w-data="600" h-data="550"><span></span>' + v.expoNm +'<em>'+cntHtml+'</em></li>';
						// }

						// dcBtnHtml += '<li class="'+disabled+'" paydcmeancd="popup_'+v.payDcMeanCd+'" hrankpaydcmeancd="'+v.hrankPayDcMeanCd+'" data-base="'+v.scnExpoOrd+'" data-point="0" dispname="'+v.methodName+'"><span></span>' + v.expoNm +'<em>'+cntHtml+'</em></li>';
					} else if(v.meanGrpCd == 'POINT'){
						if(v.payDcMeanCd == '303008') {
							pointBtnHtml += '<li class="btn-modal-open '+disabled+'" paydcmeancd="popup_'+v.payDcMeanCd+'" data-base="'+v.sortOrd+'" data-point="0" dispname="'+v.methodName+'" meanmappid="'+v.meanMappId+'" hrankMeanMappId="'+v.hrankMeanMappId+'" data-layer="layer_'+v.payDcMeanCd+'" w-data="600" h-data="450"><span>' + v.expoNm +'</span><em>'+cntHtml+'</em></li>';
						} else {
							pointBtnHtml += '<li class="btn-modal-open '+disabled+'" paydcmeancd="popup_'+v.payDcMeanCd+'" data-base="'+v.sortOrd+'" data-point="0" dispname="'+v.methodName+'" meanmappid="'+v.meanMappId+'" hrankMeanMappId="'+v.hrankMeanMappId+'" data-layer="layer_'+v.payDcMeanCd+'" w-data="600" h-data="550"><span>' + v.expoNm +'</span><em>'+cntHtml+'</em></li>';
						}
					}

				} else {

					if(v.lvl == 1 && v.scnExpoAt == 'Y'){
						$('#paySelect div.pays[paydcmeancd="'+v.payDcMeanCd+'"]').attr('data-type', v.methodName);
						$('#paySelect div.pays[paydcmeancd="'+v.payDcMeanCd+'"]').attr('meanmappid', v.meanMappId);
						$('#paySelect div.pays[paydcmeancd="'+v.payDcMeanCd+'"]').attr('hrankmeanmappid', v.hrankMeanMappId);
						$('#paySelect div.pays[paydcmeancd="'+v.payDcMeanCd+'"]').addClass(disabled);

						if(v.payDcMeanCd == '105038'){
							$('#paySelect div.joongPay[paydcmeancd="'+v.payDcMeanCd+'"]').removeClass('display-none');
							$('#paySelect div.joongPay[paydcmeancd="'+v.payDcMeanCd+'"]').find('span.hide').text(v.expoNm);
						} else {
							$('#paySelect div.pays[paydcmeancd="'+v.payDcMeanCd+'"]').text(v.expoNm);
						}

						if(v.payDcMeanCd == '105001'){
							$('#paySelect div.pays[paydcmeancd="'+v.payDcMeanCd+'"]').append('<span class="tag" id="imgTag">혜택</span>');
						}
					} else if(v.lvl == 2 && v.scnExpoAt == 'Y'){

						$('#easy-display :radio[paydcmeancd="'+v.payDcMeanCd+'"]').attr('data-type', v.methodName);
						$('#easy-display :radio[paydcmeancd="'+v.payDcMeanCd+'"]').attr('data-text', v.expoNm);
						$('#easy-display :radio[paydcmeancd="'+v.payDcMeanCd+'"]').attr('meanmappid', v.meanMappId);
						$('#easy-display :radio[paydcmeancd="'+v.payDcMeanCd+'"]').attr('hrankmeanmappid', v.hrankMeanMappId);

						//간편결제 수단 노출, 비활성화 처리
						if(disabled == 'disab') {
							$('#easy-display :radio[paydcmeancd="'+v.payDcMeanCd+'"]').attr('disabled', true);
						}

						var parentEl = $('#easy-display :radio[paydcmeancd="'+v.payDcMeanCd+'"]').closest('.newRadio_1');
						$(parentEl).removeClass('display-none');
					}
				}
			});

			$('#dcBtnList').html(dcBtnHtml);
			$('#pointBtnList').html(pointBtnHtml);

			
			$('#dcBtnList li, #pointBtnList li').on('click', function (e) {
				
				if($(this).hasClass("disab")) {
					return false;
				}

				var dispName = $(this).attr('dispname');

				
				if($(this).hasClass('act')){
					var options       = {};
					options.msg       = '적용 내역을 취소하시겠습니까?';
					options.confirmFn = delApplyMethod;
					options.param     = {confirm:dispName} ;
					options.minWidth  = 400;
					options.minHeight = 300;
					gfn_confirmMsgBox(options);
					return false;
				}

				if($(this).attr('dispname') == 'joongangFamily-display'){
					$('#joongangFamily-display').removeClass('display-none');
					return;
				}

				$('#' + $(this).attr('data-layer') + ' h3.tit').text($(this).find('span').text());

				if(dispName == 'dcoupon') {
					searchDcouponChg('');
				} else if(dispName == 'cmbnd-display') {
					searchMcouponChg();
				} else if(dispName == 'memp') {
					searchMempPoint();
				} else if(dispName == 'jfamily') {
					searchChkJfamily();
				} else if(dispName == 'vipCpon') {
					searchVipCpon('');
				} else if(dispName == 'scoupon') {
					searchStoreChg();
				}
			});

			$('#joongangFamily-display button').on('click', function (e) {
				
				if($(this).hasClass("disab")) {
					return false;
				}
			});

			// 기본 토스페이 act 설정
			$('#easyPay button').each(function(){
				if(!$(this).hasClass('disab')){
					$(this).addClass('act');
					return false;
				}
			});
		} else {
			let uplusDisable = false;

			$.each(policyList, function(i, v){
				var payDcMeanCd = v.payDcMeanCd;

				if(payDcMeanCd == '105038') {
					var $divPays = $('#paySelect div.joongPay[paydcmeancd="'+v.payDcMeanCd+'"]');

					if (v.applyCnt > 0 || v.applyAmt > 0){
						$divPays.addClass('act');
					} else if (v.useAbleAt == 'N'){
						if(!$divPays.hasClass('disab')){
							$divPays.addClass('disab');
						}
						if($divPays.hasClass('act')){
							$divPays.removeClass('act');
						}
					}
				}

				if($('li[meanmappid="'+v.meanMappId+'"]').length > 0){
					if (v.applyCnt > 0 || v.applyAmt > 0){
						$('li[meanmappid="'+v.meanMappId+'"]').addClass('act');

						// 쿠폰, 관람권, 스토어권인 경우 갯수 차감 표시
						if(payDcMeanCd == '202001' || payDcMeanCd == '202002'
								|| payDcMeanCd == '201006' || payDcMeanCd == '201003'){

							var $liem = $('li[meanmappid="'+v.meanMappId+'"]').find('em');

							var cnt = payDcMeanCd == '202001' ? vipCnt-v.applyCponCnt : 0;
							cnt = payDcMeanCd == '202002' ? dcCnt-v.applyCponCnt : cnt;
							cnt = payDcMeanCd == '201003' ? storeCmbndCnt-v.applyCponCnt : cnt;
							cnt = payDcMeanCd == '201006' ? localCmbndCnt-v.applyCponCnt : cnt;

							$liem.text('('+cnt+')');
						}

						if(v.methodName == 'uplus-display' && useUplusYn) {
							uplusDisable = true;
						}
					} else if (v.useAbleAt == 'N' || v.orgAbleAt == 'N'){
						if(!$('li[meanmappid="'+v.meanMappId+'"]').hasClass('disab')){
							$('li[meanmappid="'+v.meanMappId+'"]').addClass('disab');
						}

						if($('li[meanmappid="'+v.meanMappId+'"]').hasClass('act')){
							$('li[meanmappid="'+v.meanMappId+'"]').removeClass('act');

							// 쿠폰, 관람권, 스토어권인 경우 갯수 차감 표시
							if(payDcMeanCd == '202001' || payDcMeanCd == '202002'
									|| payDcMeanCd == '201006' || payDcMeanCd == '201003'){

								var $liem = btnId.find('em');
								var cnt = 0;

								if (payDcMeanCd == '202002' || payDcMeanCd == '202001'){
									cnt = payDcMeanCd == '202002' ? dcCnt : vipCnt;
								} else if (payDcMeanCd == '201006' || payDcMeanCd == '201003'){
									cnt = payDcMeanCd == '201006' ? localCmbndCnt : storeCmbndCnt;
								}
								$liem.text('('+cnt+')');
							}
						}
						//간편결제 사용불가 처리 (orgAbleAt = 0 일때)
						if(payDcMeanCd == '105035' || payDcMeanCd == '105036' || payDcMeanCd == '105037' || payDcMeanCd == '105003' || payDcMeanCd == '105034') {
							$('#easy-display :radio[paydcmeancd="'+payDcMeanCd+'"]').attr('disabled', true);
						}
					}
				}
			});

			if(uplusDisable) {	// 타 제휴 사용불가 처리
				$.each(policyList, function(i, v){
					if($('li[meanmappid="'+v.meanMappId+'"]').length > 0 && v.methodName != 'uplus-display'){
						if(!$('li[meanmappid="'+v.meanMappId+'"]').hasClass('disab')){
							$('li[meanmappid="'+v.meanMappId+'"]').addClass('disab');
						}

						if($('li[meanmappid="'+v.meanMappId+'"]').hasClass('act')){
							$('li[meanmappid="'+v.meanMappId+'"]').removeClass('act');
						}
					}
				});
			}
		}

		//전체금액
		var allSumAmt = parseInt($('.innerBox > .grayArea').eq(0).find('.last .rt').find('span').text().replaceAll(',', '').nvlNum(0));
		//할인금액
		var allDiscAmt = parseInt($('.innerBox > .grayArea').eq(1).find('.last .rt').find('span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0));
		//추가금액
		var allAddAmt = parseInt($('.receipt .ltrtBox .row.add .rt span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0).replaceAll('+', '').nvlNum(0));
		//최종결제금액
		var remainAmt = allSumAmt + allAddAmt - allDiscAmt;

		if ($('#payPolicCtrl').val() == "Y" && remainAmt > 0) {
			var bttnOn = false;
			for(var i=0; i<policyList.length; i++) {
				var policyMethodName = policyList[i].methodName;
				var policyApplyYn = policyList[i].useAbleAt;
				var orgAbleAt = policyList[i].orgAbleAt;

				if(policyApplyYn == 'Y' && orgAbleAt == 'Y'){
					// $(':radio[name*="radio_payment"][value="' + policyMethodName + '"]').attr('disabled', false);
					if(arrEasypay.indexOf(policyMethodName) > -1){
						initTerms();
						$('#paySelect div[data-type="easy"]').removeClass('disab');

						$(':radio[id="rdo_pay_'+ policyMethodName +'"]').prop('disabled', false);
					} else {
						$('#paySelect div[data-type="' + policyMethodName + '"]').removeClass('disab');
					}

					if(!bttnOn && (policyMethodName == 'credit' || policyMethodName == 'mobile' || policyMethodName == 'settlebank'
							|| arrEasypay.indexOf(policyMethodName) > -1)){
						bttnOn = true;
						$('#lastPayMethod').val(policyMethodName);

						if(arrEasypay.indexOf(policyMethodName) > -1) {
							$(':radio[id="rdo_pay_'+ policyMethodName +'"]').click();
						} else {
							$('#paySelect div[data-type="' + policyMethodName + '"]').click();
						}
					}
				} else {
					if(arrEasypay.indexOf(policyMethodName) == 0 && !$('#paySelect div[data-type="easy"]').hasClass('disab')){
						$('#paySelect div[data-type="easy"]').addClass('disab');
					}
					if(policyMethodName == 'credit'){
						$('#credit-display').addClass('display-none');
					}

					if(arrEasypay.indexOf(policyMethodName) > -1) {
						$(':radio[id="rdo_pay_'+ policyMethodName +'"]').prop('disabled', true);
					} else {
						$('#paySelect div[data-type="' + policyMethodName + '"]').addClass('disab');
					}
				}
			}

			if(!bttnOn){
				$('#lastPayMethod').val('');
			}
		}
	}

	
	function setCardPolicyInfo(retCponPayCardPolicList) {
		var arrCard = retCponPayCardPolicList;

		let opSize = $('#card_select option').size();
		let selectBox = document.getElementById('card_select');

		if(arrCard == null || arrCard == '') {		//초기화 - 전체카드 사용가능
			for(let i=1; i<opSize; i++) {
				selectBox[i].hidden = false;
			}
			cardControl = false;
			var selVal = $("#card_select option:selected").val();
			if ( (selVal == "01" || selVal == "23") && $('#payPolicCtrl').val() == 'N') {
				$('#special_rdo').removeClass('display-none');
			}
		} else {
			
			selectBox[0].selected = true;
			$('#paySelect div[data-type="credit"]').click();
			$('#lastPayMethod').val('credit');
			$(':radio[name="rdo_card_select"]:input[value="01"]').prop('checked', true);
			$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
			$('#rdo_credit_method').addClass('display-none');
			// $(".select-kj-info").hide();

			
			for(let i=1; i<opSize; i++) {
				if(arrCard.indexOf('19')!==-1 && selectBox[i].value==='05') {
					continue;
				}

				if(arrCard.indexOf(selectBox[i].value)===-1) {
					selectBox[i].hidden = true;
				}
			}

			cardControl = true;

			$('#paySelect div.pays').each(function(){
				if($(this).attr('data-type') != 'credit'){
					if($(this).hasClass('act')){
						$(this).removeClass('act');
					}

					if(!$(this).hasClass('disab')){
						$(this).addClass('disab');
					}
				} else {
					if(!$(this).hasClass('act')){
						$(this).addClass('act');
					}
				}
			})
		}
		//$('#card_select').selectpicker('refresh');
	}


	//전체 버튼 en/disabled 설정
	function setAllButtonDispInfo(policyList, gubun) {
		if (gubun == 'enable') {
			//할인수단 버튼 disabled
			$.each(policyList, function(j, polic){
				var payDcMeanCd = polic.payDcMeanCd;
				var meanMappId = polic.meanMappId;

				if(polic.useAble == 'Y' || polic.orgAbleAt == 'Y'){
					$('li[meanmappid="'+meanMappId+'"]').removeClass('disab');
				}
			});
            // 중앙페이 적용
            $('.joongPay').removeClass('disab');
		} else if (gubun == 'disable') {
			//할인수단 버튼 disabled
			$.each(policyList, function(j, polic){
				var payMeanMappId = polic.meanMappId;
				var payDcMeanCd = polic.payDcMeanCd;

				if(polic.applyAmt == 0 || polic.applyCnt == 0){
					$('li[meanmappid="'+payMeanMappId+'"]').addClass('disab');
				}
			});

			
			var btnList = $('#paySelect div.pays');
			$.each(btnList, function(i){
				var btnItem = $(this);

				btnItem.addClass('disab');
				btnItem.removeClass('act');
			});

			if($('#lastPayMethod').val() == ''){
				if(!$('#credit-display').hasClass('display-none')){
					$('#crdit-display').addClass('display-none');
				}
			}
            // 중앙페이 적용
            $('.joongPay').addClass('disab');
		}

		// var mobileGiftCard = new Array('gfcon', 'gfshow', 'inumber', 'donut', 'smcon', 'smilecon', 'gmarket');
		// var mCponList = new Array('pcoupon', 'mcoupon');
		// let mHappList = new Array('happ', 'happ5p', 'happ3p');
		// let mHyoilList = new Array('hyoil', 'hyoil3p', 'hyoil5p', 'hyoil7p', 'hyoil11p');
		// let mUplusList = new Array('uplus', 'uplusnew', 'uplusvip', 'uplusvipfree', 'uplusvipplus', 'uplusvipsp1', 'uplusvipsp2');
		//
		// for(var i=0;i<policyList.length;i++) {
		//
		// 	if(mobileGiftCard.indexOf(policyList[i].methodName) > -1 && policyList[i].useAbleAt == 'Y' && policyList[i].orgAbleAt == 'Y'){
		// 		$('#btn_pay_mgfcard').removeClass('disabled');
		// 		break;
		// 	} else if(mobileGiftCard.indexOf(policyList[i].methodName) > -1 && (policyList[i].useAbleAt == 'N' || policyList[i].orgAbleAt == 'N')) {
		// 		$('#btn_pay_mgfcard').addClass('disabled');
		// 	}
		// }
		//
		// for(var i=0;i<policyList.length;i++) {
		// 	if(mCponList.indexOf(policyList[i].methodName) > -1 && policyList[i].useAbleAt == 'Y' && policyList[i].orgAbleAt == 'Y'){
		// 		$('#btn_pay_mcoupon').removeClass('disabled');
		// 		break;
		// 	} else if(mCponList.indexOf(policyList[i].methodName) > -1 && (policyList[i].useAbleAt == 'N' || policyList[i].orgAbleAt == 'N')) {
		// 		$('#btn_pay_mcoupon').addClass('disabled');
		// 	}
		// }
		//
		// for(var i=0;i<policyList.length;i++) {				//해피포인트 2,000/5,000 정책 통합 처리
		// 	if(mHappList.indexOf(policyList[i].methodName) > -1 && policyList[i].useAbleAt == 'Y' && policyList[i].orgAbleAt == 'Y'){
		// 		$('#btn_pay_happ').removeClass('disabled');
		// 		break;
		// 	} else if(mHappList.indexOf(policyList[i].methodName) > -1 && (policyList[i].useAbleAt == 'N' || policyList[i].orgAbleAt == 'N')) {
		// 		$('#btn_pay_happ').addClass('disabled');
		// 	}
		// }
		//
		// for(var i=0;i<policyList.length;i++) {				//해피포인트 2,000/5,000 정책 통합 처리
		// 	if(mHyoilList.indexOf(policyList[i].methodName) > -1 && policyList[i].useAbleAt == 'Y' && policyList[i].orgAbleAt == 'Y'){
		// 		$('#btn_pay_hyoil').removeClass('disabled');
		// 		break;
		// 	} else if(mHyoilList.indexOf(policyList[i].methodName) > -1 && (policyList[i].useAbleAt == 'N' || policyList[i].orgAbleAt == 'N')) {
		// 		$('#btn_pay_hyoil').addClass('disabled');
		// 	}
		// }

		for(var i=0;i<policyList.length;i++) {              //uplus 제휴 적용 여부 체크
			if(policyList[i].methodName == 'uplus-display' && policyList[i].useAbleAt == 'Y' && policyList[i].orgAbleAt == 'Y' && useUplusYn){
				$('li[data-layer="layer_302034"]').removeClass('disab');
				break;
			} else if(policyList[i].methodName == 'uplus-display' && (policyList[i].useAbleAt == 'N' || policyList[i].orgAbleAt == 'N' || !useUplusYn)) {
				$('li[data-layer="layer_302034"]').addClass('disab');
			}
		}
	}


	//최종 결제 금액 적용
	function setLastPayAmt(policyList, retCponPayCardPolicList) {
		//전체금액
		var allSumAmt = parseInt($('.innerBox > .grayArea').eq(0).find('.last .rt').find('span').text().replaceAll(',', '').nvlNum(0));

		//할인금액
		var allDiscAmt = parseInt($('.innerBox > .grayArea').eq(1).find('.last .rt').find('span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0));

		//추가금액
		var allAddAmt = parseInt($('.receipt .ltrtBox .row.add .rt span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0).replaceAll('+', '').nvlNum(0));

		//최종결제금액
		var remainAmt = allSumAmt + allAddAmt - allDiscAmt;
		$('.receipt .ltrtBox .row.total .rt span').text( String(remainAmt).maskNumber() );

		//최종 결제 금액 0인경우 disabled 처리
		if (allSumAmt + allAddAmt - allDiscAmt == 0) {
			setAllButtonDispInfo(policyList, 'disable');

			$('#lastPayMethod').val('');

			$('#credit-display').addClass('display-none');
			$('#easy-display').addClass('display-none');

// 			$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
		} else {
			setAllButtonDispInfo(policyList, 'enable');

			if ($('#payPolicCtrl').val() == "N") {

				var btnList = $('#paySelect div.pays');
				var rdoClickPolicyName = "";

				$.each(btnList, function(i){

					var btnItem = $(this);
					var btnPayDcMeanCd = btnItem.attr('paydcmeancd');
					var btnMeanMappId = btnItem.attr('meanmappid');
					var btnHrankMeanMappId = btnItem.attr('hrankmeanmappid');

					$.each(policyList, function(j, polic){

						var policMeanMappId = polic.meanMappId;
						var policHrankMeanMappId = polic.hrankMeanMappId;
						var policPayDcMeanCd = polic.payDcMeanCd;
						var useAbleAt = polic.useAbleAt;
						var orgAbleAt = polic.orgAbleAt;
						var payMethodName = polic.methodName;


						if(policMeanMappId == btnMeanMappId){
							if(useAbleAt == 'Y' && orgAbleAt == 'Y'){
								btnItem.removeClass("disab");

								if(rdoClickPolicyName == "" || $('#lastPayMethod').val() == payMethodName){
									rdoClickPolicyName = payMethodName;
								}

							} else {
								if(btnItem.hasClass('act')){
									btnItem.removeClass('act');
								}

								if(!btnItem.hasClass('disab')){
									btnItem.addClass('disab');
								}

								if($('#lastPayMethod').val() == payMethodName){
									btnItem.removeClass("act");
									$('#lastPayMethod').val('');
								}
							}
						}
					});
				});

				// 간편결제 인경우만..
				var easyBtnList = $('#easy-display :radio');
				$.each(easyBtnList, function(i){
					var easyBtnItem = $(this);
					var easyBtnPayDcMeanCd = easyBtnItem.attr('value');
					var easyBtnMeanMappId = easyBtnItem.attr('meanmappid');
					var easyBtnHrankMeanMappId = easyBtnItem.attr('hrankmeanmappid');

					$.each(policyList, function(j, polic){

						var payMeanMappId = polic.meanMappId;
						var payHrankMeanMappId = polic.hrankMeanMappId;
						var payDcMeanCd = polic.payDcMeanCd;
						var useAbleAt = polic.useAbleAt;
						var orgAbleAt = polic.orgAbleAt;
						var payMethodName = polic.methodName;

						if(easyBtnMeanMappId == payMeanMappId){
							if(useAbleAt == 'N' || orgAbleAt == 'N') {
								easyBtnItem.attr("disabled", true);
							} else {
								easyBtnItem.attr("disabled", false);

								if(rdoClickPolicyName == "" || $('#lastPayMethod').val() == easyBtnPayDcMeanCd || rdoClickPolicyName == 'easy'){
									rdoClickPolicyName = easyBtnPayDcMeanCd;
								}
							}
						}

					});
				});

				// 적용 후 적용취소시 결제수단이 비활성화 후 사용가능처리인경우에 활성화 표시 추가
				if($('#lastPayMethod').val() != ''){
					var lasPayMethod = $('#lastPayMethod').val();
					if(!$('#paySelect div[data-type="'+lasPayMethod+'"]').hasClass('act')){
						$('#paySelect div[data-type="'+lasPayMethod+'"]').addClass('act');
					}
				}

				if($('#paySelect div[data-type="credit"]').hasClass('disab')){
					if(!$('#easy-display').hasClass('display-none')){
						$('#easy-display').addClass('display-none');
					}
				}

				if($('#paySelect div[data-type="easy"]').hasClass('disab')){
					if(!$('#credit-display').hasClass('display-none')){
						$('#credit-display').addClass('display-none');
					}
				}

				if($(':radio[name="easy_radio_payment"][value="'+ rdoClickPolicyName +'"]').length > 0 ) {
					$('#paySelect div[data-type="easy"]').trigger("click");
					$(':radio[name="easy_radio_payment"][value="'+ rdoClickPolicyName +'"]').click();
				} else {
					$('#paySelect div[data-type="'+ rdoClickPolicyName +'"]').click();
				}
			}
		}

		// 구인증 결제 팝업 기능
		if ( $('#paySelect div[data-type="credit"]').hasClass('act') && $(':radio[name="rdo_card_select"]:checked').val() == '00' && parseInt(remainAmt) >= parseInt(String(minTotalAmt).nvlNum(0))){
			$('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
		} else {
			$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
		}

		//실시간 변경
		setButtonPolicyInfo(policyList, 'N');
		if(retCponPayCardPolicList != null) {		//제약 조건 있을 때만 호출
			setCardPolicyInfo(retCponPayCardPolicList);
		}

		//현대 M 포인트, 문화누리 사용시 결제수단 disabled
		var hyCultApply = '';
		for(var i=0;i<policyList.length;i++) {
			if (('hydm' == policyList[i].methodName || 'hydm5p' == policyList[i].methodName || 'hydm6p' == policyList[i].methodName || 'culturenuri' == policyList[i].methodName)
					&& policyList[i].applyAmt > 0) {
				hyCultApply = policyList[i].methodName;
				break;
			}
		}

		//현대 M포인트 사용시 아너스카드제어
		// for(let i=0; i<policyList.length; i++) {
		// 	if(('hydm' == policyList[i].methodName || 'hydm5p' == policyList[i].methodName || 'hydm6p' == policyList[i].methodName) && policyList[i].applyAmt > 0) {
		// 		$('#btn_pay_annusgift').addClass('disabled');
		// 		break;
		// 	}
		// }

		if (hyCultApply != '') {
			//$('.select-payment > button').attr('disabled', true);
			$('#paySelect .pays.act').removeClass('act');

			if ('hydm' == hyCultApply || 'hydm5p' == hyCultApply || 'hydm6p' == hyCultApply) {
				$('#btn_pay_culturenuri').addClass('disabled');
				$('#btn_pay_'+hyCultApply).removeClass('disabled');
			} else {
				$('#btn_pay_hydm').addClass('disabled');
				$('#btn_pay_hydm5p').addClass('disabled');
				$('#btn_pay_hydm6p').addClass('disabled');
				$('#btn_pay_culturenuri').removeClass('disabled');
			}

			if(hyCultApply == 'culturenuri' && $('#cultNaverYn').val() == 'Y' && remainAmt > 0){
				// $('#credit-display').addClass('display-none');
				$('#paySelect div[data-type="easy"]').removeClass('disab');
				$('#paySelect div[data-type="easy"]').click();
				$(':input[name="easy_radio_payment"]').attr('disabled', true);
				$('#rdo_pay_naverpay').attr('disabled', false);
				$('#rdo_pay_naverpay').click();
				$('#lastPayMethod').val('naverpay');
				$('#cultNaverYn').val('Y');
			} else {
				$('#easy-display').addClass('display-none');
				$('#paySelect div[data-type="credit"]').removeClass('disab');
				$('#paySelect div[data-type="credit"]').click();

				if(hyCultApply == 'culturenuri') {
					$('#card_select option[value="12"]').prop("selected", true);
				} else {
					$('#card_select option[value="04"]').prop("selected", true);
				}
				$('#rdo_credit_method').addClass('display-none');
				$('#card_select').attr("disabled", true);
				$('#lastPayMethod').val('credit');
				$('#cultNaverYn').val('N');
			}

			//수단별 알림 문구 노출
        	fn_dispPayAlertMsg();
		}

    	//최종 결제수단 명칭 세팅
    	changePaymentName(policyList);

	}


	//할인내역 적용
	function setMovieDcInfo(policyList, retCponPolicMap) {
		var prependText = '';
		var sumApplyAmt = 0;
		var sumAddAmt   = 0;
		var retCponPayCardPolicList = null;
		if(retCponPolicMap != null) {
			minTotalAmt = String(retCponPolicMap.retMinTotalAmt).nvlNum(0);
			retCponPayCardPolicList = retCponPolicMap.retCponPayCardPolicList;
		}
		if(retCponPolicMap == '') {
			minTotalAmt = 0;
			retCponPayCardPolicList = '';
		}

		var mobileGiftCard = new Array('gfcon', 'gfshow', 'inumber', 'donut', 'smcon', 'smilecon', 'gmarket');
		var mCponList = new Array('pcoupon', 'mcoupon');
        let mHappList = new Array('happ', 'happ5p', 'happ3p');
		let mHyoilList = new Array('hyoil', 'hyoil3p', 'hyoil5p', 'hyoil7p', 'hyoil11p');
		let mUplusList = new Array('uplus', 'uplusnew', 'uplusvip', 'uplusvipfree', 'uplusvipplus', 'uplusvipsp1', 'uplusvipsp2');
		var mobileGiftCardCnt = 0;
		var mCponCnt = 0;
        let mHappCnt = 0;
		let mHyoilCnt = 0;
		let mUplusCnt = 0;
		let applyCntYn = 0;         //다른 제휴 적용시 사용 불가(2매 -> 1매 uplus, 1매 B제휴)

		var paydcmeancdArray = new Array('201004', '201005', '301002', '301003', '301004', '301005', '301006', '301007', '301008');

        $('.grayArea.bot .ltrtBox .row.data').remove();
		$.each(policyList, function (i, item) {
			var applyAmt = item.applyAmt;
			var applyCnt = item.applyCnt;
			var applyCponCnt = item.applyCponCnt;
			var methodName = item.methodName;
			var payDcMeanCd = item.payDcMeanCd;
			var dcAdoptDivCd = item.dcAdoptDivCd;
			var meanMappId = item.meanMappId;

			var btnId = $('li[meanmappid="'+meanMappId+'"]');

			if (applyAmt > 0 || applyCnt > 0) {
				
				if (item.applyAddAmt != null && item.applyAddAmt != undefined) {
					sumAddAmt += item.applyAddAmt;
				}

				if((btnId.length > 0 && payDcMeanCd != '201006' && payDcMeanCd != '301001') || paydcmeancdArray.indexOf(payDcMeanCd) > -1){
					sumApplyAmt += item.applyAmt;
				}

				if(item.execType != 'UPLUS' && methodName != 'uplus-display' && methodName != 'giftcard' && methodName != 'annusgift') {    //다른 제휴 같이 사용 불가
					applyCntYn++;
				}

				if(item.mappTyCd != 'GRP') {
					prependText = '<div class="row data"><div class="lt">' + policyList[i].meanPrnNm;
					if (item.cponType == 'CMBND' || item.cponType == 'CPON') {
						prependText += ' ' + item.applyCponCnt + '매</div>';
					} else {
						prependText += ' ' + item.applyCnt + '매</div>';
					}

					prependText += '<div class="rt"><span>' + String(item.applyAmt).maskNumber() + '</span> 원</div>';
					$('.grayArea.bot .ltrtBox').prepend(prependText);
				}

			} else {
				if(btnId.hasClass('act')){
					btnId.removeClass('act');

					// 쿠폰, 관람권, 스토어권인 경우 갯수 차감 표시
					if(payDcMeanCd == '202001' || payDcMeanCd == '202002'
							|| payDcMeanCd == '201006' || payDcMeanCd == '201003'){

						var $liem = btnId.find('em');
						var cnt = 0;

						if (payDcMeanCd == '202002' || payDcMeanCd == '202001'){
							cnt = payDcMeanCd == '202002' ? dcCnt : vipCnt;
						} else if (payDcMeanCd == '201006' || payDcMeanCd == '201003'){
							cnt = payDcMeanCd == '201006' ? localCmbndCnt : storeCmbndCnt;
						}
						$liem.text('('+cnt+')');
					}
				}

				if ( $('#paySelect div[data-type="credit"]').hasClass('act') && $(':radio[name="rdo_card_select"]:checked').val() == '00'){
					$('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
				} else {
					$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
				}
			}

			// 문화누리, 현대M포인트는 바로 결제 되도록
			if( methodName == 'hydm6p' || methodName == 'culturenuri'){
				$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
			}
		});

		$('.grayArea.bot .row.last .rt span').text(sumApplyAmt==0?'0':'-'+String(sumApplyAmt).maskNumber());

		//추가결제금액
		if (sumAddAmt > 0) {
			$('.receipt .ltrtBox .row.add .rt span').text( '+' + String(sumAddAmt).maskNumber() );
		} else {
			$('.receipt .ltrtBox .row.add .rt span').text( '0' );
		}

		if(applyCntYn > 0) {	//uplus 사용 가능 여부
			useUplusYn = false;
		} else {
			useUplusYn = true;
		}

		//최종 결제 금액 적용
		setLastPayAmt(policyList, retCponPayCardPolicList);

		//삭제 이벤트 적용
		setCancelEvent();

		if ($('#pre_disc_all_text').text() != '') {  //bc 선할인 초기화
			pre_disc_init();
		}
	}


	//적용 수단 삭제 callback함수
	function delApplyMethod(sMethodName) {
		if (sMethodName != undefined && sMethodName != ''){
			cancelMbxSellCpInfo(sMethodName);
		}
	}


	//삭제 적용 (공통)
	function cancelMbxSellCpInfo(sMethodName) {
		//쿠폰 다건 적용시 적용 불가능한 쿠폰 있을 경우 체크
		var flag = false;
		if(sMethodName == "cancelCoupon") {
			sMethodName = "dcoupon";
			flag = true;
		}

		var transNo       = $("#transNo").val();
		var paramData     = {transNo:transNo, methodName:sMethodName};

		if (sMethodName == "") {
			return;
		}

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/cancelMbxSellCpInfo.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

				
				if(sMethodName == 'hydm' || sMethodName == 'hydm5p' || sMethodName == 'hydm6p') {
					hyCultApply = '';
				} else if (sMethodName == 'culturenuri') {
					hyCultApply = '';
					$('#cultNaverYn').val('N');
				}

	        	//티켓정보 수정
				setTicketInfo(data.ticketList);
				//할인내역 갱신
				if(cardControl && sMethodName=='dcoupon') {
					setMovieDcInfo(data.policyList, '');
				} else {
					setMovieDcInfo(data.policyList);
				}

	        	//각 수단별 팝업 초기화(모든 팝업 공통)
	        	try {
					if(sMethodName == 'happ-display') {		//해피포인트 2,000/3,000/5,000 정책 통합 처리
						sMethodName = 'happ';
					} else if(sMethodName == 'hyoil-display') {		//현대오일뱅크 정책 통합 처리
						sMethodName = 'hyoil';
					} else if(sMethodName == 'hydm-display') {
						sMethodName = 'hydm6p';
					} else if(sMethodName == 'uplus-display') {		//uplus 멤버십 정책 통합 처리
						sMethodName = 'uplus';
					} else if(sMethodName == 'm-cpon-display') {
						sMethodName = 'mgfcard';
					} else if(sMethodName == 'cmbnd-display') {
						sMethodName = 'mcoupon';
					}

					//현대 M포인트 취소시 아너스카드 사용처리
					if(sMethodName == 'hydm' || sMethodName == 'hydm6p' || sMethodName == 'hydm5p') {
						$('#btn_pay_annusgift').removeClass('disabled');
						$('#card_select').attr('disabled', false);
					}
					if(sMethodName == 'culturenuri') {
						$('#card_select').attr('disabled', false);
					}

					

					if(sMethodName == 'joongangFamily-display') {
						if ($('#btn_cancel_apply_friends').length > 0) {
							eval('friends_init()');
							$('#btn_cancel_apply_friends').hide();
						}
						if ($('#btn_cancel_apply_annusgift').length > 0) {
							eval('annusgift_init()');
							$('#btn_cancel_apply_annusgift').hide();
						}
					} else {
						if(!flag) {
							eval(sMethodName+'_init()');
						}
						//삭제버튼 숨김
						$('#btn_cancel_'+sMethodName).hide();
						//레이어내 적용취소버튼 숨김
						if ($('#btn_cancel_apply_'+sMethodName).length > 0) {
							$('#btn_cancel_apply_'+sMethodName).hide();
						}
					}

					if (!$('#paySelect div[data-type="credit"]').hasClass('disab') && $('#paySelect div[data-type="credit"]').hasClass('act')
							&& $(':radio[name="rdo_card_select"]:checked').val() == '00') {
						$('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
					} else {
						$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
					}

	        	} catch(e){
					//console.log("초기화 대상 없음.....");
	        	}
	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);
	        }
		});
	}


	//삭제버튼 이벤트 적용 (공통)
	function setCancelEvent() {
		//삭제 버튼 이벤트 적용
		$('.btn-delete').off('click');

		//삭제 버튼 이벤트 적용
		$('.btn-delete').on('click', function() {
			var sMethodName   = $(this).attr('method');
			var options       = {};
			options.msg       = '적용 내역을 취소하시겠습니까?';
			options.confirmFn = delApplyMethod;
			options.param     = {confirm:sMethodName} ;
			options.minWidth  = 400;
			options.minHeight = 300;
			gfn_confirmMsgBox(options);
		});
	}

	function chkPrePayAmt(){
		var transNo       = $("#transNo").val();
		var paramData     = {transNo:transNo};

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/chkPrePayAmt.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);

	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

	        	$('#pre_disc_pop').click();

	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);
	        }
		});
	}

	//최종결제 금액 유효성 검사
	function chkLastPayAmt(option) {
		var transNo       = $("#transNo").val();
		var lastPayMethod = $('#lastPayMethod').val();
		var paramData     = {transNo:transNo, lastPayMethod:lastPayMethod};
		var discType      = $('#discType').val();

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/chkLastPayAmt.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);

	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}
	        	// $('#btn_booking_ria_pay').removeClass('disabled');  //리아결제 팝업 오픈 해제
	        	var lastPayInfo = data.lastPayInfo;
	        	if (lastPayInfo != null && lastPayInfo != undefined) {
	        		var remainAmt    = lastPayInfo.remainAmt;
	        		var chkRemainAmt = $('.receipt .row.total span').text().replaceAll(',', '');

	        		if (String(chkRemainAmt) != String(remainAmt)) {
	        			closeFdkPop();
	        			//결제금액이 일치하지 않습니다.
	        			gfn_alertMsgBox('결제금액이 일치하지 않습니다.');
						btnEvent('error');
	        			return;
	        		}

	        		if (lastPayMethod == 'credit' || lastPayMethod == 'mobile' || lastPayMethod == 'kakaopay' || lastPayMethod == 'payco' || lastPayMethod == 'naverpay' ||
							lastPayMethod == 'chai' || lastPayMethod == 'settlebank' || lastPayMethod == 'tosspay' || lastPayMethod == 'kbpay' || lastPayMethod == 'joongangpay')  {
	        			//결제 금액이 0 이상인 경우
	        			if (discType != 'HYUNM' && discType != 'CULTURE' && discType != 'TELLER') {	//현대M포인트, 문화누리 사용시 금액이 0일 수 있음
	        				if (remainAmt == 0) {
	        					closeFdkPop();
			        			//결제버튼을 선택하세요
			        			gfn_alertMsgBox('결제 버튼을 클릭 하세요.');
								btnEvent('error');
			        			return;
			        		}

	        				//카드사 선택 필수
	        				if (lastPayMethod == 'credit' && $("#card_select option:selected").val() == "00" && remainAmt > 0) {
								//결제하실 카드를 선택하세요
								gfn_alertMsgBox('결제하실 카드를 선택하세요.');
								$("#card_select").focus();
								btnEvent('error');
			        			return;
	        				}

	        				//네이버페이 최소결제금액 100원 사용자안내 처리
	        				if ((lastPayMethod == 'naverpay' || lastPayMethod == 'chai') && remainAmt < 100) {
	        					closeFdkPop();
	        					//결제하실 카드를 선택하세요
			        			gfn_alertMsgBox('최소 결제금액은 100원 입니다.');
			        			btnEvent('error');
			        			return;
	        				}
	        			}

	        		} else {
	        			//결제 금액이 0 이상인 경우
		        		if (remainAmt > 0 && lastPayMethod != 'shinhan') {
		        			closeFdkPop();
							if('Y' == $('#payPolicCtrl').val()) {		// 영화컨텐츠유형 정책 별로 결제수단 제어
								gfn_alertMsgBox('결제하실 관람권/스토어교환권을 선택하세요.');
							} else {
								//결제하지 않은 금액이 있습니다. \\n결제 수단을 선택해주세요.
								gfn_alertMsgBox('결제하지 않은 금액이 있습니다. \n결제 수단을 선택해주세요.');
							}
							if(remainAmt < parseInt(String(minTotalAmt).nvlNum(0))) {
								$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
							}
							btnEvent('error');
		        			return;
		        		}
	        		}
        			//현금영수증 팝업
        			chkCshRec(option);
	        	}

	        }, beforeSend : function() {
                btnEvent('beforeSend');
	      	}, error: function(xhr,status,error){
	      		closeFdkPop();
                btnEvent('error');

	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);
	        }
		});
	}


	//현금 영수증 팝업 여부 체크
	function chkCshRec(option) {
		var transNo       = $("#transNo").val();
		var paramData     = {transNo:transNo};
		var lastPayMethod = $('#lastPayMethod').val();
		var preDisc       = $('#preDisc').val();

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/chkCshRecAt.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

	        	$('#cashBillYn').val('N');
        		$('#cashrecIssueCd').val('');
	        	var cshRecInfo = data.cshRecInfo;

	        	if (cshRecInfo != null && cshRecInfo != undefined) {
	        		var tktCashrecAmt = cshRecInfo.tktCashrecAmt;

					//현금 영수증 금액이 0 이상인 경우
	        		if (tktCashrecAmt > 0) {
	        			precash_option = option;  //현금 영수증에 option 정보를 넘긴다.
	        			$('#cashBillAmt').text(String(tktCashrecAmt).maskNumber()+'원');
	        			$('#cash_pop').click();
	        		} else {
	        			//예매번호 생성
	        			payBokdNoProc(option);
	        		}
	        	}
	        },
	        error: function(xhr,status,error){
	        	closeFdkPop();
	        	btnEvent('error');
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	$('#cashBillYn').val('N');
        		$('#cashrecIssueCd').val('');
        		errBookingChk(err.msg);
	        }
		});
	}


	//예매번호 생성
	function payBokdNoProc(option) {
		var transNo       = $("#transNo").val();
		var lastPayMethod = $('#lastPayMethod').val();
		var preDisc       = $('#preDisc').val();
		var discType      = $('#discType').val();
		var tellerFee     = $('#tellerFee').val();
		var chkRemainAmt = $('.receipt .row.total span').text().replaceAll(',', '');

		var paramData = { transNo:transNo, lastPayMethod:lastPayMethod, preDisc:preDisc, discType:discType, tellerFee:tellerFee };

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/selectBokdNo.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

	        	if (data.statCd != "0") {
	        		closeFdkPop();
	        		gfn_alertMsgBox(data.msg);

	        		btnEvent('error');
	        	} else {
	        		//결제 실행
	        		if (((lastPayMethod == "credit" || lastPayMethod == "mobile" || lastPayMethod == 'kakaopay' || lastPayMethod == 'payco' || lastPayMethod == 'naverpay') && preDisc != "Y")
	        			|| lastPayMethod == 'chai' || lastPayMethod == 'settlebank' || lastPayMethod == 'tosspay' || lastPayMethod == 'kbpay') {
	        			fdkPayProc();
	        		} else if(lastPayMethod == 'joongangpay'){
						// 중앙페이 결제시 거래등록 후 결제 인증 페이지 호출한다.
						fn_joongAngPayAuthReg("BOKD");
	        		} else {
	        			//로딩 생성
	        			gfn_logdingModal();

	        			if (preDisc == "Y" && parseInt(chkRemainAmt) > 0) {	//bc는 무조건 0이상(선할인은 결제 금액에 포함)
	        				applyPreCreditCard(option);
	        			} else {
	        				execBookingPayment();
	        			}
	        		}
	        	}
	        },
	        error: function(xhr,status,error){
	        	closeFdkPop();
	        	btnEvent('error');

	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);
	        	cancelMbxSellCpInfo($('#lastPayMethod').val());
	        }
		});
	}


	//선할인 카드 적용
	function applyPreCreditCard(option) {
		var transNo    = $("#transNo").val();
		var useAmt     = $('.receipt .row.total span').text().replaceAll(',', '');
		var preDisc    = $('#preDisc').val();
		var discType   = $('#discType').val();
		var cardCd	   = $("#card_select option:selected").val();

		/*
		카드번호 등 세팅필요
		*/
		var paramData  = { transNo:transNo, useAmt:useAmt, preDisc:preDisc, discType:discType, cardCd:cardCd };
		$.extend(paramData, option);

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/applyPreCreditCard.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

	        	execBookingPayment();
	        },
	        error: function(xhr,status,error){
	        	btnEvent('error');

	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	//로딩 삭제
        		gfn_logdingModal();

	        	errBookingChk(err.msg);
	        	cancelMbxSellCpInfo($('#lastPayMethod').val());
	        }
		});
	}


	//최종 결제 실행
	function execBookingPayment() {
		var transNo         = $("#transNo").val();
		var cashBillYn      = $('#cashBillYn').val();
		var cashrecIssueCd  = $('#cashrecIssueCd').val();
		var bizmDivCd       = $(':radio[name="bizmDivCd"]:checked').val();
		var cashBillPhoneNo = $('#cashBillPhoneNo').val();
		var cashrecPubAmt   = $('#cashBillAmt').text().replaceAll(',', '').replaceAll('원', '');
		var preDisc         = $('#preDisc').val();
		var cardNm          = $('#card_select option:selected').text();
		var cardCd	        = $("#card_select option:selected").val();
		var cardLimit		= cardControl ? 'Y' : 'N';

		var paramData = { transNo:transNo, cashBillYn:cashBillYn,
				          cashrecIssueCd:cashrecIssueCd, bizmDivCd:bizmDivCd, cashBillPhoneNo:cashBillPhoneNo, cashrecPubAmt:cashrecPubAmt , preDisc:preDisc, cardCd: cardCd, cardLimit: cardLimit};

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/execBookingPayment.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	remainAmt = data.returnMap.remainAmt;
				if (data.statCd == "-777" && loginErrorMessageCount == 0) {
					loginErrorMessageCount++;
					closeFdkPop();
					AppHandler.Common.alert(gfn_scrtDecode(data.msg));

					return false;
				} else if (data.statCd == "0") {
					try {
						var chkAddAmt = data.returnMap.chkAddAmt;
						if (chkAddAmt > 0) {
							alert('해당 관람권은 '+String(chkAddAmt).maskNumber()+'원 추가금액 지불시\n관람이 가능합니다.')
						}
					} catch(e) {
						//console.log(e);
					}
				} else if (data.statCd != "0") {
	        		//로딩 삭제
        			gfn_logdingModal();

	        		
	        		data.msg = data.msg || '';
	        		var prefix = data.msg.split(':');
	        		if(data.msg.indexOf('결제키 기간경과')>=0){
	        			gfn_alertMsgBox(prefix[0] + ' : 잔액 재조회 후 이용 바랍니다.(결제키 기간경과)');
	        		}else if(data.msg.indexOf('결제불가 상품권 존재')>=0){
	        			gfn_alertMsgBox(prefix[0] + ' : 상품권 정보를 재확인 바랍니다.(결제불가 상품권 존재)');
	        		}else if(data.msg.indexOf('상품권잔액부족')>=0){
	        			gfn_alertMsgBox(prefix[0] + ' : 상품권 정보를 재확인 바랍니다.(상품권 잔액부족)');
	        		}else if(data.msg.indexOf('네이버페이 : Fail')>=0){
	        			gfn_alertMsgBox('결제승인에 실패했습니다.\n타 결제수단 시도 또는 고객센터로 문의바랍니다.');
	        		}else if(data.msg.indexOf("카드사 조회 불일치")>=0) {		//카드사 제약 쿠폰 적용/미적용
						if(!cardControl) {
							gfn_alertMsgBox('선택한 카드와 일치하지 않습니다. ['+cardNm+'] 로 결제 바랍니다.');
						} else {
							gfn_alertMsgBox('쿠폰 사용 조건이 맞지 않습니다. ['+cardNm+'] 로 결제 바랍니다.');
						}
					} else{
	        			gfn_alertMsgBox(data.msg);
	        		}

					//아너스카드 금액 추가 > 0 큰경우
					if(annusGiftAmt > 0 && $('#lastPayMethod').val() != 'annusgift') {
						cancelMbxSellCpInfo('annusgift');
					}
	        		cancelMbxSellCpInfo($('#lastPayMethod').val());
	        		//경우에 따라서 back 등 결정 필요

	        		btnEvent('error');

	        		return;
	        	}

	        	//예매 완료 페이지 이동
	        	goCompleteBooking();

	        }, beforeSend : function() {
	        	btnEvent('beforeSend');
	      	}, error: function(xhr,status,error){
	      		btnEvent('error');

	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	//로딩 삭제
	        	gfn_logdingModal();

	        	errBookingChk(err.msg);
	        	cancelMbxSellCpInfo($('#lastPayMethod').val());
	        }
		});
	}


	//초기화, 이전화면 이동(좌석 선점 취소는 beforeunload 로 이동)
	function initOccupSeat(gubun) {
		if (gubun == 'refresh') {
    		payRefresh();
    	} else {
    		goPrePageInitSeat();
    	}
	}


	//메시지 체크
	function msgBookingLoginChk(data) {
		//알림메시지 노출
		if (data.statCd == "-777") {  //비로그인
			closeFdkPop();
			//메가박스는 예매 또는 상영스케쥴로 이동
			
				gfn_alertMsgBox({ msg: data.msg, callback:goBookingFrist });
			
			//리아는 예매창 닫고 다시 진행 alert
			

			return false;
    	} else if (data.statCd == "0") {
    		try {
	    		var chkAddAmt = data.returnMap.chkAddAmt;
	    		if (chkAddAmt > 0) {
	    			gfn_alertMsgBox('해당 관람권은 '+String(chkAddAmt).maskNumber()+'원 추가금액 지불시\n관람이 가능합니다.')

	    		}
    		} catch(e) {
    			//console.log("추가금액 누락.....");
    		}
    	} else if (data.statCd == "-1") {
			gfn_alertMsgBox(data.msg);
			return false;
		}

		return true;
	}


	//오류메시지 체크 : 999 로 시작되는 오류 메시지 처음페이지로 리턴
	function errBookingChk(msg) {
		//알림메시지 노출
		if (msg != null && msg != "") {
			if (msg.indexOf("999:") == 0) {  //온라인 999 좌석도로
				var almsg = msg.substring(4, msg.length).replaceAll('9999:', '');
				if (almsg == "msg.pay.overPayTime") {  //결제가능 시간이 초과되어 좌석선택부터 다시 진행바랍니다. 메시지는 예매화면에서 팝업한다.(ria 체크 필요)
					//goPrePageInitSeat('BookingPay_msg94');
					gfn_alertMsgBox({ msg: '결제가능시간이 초과되어 스케쥴로 이동합니다. <br/>다시 이용바랍니다.', callback:goBookingFrist });
				} else if (almsg == "msg.pay.over.session") {  //결제가능 시간이 초과되어 좌석선택부터 다시 진행바랍니다. 메시지는 예매화면에서 팝업한다.(ria 체크 필요)
					
						var sessMsg = "로그인 가능시간이 초과되었습니다.<br/> 재 로그인 후 이용 바랍니다.";
						gfn_alertMsgBox({ msg: sessMsg, callback:goBookingFrist });
					
					
				} else {
					gfn_alertMsgBox({ msg: almsg, callback:goPrePageInitSeat });
				}
			} else if (msg.indexOf("888:") == 0) {  //온라인 888 예매 처음으로
				var almsg = msg.substring(4, msg.length).replaceAll('9999:', '');
				gfn_alertMsgBox({ msg: almsg, callback:goBookingFrist });
			} else {
				if (msg.indexOf("9999:") == 0) {  //현장용. 9999 제외 메시지 노출
					var almsg = msg.substring(5, msg.length);
					gfn_alertMsgBox({ msg: almsg });
				} else {
					gfn_alertMsgBox({ msg: msg,  minWidth:450 });
				}
			}
		}
	}


	//예매 페이지 이동
	function goBookingFrist(msg) {
		

		//parent.fn_goPrePagePcntSeatChoi(msg); //예매 페이지로 이동
		//예매 페이지 또는 상영스케쥴로 이동
		parent.fn_bokdReload('/booking');

	}


	//좌석도 페이지 이동
	function goPrePageInitSeat(msg) {
		$("#goBackYn").val("Y");
		var transNo = $("#transNo").val();
		var paramData = { transNo:transNo };
		$.ajax({
	        url: "/on/oh/ohz/PayBooking/initOccupSeat.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	parent.fn_goPrePageInitSeat(msg);  //좌석도 페이지로 이동(초기화)
	        },
	        error: function(xhr,status,error){
	        	//오류 발생시도 이전으로 이동
	        	parent.fn_goPrePageInitSeat(msg);  //좌석도 페이지로 이동(초기화)
	        }
		});
	}


	//쿠키설정
	function fn_setCookie(cname, cvalue, exdays) {
		var d = new Date();
		d.setTime(d.getTime() + (exdays*24*60*60*1000));
		var expires = "expires="+d.toUTCString();
		document.cookie = cname + "=" + cvalue + "; " + expires + ";path=/";
	}


	//쿠키조회
	function fn_getCookie(name) {
		var value = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
		return value? value[2] : null;
	}

	//결제 수단별 알림 메시지 노출
	function fn_dispPayAlertMsg() {
		var selPayment = $(':radio[name="radio_payment"]:checked').val();
		var selVal = '';
		if(selPayment == 'credit') {
			selVal = $("#card_select option:selected").val();
		}

		switch (selPayment){
	      case "mobile" :
	    	  $(".select-mobile-info").show();
	    	  $(".select-kakao-info").hide();
	    	  $(".select-payco-info").hide();
	    	  $(".select-naverpay-info").hide();
	    	  $(".select-chai-info").hide();
	    	  $(".select-settlebank-info").hide();
			  $(".select-toss-info").hide();
	          break;
	      case "kakaopay" :
	    	  $(".select-mobile-info").hide();
	    	  $(".select-kakao-info").show();
	    	  $(".select-payco-info").hide();
	    	  $(".select-naverpay-info").hide();
	    	  $(".select-chai-info").hide();
	    	  $(".select-settlebank-info").hide();
			  $(".select-toss-info").hide();
	          break;
	      case "payco" :
	    	  $(".select-mobile-info").hide();
	    	  $(".select-kakao-info").hide();
	    	  $(".select-payco-info").show();
	    	  $(".select-naverpay-info").hide();
	    	  $(".select-chai-info").hide();
	    	  $(".select-settlebank-info").hide();
			  $(".select-toss-info").hide();
	          break;
	      case "credit" :
	    	  $(".select-mobile-info").hide();
	    	  $(".select-kakao-info").hide();
	    	  $(".select-payco-info").hide();
	    	  $(".select-naverpay-info").hide();
	    	  $(".select-chai-info").hide();
	    	  $(".select-settlebank-info").hide();
			  $(".select-toss-info").hide();
	          break;
	      case "naverpay" :
	    	  $(".select-mobile-info").hide();
	    	  $(".select-kakao-info").hide();
	    	  $(".select-payco-info").hide();
	    	  $(".select-naverpay-info").show();
	    	  $(".select-chai-info").hide();
	    	  $(".select-settlebank-info").hide();
			  $(".select-toss-info").hide();
	          break;
	      case "chai" :
	    	  $(".select-mobile-info").hide();
	    	  $(".select-kakao-info").hide();
	    	  $(".select-payco-info").hide();
	    	  $(".select-naverpay-info").hide();
	    	  $(".select-chai-info").show();
	    	  $(".select-settlebank-info").hide();
			  $(".select-toss-info").hide();
	          break;
	      case "settlebank" :
	    	  $(".select-mobile-info").hide();
	    	  $(".select-kakao-info").hide();
	    	  $(".select-payco-info").hide();
	    	  $(".select-naverpay-info").hide();
	    	  $(".select-chai-info").hide();
	    	  $(".select-settlebank-info").show();
			  $(".select-toss-info").hide();
	          break;
		  case "tosspay" :
			  $(".select-mobile-info").hide();
			  $(".select-kakao-info").hide();
			  $(".select-payco-info").hide();
			  $(".select-naverpay-info").hide();
			  $(".select-chai-info").hide();
			  $(".select-settlebank-info").hide();
			  $(".select-toss-info").show();
			  break;
	      default :
	    	  $(".select-mobile-info").hide();
    	  	  $(".select-kakao-info").hide();
    	      $(".select-payco-info").hide();
    	      $(".select-naverpay-info").hide();
    	      $(".select-chai-info").hide();
    	      $(".select-settlebank-info").hide();
			  $(".select-toss-info").hide();
	    }

		if(selVal == '23') {
			$(".select-kj-info").show();
			$(".select-shinhan-info").hide();
		} else if(selVal == '02') {		// 신한 조조카드
			if($(':radio[name="rdo_card_select"]:checked').val() == '02'){ 		// 조조카드 할인
				$(".select-shinhan-info").show();
			} else {
				$(".select-shinhan-info").hide();
			}
		} else {
			$(".select-kj-info").hide();
			$(".select-shinhan-info").hide();
		}
	}

	var objPopup;
	var popInterval;
	//========================================================================================
	//fdk 결제 영역
	//========================================================================================
	function fdkPayProc() {
		var transNo     = $("#transNo").val();
		var useAmt      = $('.receipt .row.total span').text().replaceAll(',', '');
		var sMethodName = $('#lastPayMethod').val();
		var selectCard  = $("#card_select option:selected").val();
		var selSpCard   = $(':radio[name="rdo_card_select"]:checked').val();
		var pointDmode  = "";
		var cultNaverYn = $('#cultNaverYn').val();

		if (sMethodName == 'credit') {  //신용카드
			if (selectCard == '03' && selSpCard == '02') {	//삼성카드 포인트
				pointDmode = 'S004';
			} else if (selectCard == '27' && selSpCard == '02') {	//하나머니
				pointDmode = 'H004';
			}
		} else if (sMethodName == 'kakaopay') {  //카카오페이
			selectCard = 'X4';
		} else if (sMethodName == 'payco') {  //페이코
			selectCard = 'W2';
		} else if (sMethodName == 'naverpay') {  //네이버페이
			selectCard = 'W2';
		} else if (sMethodName == 'tosspay') {  //토스페이
			selectCard = 'X8';
		} else if (sMethodName == 'kbpay') {  //kbpay
			selectCard = 'KB';
		} else {
			selectCard = '';
			pointDmode = '';
		}

		$("#popupForm_transNo").val(transNo);
		$("#popupForm_useAmt").val(useAmt);
		$("#popupForm_methodName").val(sMethodName);
		$("#popupForm_selectCard").val(selectCard);
		$("#popupForm_pointDmode").val(pointDmode);
		$("#popupForm_cultNaverYn").val(cultNaverYn);

		var popSrc = '/on/oh/ohz/PayBooking/applyCreditCard.do';

		if(sMethodName == 'settlebank') {
			popSrc = '/on/oh/ohz/PayBooking/applySettlebank.do';
		}

		openKiccPop(popSrc);
		wrapWindowByMask();

		//주기적으로 팝업존재여부를 확인해서 close이면 모달제거 및 초기화
		popInterval = setInterval(function(){
			if(typeof(objPopup) === 'undefined' || (objPopup && objPopup.closed)){	//typeof : 선언하지 않았거나 초기화하지 않았으면 undefined
				gfn_alertMsgBox('결제를 취소하셨습니다. 주문 내용 확인 후 다시 결제해 주세요.');
				initObjPop();
			}
		}, 500);
	}

	// kicc 결제창 인증
	function openKiccPop(popSrc){
		var popupWidth = 560;
		var popupHeight = 600;
		var sMethodName = $('#lastPayMethod').val();

		if(sMethodName == 'settlebank') {
			popupWidth = 480;
			popupHeight = 640;
		} else if(sMethodName == 'kbpay') {		// kbpay 팝업사이즈 변경
			popupWidth = 460;
			popupHeight = 470;
		}

		var popupX = (window.screen.width / 2) - (popupWidth / 2);
		var popupY = (window.screen.height / 2) - (popupHeight / 2);

		objPopup = window.open('','popupForm','width=' + popupWidth +', height=' + popupHeight + ',left=' + popupX + ',top=' + popupY +', directories=no');
		var popupForm = document.popupForm;
		var url = popSrc;

		popupForm.action = url;
		popupForm.method = 'post';
		popupForm.target = 'popupForm';
		popupForm.submit();

	}

    function closeFdkPop(){
    	if(objPopup) {
			objPopup.close();
        }
    }

	//팝업호출 이전상태로 초기화
    function initObjPop(){
    	document.getElementById("mask").style.display = "none";
		cancelMbxSellCpInfo($('#lastPayMethod').val());
		btnEvent('error');
		popIntervalClear();
    }

    function popIntervalClear(){
    	clearInterval(popInterval);
    }

	//약관 자세히보기 팝업
	function openTermsPop(el){
		var popupWidth = 520;
		var popupHeight = 600;

		var popupX = (window.screen.width / 2) - (popupWidth / 2);
		var popupY = (window.screen.height / 2) - (popupHeight / 2);

		var src = '';
		if(el=='one') {
			src = 'https://megabox.kicc.co.kr/html/terms/terms1.html';
		} else if(el=='two') {
			src = 'https://megabox.kicc.co.kr/html/terms/terms2.html';
		} else if(el=='three'){
			src = 'https://megabox.kicc.co.kr/html/terms/terms3.html';
		} else {
			src = 'https://megabox.kicc.co.kr/html/terms/terms4.html';
		}

		objPopup = window.open(src,'term_pop','width=' + popupWidth +', height=' + popupHeight + ',left=' + popupX + ',top=' + popupY + ',scrollbars=yes');
	}


	//레이어 팝업 하단 영역 마스킹 처리(레이어 팝업 호출 시 사용)
	function wrapWindowByMask(){
        //화면의 높이와 너비를 구한다.
        var maskHeight = $(document).height();
        var maskWidth  = $(window).width();

        //마스크의 높이와 너비를 화면 것으로 만들어 전체 화면을 채운다.
        $('#mask').css({'width':maskWidth,'height':maskHeight});

        //애니메이션 효과
        $('#mask').fadeIn(1000);
        $('#mask').fadeTo("slow",0.6);
	}

	
	function fdkAuthResult(fdkResultData) {

		popIntervalClear();

		var lastPayMethod = $('#lastPayMethod').val();

		if (fdkResultData.Code != '0000') {
			// 중앙페이 > 비밀번호 5회이상 메시지 노출안함, 인증창 닫기의 경우 메시지 미노출 처리
			if((lastPayMethod == 'joongangpay' && fdkResultData.Code == '0368') || fdkResultData.Code == '-1'){
	    	}else{
				gfn_alertMsgBox(fdkResultData.Msg);
	    	}
			//**********  window.open이라서 함수 호출  ****************//
			initObjPop();
			return false;
		}

		var transNo         = $("#transNo").val();
		var cashBillYn      = $('#cashBillYn').val();
		var cashrecIssueCd  = $('#cashrecIssueCd').val();
		var bizmDivCd       = $(':radio[name="bizmDivCd"]:checked').val();
		var cashBillPhoneNo = $('#cashBillPhoneNo').val();
		var cashrecPubAmt   = $('#cashBillAmt').text().replaceAll(',', '').replaceAll('원', '');
		var shopOrderNo;

		if(bizmDivCd == "") {
			bizmDivCd = "PERSON";
		}

		if(lastPayMethod == 'joongangpay'){
			shopOrderNo = fdkResultData.shopOrderNo;
		}

		//var paramData = {transNo:transNo, Code:rtncode, Msg:rtnmsg , authorizationId:authorizationId, cashBillYn:cashBillYn,
		//    cashrecIssueCd:cashrecIssueCd, bizmDivCd:bizmDivCd, cashBillPhoneNo:cashBillPhoneNo,
		//    cashrecPubAmt:cashrecPubAmt, hotdealAt: bokdPayForm.hotDealYn.value, hotDealEventNo: bokdPayForm.hotDealEventNo.value, channelCd: channelCd };

		var paramData = {
			transNo : transNo,
			Code : fdkResultData.Code,
			Msg : fdkResultData.Msg ,
			authorizationId : fdkResultData.authorizationId,
			traceNo : fdkResultData.traceNo,
			shopOrderNo : shopOrderNo,
			cashBillYn : cashBillYn,
			cashrecIssueCd : cashrecIssueCd,
			bizmDivCd : bizmDivCd,
			cashBillPhoneNo : cashBillPhoneNo,
			cashrecPubAmt : cashrecPubAmt,
			// hotdealAt : bokdPayForm.hotDealYn.value,
			// hotDealEventNo : bokdPayForm.hotDealEventNo.value,
			channelCd : 'ONLINE',
			paymentId : fdkResultData.paymentId

			// ReplyCode : fdkResultData.ReplyCode,
			// ReplyMessage : fdkResultData.ReplyMessage,
			// PayMethod : fdkResultData.PayMethod,
			// MxID : fdkResultData.MxID,
			// MxIssueNO : fdkResultData.MxIssueNO,
			// Amount : fdkResultData.Amount,
			//
			// TID : fdkResultData.TID,
			// EncryptedData : fdkResultData.EncryptedData,
			// HashData : fdkResultData.HashData,
			// AuthDate : fdkResultData.AuthDate,
		};

		$.ajax({
			url: "/on/oh/ohz/PayBooking/execBookingPayment.do",
			type: "POST",
			contentType: "application/json;charset=UTF-8",
			dataType: "json",
			data: JSON.stringify(paramData),
			success: function (data, textStatus, jqXHR) {

				if (!msgBookingLoginChk(data)) {
					//fn_btnEvent('error');
					gfn_logdingModal();
					initObjPop();
					return;
				}
				if (data.statCd != "0") {
					gfn_logdingModal();

					//alert(gfn_scrtDecode(data.msg));
					
					data.msg = data.msg || '';
					var prefix = data.msg.split(':');

					if(data.msg.indexOf('결제키 기간경과')>=0){
						gfn_alertMsgBox(prefix[0] + ' : 잔액 재조회 후 이용 바랍니다.(결제키 기간경과)');
					}else if(data.msg.indexOf('결제불가 상품권 존재')>=0){
						gfn_alertMsgBox(prefix[0] + ' : 상품권 정보를 재확인 바랍니다.(결제불가 상품권 존재)');
					}else if(data.msg.indexOf('상품권잔액부족')>=0){
						gfn_alertMsgBox(prefix[0] + ' : 상품권 정보를 재확인 바랍니다.(상품권 잔액부족)');
					}else if(data.msg.indexOf('네이버페이 : Fail')>=0){
						gfn_alertMsgBox('결제승인에 실패했습니다.\n타 결제수단 시도 또는 고객센터로 문의바랍니다.');
					}else{
						gfn_alertMsgBox(data.msg);
					}

					//아너스기프트카드 경우 back
					if(annusGiftAmt > 0) {
						cancelMbxSellCpInfo('annusgift');
					}

					//경우에 따라서 back 등 결정 필요
					initObjPop();

					return;
				}

				
				goCompleteBooking();
			}, beforeSend : function() {
				gfn_logdingModal();
				btnEvent('beforeSend');
			}, error: function(xhr,status,error){
				gfn_logdingModal();
				btnEvent('error');

				var err = JSON.parse(xhr.responseText);
				//err.statCd 에 따라서 이전화면으로 리턴 가능토록
				errBookingChk(err.msg);

				initObjPop();
			}
		});
	}

	//세틀뱅크 최종결제
	function settlebankAuthResult(settlebankResultData) {
		popIntervalClear();

		var lastPayMethod = $('#lastPayMethod').val();

		if (settlebankResultData.resultCd != '0') {
			var message = settlebankResultData.resultMsg;
			if(!(dS.browser.brwIsSafari() && !dS.browser.brwIsChrome())) {
				gfn_alertMsgBox(message);
			}
			initObjPop();
			return false;
		}

		var transNo         = $("#transNo").val();
		var cashBillYn      = $('#cashBillYn').val();
		var cashrecIssueCd  = $('#cashrecIssueCd').val();
		var bizmDivCd       = $(':radio[name="bizmDivCd"]:checked').val();
		var cashBillPhoneNo = $('#cashBillPhoneNo').val();
		var cashrecPubAmt   = $('#cashBillAmt').text().replaceAll(',', '').replaceAll('원', '');

		if(bizmDivCd == "") {
			bizmDivCd = "PERSON";
		}

		var paramData = {
			transNo : transNo,

			ordNo : settlebankResultData.ordNo,
			authNo : settlebankResultData.authNo,
			trDay : settlebankResultData.trDay,
			trTime : settlebankResultData.trTime,

			cashBillYn : cashBillYn,
			cashrecIssueCd : cashrecIssueCd,
			bizmDivCd : bizmDivCd,
			cashBillPhoneNo : cashBillPhoneNo,
			cashrecPubAmt : cashrecPubAmt,
			channelCd : 'ONLINE'
		};

		$.ajax({
			url: "/on/oh/ohz/PayBooking/execBookingPayment.do",
			type: "POST",
			contentType: "application/json;charset=UTF-8",
			dataType: "json",
			data: JSON.stringify(paramData),
			success: function (data, textStatus, jqXHR) {
				if (!msgBookingLoginChk(data)) {
					gfn_logdingModal();
					return;
				}
				if (data.statCd != "0") {
					gfn_logdingModal();

					data.msg = data.msg || '';

					initObjPop();

					gfn_alertMsgBox(data.msg);

					return;
				}

				
				goCompleteBooking();
			}, beforeSend : function() {
				gfn_logdingModal();
				btnEvent('beforeSend');
			}, error: function(xhr,status,error){
				gfn_logdingModal();
				btnEvent('error');

				var err = JSON.parse(xhr.responseText);
				//err.statCd 에 따라서 이전화면으로 리턴 가능토록
				errBookingChk(err.msg);

				initObjPop();
			}
		});
	}

	//예매 완료 페이지 이동
	function goCompleteBooking() {

    	// 넷퍼넬 자원 반환
    	NetFunnel_Complete();

		$("#completeYn").val("Y");
    	$("#completeTransNo").val($("#transNo").val());
    	$("#completeRiaMemberYn").val(parent.riaMemberYn);
    	$("#completeRiaBirthday").val(parent.riaParamBirthday);
    	$("#completeForm").attr("action", "/booking/payment-successcomplete");
    	$("#completeForm").attr("target", "_parent");
    	$("#completeForm").submit();
	}

	jQuery.fn.center = function () {
	    this.css("position","absolute");
	    this.css("top", Math.max(0, (($(window).height() - $(this).outerHeight()) / 2) + $(window).scrollTop()) + 330 + "px");
	    return this;
	}

	//========================================================================================
	//fdk 결제 영역
	//========================================================================================
</script><script src="./ui.common(2).js.다운로드"></script><script src="./front(2).js.다운로드"></script></head>


    
		
	
	











<!-- selectbox custom -->
<!-- selectbox custom -->









<body class="body-iframe">
<form name="payForm" id="payForm" method="post">
	<input type="hidden" name="playSchdlNo" id="playSchdlNo" value="">
	<input type="hidden" name="seatOccupText" id="seatOccupText" value="">
	<input type="hidden" name="totalAmt" id="totalAmt" value="">
	<input type="hidden" name="benepiaTotalAmt" id="benepiaTotalAmt" value="">
	<input type="hidden" name="transNo" id="transNo">
	<input type="hidden" name="cashBillYn" id="cashBillYn" value="">
	<input type="hidden" name="cashrecIssueCd" id="cashrecIssueCd" value="">
	<input type="hidden" name="entrpMbCd" id="entrpMbCd" value="">
    <input type="hidden" name="tkeYn" id="tkeYn" value="">

	<input type="hidden" name="lastPayMethod" id="lastPayMethod" value="credit">
	<input type="hidden" name="preDisc" id="preDisc" value="">
	<input type="hidden" name="discType" id="discType" value="">
	<input type="hidden" name="tellerFee" id="tellerFee" value="">
	<input type="hidden" name="completeYn" id="completeYn" value="">
	<input type="hidden" name="prepareYn" id="prepareYn" value="">
	<input type="hidden" name="prepareFavorYn" id="prepareFavorYn" value="">
	<input type="hidden" name="goBackYn" id="goBackYn" value="">
	<input type="hidden" name="cultNaverYn" id="cultNaverYn" value="N">
</form>
<form name="completeForm" id="completeForm" method="post">
	<input type="hidden" name="completeTransNo" id="completeTransNo">
	<input type="hidden" name="completeRiaMemberYn" id="completeRiaMemberYn">
	<input type="hidden" name="completeRiaBirthday" id="completeRiaBirthday">
</form>








<form name="popupForm">
	<input type="hidden" name="transNo" id="popupForm_transNo">
	<input type="hidden" name="useAmt" id="popupForm_useAmt">
	<input type="hidden" name="methodName" id="popupForm_methodName">
	<input type="hidden" name="selectCard" id="popupForm_selectCard">
	<input type="hidden" name="pointDmode" id="popupForm_pointDmode">
	<input type="hidden" name="cultNaverYn" id="popupForm_cultNaverYn">
</form>

<input type="hidden" name="JAPayMethodTypeCode" id="JAPayMethodTypeCode">
<input type="hidden" name="JAPayMethodDetailCode" id="JAPayMethodDetailCode">
<input type="hidden" name="JAEasypayVirtualNo" id="JAEasypayVirtualNo">

<input type="hidden" name="dowCd" id="dowCd">
<input type="hidden" name="brchNo" id="brchNo">
<input type="hidden" name="getToday" id="getToday">
<input type="hidden" name="areaCd" id="areaCd">
<input type="hidden" name="mbIdntfcDivCd" id="mbIdntfcDivCd">
<input type="hidden" name="payPolicCtrl" id="payPolicCtrl">
<input type="hidden" name="ticketCnt" id="ticketCnt">

<!-- 레이어 팝업 처리 시 화면 영역 시작 -->
<div id="mask"></div>










<!-- 레이어 팝업 처리 시 화면 영역 끝 -->


<div class="inner-wrap" style="">
	<!-- quick-reserve -->
	<div class="reservePay2">

		<div class="contentsArea">
			<h2 class="tit">결제하기<!-- 결제하기 --></h2>

			






<script type="text/javascript">
var requestPayAt = "Y";

$(function(){
	//RIA의 경우
    if(parent.sellChnlCd != ""){
        $('.inner-wrap')
        	.css('padding-bottom','')
        	.css('padding-top','');	//하단 상단 공백 제거
//         $('#btnLangChg').hide();    //언어전환 버튼숨김

        //로그인 되었으면
        if(parent.riaLoginAt == "Y"){
        	$('.cti-area input[name=riaName]').attr('value',parent.riaParamName);	//고객명
            $('.cti-area input[name=riaMobileNo]').attr('value',parent.riaParamMobileNo);	//고객전화번호
            $('.cti-area input[name=riaBirthday]').attr('value',parent.riaParamBirthday);	//고객생년월일
        	$('.cti-area input[name=riaMemberYn]').attr('value',parent.riaMemberYn == "Y" ? "회원" : "비회원");	//회원여부

        	$('.cti-area input[name=riaName]').attr("readonly",true);		//고객명
            $('.cti-area input[name=riaMobileNo]').attr("readonly",true);	//고객전화번호
            $('.cti-area input[name=riaBirthday]').attr("readonly",true);	//고객생년월일

            $('.cti-area input[name=riaMemberYn]').attr("readonly",true);	//회원여부

        	$('.cti-area button').attr('login-at',"Y");

            //결제화면이 아니면
            if("N" == requestPayAt){
            	$('.cti-area button').html('재인증');
            }
        }
        //로그인 되지 않았으면
        else {
        	$('.cti-area input[name=riaName]').attr('value',parent.riaParamName);	//고객명
            $('.cti-area input[name=riaMobileNo]').attr('value',parent.riaParamMobileNo);	//고객전화번호
            $('.cti-area input[name=riaBirthday]').attr('value',parent.riaParamBirthday);	//고객생년월일
            $('.cti-area input[name=riaMemberYn]').attr('value','');	//회원여부

        	$('.cti-area input[name=riaName]').attr("readonly",false);		//고객명
            $('.cti-area input[name=riaMobileNo]').attr("readonly",false);	//고객전화번호
            $('.cti-area input[name=riaBirthday]').attr("readonly",false);	//고객생년월일

            $('.cti-area input[name=riaMemberYn]').attr("readonly",true);	//회원여부

            $('.cti-area button').attr('login-at',"N");	//회원여부
          	//결제화면이 아니면
            if("N" == requestPayAt){
        		$('.cti-area button').html('인증요청');
            }
        }

        //드림센터의 경우
		if(parent.sellChnlCd == "TELLER"){
			$('.cti-area').show();	//cti 로그인창 표시
		}
		else {
			$('.cti-area').hide();	//cti 로그인창 표시
		}


		//회원정보 확인을 위한 초기 파라메타 셋팅

		//파라메타 셋팅후
		//회원여부확인				부모창
		//나머지 화면 disable 처리	부모창

	}
    else {
        $('.quick-reserve-ad-area').show();	//광고영역 표시
//         $('#btnLangChg').show();	//언어전환 버튼표시 사용안함 20200106 김민영
    }

    /* RIA 재인증 버튼 클릭 */
    $('.cti-area button').on("click", function(){

		//입력값 검증
		if($('.cti-area button').attr('login-at') == "N"){

// 			if($(".cti-area input[name=riaName]").val().length == 0){
// 				gfn_alertMsgBoxSize('이름은  필수 입력 항목 입니다.',400,250);	//{0} 필수 입력 항목 입니다.
// 				return;
// 			}

			if(!fn_validateDateYn($(".cti-area input[name=riaBirthday]").val())){
				gfn_alertMsgBoxSize('생년월일을 정확히 입력해주세요.',400,250);	//생년월일을 정확히 입력해주세요.
				return;
			}

			if($(".cti-area input[name=riaMobileNo]").val().length < 10){
				gfn_alertMsgBoxSize('휴대폰번호를 정확히 입력해주세요.',400,250);	//휴대폰번호를 정확히 입력해주세요.
				return;
			}

			if($(".cti-area input[name=riaMobileNo]").val().substr(0,2) != "01"){
				gfn_alertMsgBoxSize('휴대폰번호를 정확히 입력해주세요.',400,250);	//휴대폰번호를 정확히 입력해주세요.
				return;
			}
		}
		parent.fn_setRiaLoginToggle( [$('.cti-area button').attr('login-at')
    								 ,$(".cti-area input[name=riaName]").val()
    								 ,$(".cti-area input[name=riaBirthday]").val()
    								 ,$(".cti-area input[name=riaMobileNo]").val()]
    								);
    });


    /* 이름 숫자를 제외한 입력 여부판단 */
	$(".cti-area input[name=riaName]").on("keyup", function(e){
		var partton = /[^ㄱ-힣a-zA-Z]/g;
		if(partton.test($(this).val())) {
			var value = $(this).val().replace(/[^ㄱ-힣a-zA-Z]/g,"");
			$(this).val(value);
		}
 	});
	$(".cti-area input[name=riaName]").focusout(function(){
		var partton = /[^ㄱ-힣a-zA-Z]/g;
		if(partton.test($(this).val())) {
			var value = $(this).val().replace(/[^ㄱ-힣a-zA-Z]/g,"");
			$(this).val(value);
		}
	});

    /* 생년월일 숫자만 입력 여부판단 */
	$(".cti-area input[name=riaBirthday]").on("keyup", function(e){
		$(this).val($(this).val().replace(/[^0-9]/g,""));
	});
	$(".cti-area input[name=riaBirthday]").focusout(function(){
		$(this).val($(this).val().replace(/[^0-9]/g,""));
	});

    /* 휴대폰번호 숫자만 입력 여부판단 */
	$(".cti-area input[name=riaMobileNo]").on("keyup", function(e){
		$(this).val($(this).val().replace(/[^0-9]/g,""));
    });
	$(".cti-area input[name=riaMobileNo]").focusout(function(){
		$(this).val($(this).val().replace(/[^0-9]/g,""));
	});
});


/*날짜 형태 확인*/
function fn_validateDateYn(param) {
	try
	{
		var yearFront = "";
		var year = "";
		var month = "";
		var day = "";

		param = param.replace(/-/g,'');

		// 자리수가 맞지않을때
		if( isNaN(param) || param.length < 6 || param.length == 7) {
			return false;
		}

		if(param.length == 6){
			year = Number(param.substring(0, 2));
			month = Number(param.substring(2, 4));
			day = Number(param.substring(4, 6));
		}
		else if (param.length == 8){
			var date = new Date();
			yearFront = Number(param.substring(0, 4));
			year = Number(param.substring(2, 4));
			month = Number(param.substring(4, 6));
			day = Number(param.substring(6, 8));

			if(yearFront > date.getFullYear()){
				return false;
			}
		}
		var dd = day / 0;

		if( month<1 || month>12 ) {
			return false;
		}

		var maxDaysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
		var maxDay = maxDaysInMonth[month-1];

		// 윤년 체크
		if( month==2 && ( year%4==0 && year%100!=0 || year%400==0 ) ) {
			maxDay = 29;
		}

		if( day<=0 || day>maxDay ) {
			return false;
		}
		return true;

	} catch (err) {
		return false;
	}
}

</script>
<!-- cti 일때만 출력 -->
<div class="cti-area" style="display:none">
    <p>이름</p>
    <input maxlength="20" name="riaName" type="text" title="이름 출력" class="input-text a-c w120px" placeholder="이름" value="">

    <p>생년월일</p>
    <input maxlength="8" name="riaBirthday" type="text" title="생년월일 출력" class="input-text a-c w150px" placeholder="6자리 또는 8자리" value="">

    <p>휴대폰번호</p>
    <input maxlength="11" name="riaMobileNo" type="text" title="휴대폰번호 출력" class="input-text a-c w150px" placeholder="- 없이 입력" value="">

    <p>회원</p>
    <input name="riaMemberYn" type="text" title="회원여부 출력" class="input-text a-c w100px" value="" readyonly="readyonly" readonly="readonly">

	
		
	
</div>

			<section class="section">
				<div class="titleArea">
					<h3 class="tits">예매정보</h3>
				</div>
				<div class="movInfo" id="movieInfo">
					<div class="movImg">
						<img src="./bg-noimage-notmain.png" alt="" onerror="noImg(this);">
						<div class="movie-grade size12" id="admisClassNm"></div>
						<!-- 같은 방식이지만 size12 클래스 추가됨 -->
					</div>
					<ul class="list">
						<li id="movieNm"></li>
						<li><span id="playDe">&nbsp;</span><em id="dowNm">&nbsp;</em> <span id="playTime"></span></li>
						<li><span id="brchNm"></span><span class="dotgrbx"></span><span id="playKindNm"></span></li>
						<li></li>
					</ul>
				</div>
			</section>

			<section class="section">
				<div class="titleArea">
					<h3 class="tits">할인적용</h3>
					<div class="rt">
						<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#" class="btn bty1" id="btn_booking_init">초기화</a>
					</div>
				</div>
				
					<div class="discount" id="discount">
						<div class="neTab" id="neTab">
							<a href="javascript:void(0)" class="act">쿠폰 / 관람권 / 기타</a>
							<a href="javascript:void(0)" class="">포인트</a>
						</div>
						<!-- tabCont -->
						<div class="tabCont" id="dcTab">
							<ul class="btnList" id="dcBtnList">
							</ul>
							<div class="checkArea display-none" id="dcCponDiv" style="display:none;">
								<div class="newCheck_1">
									<input type="checkbox" id="dcCponApply" name="dcCponApply" paydcmeancd="">
									<label for="dcCponApply">최대할인 쿠폰 적용</label>
								</div>
								<a href="javascript:openDcCponPopup()" class="rt disab">적용 쿠폰 확인</a> <!--disab 있음-->
							</div>
							<div class="textBox" style="padding-top:16px">
								<ul class="dotList">
									<li>기프트콘, 기프티쇼, 아이넘버, 도넛북, 스마트콘, 스마일콘, G마켓 예매권은  [모바일관람권]에서 사용하실 수 있습니다.</li>
								</ul>
							</div>
						</div>

						<div class="tabCont display-none" id="pointTab">
							<ul class="btnList" id="pointBtnList">
							</ul>
						</div>
						<!--//tabCont end -->
					</div>
				
				
			</section>
			<section class="section">
				<div class="titleArea">
					<div class="tit">결제수단</div>
				</div>
				<!-- paySelect -->
				<div class="paySelect" id="paySelect">
					<div class="joongPay none display-none" data-type="joongang-display" paydcmeancd="105038">
						<div class="title">
							<div class="tit"><span class="hide">joongang pay</span></div>
							<div class="btn" id="btnMng" style="display: none;"></div>
						</div>
						<!-- cardBox -->
						<div class="nullAdd" id="joongAngPayList" onclick="fn_kiccJoinAgree();">자주사용하는 카드 등록하고<br> 더욱 빠르게 결제하세요!</div>
						<!--//cardBox end-->
					</div>
					<div class="pays" data-type="credit" paydcmeancd="102001">신용 / 체크카드</div> <!--선택되면 체크 act-->
					<div class="pays" data-type="easy" paydcmeancd="105001"><span class="tag display-none" id="imgTag">혜택</span>간편결제</div> <!--사용 못할때는 disab 추가-->
					<div class="pays" data-type="mobile" paydcmeancd="105005">휴대폰결제</div>
					<div class="pays" data-type="settlebank" paydcmeancd="105030">내통장결제</div>
				</div>
				<!--//paySelect end -->
				<!-- ord 카드사 선택 -->
				<div class="ord display-none" id="credit-display">
					<div class="item">카드사 선택</div>
					<div class="item">
						<select id="card_select" title="카드사 선택" class="newSelect">
							<option value="00" selected="">선택</option><!-- 전체카드   -->
							<option value="01">비씨카드</option><!-- 비씨카드   -->
							<option value="07">국민카드</option><!-- 국민카드   -->
							<option value="02">신한카드</option><!-- 신한카드   -->
							<option value="03">삼성카드</option><!-- 삼성카드   -->
							<option value="05">롯데카드</option><!-- 롯데카드   -->
							<option value="12">농협카드</option><!-- 농협카드   -->
							<option value="27">하나카드</option><!-- 하나카드   -->
							<option value="04">현대카드</option><!-- 현대카드   -->
							<option value="13">씨티카드</option><!-- 씨티카드   -->
							<option value="22">제주카드</option><!-- 제주카드   -->
							<option value="14">우리카드</option><!-- 우리카드   -->
							<option value="11">수협카드</option><!-- 수협카드   -->
							<option value="24">전북카드</option><!-- 전북카드   -->
							<option value="23">광주카드</option><!-- 광주카드   -->
							<option value="17">신협카드</option><!-- 신협카드   -->
							<option value="90">카카오뱅크</option><!-- 카카오뱅크 -->
							<option value="91">케이뱅크</option><!-- 케이뱅크   -->
							
							<option value="B0">우체국카드</option><!-- 우체국 카드   -->
							<option value="B1">토스  카드</option><!-- 토스  카드  -->
							<option value="B2">SC제일은행 비씨카드</option><!-- SC제일은행 비씨카드   -->
							<option value="S0">SC제일은행 삼성카드</option><!-- SC제일은행 삼성카드   -->
							<option value="B3">IBK기업은행 카드</option><!-- IBK기업은행 카드  -->
						</select>
					</div>

					<div class="item display-none" id="rdo_credit_method">
						<div class="radioArea">
							<div class="newRadio_1">
								<input type="radio" name="rdo_card_select" id="app_card" checked="" value="01">
								<label for="app_card" id="label_app_card">앱카드 <!-- ISP, APP --></label>
							</div>
							<div class="newRadio_1">
								<input type="radio" name="rdo_card_select" id="general_card" value="00">
								<label for="general_card" id="label_general_card">일반결제 <!-- 일반결제 --></label>
							</div>
							<div class="newRadio_1" id="special_rdo">
								<input type="radio" name="rdo_card_select" id="special_card" value="02">
								<label for="special_card" id="label_special_card">포인트사용 <!-- 삼성카드 포인트 사용 --></label>
							</div>
						</div>
					</div>
				</div>
				<!--//ord 카드사 선택 -->
				<!-- ord 간편결제 선택 -->
				<div class="ord display-none" id="easy-display">
					<div class="item">
						<div class="radioArea">
							<div class="newRadio_1 display-none">
								<input type="radio" name="easy_radio_payment" id="rdo_pay_tosspay" value="tosspay" paydcmeancd="105035" data-text="토스페이">
								<label for="rdo_pay_tosspay">토스페이</label>
							</div>
							
								<div class="newRadio_1 display-none">
									<input type="radio" name="easy_radio_payment" id="rdo_pay_naverpay" value="naverpay" paydcmeancd="105036" data-text="네이버페이">
									<label for="rdo_pay_naverpay">네이버페이</label>
								</div>
							
							<div class="newRadio_1 display-none">
								<input type="radio" name="easy_radio_payment" id="rdo_pay_kakaopay" value="kakaopay" paydcmeancd="105037" data-text="카카오페이">
								<label for="rdo_pay_kakaopay">카카오페이</label>
							</div>
							<div class="newRadio_1 display-none">
								<input type="radio" name="easy_radio_payment" id="rdo_pay_payco" value="payco" paydcmeancd="105003" data-text="페이코">
								<label for="rdo_pay_payco">페이코</label>
							</div>
							<div class="newRadio_1 display-none">
								<input type="radio" name="easy_radio_payment" id="rdo_pay_kbpay" value="kbpay" paydcmeancd="105034" data-text="KB PAY">
								<label for="rdo_pay_kbpay">KB PAY</label>
							</div>




						</div>
					</div>
				</div>
				<!--//ord 간편결제 선택 -->
				<!-- 간편결제용 -->

				<!-- 2020.02.07 수단별 알림 문구 추가 -->
				<div class="dotList" id="paymentInfo">
					<ul class="dotList display-none" content-paydcmeancd="102001" value="credit"></ul>
					<ul class="dotList display-none" content-paydcmeancd="105005" value="mobile"></ul>
					<ul class="dotList display-none" content-paydcmeancd="105030" value="settlebank"></ul>
					<ul class="dotList display-none" content-paydcmeancd="105035" value="tosspay"></ul>
					<ul class="dotList display-none" content-paydcmeancd="105036" value="naverpay"></ul>
					<ul class="dotList display-none" content-paydcmeancd="105037" value="kakaopay"></ul>
					<ul class="dotList display-none" content-paydcmeancd="105003" value="payco"></ul>
					<ul class="dotList display-none" content-paydcmeancd="105034" value="kbpay"></ul>
					<ul class="dotList display-none" content-paydcmeancd="305005" value="shinhan">신한카드 조조무료 서비스는 '아침愛 조조할인' 선택 시에만 적용되며 실적 및 조건 충족 시 월 1회, 최대 2인까지 무료로 관람하실 수 있습니다.</ul>
				</div>
				<div class="textInfo" id="promt">
					<div class="tit">결제 프로모션</div>
					<div class="inbox">
					</div>
				</div>
				<dl class="term-list" id="terms">
					<dt>
						<span class="bg-chk small">
							<input type="checkbox" id="agree"><label for="agree">결제대행 서비스 약관 필수 동의</label>
						</span>
					</dt>
					<dd class="tit">
						전자금융거래 기본약관<!-- 전자금융거래 기본약관 -->
						<a href="javascript:void(0);" onclick="openTermsPop(&#39;one&#39;)">내용보기</a>
					</dd>
					<dd class="tit">
						개인정보 수집 및 이용에 대한 동의<!-- 개인정보 수집 및 이용에 대한 동의 -->
						<a href="javascript:void(0);" onclick="openTermsPop(&#39;two&#39;)">내용보기</a>
					</dd>
					<dd class="tit">
						개인정보의 제 3자 제공 동의<!-- 개인정보 제공 및 위탁 안내 -->
						<a href="javascript:void(0);" onclick="openTermsPop(&#39;three&#39;)">내용보기</a>
					</dd>
					<dd class="tit">
						개인정보의 처리 위탁 동의<!-- 개인정보의 처리 위탁 동의 -->
						<a href="javascript:void(0);" onclick="openTermsPop(&#39;four&#39;)">내용보기</a>
					</dd>
				</dl>
			</section>
		</div>

		<div class="rightArea">
			<!-- receipt -->
			<div class="receipt">
				<div class="cont">
					<h4>결제금액</h4>
					<!-- innerBox -->
					<div class="innerBox" style="max-height:270px; overflow-y:auto;">
						<div class="grayArea top">
							<!-- ltrtBox -->
							<div class="ltrtBox">
								<div class="row last">
									<div class="lt">금액 <!-- 금액 --></div>
									<div class="rt"><span></span> 원 <!-- 원 --></div>
								</div>
							</div>
							<!--//ltrtBox end -->
						</div>
						<div class="grayArea bot">
							<!-- ltrtBox -->
							<div class="ltrtBox">
								<div class="row data">
									<div class="lt"></div>
									<div class="rt"><span>0</span> 원</div>
								</div>
								<div class="row last">
									<div class="lt">할인적용</div>
									<div class="rt"><span>0</span> 원 <!-- 원 --></div>
								</div>
							</div>
							<!--//ltrtBox end -->
						</div>
					</div>
					<!--//innerBox end -->
					<!-- ltrtBox -->
					<div class="ltrtBox">
						<div class="row add">
							<div class="lt">추가 차액</div>
							<div class="rt"><span>0</span></div>
						</div>
						<div class="row total">
							<div class="lt">최종결제금액</div>
							<div class="rt"><span>0</span> 원 <!-- 원 --></div>
						</div>
						<div class="row last">
							<div class="lt">결제수단</div>
							<div class="rt">신용/체크카드</div>
						</div>
					</div>
					<!--//ltrtBox end -->
				</div>
				<div class="btnArea">
					<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#" class="btn01" id="btn_booking_back" title="이전">이전 <!-- 이전 --></a>
					
						
						
						
							<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#" class="btn02 btn-modal-open" id="btn_booking_pay" onclick="startPay()" title="결제">결제</a>
						
					
				</div>
			</div>
			<!--//receipt end -->
			
				
					
					
						<div class="adbox">
							
								
								
									<a id="payBannerPCLink2" href="https://www.megabox.co.kr/event/detail?eventNo=16112" target="_top" title="">
										<img id="payBannerPC2" style="width:310px;" src="./IjX6plClelXbyS8qEmpePYrEjbVAUKYv.png" alt=" ">
									</a>
								
							
						</div>
					
				
			
		</div>
	</div>
	<div class="layerPop24 display-none" id="joongangFamily-display">
		<div class="dim"></div>
		<!-- layerPop 중앙패밀리 -->
		<div class="layerPop w350"> <!--다른 가로값-->
			<div class="hd">
				<div class="tit">중앙패밀리</div>
				<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#" class="exit" onclick="$(&#39;#joongangFamily-display&#39;).addClass(&#39;display-none&#39;);"></a>
			</div>
			<!-- bd -->
			<div class="bd pg35"><!--페딩값이 다름-->
				<div class="topLine">
					<div class="text2">혜택받으실 카드를 선택해주세요!</div>
				</div>
				<div class="layerBtnBox juSb">
					<button class="btnty03 btn-modal-open" data-val="friends" data-layer="layer_205003" w-data="600" h-data="550">플래티넘/스타/프렌즈</button>
					<button class="btnty03 btn-modal-open" data-val="annusgift" data-layer="layer_103003" w-data="600" h-data="550">아너스카드</button>
				</div>
			</div>
			<!--//bd end -->
		</div>
		<!--//layerPop end -->
	</div>
	<!--// quick-reserve -->
</div>


	<!-- 레이어 : 메가박스 VIP영화쿠폰 -->
	






<script type="text/javascript">
	var vipCponList = new Array();
	
	var couponChkCnt = 0;

	//초기화 공통 sMethodName.init
	function vipCpon_init() {
		//조회내역 초기화
		//$('#layer_vip_coupon .table-wrap > table > tbody> tr').remove();
		$('#layer_202001 .table-wrap > .scroll > table > tbody> tr').remove();
	}

	$(function() {
		//VIP 쿠폰 적용
		$('#btn_apply_vipCpon').on('click', function() {
			applyVipCpon();
		});

		//VIP 쿠폰 적용취소
		$('#btn_cancel_apply_vipCpon').on('click', function() {
			var sMethodName = "vipCpon";
			cancelMbxSellCpInfo(sMethodName);

			//닫기버튼 클릭
	       	$('#layer_202001 .close-layer').click();
		});
	});

	//vip 쿠폰 존재여부
	function getInitVipcponCnt() {
		//return $('#layer_vip_coupon .table-wrap > table > tbody> tr').length;
		return $('#layer_202001 .table-wrap > .scroll > table > tbody> tr').length;
	}

	//vip 쿠폰 초기화
	function setInitVipcpon() {
		//$('#layer_vip_coupon .table-wrap > table > tbody> tr').remove();
		$('#layer_202001 .table-wrap > .scroll > table > tbody> tr').remove();
	}

	//vip 쿠폰 조회
	function searchVipCpon(searchMode) {
		//초기화
		setInitVipcpon();
		var transNo       = $("#transNo").val();
		var paramData     = {transNo:transNo, searchMode:searchMode};

		$('#layer_202001 .table-wrap > .scroll > table > tbody> tr').remove();
		vipCponList = new Array();

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/searchVipCpon.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}
	        	//쿠폰 전역변수 세팅
	        	vipCponList = data.cponList;
	        	//쿠폰 목록 세팅
	        	setVipCponList(vipCponList);

	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);
	        }
		});
	}

	//vip 쿠폰 목록 세팅
	function setVipCponList(cponList) {
		var cponListText = "";
		for(var i=0;i<cponList.length;i++) {
			var expoNo  = cponList[i].cponNo.substring(0,4)
			+"-"+cponList[i].cponNo.substring(4,8)
			+"-"+cponList[i].cponNo.substring(8,12)
			+"-****";
			let maxDcCponChoiYn = cponList[i].maxDcCponChoiYn;

			cponListText = '<tr> ';
			cponListText += '	<td class="a-l"> ';
			cponListText += '		<strong>'+cponList[i].cponNm+'</strong><p class="inner-code">'+expoNo+'</p>';
			cponListText += '	</td> ';
			cponListText += '	<td>'+cponList[i].validStartDe.maskDate()+'~'+cponList[i].validEndDe.maskDate()+'</td> ';
			if(maxDcCponChoiYn == 'Y'){
				cponListText += '	<td><input type="checkbox" title="쿠폰 사용" name="chkVipCpon" checked="checked" idx="'+i+'"/></td> ';
			} else {
				cponListText += '	<td><input type="checkbox" title="쿠폰 사용" name="chkVipCpon" idx="'+i+'"/></td> ';
			}
			cponListText += '</tr> ';

			//$('#layer_vip_coupon .table-wrap > table > tbody').append(cponListText);
			$('#layer_202001 .table-wrap > .scroll > table > tbody').append(cponListText);
			if($('#layer_202001 .table-wrap > .scroll > table > tbody').height() > $('#layer_202001 .table-wrap > .scroll').height()) {
				$('#layer_202001 .table-wrap > .scroll').css("margin-right", "-17px");
			}
			//체크박스 이벤트 생성
			setChkVipCponEvent();
		}
	}

	//체크박스 이벤트
	function setChkVipCponEvent() {
		$(":checkbox[name='chkVipCpon']").off().on('click', function() {

			if (!$(this).prop('checked')) {
				return;
			}
			
			var $chk = $(":checkbox[name='chkVipCpon']:checked");
			
			if ( $chk.length == 0 ) {
				gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
				return;
			}
			
			couponChkCnt = couponChkCnt + 1;
	        $(this).attr('data-ord', couponChkCnt);
			
			$chk.sort(function(a, b) {
	        	return a.attributes['data-ord'].value > b.attributes['data-ord'].value ? 1 : a.attributes['data-ord'].value < b.attributes['data-ord'].value ? -1 : 0;
	        });

			var transNo   = $("#transNo").val();
			var paramCpon = new Array();

			$.each($chk, function() {
				paramCpon.push(vipCponList[$(this).attr('idx')]);
			});

			////console.log(paramCpon);

			var paramData = {transNo:transNo, cponList:paramCpon, redisUpdateAt:'N'};
			
			var idx        = $(this).attr('idx');

			$.ajax({
		        //url: "/on/oh/ohz/PayBooking/applyAbleCponChk.do",
		        url: "/on/oh/ohz/PayBooking/applyVipCpon.do",
		        type: "POST",
		        contentType: "application/json;charset=UTF-8",
		        dataType: "json",
				data: JSON.stringify(paramData),
		        success: function (data, textStatus, jqXHR) {
		        	//console.log(data);
		        	if (!msgBookingLoginChk(data)) {
		        		$(":checkbox[name='chkVipCpon']").each(function() {
							if ($(this).attr('idx') == idx) {
								$(this).prop('checked', false);
							}
			        	});
		        		return;
		        	}
		        },
		        error: function(xhr,status,error){
		        	var err = JSON.parse(xhr.responseText);
		        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
		        	errBookingChk(err.msg);

		        	//추후 order 변경 등 고려 foreach 로 처리
		        	$(":checkbox[name='chkVipCpon']").each(function() {
						if ($(this).attr('idx') == idx) {
							$(this).prop('checked', false);
						}
		        	});
		        }
			});

		});
	}

	//vip 쿠폰 적용
	function applyVipCpon() {
		var $chk = $(":checkbox[name='chkVipCpon']:checked");
		
		if ( $chk.length == 0 ) {
			gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
			return;
		}
		
		$chk.sort(function(a, b) {
        	return a.attributes['data-ord'].value > b.attributes['data-ord'].value ? 1 : a.attributes['data-ord'].value < b.attributes['data-ord'].value ? -1 : 0;
        });

		var transNo   = $("#transNo").val();
		var paramCpon = new Array();

		$.each($chk, function() {
			vipCponList[$(this).attr('idx')].transNo = transNo;
			paramCpon.push(vipCponList[$(this).attr('idx')]);
		});

		////console.log(paramCpon);

		var paramData = {transNo:transNo, cponList:paramCpon, redisUpdateAt:'Y'};

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/applyVipCpon.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

	        	//할인내역 갱신
	        	setMovieDcInfo(data.policyList);

	        	$('#btn_cancel_vipCpon').show(); //취소버튼
	        	$('#btn_cancel_apply_vipCpon').show(); //적용취소버튼


	        	//닫기버튼 클릭
	        	$('#layer_202001 .close-layer').click();
	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);
	        }
		});
	}

</script>
<!-- 레이어 : 메가박스 VIP영화쿠폰 -->
<section id="layer_202001" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">메가박스 VIP영화쿠폰<!-- 메가박스 VIP영화쿠폰 --></h3>
		</header>

		<div class="layer-con">
			<div class="reset mb10">
				사용할 쿠폰을 선택해주세요.<!-- 보유중인 VIP 영화쿠폰을 선택해주세요. -->
			</div>

			<div class="table-wrap divide">
				<table class="board-list line">
					<caption>VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 제목 표<!-- 메가박스 VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 제목 표 --></caption>
					<colgroup>
						<col>
						<col style="width:200px;">
						<col style="width:56px;">
					</colgroup>
					<thead>
						<tr>
							<th scope="col">쿠폰 <!-- 쿠폰 --></th>
							<th scope="col">유효기간 <!-- 유효기간 --></th>
							<th scope="col">사용 <!-- 사용 --></th>
						</tr>
					</thead>
				</table>

				<!--
					상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
				 -->
				<div class="scroll" style="min-height:340px; max-height:340px;">
					<table class="board-list line">
						<caption>메가박스 VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 내용 표<!-- 메가박스 VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 내용 표 --></caption>
						<colgroup>
							<col>
							<col style="width:200px;">
							<col style="width:56px;">
						</colgroup>
						<tbody>
							<!-- <tr>
								<td class="a-l">
									<strong>관람권명</strong><br />
									1234-5678-1234-****
								</td>
								<td>2019-01-08~2019-01-31</td>
								<td><input type="checkbox" title="쿠폰 사용" /></td>
							</tr>
							<tr>
								<td class="a-l">
									<strong>부티크프라이빗 관람권</strong><br />
									1234-5678-1234-****
								</td>
								<td>2019-01-08~2019-01-31</td>
								<td><input type="checkbox" title="쿠폰 사용" /></td>
							</tr> -->
						</tbody>
					</table>
				</div>
			</div>
			<!--
			<div class="box-border v1 use-guide mt15">
				<p class="tit">이용안내</p>

				<ul class="dot-list">
					<li>등록된 관람권은 나의메가박스에서 확인 및 삭제하실 수 있습니다.</li>
				</ul>
			</div>
			 -->
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer">닫기 <!-- 닫기 --></button>
			<button type="button" class="button small purple" id="btn_cancel_apply_vipCpon" style="display:none;">적용취소 <!-- 적용취소 --></button>
			<button type="button" class="button small purple" id="btn_apply_vipCpon">적용 <!-- 적용 --></button>
		</div>

		<button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
	</div>
</section>
<!--// 레이어 : 메가박스 VIP영화쿠폰 -->


	<!--// 레이어 : 메가박스 VIP영화쿠폰 -->

	<!-- 레이어 : 메가박스 관람권 -->
	





<script type="text/javascript">
var mcouponChgList = new Array();

//초기화 공통 sMethodName.init
function mcoupon_init() {
	setInitMcouponChg();
	mcouponChgList = new Array();
	$('#mcouponNo').val('');
	$('#mcouponCertNo').val('');
}

$(function() {
	//영화관람권 문자만 사용
	//$("#scouponNo").megaBoxNumberCheck();
	$("#mcouponCertNo").megaBoxNumberCheck();

	//교환권 등록버튼 클릭
	$('#btn_reg_mcoupon').on('click', function() {
		registMcoupon();
	});

	//적용버튼 클릭
	$('#btn_apply_mcoupon').on('click', function() {
		applyMcouponChg();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_mcoupon').on('click', function() {
		var sMethodName = "mcoupon";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
       	$('#layer_201006 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_mcoupon, #btn_close_modal_mcoupon').on('click', function() {
		$('#mcouponNo').val('');
		$('#mcouponCertNo').val('');
	});
});

//영화관람권 존재여부
function getInitMcouponChgCnt() {
	//return $('#layer_movie_megabox_coupon .table-wrap > table > tbody> tr').length;
	return $('#layer_201006 .table-wrap > .scroll > table > tbody> tr').length;
}

//영화관람권 초기화
function setInitMcouponChg() {
	//$('#layer_movie_megabox_coupon .table-wrap > table > tbody> tr').remove();
	$('#layer_201006 .table-wrap > .scroll > table > tbody> tr').remove();
}

//영화관람권 등록
function registMcoupon() {
	//초기화
	var transNo     = $("#transNo").val();
	var mcouponNo   = $("#mcouponNo").val();
	var mcouponCertNo = '';


	//영화관람권 자릿수 체크
	if (mcouponNo.length < 12) {
		gfn_alertMsgBox('관람권 번호를 다시 확인해 주세요.');	//영화관람권 12자리를 입력하세요
		$("#mcouponNo").focus();
		return;
	}

	if (mcouponNo.length == 12){
		mcouponCertNo = '0000';
	} else {
		mcouponCertNo = $("#mcouponNo").val().substr(12);
	}

	//기 조회여부 체크
	for(var i=0;i<mcouponChgList.length;i++) {
		if (mcouponNo.substring(0, 12) == mcouponChgList[i].cmbndNo) {
			gfn_alertMsgBox('이미 조회 되었습니다.');
			return;
		}
	}
	var scouponNo  = mcouponNo + mcouponCertNo;
	var paramData  = {scouponNo:scouponNo, transNo:transNo, cmbnd_type:'mcoupo' };
	$.ajax({
        url: "/on/oh/ohz/PayBooking/registVcCmbnd.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

			if (data.resultStatus == 'Y') {
				addMcouponChg(mcouponNo.substring(0, 12));
			} else {
				if (data.resultMsg != null && data.resultMsg != undefined) {
					gfn_alertMsgBox(data.resultMsg);
				} else {
					gfn_alertMsgBox('기명처리 불가한 교환권입니다.');
				}
			}
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
	});

}

//영화관람권 추가
function addMcouponChg(mcouponNo) {
	//초기화
	var transNo     = $("#transNo").val();
	var paramData  = {transNo:transNo, cmbndNo:mcouponNo };

	$.ajax({
        url: "/on/oh/ohz/PayBooking/searchMovieCpon.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//쿠폰 전역변수 세팅
        	var vcCmbndList = data.vcCmbndList[0];

        	mcouponChgList.push(vcCmbndList);
        	var i = mcouponChgList.length-1;

        	var expoNo  = mcouponChgList[i].cmbndNo.substring(0,4)
			+"-"+mcouponChgList[i].cmbndNo.substring(4,8)
			+"-"+mcouponChgList[i].cmbndNo.substring(8,12)
			+"-****";

    		cponListText = '<tr> ';
    		cponListText += '	<td class="a-l">'+mcouponChgList[i].cmbndExpoNm+'<p class="inner-code">'+expoNo+'</p></td> ';
    		cponListText += '	<td class="a-l"> ';
    		//cponListText += '		총(0/1) | 주간(0/1) | 월간(0/1)<br /> '; 현재 영어에서 제한횟수 관리가 되고 있지 않음. 추후 추가 필요
    		cponListText += '		'+String(mcouponChgList[i].validStartDe).maskDate()+'~'+String(mcouponChgList[i].validExprDe).maskDate()+' ';
    		cponListText += '	</td> ';
    		cponListText += '	<td><input type="checkbox" title="메가박스 관람권" name="chkMCpon" idx="'+i+'" cponno="'+mcouponChgList[i].cmbndNo+'"/></td> ';
    		cponListText += '</tr> ';

    		//$('#layer_movie_megabox_coupon .table-wrap > table > tbody').append(cponListText);
    		$('#layer_201006 .table-wrap > .scroll > table > tbody').append(cponListText);

			// 관람권 버튼 카운트 갱신
			if(localCmbndCnt != mcouponChgList.length){
				localCmbndCnt = mcouponChgList.length;

				$('li[paydcmeancd="popup_201006"]').find('em').text('('+localCmbndCnt+')');
			}

    		$('#mcouponNo').val('');
    		$('#mcouponCertNo').val('');

    		setChkMcouponEvent();
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
	});
}


//영화관람권 조회
function searchMcouponChg() {
	//초기화
	var transNo    = $("#transNo").val();
	var paramData  = {transNo:transNo };
	mcouponChgList = new Array();

	$.ajax({
        url: "/on/oh/ohz/PayBooking/searchMovieCpon.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//쿠폰 전역변수 세팅
        	var vcCmbndList = data.vcCmbndList;
        	for(var i=0;i<vcCmbndList.length;i++){
        		mcouponChgList.push(vcCmbndList[i]);
        	}

        	//쿠폰 목록 세팅
        	setMcouponChg(mcouponChgList);
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
	});
}


//영화관람권 목록 세팅
function setMcouponChg(cponList) {
	setInitMcouponChg();
	var cponListText = "";
	for(var i=0;i<cponList.length;i++) {
		var expoNo  = cponList[i].cmbndNo.substring(0,4)
				+"-"+cponList[i].cmbndNo.substring(4,8)
				+"-"+cponList[i].cmbndNo.substring(8,12)
				+"-****";

		cponListText = '<tr> ';
		cponListText += '	<td class="a-l">'+cponList[i].cmbndExpoNm+'<p class="inner-code">'+expoNo+'</p></td> ';
		cponListText += '	<td class="a-l"> ';
		//cponListText += '		총(0/1) | 주간(0/1) | 월간(0/1)<br /> '; 현재 영어에서 제한횟수 관리가 되고 있지 않음. 추후 추가 필요
		cponListText += '		'+String(cponList[i].validStartDe).maskDate()+'~'+String(cponList[i].validExprDe).maskDate()+' ';
		cponListText += '	</td> ';
		cponListText += '	<td><input type="checkbox" title="스토어권 사용" name="chkMCpon" idx="'+i+'" cponno="'+cponList[i].cmbndNo+'"/></td> ';
		cponListText += '</tr> ';

		//$('#layer_movie_megabox_coupon .table-wrap > table > tbody').append(cponListText);
		$('#layer_201006 .table-wrap > .scroll > table > tbody').append(cponListText);
		if($('#layer_201006 .table-wrap > .scroll > table > tbody').height() > $('#layer_201006 .table-wrap > .scroll').height()) {
			$('#layer_201006 .table-wrap > .scroll').css("margin-right", "-17px");
		}

		setChkMcouponEvent();
	}
}

//체크박스 이벤트
function setChkMcouponEvent() {
	$(":checkbox[name='chkMCpon']").off().on('click', function() {

		if (!$(this).prop('checked')) {
			return;
		}
		var transNo    = $("#transNo").val();
		var cmbndNo    = mcouponChgList[$(this).attr('idx')].cmbndNo;
		var methodName = "mcoupon";
		var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName};
		var idx        = $(this).attr('idx');

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}
	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);

	        	//추후 order 변경 등 고려 foreach 로 처리
	        	$(":checkbox[name='chkMCpon']").each(function() {
					if ($(this).attr('idx') == idx) {
						$(this).prop('checked', false);
					}
	        	});
	        }
		});

	});
}


//영화관람권 적용
function applyMcouponChg() {
	var chkCnt = $(":checkbox[name='chkMCpon']:checked").length;

	if ( chkCnt == 0 ) {
		gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
		return;
	}

	var transNo     = $("#transNo").val();
	var playSchdlNo = $("#playSchdlNo").val();
	var paramCpon   = new Array();

	$(":checkbox[name='chkMCpon']:checked").each(function(idx) {
		mcouponChgList[$(this).attr('idx')].transNo = transNo;
		paramCpon.push(mcouponChgList[$(this).attr('idx')]);
	});

	var paramData = {transNo:transNo, cponList:paramCpon, playSchdlNo:playSchdlNo};
	$.ajax({
        url: "/on/oh/ohz/PayBooking/applyMovieCpon.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//예매화면 할인내역 갱신
        	setMovieDcInfo(data.policyList);

        	$('#btn_cancel_mcoupon').show(); //취소버튼
        	$('#btn_cancel_apply_mcoupon').show(); //적용취소버튼

        	//닫기버튼 클릭
        	$('#layer_201006 .close-layer').click();
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
	});
}

</script>


<!-- 레이어 : 메가박스 관람권 -->
<section id="layer_201006" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">메가박스 관람권<!-- 메가박스 관람권 --></h3>
		</header>

		<div class="layer-con">
			<div class="reset mb10">
				보유하신 관람권은 등록 후 사용하실 수 있습니다.<br>사용할 관람권을 등록 또는 선택해주세요.
				<!-- 보유하신 관람권은 등록 후 사용하실 수 있으며 등록된 관람권은<br />
				온라인에서만 사용 가능합니다. 사용할 관람권 또는 쿠폰을 선택해주세요. -->
			</div>

			<div class="popup-gray mid-info-box">
				<div class="pop-search-area">
					<p class="sh-txt reset mr08"><span class="label">관람권번호<!-- 관람권번호 --></span></p>

					<div class="sh-input">
						<input type="text" placeholder="관람권번호 12자리 또는 16자리 입력" title="메가박스 관람권 번호 입력" class="input-text w270px" id="mcouponNo" maxlength="16">
					</div>

					<div class="sh-btn gray">
						<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#layer_movie_megabox_coupon_regi" w-data="600" h-data="320" class="button small gray btn-modal-open" id="btn_reg_mcoupon" title="관람권등록">관람권등록<!-- 관람권등록 --></a>
					</div>
				</div>
			</div>

			<div class="table-wrap divide">
				<table class="board-list line">
					<caption>관람권, 유효기간, 사용여부 항목을 가진 영화관람권 목록의 제목 표<!-- 관람권, 유효기간, 사용여부 항목을 가진 영화관람권 목록의 제목 표 --></caption>
					<colgroup>
						<col>
						<col style="width:200px;">
						<col style="width:56px;">
					</colgroup>
					<thead>
						<tr>
							<th scope="col">관람권<!-- 관람권 --></th>
							<th scope="col">유효기간<!-- 유효기간 --></th>
							<th scope="col">사용<!-- 사용 --></th>
						</tr>
					</thead>
				</table>

				<!--
					상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
				 -->
				<div class="scroll" style="min-height:129px; max-height:129px;">
					<table class="board-list line">
						<caption>관람권, 유효기간, 사용여부 항목을 가진 영화관람권 목록의 내용 표<!-- 관람권, 유효기간, 사용여부 항목을 가진 영화관람권 목록의 내용 표 --></caption>
						<colgroup>
							<col>
							<col style="width:200px;">
							<col style="width:56px;">
						</colgroup>
						<tbody>
							<!-- <tr>
								<td class="a-l">
									<strong>관람권명</strong><br />
									1234-5678-1234-****
								</td>
								<td>2019-01-08~2019-01-31</td>
								<td>
									<input type="checkbox" title="사용" />
								</td>
							</tr>
							<tr>
								<td class="a-l">
									<strong>부티크프라이빗 관람권</strong><br />
									1234-5678-1234-****
								</td>
								<td>2019-01-08~2019-01-31</td>
								<td>
									<input type="checkbox" title="사용" />
								</td>
							</tr>
							<tr>
								<td class="a-l">
									<strong>부티크프라이빗 관람권</strong><br />
									1234-5678-1234-****
								</td>
								<td>2019-01-08~2019-01-31</td>
								<td>
									<input type="checkbox" title="사용" />
								</td>
							</tr>
							<tr>
								<td class="a-l">
									<strong>부티크프라이빗 관람권</strong><br />
									1234-5678-1234-****
								</td>
								<td>2019-01-08~2019-01-31</td>
								<td>
									<input type="checkbox" title="사용" />
								</td>
							</tr>
							<tr>
								<td class="a-l">
									<strong>부티크프라이빗 관람권</strong><br />
									1234-5678-1234-****
								</td>
								<td>2019-01-08~2019-01-31</td>
								<td>
									<input type="checkbox" title="사용" />
								</td>
							</tr> -->
						</tbody>
					</table>
				</div>
			</div>

			<div class="box-border v1 use-guide mt15">
				<p class="tit">이용안내<!-- 이용안내 --></p>

				<ul class="dot-list">
					<li>온라인에 등록된 관람권은 극장 매표소에서는 사용이 불가합니다.<!-- 등록된 관람권은 나의메가박스에서 확인 및 삭제하실 수 있습니다. --></li>
					<li>등록된 관람권은 나의메가박스에서 확인하실 수 있습니다.<!-- 등록된 관람권은 나의메가박스에서 확인 및 삭제하실 수 있습니다. --></li>
					<li>2021년도 라이프다이어리 내에 관람권은 '메가박스포인트/쿠폰'&gt;'메가박스할인쿠폰'에서 등록 후 사용 가능합니다.</li>
				</ul>
			</div>
		</div>
		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_mcoupon">닫기<!-- 닫기 --></button>
			<button type="button" class="button small purple" id="btn_cancel_apply_mcoupon" style="display:none;">적용취소<!-- 적용취소 --></button>
			<button type="button" class="button small purple" id="btn_apply_mcoupon">적용<!-- 적용 --></button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_mcoupon">레이어 닫기<!-- 레이어 닫기 --></button>
	</div>
</section>
<!--// 레이어 : 메가박스 관람권 -->

	<!--// 레이어 : 메가박스 관람권 -->

	<!-- 레이어 : 메가박스 멤버십 포인트 -->
	





<script type="text/javascript">
var mempNormalMemberChgInfo = new Object();	//memp normal
var arrSelSeatUniqNo = null;

//초기화 공통 sMethodName.init
function memp_init() {  //전체초기화
	setInitMempPoint();
	mempNormalMemberChgInfo = new Object();
}

$(function() {
	// 포인트 체크박스
	$(document).on('click', ':input:checkbox', function(e){
		var totPoint = 0;
		var totCnt = 0;
		arrSelSeatUniqNo = new Array();

		$('[id^="memp_chk_point_"]').each(function() {
			if($(this).prop('checked')) {
				totPoint = totPoint + $(this).val().toInt();
				totCnt++;

				var objSelSeat = new Object();
				var seatUniqNo = $(this).attr('seatUniqNo');

				objSelSeat['seatUniqNo'] = seatUniqNo;
				arrSelSeatUniqNo.push(objSelSeat);
			}
		});

		$('#mempUseTotalPoint').text(totPoint.format());
		$('#mempUseTotalPointCnt').text(totCnt.format());

	});

	//멤버십 포인트 적용
	$('#btn_apply_memp').on('click', function() {

		// 포인트 비밀번호 입력란이 노출될때
		if($('#viewPointPw').css('display') == 'none'){
			applyMempPoint();
		}else{
			// 포인트 비밀번호 체크
			var pointPwd = $('#pointPwd').val();

			if(pointPwd.length != 4){
				gfn_alertMsgBox("포인트 비밀번호 4자리를 입력해주세요.");
				return;
			}

	        // 포인트 비밀번호 확인
	        var paramData = {
	            'pointPwd' : pointPwd
	        };

	        $.ajaxMegaBox({
	            contentType   : 'application/json;charset=UTF-8',
	            url           : '/pointPwCheck',
	            data          : JSON.stringify(paramData),
	            success       : function (data) {
	                var result = data.result;
	                if (result == "true") {
	                	applyMempPoint();
	                } else {
	                	gfn_alertMsgBox("포인트 비밀번호가 일치하지 않습니다.\n다시 입력해주세요.");
	                }
	            },
	            error: function(xhr,status,error){
	                var err = JSON.parse(xhr.responseText);
	                alert(err.message);
	            }
	        });

		}
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_memp').on('click', function() {
		var sMethodName = "memp";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_204001 .close-layer').click();
	});
});


//멤버십 포인트 초기화
function setInitMempPoint() {
	var checkListText = "";

	$('.usable-point').find('em').text("0"); // 사용가능 전체 포인트
	$('#mempOldPoint').text("0"); // 구포인트
	$('#mempNewPoint').text("0"); // 신포인트
	$('#mempUseTotalPoint').text("0"); // 적용된 총 포인트
	$('#mempUseTotalPointCnt').text("0") // 적용된 총 매수

	$('.chk-wrap').empty();
	for(var i=0; i<8; i++) {
		checkListText =  "<div class=\"block\"></div>";
		$('.chk-wrap').append(checkListText);
	}
}

//멤버십 포인트 조회
function searchMempPoint() {
	var transNo   = $("#transNo").val();

	memp_init(); // 초기화


	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	/*
	//if ($('#btn_cancel_apply_memp').is(':visible')) {
	if ($('#btn_cancel_apply_memp').css('display') != "none") {
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.'); //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.

		$('#btn_pay_memp').addClass("no-event");
		return;
	}
	$('#btn_pay_memp').removeClass("no-event");
	*/

	var paramData  = {transNo:transNo};
	//console.log("transNo :" + transNo);

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchMemberPoint.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//멤버십 포인트 전역변수 세팅
      	mempNormalMemberChgInfo = data.memShipInfo;

      	//멤버십 포인트 목록 세팅
      	setMempPointChg(mempNormalMemberChgInfo);

     // 포인트 비밀번호 사용시 노출
      	if(data.usePointPwAt == 'Y'){
      		$('#viewPointPw').show();
      	}else{
      		$('#viewPointPw').hide();
      		//gfn_alertMsgBoxSize("안전한 서비스 이용을 위해 메가박스 멤버십 포인트 사용시\n비밀번호 입력 후 사용할 수 있도록 안내하고 있습니다.\n\n설정을 원하시면 나의메가박스 > 포인트비밀번호 설정을 해주세요.",500,250);
      	}

      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}

//멤버십 포인트 목록 세팅
function setMempPointChg(pointInfo) {
	// 임시데이타 테스트옹
	/*
	pointInfo = {
			oldRestPoint : 5000,
			restPoint : 20000,
			comboList : [{useCnt:1, useAmt:8000, seatUniqNo:'00201301'},
					  	 {useCnt:2, useAmt:8000, seatUniqNo:'00201001'},
					     {useCnt:3, useAmt:8000, seatUniqNo:'00201101'},
					 	 {useCnt:4, useAmt:8000, seatUniqNo:'00201201'}]
	}
	*/

	// 구포인트가 없을 경우 포인트 구분정보 보여주지 않음
	// if (pointInfo.oldRestPoint == 0) {
	// 	$('.point-div').hide();
	// }
	// // 구포인트는 평일만 사용가능(주말,공휴일인 경우 화면상 diabled), 1:일요일, 7:토요일, 8:공휴일
	// if ($('#dowCd').text() == "1" || $('#dowCd').text() == "7" || $('#dowCd').text() == "8") {
	// 	$('#divOldPoint').addClass('disabled');
	// }

	$('.usable-point').find('em').text(pointInfo.useAbleAmt.format()); // 사용가능 전체 포인트
	// $('#mempOldPoint').text(pointInfo.oldRestPoint.format()); // 구포인트
	// $('#mempNewPoint').text(pointInfo.restPoint.format()); // 신포인트
	$('.chk-wrap').empty();

	var pointCheckListCnt = pointInfo.comboList.length;

	for(var i=0; i<8; i++) {
		if (pointCheckListCnt >= (i+1)) {
			var checkInfo = pointInfo.comboList[i];
			var appendHtml = "";

			appendHtml += "<div class=\"block\">";
			appendHtml += "<span class=\"bg\">";
			appendHtml += "		<input type=\"checkbox\" id=\"memp_chk_point_" + (i+1) + "\" seatUniqNo=\"" + checkInfo.seatUniqNo + "\" value=\"" + checkInfo.useAmt + "\"/> ";
			appendHtml += "     <label for=\"memp_chk_point_" + (i+1) + "\">" + checkInfo.useCnt + " (" + checkInfo.useAmt.format() + " P)</label>";
			appendHtml += "</span>";
			appendHtml += "</div>";

			$('.chk-wrap').append(appendHtml);
		} else {
			$('.chk-wrap').append("<div class=\"block\"></div>");
		}
	}
}

//멤버십 포인트 적용
function applyMempPoint() {
	var transNo = $("#transNo").val();
	//var  useCnt = '4',oldRestPoint = '0',restPoint = '62100';	//멤버십
	//var selSeat = [{seatUniqNo:'00201301'}, {seatUniqNo:'00201001'}, {seatUniqNo:'00201101'}, {seatUniqNo:'00201201'}];
	var useAmt = $('#mempUseTotalPoint').text().replaceAll(",","");
	var useCnt = $('#mempUseTotalPointCnt').text();
	var oldRestPoint = mempNormalMemberChgInfo.oldRestPoint;
	var restPoint = mempNormalMemberChgInfo.restPoint;
	var selSeat = arrSelSeatUniqNo;


	if ( useAmt.nvlNum(0) == 0 ) {
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.'); //할인 적용할 매수를 선택하세요.
		return;
	}

	var paramData = { oldRestPoint:oldRestPoint,restPoint:restPoint, transNo:transNo, useCnt:useCnt, selSeat:selSeat};
	//console.log(paramData);

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyMemberShip.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_memp').show(); //취소버튼
      	$('#btn_cancel_apply_memp').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_204001 .close-layer').click();
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}
</script>

<!-- 레이어 : 메가박스 멤버십 포인트 -->
<section id="layer_204001" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">메가박스 멤버십 포인트<!-- 메가박스 멤버십 포인트 --></h3>
		</header>

		<div class="layer-con">
			<!-- layer-membership-point -->
			<div class="layer-membership-point">
				<ul class="dot-list">
					<li>회원님께서 보유하고 있는 포인트가 조회됩니다.<!-- 회원님께서 보유하고 있는 포인트가 조회됩니다. --></li>
					<li>포인트 사용 관람 시, 티켓 가격 100%  차감 사용 가능합니다. (부분 사용 불가)<!-- 포인트 사용 관람 시, 티켓 가격 100%  차감 사용 가능합니다. (부분 사용 불가) --></li>
					<li>특별 콘텐트 및 일부 영화의 경우 포인트 사용 관람 불가합니다.<!-- 특별 콘텐트 및 일부 영화의 경우 포인트 사용 관람 불가합니다. --></li>
					<li>예매 취소 시 유효기간이 지난 멤버십 포인트는 복구되지 않습니다.<!-- 예매취소시 유효기간이 지난 멤버십 포인트는 복구되지 않습니다. --></li>
				</ul>

				<div class="usable-point">
					<i class="iconset ico-point"></i> 보유 멤버십 포인트<!-- 보유 멤버십 포인트 --> <span><em>0</em> P</span>
					<div id="viewPointPw" style="display:none;">
						<p class="sh-txt reset"><label for="pointPwd">포인트 비밀번호</label>
							<input type="text" id="pointPwd" title="포인트 비밀번호" class="input-text w120px x-small pwnew" maxlength="4" placeholder="숫자 4자리" style="margin-left: 20px;">
						</p>
					</div>
				</div>

				<!-- chk-point -->
				<div class="chk-point">
					<div class="chk-wrap">
						<!--
						<div class="block">
							<span class="bg">
								<input type="checkbox" name="memp_chk_point_1" id="memp_chk_point_1" /> <label for="memp_chk_point_1">1 (8,000 P)</label>
							</span>
						</div>
						-->
					</div>

					<div class="total-point">
						총<!-- 총 --> <span id="mempUseTotalPoint">0</span> P / <span id="mempUseTotalPointCnt">0</span> 매<!-- 매 -->
					</div>
				</div>
				<!--// chk-point -->
			</div>
			<!--// layer-membership-point -->
		</div>
		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer">닫기<!-- 닫기 --></button>
			<button type="button" class="button small purple" id="btn_cancel_apply_memp" style="display:none;">적용취소<!-- 적용취소 --></button>
			<button type="button" class="button small purple" id="btn_apply_memp">적용<!-- 적용 --></button>
		</div>

		<button type="button" class="btn-modal-close">레이어 닫기<!-- 레이어 닫기 --></button>
	</div>
</section>
<!--// 레이어 : 메가박스 멤버십 포인트 -->

	<!--// 레이어 : 메가박스 멤버십 포인트 -->

	<!-- 레이어 : 스토어교환권 -->
	





<script type="text/javascript">
var storeChgList = new Array();

//초기화 공통 sMethodName.init
function scoupon_init() {
    setInitStoreChg();
    storeChgList = new Array();
    $('#scouponNo').val('');
}

$(function() {
    //스토어 교환권 문자만 사용
    //$("#scouponNo").megaBoxNumberCheck();

    //교환권 등록버튼 클릭
    $('#btn_reg_scoupon').on('click', function() {
        registStore();
    });

    //적용버튼 클릭
    $('#btn_apply_scoupon').on('click', function() {
        applyStoreChg();
    });

    //적용취소버튼 클릭
    $('#btn_cancel_apply_scoupon').on('click', function() {
        var sMethodName = "scoupon";
        cancelMbxSellCpInfo(sMethodName);

        //닫기버튼 클릭
           $('#layer_201003 .close-layer').click();
    });

    //닫기버튼 클릭
    $('#btn_close_scoupon, #btn_close_modal_scoupon').on('click', function() {
    	$('#scouponNo').val('');
    });
});

//스토어교환권 존재여부
function getInitStoreChgCnt() {
    //return $('#layer_store_change .table-wrap > table > tbody> tr').length;
    return $('#layer_201003 .table-wrap > .scroll > table > tbody> tr').length;
}

//스토어교환권 초기화
function setInitStoreChg() {
    //$('#layer_store_change .table-wrap > table > tbody> tr').remove();
    $('#layer_201003 .table-wrap > .scroll > table > tbody> tr').remove();
}

//스토어교환권 등록
function registStore() {
    //초기화
    var transNo     = $("#transNo").val();
    var scouponNo   = $("#scouponNo").val();

    //스토어교환권 자릿수 체크
    if (scouponNo.length != 16) {
        gfn_alertMsgBox('스토어교환권 번호 16자리를  입력하세요.');	//스토어교환권 16자리를 입력하세요
        $("#scouponNo").focus();
        return;
    }

    //기 조회여부 체크
    for(var i=0;i<storeChgList.length;i++) {
        if (scouponNo.substring(0, 16) == storeChgList[i].cmbndNo) {
            gfn_alertMsgBox('이미 조회 되었습니다.');
            return;
        }
    }

    var paramData  = {scouponNo:scouponNo, transNo:transNo, cmbnd_type:'store' };
    $.ajax({
        url: "/on/oh/ohz/PayBooking/registVcCmbnd.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
        data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
            //console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

            if (data.resultStatus == 'Y') {
                addStoreChg(scouponNo.substring(0, 16));
            } else {
				if (data.resultMsg != null && data.resultMsg != undefined) {
					gfn_alertMsgBox(data.resultMsg);
				} else {
					gfn_alertMsgBox('기명처리 불가한 교환권입니다.');
				}
            }
        },
        error: function(xhr,status,error){
            var err = JSON.parse(xhr.responseText);
            //err.statCd 에 따라서 이전화면으로 리턴 가능토록
            errBookingChk(err.msg);
        }
    });

}

//스토어교환권 추가
function addStoreChg(scouponNo) {
    //초기화
    var transNo     = $("#transNo").val();
    var paramData  = {transNo:transNo, cmbndNo:scouponNo };

    $.ajax({
        url: "/on/oh/ohz/PayBooking/searchVcCmbnd.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
        data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
            //console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

            //쿠폰 전역변수 세팅
            var vcCmbndList = data.vcCmbndList[0];

            storeChgList.push(vcCmbndList);
            var i = storeChgList.length-1;


        	var expoNo  = storeChgList[i].cmbndNo.substring(0,4)
			+"-"+storeChgList[i].cmbndNo.substring(4,8)
			+"-"+storeChgList[i].cmbndNo.substring(8,12)
			+"-****";

			cponListText = '<tr> ';
			cponListText += '	<td class="a-l">'+storeChgList[i].cmbndExpoNm+'<p class="inner-code">'+expoNo+'</p></td> ';
            cponListText += '	<td class="a-l"> ';
            //cponListText += '		총(0/1) | 주간(0/1) | 월간(0/1)<br /> '; 현재 영어에서 제한횟수 관리가 되고 있지 않음. 추후 추가 필요
            cponListText += '		'+String(storeChgList[i].validStartDe).maskDate()+'~'+String(storeChgList[i].validExprDe).maskDate()+' ';
            cponListText += '	</td> ';
            cponListText += '	<td><input type="checkbox" title="" name="chkSCpon" idx="'+i+'" cponno="'+storeChgList[i].cmbndNo+'" selldivcd="'+storeChgList[i].sellDivCd+'"/></td> '; //MSG 스토어권 사용
            cponListText += '</tr> ';

            //$('#layer_store_change .table-wrap > table > tbody').append(cponListText);
            $('#layer_201003 .table-wrap > .scroll > table > tbody').append(cponListText);

            // 관람권 버튼 카운트 갱신
            if(storeCmbndCnt != storeChgList.length){
                storeCmbndCnt = storeChgList.length;

                $('li[paydcmeancd="popup_201003"]').find('em').text('('+storeCmbndCnt+')');
            }

            $('#scouponNo').val('');

            setChkStoreEvent();
        },
        error: function(xhr,status,error){
            var err = JSON.parse(xhr.responseText);
            //err.statCd 에 따라서 이전화면으로 리턴 가능토록
            errBookingChk(err.msg);
        }
    });
}


//스토어교환권 조회
function searchStoreChg() {
    //초기화
    var transNo     = $("#transNo").val();
    var paramData  = {transNo:transNo };

    $('#layer_201003 .table-wrap > .scroll > table > tbody> tr').remove();
    storeChgList = new Array();

    $.ajax({
        url: "/on/oh/ohz/PayBooking/searchVcCmbnd.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
        data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
            //console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

            //쿠폰 전역변수 세팅
            var vcCmbndList = data.vcCmbndList;
            for(var i=0;i<vcCmbndList.length;i++){
                storeChgList.push(vcCmbndList[i]);
            }

            //쿠폰 목록 세팅
            setStoreChg(storeChgList);
        },
        error: function(xhr,status,error){
            var err = JSON.parse(xhr.responseText);
            //err.statCd 에 따라서 이전화면으로 리턴 가능토록
            errBookingChk(err.msg);
        }
    });
}


//스토어교환권 목록 세팅
function setStoreChg(cponList) {
    setInitStoreChg();
    var cponListText = "";
    for(var i=0;i<cponList.length;i++) {
    	var expoNo  = cponList[i].cmbndNo.substring(0,4)
						+"-"+cponList[i].cmbndNo.substring(4,8)
						+"-"+cponList[i].cmbndNo.substring(8,12)
						+"-****";

        cponListText = '<tr> ';
        cponListText += '	<td class="a-l">'+cponList[i].cmbndExpoNm+'<p class="inner-code">'+expoNo+'</p></td> ';
        cponListText += '	<td class="a-l"> ';
        //cponListText += '		총(0/1) | 주간(0/1) | 월간(0/1)<br /> '; 현재 영어에서 제한횟수 관리가 되고 있지 않음. 추후 추가 필요
        cponListText += '		'+String(cponList[i].validStartDe).maskDate()+'~'+String(cponList[i].validExprDe).maskDate()+' ';
        cponListText += '	</td> ';
        cponListText += '	<td><input type="checkbox" title="" name="chkSCpon" idx="'+i+'" cponno="'+cponList[i].cmbndNo+'" selldivcd="'+storeChgList[i].sellDivCd+'"/></td> '; //MSG 스토어권 사용
        cponListText += '</tr> ';

        //$('#layer_store_change .table-wrap > table > tbody').append(cponListText);
        $('#layer_201003 .table-wrap > .scroll > table > tbody').append(cponListText);
        if($('#layer_201003 .table-wrap > .scroll > table > tbody').height() > $('#layer_201003 .table-wrap > .scroll').height()) {
            $('#layer_201003 .table-wrap > .scroll').css("margin-right", "-17px");
        }

        setChkStoreEvent();
    }
}


//체크박스 이벤트
function setChkStoreEvent() {
	$(":checkbox[name='chkSCpon']").off().on('click', function() {

		var selldivcd = $(this).attr('selldivcd');

		if (!$(this).prop('checked')) {
			return;
		}
		var transNo    = $("#transNo").val();
		var cmbndNo    = storeChgList[$(this).attr('idx')].cmbndNo;
		var methodName = "scoupon";
		var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName};
		var idx        = $(this).attr('idx');

		$.ajax({
	        url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		return;
	        	}

                if(selldivcd == 'SEDC03'){

                    var almsg = '조회하신 교환권에 매점상품이 포함되어 있습니다. <br><br>매점 교환권은 현장 매점 또는 KIOSK에서 사용가능하며, 자세한 사용방법은 상품 상세 페이지 확인 부탁드립니다.';
                    gfn_alertMsgBox({ msg: almsg });
                }

	        	
	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);

	        	//추후 order 변경 등 고려 foreach 로 처리
	        	$(":checkbox[name='chkSCpon']").each(function() {
					if ($(this).attr('idx') == idx) {
						$(this).prop('checked', false);
					}
	        	});
	        }
		});

	});
}


//스토어교환권 적용
function applyStoreChg() {
    var chkCnt = $(":checkbox[name='chkSCpon']:checked").length;

    if ( chkCnt == 0 ) {
        gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
        return;
    }

    var transNo     = $("#transNo").val();
    var playSchdlNo = $("#playSchdlNo").val();
    var paramCpon   = new Array();

    $(":checkbox[name='chkSCpon']:checked").each(function(idx) {
        storeChgList[$(this).attr('idx')].transNo = transNo;
        paramCpon.push(storeChgList[$(this).attr('idx')]);
    });

    var paramData = {transNo:transNo, cponList:paramCpon, playSchdlNo:playSchdlNo};
    $.ajax({
        url: "/on/oh/ohz/PayBooking/applyVcCmbnd.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
        data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
            //console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

            //예매화면 할인내역 갱신
            setMovieDcInfo(data.policyList);

            $('#btn_cancel_scoupon').show(); //취소버튼
            $('#btn_cancel_apply_scoupon').show(); //적용취소버튼

            //닫기버튼 클릭
            $('#layer_201003 .close-layer').click();
        },
        error: function(xhr,status,error){
            var err = JSON.parse(xhr.responseText);
            //err.statCd 에 따라서 이전화면으로 리턴 가능토록
            errBookingChk(err.msg);
        }
    });
}

</script>

<!-- 레이어 : 스토어교환권 -->
<section id="layer_201003" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
    <div class="wrap">
        <header class="layer-header">
            <h3 class="tit">스토어교환권<!-- 스토어교환권 --></h3>
        </header>

        <div class="layer-con">
            <div class="popup-gray v1 mt0">
                <div class="pop-search-area">
                    <p class="sh-txt reset"><span class="label">교환권번호<!-- 교환권번호 --></span></p>

                    <div class="sh-input ml08"><input type="text" title="스토어교환권 번호입력" class="input-text w200px" id="scouponNo" name="scouponNo" maxlength="16"></div><!-- 스토어교환권 번호입력 -->

                    <div class="sh-btn gray">
                        <button type="button" class="button small gray" id="btn_reg_scoupon">교환권등록<!-- 교환권등록 --></button>
                    </div>
                </div>
            </div>

            <div class="table-wrap divide mt15">
                <table class="board-list line">
                    <caption>교환권 정보, 사용내역/유효기간, 사용 항목을 가진 스토어교환권 제목표<!-- 교환권 정보, 사용내역/유효기간, 사용 항목을 가진 스토어교환권 제목표 --></caption>
                    <colgroup>
                        <col style="width:220px;">
                        <col>
                        <col style="width:60px;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th scope="col">교환권 정보<!-- 교환권 정보 --></th>
                            <th scope="col">사용내역/유효기간<!-- 사용내역/유효기간 --></th>
                            <th scope="col">사용<!-- 사용 --></th>
                        </tr>
                    </thead>
                </table>

                <!--
                    상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
                 -->
                <div class="scroll" style="min-height:299px; max-height:299px;">
                    <table class="board-list line">
                        <caption>교환권 정보, 사용내역/유효기간, 사용 항목을 가진 스토어교환권 내용표<!-- 교환권 정보, 사용내역/유효기간, 사용 항목을 가진 스토어교환권 내용표 --></caption>
                        <colgroup>
                            <col style="width:220px;">
                            <col>
                            <col style="width:60px;">
                        </colgroup>
                        <tbody>
                            <!-- <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr>
                            <tr>
                                <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                <td class="a-c">
                                    총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                    / 2019.03.25~2021.03.24<br />
                                    주말에만 사용 가능
                                </td>
                                <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="btn-group-fixed">
            <button type="button" class="button small close-layer" id="btn_close_scoupon">닫기<!-- 닫기 --></button>
            <button type="button" class="button small purple" id="btn_cancel_apply_scoupon" style="display:none;">적용취소<!-- 적용취소 --></button>
            <button type="button" class="button small purple" id="btn_apply_scoupon">적용<!-- 적용 --></button>
        </div>

        <button type="button" class="btn-modal-close" id="btn_close_modal_scoupon">레이어 닫기<!-- 레이어 닫기 --></button>
    </div>
</section>
<!-- 레이어 : 스토어교환권 -->

	<!--// 레이어 : 스토어교환권 -->

	<!-- 레이어 : 기프티콘 -->
	
	<!--// 레이어 : 기프티콘 -->

	<!-- 레이어 : 기프티쇼 -->
	
	<!--// 레이어 : 기프티쇼 -->

	<!-- 레이어 : G마켓 -->
	
	<!--// 레이어 : G마켓 -->

	<!-- 레이어 : 아이넘버 -->
	
	<!-- // 레이어 : 아이넘버 -->

	<!-- 레이어 : 도넛북 -->
	
	<!-- // 레이어 : 도넛북 -->

	<!-- 레이어 : 스마트콘 -->
	
	<!-- // 레이어 : 스마트콘 -->

	<!-- 레이어 : 제휴예매권 -->
	
	<!-- // 레이어 : 제휴예매권 -->

	<!-- 레이어 : 메가박스 프렌즈 -->
	





<script type="text/javascript">
var friendsChgInfo = new Object();

//초기화 공통 sMethodName.init
function friends_init() {  //메가박스 프렌즈 전체초기화'

	setInitFriends();
	friendsChgInfo = new Object();

	$('#friendsCardNum').val('');
	$('#friendsCardNum_hid').val('');
	$('#tdFriendsDayLmt').html('');
	$('#tdFriendsMonthLmt').html('');
	$('#tdTdayBokdAbleAt').html('');
	$('#tdMovieDupUseAt').html('');
}

$(function() {
	//숫자만 입력가능
	$('#friendsCardNum').megaBoxCardNumberCheck();

	//조회버튼 클릭
	$('#btn_select_friends').on('click', function() {
		searchFriends();
	});

	//프렌즈 적용
	$('#btn_apply_friends').on('click', function() {
		applyFriends();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_friends').on('click', function() {
		var sMethodName = "friends";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
		$('#layer_205003 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_friends, #btn_close_modal_friends').on('click', function() {
		if (!$('#btn_cancel_apply_friends').is(':visible')) {
			friends_init();
		}
	});
});

//메가박스 프렌즈 포인트 초기화
function setInitFriends() {
	$('#layer_205003 select').html('<option value="0">매수할인선택</option>');
}

//메가박스 프렌즈 조회
function searchFriends() {
	var transNo = $('#transNo').val();
	var cardNo  = $('#friendsCardNum_hid').val();

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_friends').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == '') {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	var paramData = { cardNo:cardNo, transNo:transNo };

	$.ajax({
		url         : '/on/oh/ohz/PayBooking/searchFriendsMemShip.do',
		type        : 'POST',
		contentType : 'application/json;charset=UTF-8',
		dataType    : 'json',
		data        : JSON.stringify(paramData),
		success: function (data, textStatus, jqXHR) {
			if (!msgBookingLoginChk(data)) {
				return;
			}

			//쿠폰 전역변수 세팅
			friendsChgInfo = data.friendsInfo;

			//쿠폰 목록 세팅
			setFriendsChg(friendsChgInfo);
		},
		error: function(xhr,status,error){
			var err = JSON.parse(xhr.responseText);
			//err.statCd 에 따라서 이전화면으로 리턴 가능토록
			errBookingChk(err.msg);
		}
        , beforeSend : function() {
    		$('#btn_select_friends').prop("disabled", true);
    		$('#btn_select_friends').addClass('disabled');
    	}
    	, complete : function() {
    		setTimeout(function(){
       			$('#btn_select_friends').removeClass('disabled');
       			$('#btn_select_friends').prop("disabled", false);
    		},1500);
    	}
	});
}

//메가박스 프렌즈 목록 세팅
function setFriendsChg(friendsInfo) {

	var useAmt01 = 0;
	var useAmt02 = 0;

	setInitFriends();

	$.each(friendsInfo.personComboList, function(i, param) {
		useAmt01 += param.useAmt;
		$('#selFriends01').append('<option value="'+param.useCnt+'">'+param.useCnt+'매'+' (-'+String(useAmt01).maskNumber()+')</option>');
	});

	$.each(friendsInfo.partnerComboList, function(i, param) {
		useAmt02 += param.useAmt;
		$('#selFriends02').append('<option value="'+param.useCnt+'">'+param.useCnt+'매'+' (-'+String(useAmt02).maskNumber()+')</option>');
	});

	if (friendsInfo.tktDayUseNmrsLmt == "999") {
		$('#tdFriendsDayLmt').html('무제한');
	} else {
		$('#tdFriendsDayLmt').html(friendsInfo.tktDayUseNmrsLmt);
	}

	if (friendsInfo.tktMonthUseNmrsLmt == "999") {
		$('#tdFriendsMonthLmt').html('무제한');
	} else {
		$('#tdFriendsMonthLmt').html(friendsInfo.tktMonthUseNmrsLmt);
	}

	if (friendsInfo.movieDupUseAt == "Y") {	//영화중복	--가능 --불가
		$('#tdMovieDupUseAt').html('가능');	//가능
	} else {
		$('#tdMovieDupUseAt').html('불가');	//불가
	}

	if (friendsInfo.tdayBokdAbleAt == "Y") {	//당일예매	--당일+후일 --당일
		$('#tdTdayBokdAbleAt').html('당일');	//당일
	} else {
		$('#tdTdayBokdAbleAt').html('당일+후일');	//당일+후일
	}
}

//메가박스 프렌즈 적용
function applyFriends() {

	var transNo    = $('#transNo').val();
	var cardNo     = $('#friendsCardNum_hid').val();
	var personCnt  = $('#selFriends01 option:selected').val();
	var partnerCnt = $('#selFriends02 option:selected').val();
	var mmnyDcPolicNo = friendsChgInfo.mmnyDcPolicNo;


	if (personCnt == 0) {
		//본인관람가에 적용할 매수를 선택하세요.
		gfn_alertMsgBox('본인관람가에 적용할 매수를 선택하세요.');
		return;
	}

	if (cardNo == '') {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	var paramData = { cardNo:cardNo,transNo:transNo, personCnt:personCnt, partnerCnt:partnerCnt, mmnyDcPolicNo:mmnyDcPolicNo };

	$.ajax({
		url        : '/on/oh/ohz/PayBooking/applyFriendsMemShip.do',
		type       : 'POST',
		contentType: 'application/json;charset=UTF-8',
		dataType   : 'json',
		data       : JSON.stringify(paramData),
		success    : function (data, textStatus, jqXHR) {
			//console.log(data);
			if (!msgBookingLoginChk(data)) {
				return;
			}

			//할인내역 갱신
			setMovieDcInfo(data.policyList);

			$('#btn_cancel_friends').show(); //취소버튼
			$('#btn_cancel_apply_friends').show(); //적용취소버튼

			//닫기버튼 클릭
			$('#layer_205003 .close-layer').click();
			$('#joongangFamily-display').addClass('display-none');
		},
		error: function(xhr,status,error){
			var err = JSON.parse(xhr.responseText);
			//err.statCd 에 따라서 이전화면으로 리턴 가능토록
			errBookingChk(err.msg);
		}
	});
}
</script>

<!-- 레이어 : 메가박스 프렌즈 -->
<input type="hidden" id="friendsCardNum_hid">
<section id="layer_205003" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">플래티넘/스타카드/프렌즈<!-- 메가박스 프렌즈 --></h3>
		</header>

		<div class="layer-con">
			<div class="popup-gray mid-info-box mt0">
				<div class="pop-search-area">
					<p class="sh-txt reset mr08"><span class="label">카드번호<!-- 카드번호 --></span></p>

					<div class="sh-input">
						<input type="text" title="메가박스 프랜즈 카드번호 입력" class="input-text w200px" id="friendsCardNum" maxlength="16">
					</div>

					<div class="sh-btn gray">
						<button type="button" class="button small gray" id="btn_select_friends">조회<!-- 조회 --></button>
					</div>
				</div>
			</div>

			<div class="table-wrap device">
				<table class="board-form">
					<caption>메가박스 프랜즈 멤버십을 본인 관람가, 동반자 관람단가, 월 제한수, 일 제한수, 주말가능, 관람가능일 순서로 입력하는 표<!-- 메가박스 프랜즈 멤버십을 본인 관람가, 동반자 관람단가, 월 제한수, 일 제한수, 주말가능, 관람가능일 순서로 입력하는 표 --></caption>
					<colgroup>
						<col style="width:125px;">
						<col>
						<col style="width:125px;">
						<col>
					</colgroup>
					<tbody>
						<tr>
							<th scope="row"><label for="selFriends01">본인 관람가<!-- 본인 관람가 --></label></th>
							<td colspan="3">
								<select id="selFriends01" class="w150px x-small">
									<option>매수할인선택<!-- 매수할인선택 --></option>
								</select>
							</td>
						</tr>
						<tr>
							<th scope="row"><label for="selFriends02">동반자 관람단가<!-- 동반자 관람단가 --></label></th>
							<td colspan="3">
								<select id="selFriends02" class="w150px x-small">
									<option>매수할인선택<!-- 매수할인선택 --></option>
								</select>
							</td>
						</tr>
						<tr>
							<th scope="row">월 제한수<!-- 월 제한수 --></th>
							<td id="tdFriendsMonthLmt"></td>
							<th scope="row">일 제한수<!-- 일 제한수 --></th>
							<td id="tdFriendsDayLmt"></td>
						</tr>
						<tr>
							<th scope="row">당일예매<!-- 당일예매 --></th>
							<td id="tdTdayBokdAbleAt"></td>
							<th scope="row">영화중복<!-- 영화중복 --></th>
							<td id="tdMovieDupUseAt"></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_friends">닫기<!-- 닫기 --></button>
			<button type="button" class="button small purple" id="btn_cancel_apply_friends" style="display:none;">적용취소<!-- 적용취소 --></button>
			<button type="button" class="button small purple" id="btn_apply_friends">적용<!-- 적용 --></button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_friends">레이어 닫기<!-- 레이어 닫기 --></button>
	</div>
</section>
<!--// 레이어 : 메가박스 프렌즈 -->

	<!--// 레이어 : 메가박스 프렌즈 -->

	<!-- 레이어 : 메가박스 아너스카드 -->
	





<script type="text/javascript">
var annusChgInfo = new Object();

//초기화 공통 sMethodName.init
function annusgift_init() {  //아너스카드 전체초기화
	// setInitAnnus();
	annusChgInfo = new Object();

	$('#annusCardNum').val('');
	$('#annusCvcNum').val('');
	$('#annusCardNum_hid').val('');
	$('#annusCvcNum_hid').val('');
	$('#annusUseAbleAmt').text('0');
	$('#annusUseCash').val("");
}

$(function() {
	//숫자만 입력가능
	$('#annusCardNum').megaBoxCardNumberCheck();
	$('#annusCvcNum').megaBoxCvcNumberCheck();
	$('#annusAbleCash').megaBoxCommaNumberCheck();
	$('#annusUseCash').megaBoxCommaNumberCheck();

	//조회버튼 클릭
	$('#btn_select_annus').on('click', function() {
		searchAnnus();
	});

	//아너스카드 적용
	$('#btn_apply_annus').on('click', function() {
		applyAnnus();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_annusgift').on('click', function() {
		var sMethodName = "annusgift";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_103003 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_annus, #btn_close_modal_annus').on('click', function() {
		if (!$('#btn_cancel_apply_annusgift').is(':visible')) {
			annusgift_init();
		}
	});
});


//아너스카드 초기화
function setInitAnnus() {
	$('#selAnnus > option').remove();
	$('#selAnnus').append('<option value="0">선택</option>');
}

//아너스카드 조회
function searchAnnus() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#annusCardNum_hid").val();
	const cvvCd    = $("#annusCvcNum_hid").val();

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_annusgift').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "" || cardNo.length < 16 || cvvCd == "" || cvvCd.length < 7) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo, cvvCd:cvvCd};

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchAnnusGiftCard.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//쿠폰 전역변수 세팅
      	annusChgInfo = data.annusInfo;

      	//쿠폰 목록 세팅
      	setAnnusChg(annusChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
		//error 발생시 사용가능금액 초기화
		$('#annusUseAbleAmt').text('0');
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#btn_select_annus').prop("disabled", true);
  		$('#btn_select_annus').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#btn_select_annus').removeClass('disabled');
     			$('#btn_select_annus').prop("disabled", false);
  		},1500);
  	  }
	});
}

//아너스카드 목록 세팅
function setAnnusChg(cponInfo) {
	// setInitAnnus();
	// var cponListText = "";

	$('#annusUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());

	// var cponList = cponInfo.comboList;
	// var useAmt   = 0;
	
	
    
	
	
}

//아너스카드 적용
function applyAnnus() {

	var transNo  = $("#transNo").val();
	var cardNo   = $("#annusCardNum_hid").val();
	// var useCnt   = $('#selAnnus option:selected').val();
	const useCash = getMonenyNum($("#annusUseCash").val()); //사용 금액
	const useAbleAmt = getMonenyNum($("#annusUseAbleAmt").text()); // 보유 금액
	const remainAmt = getMonenyNum($('.receipt .row.total span').text()); //최종 결제금액
	const cvvCd = $("#annusCvcNum_hid").val();

	//카드번호 체크
	if (cardNo == "" || cardNo.length < 16 || cvvCd == "" || cvvCd.length < 7) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	//사용할 금액 체크
	if (useCash == 0) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
		return;
	}

	//보유 금액 체크
	if (useAbleAmt == 0) {
		gfn_alertMsgBox('사용가능 금액이 없습니다.');
		return;
	}

	//사용금액 체크 - 사용금액(#1)이 보유금액(#2)을 초과했습니다.
	if (useAbleAmt < useCash) {
		gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',getMoneyStr(useCash)).replace('#2',getMoneyStr(useAbleAmt)));
		return;
	}

	//사용금액 체크 - 사용금액(#1)이 결제 금액(#2)보다 큽니다.
	if (useCash > remainAmt) {
		gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',getMoneyStr(useCash)).replace('#2',getMoneyStr(remainAmt)));
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo, cvvCd:cvvCd, useAmt: useCash};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyAnnusGiftCard.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_annus').show(); //취소버튼
      	$('#btn_cancel_apply_annusgift').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_103003 .close-layer').click();
		$('#joongangFamily-display').addClass('display-none');
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}

//적용 가능 캐시 모두 적용
function useCashAll() {

	const useAbleAmt = getMonenyNum($("#annusUseAbleAmt").text()); //보유금액
	const remainAmt = getMonenyNum($('.receipt .row.total span').text()); //최종 결제금액, 최대 사용 가능 금액

	if (useAbleAmt == 0) {
		gfn_alertMsgBox('사용가능 금액이 없습니다.');
		return;
	}

	let maxAmt = useAbleAmt > remainAmt ? remainAmt : useAbleAmt;
	$("#annusUseCash").val(getMoneyStr(maxAmt));
}

/**
 * 입력한 금액 숫자로 변환
 * @param money
 * @returns {Number|number}
 */
function getMonenyNum(money) {
	const _money = parseInt(String(money).replace(/[^0-9]/g,''));
	if(isNaN(_money)){
		return 0;
	}
	return _money;
}

/**
 * 입력한 금액 ','와 문자로 변환
 * @param money
 * @returns {*}
 */
function getMoneyStr(money) {
	let _money = parseInt(String(money).replace(/[^0-9]/g,''));
	if(isNaN(_money)){
		_money = 0;
	}
	return String(_money).maskNumber();
}
</script>

	<!-- 레이어 : 아너스카드 -->
	<input type="hidden" id="annusCardNum_hid">
	<input type="hidden" id="annusCvcNum_hid">
	<section id="layer_103003" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">메가박스 아너스카드 <!-- 메가박스 아너스카드 --></h3>
			</header>

			<div class="layer-con">
				<div class="reset">
					보유하고 계신 아너스카드 정보를 입력해주세요. 
				</div>
				<div class="popup-gray mid-info-box mb10">
					<div class="pop-search-area line-wid">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label class="label">카드번호 <!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" style="width: 214px;" title="메가박스 아너스카드 카드번호 입력 &lt;!-- 메가박스 아너스카드 카드번호 입력 --&gt;" class="input-text" id="annusCardNum" maxlength="16" placeholder="카드번호 &#39;-&#39;없이 입력 (16자리)">
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label class="label">CVC번호 <!-- CVC번호 --></label></p>
							<div class="sh-input">
								<input type="text" id="annusCvcNum" title="CVC번호" class="input-text w120px" placeholder="숫자 7자리 입력" maxlength="7">
							</div>

							<div class="sh-btn gray">
								<button type="button" class="button small gray" id="btn_select_annus">조회 <!-- 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label class="label">잔여금액 <!-- 잔여금액 --></label></p>
							<span class="font-green" id="annusUseAbleAmt">0</span>원
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label class="label">사용할 금액 <!-- 사용할 금액 --></label></p>
							<div class="sh-input">
								<input type="text" id="annusUseCash" title="사용할 금액" class="input-text w200px x-small" maxlength="10">
							</div>
							<div class="sh-btn ml05">
								<button type="button" class="button gray-line x-small" id="annusUseCashAll" onclick="useCashAll();">모두사용</button>
							</div>
						</div>
					</div>
				</div>

				<div class="box-border v1 use-guide mt10">
					<p class="tit">이용안내</p>

					<ul class="dot-list gray">
						<li>보유하신 아너스카드 번호 16자리, CVC번호 7자리를 조회해주세요.</li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_annus">닫기 <!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_annusgift" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_annus">적용 <!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_annus">레이어 닫기 <!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!-- 레이어 : 아너스카드 -->









	<!--// 레이어 : 메가박스 아너스카드 -->

	<!-- 레이어 : 메가박스 영화할인 쿠폰 -->
	





<script type="text/javascript">
var dcouponChgList = new Array();
var couponChkCnt = 0;

//초기화 공통 sMethodName.init
function dcoupon_init() {
	setInitDcouponChg();
	dcouponChgList = new Array();
	$('#dcouponNo').val('');
}

$(function() {
	//영화할인쿠폰 문자만 사용
	$("#dcouponNo").megaBoxNumberCheck();

	//영화할인쿠폰 등록버튼 클릭
	$('#btn_reg_dcoupon').on('click', function() {
		registDcoupon();
	});

	//적용버튼 클릭
	$('#btn_apply_dcoupon').on('click', function() {
		applyDcouponChg();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_dcoupon').on('click', function() {
		var sMethodName = "dcoupon";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
		$('#layer_202002 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_dcoupon, #btn_close_modal_dcoupon').on('click', function() {
		$('#dcouponNo').val('');
	});

});

//영화할인쿠폰 존재여부
function getInitDcouponChgCnt() {
	return $('#data_table tbody> tr').length;
}

//영화할인쿠폰 초기화
function setInitDcouponChg() {
	$('#data_table tbody> tr').remove();
}

//영화할인쿠폰 등록
function registDcoupon() {
	//초기화
	var transNo = $("#transNo").val();
	var cponNo  = $("#dcouponNo").val();

	//영화할인쿠폰 자릿수 체크
	if (cponNo.length < 8) {
		gfn_alertMsgBox("할인쿠폰 번호를 확인해주세요");	//영화할인쿠폰 16자리를 입력하세요
		$("#dcouponNo").focus();
		return;
	}

	//기 조회여부 체크
	for (var i = 0; i < dcouponChgList.length; i++) {
		if (dcouponChgList[i].cponNo == cponNo) {
			gfn_alertMsgBox('이미 조회 되었습니다.');
			return;
		}
	};

	var paramData  = {cponNo:cponNo, transNo:transNo};

	$.ajax({
		url         : '/on/oh/ohz/PayBooking/registDiscountCpon.do',
		type        : 'POST',
		contentType : 'application/json;charset=UTF-8',
		dataType    : 'json',
		data        : JSON.stringify(paramData),
		success: function (data, textStatus, jqXHR) {

			if (!msgBookingLoginChk(data)) {
				return;
			}

			if (data.resultStatus == 'Y') {
				addDcouponChg(cponNo);
                gfn_alertMsgBox("쿠폰등록이 완료 되었습니다.");
			} else {
				if (data.msg != undefined && data.msg != null) {
					gfn_alertMsgBox(data.msg);
				}
				//gfn_alertMsgBox('등록 처리 불가한 할인 쿠폰입니다.');
			}
		},
		error: function(xhr,status,error){
			var err = JSON.parse(xhr.responseText);
			//err.statCd 에 따라서 이전화면으로 리턴 가능토록
			errBookingChk(err.msg);
		}
	});
}

//영화할인쿠폰 추가
function addDcouponChg(cponNo) {
	//초기화
	var transNo   = $("#transNo").val();
	var paramData = {transNo:transNo};

	$.ajax({
		url         : '/on/oh/ohz/PayBooking/searchDiscountCpon.do',
		type        : 'POST',
		contentType : 'application/json;charset=UTF-8',
		dataType    : 'json',
		data        : JSON.stringify(paramData),
		success: function (data, textStatus, jqXHR) {

			if (!msgBookingLoginChk(data)) {
				return;
			}

			if( data.cponList.length > 0){

				// 추가된 쿠폰만 남기고 지움.
				var listA = data.cponList;

				for(var x=0; x < dcouponChgList.length; x++){
					for(var j=listA.length-1; j>=0; j--){
						if(dcouponChgList[x].cponNo == listA[j].cponNo){
							listA.splice(j,1);
						}
					}
				}

				var cponList = listA[0];
				dcouponChgList.push(cponList);
				var i = dcouponChgList.length-1;

				//console.log("-----------cponList" + cponList);
				var expoNo  = String(cponList.cponNo).substring(0,4)
				+"-"+String(cponList.cponNo).substring(4,8)
				+"-"+String(cponList.cponNo).substring(8,12)
				+"-****";

				cponListText  = '<tr>';
				cponListText += '	<td class="a-l">'+ cponList.cponNm +'<p class="inner-code">'+expoNo+'</p></td>';
				cponListText += '	<td>'+ cponList.validStartDe.maskDate() +'<br />~ '+ cponList.validEndDe.maskDate() +'</td>';
				cponListText += '	<td><input type="checkbox" title="쿠폰 사용여부 체크" name="chkDcoupon" data-idx="'+i+'"/></td>';
				cponListText += '</tr>';

				$('#data_table tbody').append(cponListText);
	            $('#dcouponNo').val('');

				// 할인쿠폰 버튼 카운트 갱신
				if(dcCnt != dcouponChgList.length){
					dcCnt = dcouponChgList.length;

					$('li[paydcmeancd="popup_202002"]').find('em').text('('+dcCnt+')');
				}

	            //체크박스 이벤트 생성
	    		setChkDisCponEvent();
			}
		},
		error: function(xhr,status,error){
			var err = JSON.parse(xhr.responseText);
			//err.statCd 에 따라서 이전화면으로 리턴 가능토록
			errBookingChk(err.msg);
		}
	});
}

//영화할인쿠폰 조회
function searchDcouponChg(searchMode) {
	//초기화
	var transNo   = $("#transNo").val();
	var paramData = { transNo:transNo, searchMode:searchMode };

	dcouponChgList = new Array();
	$('#data_table tbody> tr').remove();

	$.ajax({
		url         : '/on/oh/ohz/PayBooking/searchDiscountCpon.do',
		type        : 'POST',
		contentType : 'application/json;charset=UTF-8',
		dataType    : 'json',
		data        : JSON.stringify(paramData),
		success: function (data, textStatus, jqXHR) {
			// 안내문구 3줄로 인한 css수정처리
			$('#layer_202002 div.layer-con').css('height', '465px');

			if (!msgBookingLoginChk(data)) {
				return;
			}

			//쿠폰 전역변수 세팅
			$.each(data.cponList, function(i, param){
				dcouponChgList.push(param);
			});

			//쿠폰 목록 세팅
			setDcouponChg(dcouponChgList);
		},
		error: function(xhr,status,error){
			var err = JSON.parse(xhr.responseText);
			//err.statCd 에 따라서 이전화면으로 리턴 가능토록
			errBookingChk(err.msg);
		}
	});
}


//영화할인쿠폰 목록 세팅
function setDcouponChg(cponList) {
	setInitDcouponChg();

	var cponListText = '';

	$.each(cponList, function(i, param){
		var expoNo  = param.cponNo.substring(0,4)
						+"-"+param.cponNo.substring(4,8)
						+"-"+param.cponNo.substring(8,12)
						+"-****";
		var maxDcCponChoiYn = param.maxDcCponChoiYn;

		cponListText  = '<tr>';
		cponListText += '	<td class="a-l">'+ param.cponNm +'<p class="inner-code">'+expoNo+'</p></td>';
		cponListText += '	<td>'+ param.validStartDe.maskDate() +'<br />~ '+ param.validEndDe.maskDate() +'</td>';
		if(maxDcCponChoiYn == 'Y'){
			cponListText += '	<td><input type="checkbox" title="쿠폰 사용여부 체크" name="chkDcoupon" checked="checked" data-idx="'+i+'"/></td>';
		} else {
			cponListText += '	<td><input type="checkbox" title="쿠폰 사용여부 체크" name="chkDcoupon" data-idx="'+i+'"/></td>';
		}

		cponListText += '</tr>';

		$('#data_table tbody').append(cponListText);
		if($('#data_table tbody').height() > $('#layer_202002 .table-wrap > .scroll').height()) {
			$('#layer_202002 .table-wrap > .scroll').css("margin-right", "-17px");
		}

		//체크박스 이벤트 생성
		setChkDisCponEvent();
	});
}


//체크박스 이벤트
function setChkDisCponEvent() {
	$(":checkbox[name='chkDcoupon']").off().on('click', function() {

		if (!$(this).prop('checked')) {
			return;
		}
		
		couponChkCnt = couponChkCnt + 1;
        $(this).attr('data-ord', couponChkCnt);
		
		var $chk = $('#layer_202002 :checkbox[name="chkDcoupon"]:checked');
		
		$chk.sort(function(a, b) {
        	return a.attributes['data-ord'].value > b.attributes['data-ord'].value ? 1 : a.attributes['data-ord'].value < b.attributes['data-ord'].value ? -1 : 0;
        });

		if ($chk.length == 0) {
			gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
			return;
		}

		var transNo   = $('#transNo').val();
		var paramCpon = new Array();

		$.each($chk, function() {
			paramCpon.push({'cponNo' : dcouponChgList[$(this).data('idx')].cponNo});
		});

		var paramData = { transNo:transNo, cponList:paramCpon, redisUpdateAt:'N' };
		
		var idx        = $(this).attr('data-idx');

		$.ajax({
	        //url: "/on/oh/ohz/PayBooking/applyAbleCponChk.do",
	        url: '/on/oh/ohz/PayBooking/applyDiscountCpon.do',
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
			data: JSON.stringify(paramData),
	        success: function (data, textStatus, jqXHR) {
	        	//console.log(data);
	        	if (!msgBookingLoginChk(data)) {
	        		$(":checkbox[name='chkDcoupon']").each(function() {
						if ($(this).attr('data-idx') == idx) {
							$(this).prop('checked', false);
						}
		        	});
	        		return;
	        	}
	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	        	errBookingChk(err.msg);

	        	//추후 order 변경 등 고려 foreach 로 처리
	        	$(":checkbox[name='chkDcoupon']").each(function() {
					if ($(this).attr('data-idx') == idx) {
						$(this).prop('checked', false);
					}
	        	});
	        }
		});

	});
}


//영화할인쿠폰 적용
function applyDcouponChg() {

	var $chk = $('#layer_202002 :checkbox[name="chkDcoupon"]:checked');

	if ($chk.length == 0) {
		gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
		return;
	}

	var transNo   = $('#transNo').val();
	var paramCpon = new Array();

	$chk.sort(function(a, b) {
    	return a.attributes['data-ord'].value > b.attributes['data-ord'].value ? 1 : a.attributes['data-ord'].value < b.attributes['data-ord'].value ? -1 : 0;
    });
	
	$.each($chk, function() {
		paramCpon.push({'cponNo' : dcouponChgList[$(this).data('idx')].cponNo});
	});

	var paramData = { transNo:transNo, cponList:paramCpon, redisUpdateAt:'Y' };

	$.ajax({
		url         : '/on/oh/ohz/PayBooking/applyDiscountCpon.do',
		type        : 'POST',
		contentType : 'application/json;charset=UTF-8',
		dataType    : 'json',
		data        : JSON.stringify(paramData),
		success: function (data, textStatus, jqXHR) {
			//console.log(data);
			if (!msgBookingLoginChk(data)) {
				return;
			}
			
			if(data.cancelCpon.length > 0) {
				gfn_alertMsgBox("적용 불가능한 쿠폰이 있습니다.");

				cancelMbxSellCpInfo('cancelCoupon');

				for(var i=0; i<data.cancelCpon.length; i++) {
					$.each($chk, function() {
						var idx = $(this).data('idx');
						if(data.cancelCpon[i] == dcouponChgList[idx].cponNo) {
							$(':checkbox[name="chkDcoupon"]').eq(idx).prop('checked', false);
						}
					});
				}
			} else {
				let retCponPayPolicList = data.returnMap.retCponPayPolicList;
				let retCponPayPolicNm = data.returnMap.retCponPayPolicNm;
				let retCponPayCardPolicList = data.returnMap.retCponPayCardPolicList;
				let retCponPayCardPolicNm = data.returnMap.retCponPayCardPolicNm;
				let retMinTotalAmt = data.returnMap.retMinTotalAmt;
				let payLmtAt = data.returnMap.payLmtAt;
				let othCpDupAt = data.returnMap.othCpDupAt;
				let errMsg = '';
				let methodList = '';

				if (retCponPayCardPolicList.length > 0) {
					retCponPayPolicNm = retCponPayPolicNm.replace('신용카드,', '');
					retCponPayPolicNm = retCponPayPolicNm.replace(',신용카드', '');
					retCponPayPolicNm = retCponPayPolicNm.replace('신용카드', '');

					if(retCponPayPolicNm != '') {
						retCponPayPolicNm += ',';
					}

					methodList = '['+retCponPayPolicNm+'신용카드(' + retCponPayCardPolicNm + ')]';
				} else if(retCponPayPolicList.length > 0){
					methodList = '[' + retCponPayPolicNm + ']';
				} else {
					retCponPayCardPolicList = null;
				}

				if(methodList.length > 0) {
					if(retMinTotalAmt > 0 && payLmtAt == 'Y') {
						errMsg = methodList + '로만 결제가능하며 최종결제금액이 ['+ String(retMinTotalAmt).maskNumber() +']원 이상시 사용가능합니다.';
					} else if (retMinTotalAmt > 0) {
						errMsg = '결제수단 중 '+ methodList + '가 필수 적용되어야하며 최종결제금액이 ['+ String(retMinTotalAmt).maskNumber() +']원 이상시 사용가능합니다.';
					} else if (payLmtAt == 'Y') {
						errMsg = '해당 쿠폰 사용시 최종 결제 단계에서 ' + methodList + '로만 결제가능합니다.';
					} else {
						errMsg = '해당 쿠폰 사용시 결제수단 중 ' + methodList + '가 필수 적용되어야 합니다.';
					}
				}

				if(errMsg.length > 0) {
					if(payLmtAt === 'Y' && othCpDupAt === 'Y') {
						errMsg += ' 단, 쿠폰사용시 타쿠폰, 모바일상품권, 제휴포인트 적용 불가합니다.';
					} else if (payLmtAt === 'Y') {
						errMsg += ' 단, 쿠폰사용시 모바일상품권, 제휴포인트 적용 불가합니다.';
					} else if (othCpDupAt === 'Y') {
						errMsg += ' 단, 쿠폰사용시 타쿠폰 적용 불가합니다.';
					}
					gfn_alertMsgBox(errMsg);
				}

				var retCponPolicMap = {
					retCponPayCardPolicList : retCponPayCardPolicList,
					retMinTotalAmt : retMinTotalAmt
				}
				//예매화면 할인내역 갱신
				setMovieDcInfo(data.policyList, retCponPolicMap);

				$('#btn_cancel_dcoupon').show(); //취소버튼
				$('#btn_cancel_apply_dcoupon').show(); //적용취소버튼

				//닫기버튼 클릭
				$('#layer_202002 .close-layer').click();
			}
		},
		error: function(xhr,status,error){
			var err = JSON.parse(xhr.responseText);
			//err.statCd 에 따라서 이전화면으로 리턴 가능토록
			errBookingChk(err.msg);
		}
	});
}
</script>

<!-- 레이어 : 메가박스 영화할인 쿠폰 -->
<section id="layer_202002" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">메가박스 할인쿠폰<!-- 메가박스 할인쿠폰 --></h3>
		</header>

		<div class="layer-con">
			<div class="pop-tit">사용할 쿠폰을 선택해주세요.<!-- 사용할 쿠폰을 선택해주세요. --></div>

			<div class="popup-gray mid-info-box mb20">
				<div class="pop-search-area">
					<p class="sh-txt reset mr08"><span class="label">쿠폰번호<!-- 쿠폰번호 --></span></p>

					<div class="sh-input">
						<input id="dcouponNo" type="text" title="메가박스 영화할인쿠폰 16자리 입력" placeholder="" class="input-text" style="width:250px;" maxlength="16">
					</div>

					<div class="sh-btn gray">
						<button type="button" class="button small gray" id="btn_reg_dcoupon">쿠폰등록<!-- 쿠폰등록 --></button>
					</div>
				</div>
			</div>

			<div class="table-wrap divide">
				<table class="board-list line">
					<caption>쿠폰명, 쿠폰번호, 유효기간, 사용 항목을 가진 메가박스 영화할인쿠폰 목록의 제목 표<!-- 쿠폰명, 쿠폰번호, 유효기간, 사용 항목을 가진 메가박스 영화할인쿠폰 목록의 제목 표 --></caption>
					<colgroup>
						<col>
						<col style="width:115px;">
						<col style="width:60px;">
					</colgroup>
					<thead>
						<tr>
							<th scope="col">쿠폰명<!-- 쿠폰명 --></th>
							<th scope="col">유효기간<!-- 유효기간 --></th>
							<th scope="col">사용<!-- 사용 --></th>
						</tr>
					</thead>
				</table>

				<div class="scroll" style="min-height:171px; max-height:171px;">
					<table class="board-list line" id="data_table">
						<caption>쿠폰명, 쿠폰번호, 유효기간, 사용 항목을 가진 메가박스 영화할인쿠폰 목록의 내용 표<!-- 쿠폰명, 쿠폰번호, 유효기간, 사용 항목을 가진 메가박스 영화할인쿠폰 목록의 내용 표 --></caption>
						<colgroup>
							<col>
							<col style="width:115px;">
							<col style="width:60px;">
						</colgroup>
						<tbody>
						</tbody>
					</table>
				</div>

				<div class="box-border v1 use-guide mt15">
					<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>사용 가능한 쿠폰만 노출됩니다.<!-- 사용 가능한 쿠폰만 노출됩니다. --></li>
						<li>전체 쿠폰 목록은 나의 메가박스 &gt; 할인쿠폰에서 확인 가능합니다.<!-- 전체 쿠폰 목록은 나의 메가박스 > 할인쿠폰에서 확인 가능합니다. --></li>
						<li>보유하신 쿠폰은 등록 후 이용하실 수 있습니다.<!-- 보유하신 쿠폰은 등록 후 이용하실 수 있습니다. --></li>
						<li>카드사 제휴쿠폰은 타 쿠폰 및 제휴포인트와 중복 적용 불가합니다.<!-- 카드사 제휴쿠폰은 타 쿠폰 및 제휴포인트와 중복 적용 불가합니다.. --></li>
					</ul>
				</div>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_dcoupon">닫기<!-- 닫기 --></button>
			<button type="button" class="button small purple" id="btn_cancel_apply_dcoupon" style="display:none;">적용취소<!-- 적용취소 --></button>
			<button type="button" class="button small purple" id="btn_apply_dcoupon">적용<!-- 적용 --></button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_dcoupon">레이어 닫기<!-- 레이어 닫기 --></button>
	</div>
</section>
<!-- //레이어 : 메가박스 영화할인 쿠폰 -->
	<!-- //레이어 : 메가박스 영화할인 쿠폰 -->

	
	
	

	<!-- 레이어 : 현대 M포인트 카드 -->

	<!--// 레이어 : 현대 M포인트 카드 -->

	<!-- 레이어 : 현대 M 5000포인트 카드 -->

	<!--// 레이어 : 현대 M 5000포인트 카드 -->

	<!-- 레이어 : 현대 M 6000포인트 카드 -->
	





<script type="text/javascript">
var hyM6PointChgInfo = new Object();

//초기화 공통 sMethodName.init
function hydm6p_init() {  //현대M포인트 전체초기화
	setInitHyM6Point();
	hyM6PointChgInfo = new Object();

	$('#hyM6PointCardNum_1').val('');
	$('#hyM6PointCardNum_2').val('');
	$('#hyM6PointCardNum_3').val('');
	$('#hyM6PointCardNum_4').val('');
	$('#hyM6PointUseAbleAmt').text('0');

	$('#hyundai_m_6point_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#hy_m_6point_card_mm').val('');
	$('#hy_m_6point_card_yy').val('');
	$('#hyundai_m_6point_card_birthday').val('');
	$('#hyundai_m_6point_card_password').val('');
}


$(function() {
	//숫자만 입력가능
	$('#hyM6PointCardNum_1').megaBoxNumberCheck();
	$('#hyM6PointCardNum_2').megaBoxNumberCheck();
	$('#hyM6PointCardNum_3').megaBoxNumberCheck();
	$('#hyM6PointCardNum_4').megaBoxNumberCheck();
	$('#hyundai_m_6point_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#hy_m_6point_card_mm').megaBoxNumberCheck();  //유효기간 숫자만 입력
	$('#hy_m_6point_card_yy').megaBoxNumberCheck();  //유효기간 숫자만 입력

	//조회버튼 클릭
	$('#btn_select_hydm6p').on('click', function() {
		searchHyM6Point();
	});

	//현대m포인트 적용
	$('#btn_apply_hydm6p').on('click', function() {
		applyHyM6Point();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_hydm6p').on('click', function() {
		var sMethodName = "hydm6p";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_303024 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_hydm6p, #btn_close_modal_hydm6p').on('click', function() {
		if (!$('#btn_cancel_apply_hydm6p').is(':visible')) {
			hydm6p_init();
		}
	});
});


//현대m포인트 포인트 초기화
function setInitHyM6Point() {
	$('#selHyM6Point > option').remove();
	$('#selHyM6Point').append('<option value="0">선택</option>');
}

//현대m포인트 조회
function searchHyM6Point() {
	var transNo    = $("#transNo").val();
	var cardNo1    = $("#hyM6PointCardNum_1").val();
	var cardNo2    = $("#hyM6PointCardNum_2").val();
	var cardNo3    = $("#hyM6PointCardNum_3").val();
	var cardNo4    = $("#hyM6PointCardNum_4").val();
	var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;

	var password   = $("#hyundai_m_6point_card_password").val();
	var valBirth   = $('#hyundai_m_6point_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#hy_m_6point_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#hy_m_6point_card_yy').val();  //유효기간 숫자만 입력

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_hydm6p').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (valMonth == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#hy_m_6point_card_mm').focus();
		return;
	}

	if (valYear == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#hy_m_6point_card_yy').focus();
		return;
	}

	if (valBirth == "") {
		gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
		$('#hyundai_m_6point_card_birthday').focus();
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
		$("#hyundai_m_point_card_password").focus();
		return;
	}

	var paramData = { cardNo1:cardNo1,cardNo2:cardNo2,cardNo3:cardNo3,cardNo4:cardNo4,cardNo:cardNo,transNo:transNo, valMonth:valMonth, valYear:valYear, valBirth:valBirth, password:password};

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchHyundaiM6point.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//쿠폰 전역변수 세팅
      	hyM6PointChgInfo = data.hyMPointInfo;

      	//쿠폰 목록 세팅
      	setHyM6PointChg(hyM6PointChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#btn_select_hydm6p').prop("disabled", true);
  		$('#btn_select_hydm6p').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#btn_select_hydm6p').removeClass('disabled');
     			$('#btn_select_hydm6p').prop("disabled", false);
  		},1500);
  	  }
	});
}

//현대m포인트 목록 세팅
function setHyM6PointChg(cponInfo) {
	setInitHyM6Point();
	var cponListText = "";

	$('#hyM6PointUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());

	var cponList = cponInfo.comboList;

	var useAmt   = 0;
	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
		$('#selHyM6Point').append(cponListText);
	}
}

//현대m포인트 적용
function applyHyM6Point() {

	var transNo  = $("#transNo").val();
	var cardNo1  = $("#hyM6PointCardNum_1").val();
	var cardNo2  = $("#hyM6PointCardNum_2").val();
	var cardNo3  = $("#hyM6PointCardNum_3").val();
	var cardNo4  = $("#hyM6PointCardNum_4").val();
	var cardNo   = cardNo1 + cardNo2 + cardNo3 + cardNo4;
	var useCnt   = $('#selHyM6Point option:selected').val();
	var password = $("#hyundai_m_6point_card_password").val();

	var valBirth   = $('#hyundai_m_6point_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#hy_m_6point_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#hy_m_6point_card_yy').val();  //유효기간 숫자만 입력

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
		$("#hyundai_m_point_card_password").focus();
		return;
	}

	if (valMonth == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#hy_m_6point_card_mm').focus();
		return;
	}

	if (valYear == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#hy_m_6point_card_yy').focus();
		return;
	}

	if (valBirth == "") {
		gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
		$('#hyundai_m_6point_card_birthday').focus();
		return;
	}

	if ($('#hyundai_m_6point_card_agree').prop('checked') == false) {
		gfn_alertMsgBox('결제대행서비스 약관에 모두 동의하셔야 결제하실 수 있습니다.');
		$('#hyundai_m_6point_card_agree').focus();
		return;
	}

	var paramData = { cardNo1:cardNo1,cardNo2:cardNo2,cardNo3:cardNo3,cardNo4:cardNo4,cardNo:cardNo,
			password:password, transNo:transNo, valMonth:valMonth, valYear:valYear, valBirth:valBirth, useCnt:useCnt};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyHyundaiM6point.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_hydm6p').show(); //취소버튼
      	$('#btn_cancel_apply_hydm6p').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_303024 .close-layer').click();
      	$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}

//현대m포인트 결제
function payHyM6Point() {
	var cardNo1  = $("#hyM6PointCardNum_1").val();
	var cardNo2  = $("#hyM6PointCardNum_2").val();
	var cardNo3  = $("#hyM6PointCardNum_3").val();
	var cardNo4  = $("#hyM6PointCardNum_4").val();
	var cardNo   = cardNo1 + cardNo2 + cardNo3 + cardNo4;
	var useCnt   = $('#selHyM6Point option:selected').val();
	var password = $("#hyundai_m_6point_card_password").val();

	var valBirth   = $('#hyundai_m_6point_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#hy_m_6point_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#hy_m_6point_card_yy').val();  //유효기간 숫자만 입력

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
		return;
	}

	if (valMonth == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		return;
	}

	if (valYear == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		return;
	}

	if (valBirth == "") {
		gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
		return;
	}

	var option = { cardNo1:cardNo1,cardNo2:cardNo2,cardNo3:cardNo3,cardNo4:cardNo4,cardNo:cardNo,
			       password:password, valMonth:valMonth, valYear:valYear, valBirth:valBirth, useCnt:useCnt,
			       preDisc:'Y',  discType:'HYUNM'};

	//최종결제 금액 유효성 검사 및 결제 처리
	chkLastPayAmt(option);

}
</script>

	<!-- 레이어 : 현대 M포인트 카드 -->
	<section id="layer_303024" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">현대카드 M포인트<!-- 현대 M포인트 카드 --></h3>
			</header>

			<div class="layer-con">
				<div class="reset">
					 현대 M포인트 카드 정보를 입력해주세요<!-- 현대 M포인트 카드 정보를 입력해주세요 -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="hyundai_m_point_card_num">카드번호<!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" title="현대 M포인트 카드번호 첫번째자리 입력" class="input-text w60px x-small" id="hyM6PointCardNum_1" maxlength="4"> -
								<input type="text" title="현대 M포인트 카드번호 두번째자리 입력" class="input-text w60px x-small" id="hyM6PointCardNum_2" maxlength="4"> -
								<input type="number" title="현대 M포인트 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" id="hyM6PointCardNum_3" maxlength="4" oninput="gfn_numberMaxLength(this);"> -
								<input type="text" title="현대 M포인트 카드번호 네번째자리 입력" class="input-text w60px x-small" id="hyM6PointCardNum_4" maxlength="4">
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="hyundai_m_point_card_date">카드유효기간<!-- 카드유효기간 --></label></p>

							<div class="sh-input">
								<input type="text" id="hy_m_6point_card_mm" title="현대 M포인트 카드 유효기간 월 입력" placeholder="MM" class="input-text w60px x-small a-c" maxlength="2"> /
								<input type="text" id="hy_m_6point_card_yy" title="현대 M포인트 카드 유효기간 년 입력" placeholder="YY" class="input-text w60px x-small a-c" maxlength="2">
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="hyundai_m_6point_card_password">비밀번호<!-- 비밀번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="hyundai_m_6point_card_password" title="현대 M포인트 카드 비밀번호 입력" class="input-text w60px x-small pwnew" maxlength="2">
								<span class="font-size-13 font-gray ml05">앞 2자리<!-- 앞 2자리 --></span>
							</div>
						</div>

						<div class="pop-search-area-line gray">
							<p class="sh-txt reset vt"><label for="hyundai_m_6point_card_birthday">생년월일<!-- 생년월일 --></label></p>
							<div class="sh-input mr0">
								<input type="text" id="hyundai_m_6point_card_birthday" title="현대 M포인트 카드 생년월일 입력" class="input-text w80px x-small" maxlength="10">
								<button type="button" class="button gray x-small ml07" id="btn_select_hydm6p">조회<!-- 조회 --></button>

								<p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자) / 사업자번호 10자리<!-- 생년월일 6자리(카드소유자) / 사업자번호 10자리 --></p>

							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset vt"><label for="hyundai_m_point_card_ticket_counting">적용매수</label></p>
							<div class="sh-input mr0">
								<select title="현대 M포인트 선택" class="w120px v1 x-small" id="selHyM6Point">
									<option value="0">선택<!-- 선택 --></option>
								</select>

								<span class="ml05 font-size-13">사용 가능한 포인트는 <em class="font-gblue" id="hyM6PointUseAbleAmt">0</em> Point 입니다.<!-- 입니다. --></span>
							</div>
						</div>
					</div>
				</div>

				<div class="box-border v1 use-guide">
					<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list gray">
                        <li>요일 무관 영화 예매 시 장당 현대 6,000M포인트 사용(단 문화의날 제외)</li>
                        <li>M포인트 사용 후 해당 카드로만 결제 조건 (간편결제사 이용 불가)</li>
                        <li>10,000원 이상 티켓부터 6,000M포인트 사용 가능</li>
						<li>다른 할인서비스 및 쿠폰과 중복 적용 불가</li>
					</ul>
				</div>

				<div class="mt10">
					<input type="checkbox" id="hyundai_m_6point_card_agree">
					<label for="hyundai_m_6point_card_agree">결제대행 서비스 약관 필수 동의 <!-- 결제대행서비스 약관에 모두 동의 --></label>

					<div class="mt10">
						<a href="https://megabox.kicc.co.kr/html/terms/terms1.html" title="전자금융거래 기본약관" target="_blank" class="a-link ml20" style="font-size: 14px;">전자금융거래 기본약관 <!-- 전자금융거래 기본약관 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms2.html" title="개인정보 수집 및 이용에 대한 동의" target="_blank" class="a-link ml20" style="font-size: 14px;">개인정보 수집 및 이용에 대한 동의 <!-- 개인정보 수집 및 이용에 대한 동의 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms3.html" title="개인정보의 제 3자 제공 동의" target="_blank" class="a-link ml20" style="font-size: 14px;">개인정보의 제 3자 제공 동의 <!-- 개인정보의 제 3자 제공 동의 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms4.html" title="개인정보의 처리 위탁 동의" target="_blank" class="a-link ml20" style="font-size: 14px;">개인정보의 처리 위탁 동의 <!-- 개인정보의 처리 위탁 동의 --> <i class="iconset ico-arr-right-green"></i></a>
					</div>
				</div>

			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_hydm6p">닫기<!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_hydm6p" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_hydm6p">적용<!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_hydm6p">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : 현대 M포인트 카드 -->
	<!--// 레이어 : 현대 M 6000포인트 카드 -->

	<!-- 레이어 : 문화누리 카드 -->
	





<script type="text/javascript">
var culturenuriChgInfo = new Object();

//초기화 공통 sMethodName.init
function culturenuri_init() {  //문화누리 전체초기화
	setInitCulturenuri();
	culturenuriChgInfo = new Object();

	$('#culturenuriCardNum').val('');
	$('#culturenuriCardNum_hid').val('');

	$('#culturenuri_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#culturenuri_card_mm').val('');
	$('#culturenuri_card_yy').val('');
	$('#culturenuri_card_birthday').val('');
	$('#culturenuri_card_password').val('');
	$('#rdo_cult_credit').click();
}


$(function() {
	//숫자만 입력가능
	$('#culturenuriCardNum').megaBoxCardNumberCheck();
	$('#culturenuri_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#culturenuri_card_mm').megaBoxNumberCheck();  //유효기간 숫자만 입력
	$('#culturenuri_card_yy').megaBoxNumberCheck();  //유효기간 숫자만 입력

	//조회버튼 클릭
	$('#btn_select_culturenuri').on('click', function() {
		searchCulturenuri();
	});

	//문화누리 적용
	$('#btn_apply_culturenuri').on('click', function() {
		applyCulturenuri();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_culturenuri').on('click', function() {
		var sMethodName = "culturenuri";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_305004 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_culturenuri, #btn_close_modal_culturenuri').on('click', function() {
		if (!$('#btn_cancel_apply_culturenuri').is(':visible')) {
			culturenuri_init();
		}
	});

	$('input[name="rdo_cult_select"]').change(function() {
		setInitCulturenuri();
		$('#culturenuriCardNum').val('');
		$('#culturenuri_card_mm').val('');
		$('#culturenuri_card_yy').val('');
		$('#culturenuri_card_password').val('');
		$('#culturenuri_card_birthday').val('');

		var naverPayYn = $('input[name="rdo_cult_select"]:checked').val();

		if(naverPayYn == 'Y') {
			$('#culturenuriCardNum').prop('disabled', true);
			$('#culturenuri_card_mm').prop('disabled', true);
			$('#culturenuri_card_yy').prop('disabled', true);
			$('#culturenuri_card_password').prop('disabled', true);
			$('#culturenuri_card_birthday').prop('disabled', true);
			$('#btn_select_culturenuri').prop('disabled', true);

			var paramData = { naverPayYn:naverPayYn, transNo:$("#transNo").val()};

			$.ajax({
				url: "/on/oh/ohz/PayBooking/searchCulturenuri.do",
				type: "POST",
				contentType: "application/json;charset=UTF-8",
				dataType: "json",
				data: JSON.stringify(paramData),
				success: function (data, textStatus, jqXHR) {
					//console.log(data);
					if (!msgBookingLoginChk(data)) {
						return;
					}

					//쿠폰 전역변수 세팅
					culturenuriChgInfo = data.culturenuriInfo;

					//쿠폰 목록 세팅
					setCulturenuriChg(culturenuriChgInfo);
				},
				error: function(xhr,status,error){
					var err = JSON.parse(xhr.responseText);
					//err.statCd 에 따라서 이전화면으로 리턴 가능토록
					errBookingChk(err.msg);
				}
				, beforeSend : function() {
					$('#rdo_cult_credit').prop("disabled", true);
				}
				, complete : function() {
					setTimeout(function(){
						$('#rdo_cult_credit').prop("disabled", false);
					},1500);
				}
			});
		} else {
			$('#culturenuriCardNum').prop('disabled', false);
			$('#culturenuri_card_mm').prop('disabled', false);
			$('#culturenuri_card_yy').prop('disabled', false);
			$('#culturenuri_card_password').prop('disabled', false);
			$('#culturenuri_card_birthday').prop('disabled', false);
			$('#btn_select_culturenuri').prop('disabled', false);
		}
	});
});


//문화누리 포인트 초기화
function setInitCulturenuri() {
	$('#selCulturenuri > option').remove();
	$('#selCulturenuri').append('<option value="0">선택</option>');
}

//문화누리 조회
function searchCulturenuri() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#culturenuriCardNum_hid").val().replaceAll('-', '').nvlNum(0);

	var valBirth   = $('#culturenuri_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#culturenuri_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#culturenuri_card_yy').val();  //유효기간 숫자만 입력

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_culturenuri').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (valMonth == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#culturenuri_card_mm').focus();
		return;
	}

	if (valYear == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#culturenuri_card_yy').focus();
		return;
	}

	if (valBirth == "") {
		gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
		$('#culturenuri_card_birthday').focus();
		return;
	}

	var paramData = { cardNo:cardNo,transNo:transNo, valMonth:valMonth, valYear:valYear, valBirth:valBirth};

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchCulturenuri.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//쿠폰 전역변수 세팅
      	culturenuriChgInfo = data.culturenuriInfo;

      	//쿠폰 목록 세팅
      	setCulturenuriChg(culturenuriChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}

//문화누리 목록 세팅
function setCulturenuriChg(cponInfo) {
	setInitCulturenuri();

	var cponListText = "";
	var cponList = cponInfo.comboList;
	var useAmt   = 0;
	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
		$('#selCulturenuri').append(cponListText);
	}

	// if(cponList.length > 0) {
	// 	$("#selCulturenuri option:eq(1)").attr("selected", "selected");
	// }
}

//문화누리 적용
function applyCulturenuri() {

	var transNo  = $("#transNo").val();
	var cardNo   = $("#culturenuriCardNum_hid").val().replaceAll('-', '').nvl('');
	var useCnt   = $('#selCulturenuri option:selected').val();
	var password = $("#culturenuri_card_password").val();

	var valBirth   = $('#culturenuri_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#culturenuri_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#culturenuri_card_yy').val();  //유효기간 숫자만 입력
	var naverPayYn = $(':radio[name="rdo_cult_select"]:checked').val();

	if(naverPayYn != 'Y') {
		if (cardNo == "" || cardNo.length < 10) {
			gfn_alertMsgBox('카드 번호를 입력하세요.');
			return;
		}

		if (password == "") {
			gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
			$("#culturenuri_card_password").focus();
			return;
		}

		if (valMonth == "") {
			gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
			$('#culturenuri_card_mm').focus();
			return;
		}

		if (valYear == "") {
			gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
			$('#culturenuri_card_yy').focus();
			return;
		}

		if (valBirth == "") {
			gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
			$('#culturenuri_card_birthday').focus();
			return;
		}
	}

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if(naverPayYn == null || naverPayYn == '') {
		gfn_alertMsgBox('결제 수단을 선택해주세요.');
		$('#payMethodSelect').focus();
		return;
	}

	var paramData = { cardNo:cardNo,password:password, transNo:transNo, valMonth:valMonth, valYear:valYear, valBirth:valBirth, useCnt:useCnt};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyCulturenuri.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
		$('#cultNaverYn').val(naverPayYn);
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_culturenuri').show(); //취소버튼
      	$('#btn_cancel_apply_culturenuri').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_305004 .close-layer').click();
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}

//문화누리 결제
function payCulturenuri() {
	var cardNo   = $("#culturenuriCardNum_hid").val().replaceAll('-', '').nvlNum(0);
	var useCnt   = $('#selCulturenuri option:selected').val();
	var password = $("#culturenuri_card_password").val();

	var valBirth   = $('#culturenuri_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#culturenuri_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#culturenuri_card_yy').val();  //유효기간 숫자만 입력
	var naverPayYn = $(':radio[name="rdo_cult_select"]:checked').val();

	if(naverPayYn != 'Y') {
		if (cardNo == "" || cardNo.length < 10) {
			gfn_alertMsgBox('카드 번호를 입력하세요.');
			return;
		}

		if (password == "") {
			gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
			$("#culturenuri_card_password").focus();
			return;
		}

		if (valMonth == "") {
			gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
			$('#culturenuri_card_mm').focus();
			return;
		}

		if (valYear == "") {
			gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
			$('#culturenuri_card_yy').focus();
			return;
		}

		if (valBirth == "") {
			gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
			$('#culturenuri_card_birthday').focus();
			return;
		}
	}

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if(naverPayYn == null || naverPayYn == '') {
		gfn_alertMsgBox('결제 수단을 선택해주세요.');
		$('#payMethodSelect').focus();
		return;
	}

	var option = { cardNo:cardNo,
			       password:password, valMonth:valMonth, valYear:valYear, valBirth:valBirth, useCnt:useCnt,
			       preDisc:'Y',  discType:'CULTURE', naverPayYn:naverPayYn};

	//최종결제 금액 유효성 검사 및 결제 처리
	chkLastPayAmt(option);

}
</script>

	<!-- 레이어 : 문화누리 카드 -->
	<input type="hidden" id="culturenuriCardNum_hid">
	<section id="layer_305004" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">문화누리 카드<!-- 문화누리 카드 --></h3>
			</header>

			<div class="layer-con">
				<div class="reset">
					결제수단 선택
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line" id="payMethodSelect">
							<input type="radio" name="rdo_cult_select" id="rdo_cult_credit" value="N" checked="">
							<label for="rdo_cult_credit" class="mr50">문화누리카드</label>
							<input type="radio" name="rdo_cult_select" id="rdo_cult_naver" value="Y">
							<label for="rdo_cult_naver">문화누리-네이버페이</label>
						</div>
					</div>
				</div>

				<div class="reset">
					  카드정보 조회<!-- 카드정보 조회 -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="mnuri_card_num">카드번호<!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" title="문화누리 카드번호 입력" class="input-text w180px x-small" id="culturenuriCardNum" maxlength="20">
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="mnuri_card_num_card_date">카드유효기간<!-- 카드유효기간 --></label></p>

							<div class="sh-input">
								<input type="text" id="culturenuri_card_mm" title="문화누리 카드 유효기간 월 입력" placeholder="MM" class="input-text w60px x-small a-c" maxlength="2"> /
								<input type="text" id="culturenuri_card_yy" title="문화누리 유효기간 년 입력" placeholder="YY" class="input-text w60px x-small a-c" maxlength="2">
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="culturenuri_card_password">비밀번호<!-- 비밀번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="culturenuri_card_password" title="문화누리 카드 비밀번호 입력" class="input-text w60px x-small pwnew" maxlength="2">
								<span class="font-gray ml05 font-size-13">앞 2자리<!-- 앞 2자리 --></span>
							</div>
						</div>

						<div class="pop-search-area-line gray">
							<p class="sh-txt reset vt"><label for="mnuri_card_birthday">생년월일<!-- 생년월일 --></label></p>
							<div class="sh-input mr0">
								<input type="text" id="culturenuri_card_birthday" title="문화누리 카드 생년월일 입력" class="input-text w80px x-small" maxlength="10">

								<p class="reset inline-block font-size-13 font-gray ml05">생년월일 6자리(카드소유자)<!-- 생년월일 6자리(카드소유자) --></p>
							</div>
							<button type="button" class="button gray x-small ml07" id="btn_select_culturenuri">조회<!-- 조회 --></button>
						</div>
					</div>
				</div>

				<div class="pop-util mb15">
					<ul>
						<li>
							<p class="vm">할인매수 선택<!-- 적용매수 --></p>
						</li>
						<li class="a-r">
							<select title="문화누리 적용매수 선택" class="w120px x-small" id="selCulturenuri">
								<option value="0">선택<!-- 선택 --></option>
							</select>
						</li>
					</ul>
				</div>

				<div class="box-border v1 use-guide">
					<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>결제수단 '문화누리-네이버페이' 선택 시 카드정보 입력 불필요<!-- 네이버페이 선택 시 카드정보 입력 불필요 --></li>
						<li>문화누리카드 선택 시 카드 정보 입력 필요 및 해당 카드로만 결제 가능<!-- 문화누리카드 선택 시 카드 정보 입력 필요 및 해당 카드로만 결제 가능 --></li>
						<li>네이버페이 선택 시 결제수단 '네이버페이 내 문화누리카드'로만 결제 가능<!-- '네이버페이 내 문화누리카드'로만 결제 가능 --></li>
						<li>티켓 1매당 2,500원 할인(동반 1인까지)<!-- 티켓 1매당 2,500원 할인(동반 1인까지) --></li>
						<li>일반관 2D/3D 성인, 청소년 정상가 선택 시 할인 적용 가능<!-- 일반관 2D/3D 성인, 청소년 정상가 선택 시 할인 적용 가능 --></li>
						<li>문화누리카드 잔액 부족 시 결제 불가, 타 쿠폰 및 할인 중복적용 불가<!-- 문화누리카드 잔액 부족 시 결제 불가, 타 제휴 및 쿠폰 할인 중복사용 불가 --></li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_culturenuri">닫기<!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_culturenuri" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_culturenuri">적용<!-- 적용 --></button>

			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_culturenuri">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!-- // 레이어 : 문화누리 카드 -->
	<!-- // 레이어 : 문화누리 카드 -->

	<!-- 레이어 : GS&POINT -->
	





<script type="text/javascript">
var gsnPointChgInfo = new Object();

//초기화 공통 sMethodName.init
function gsnp_init() {  //gs포인트 전체초기화
	setInitGsnPoint();
	gsnPointChgInfo = new Object();

	$('#gsnPointCardNum').val('');
	$('#gsnPointCardNum_hid').val('');
	$('#gsnPointUseAbleAmt').text('0');
	$('#gs_card_pwd').val('');
}

$(function() {
	//숫자만 입력가능
	$('#gsnPointCardNum').megaBoxCardNumberCheck();  //생년월일/사업자번호 숫자만 입력

	//조회버튼 클릭
	$('#btn_select_gsnp').on('click', function() {
		searchGsnPoint();
	});

	//gs포인트 적용
	$('#btn_apply_gsnp').on('click', function() {
		applyGsnPoint();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_gsnp').on('click', function() {
		var sMethodName = "gsnp";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_303002 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_gsnp, #btn_close_modal_gsnp').on('click', function() {
		if (!$('#btn_cancel_apply_gsnp').is(':visible')) {
			gsnp_init();
		}
	});
});


//gs포인트 초기화
function setInitGsnPoint() {
	$('#selGsnPoint > option').remove();
	$('#selGsnPoint').append('<option value="0">선택</option>');
}

//gs포인트 조회
function searchGsnPoint() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#gsnPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_gsnp').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo};

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchGsPoint.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//쿠폰 전역변수 세팅
      	gsnPointChgInfo = data.gsPointInfo;

      	//쿠폰 목록 세팅
      	setGsPointChg(gsnPointChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#btn_select_gsnp').prop("disabled", true);
  		$('#btn_select_gsnp').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#btn_select_gsnp').removeClass('disabled');
     			$('#btn_select_gsnp').prop("disabled", false);
  		},1500);
  	  }
	});
}

//gs포인트 목록 세팅
function setGsPointChg(cponInfo) {
	setInitGsnPoint();
	var cponListText = "";

	$('#gsnPointUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());

	var cponList = cponInfo.comboList;
	var useAmt   = 0;
	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
		$('#selGsnPoint').append(cponListText);
	}
}

//gs포인트 적용
function applyGsnPoint() {

	var transNo  = $("#transNo").val();
	var cardNo     = $("#gsnPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);
	var useCnt   = $('#selGsnPoint option:selected').val();
	var password = $("#gs_card_pwd").val();

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
		$("#gs_card_pwd").focus();
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt, password:password};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyGsPoint.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_gsnp').show(); //취소버튼
      	$('#btn_cancel_apply_gsnp').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_303002 .close-layer').click();
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}
</script>

	<!-- 레이어 : GS&POINT -->
	<input type="hidden" id="gsnPointCardNum_hid">
	<section id="layer_303002" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">GS&amp;POINT</h3>
			</header>

			<div class="layer-con">
				<div class="reset">
					GS&amp;POINT 카드 정보를 입력해주세요.<!-- 카드 정보를 입력해주세요. -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="gsnPointCardNum_1">카드번호<!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" title="GS&amp;POINT 카드번호 입력" class="input-text w180px x-small" id="gsnPointCardNum" maxlength="20">
								<button type="button" class="button gray x-small ml05" id="btn_select_gsnp">포인트 조회<!-- 포인트 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">사용가능 포인트<!-- 사용가능 포인트 --></p>

							<div class="sh-input">
								<div class="sh-input">
									<em id="gsnPointUseAbleAmt" class="font-gblue">0</em> 점<!-- 점 -->
								</div>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">적용 매수 선택<!-- 적용 매수 선택 --></p>

							<div class="sh-input">
								<select title="GS 포인트 적용 매수 선택" class="w100px x-small" id="selGsnPoint">
									<option value="0">선택<!-- 선택 --></option>
								</select>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="gs_card_pwd">비밀번호<!-- 비밀번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="gs_card_pwd" title="GS&amp;POINT 카드 비밀번호 입력" class="input-text w100px x-small pwnew" maxlength="15">
							</div>
						</div>
					</div>
				</div>

				<div class="box-border v1 use-guide">
					<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>장당 2,000포인트 차감 할인(1일 최대 8매)<!-- 장당 2,000포인트 차감 할인(1일 최대 8매) --></li>
						<li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_gsnp">닫기<!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_gsnp" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_gsnp">적용<!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_gsnp">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : GS&POINT -->
	<!--// 레이어 : GS&POINT -->

	<!-- 레이어 : 현대오일뱅크 -->
	





<script type="text/javascript">
let hyOilChgInfo = {};
let hyoil3pChgInfo = {};
let hyoil5pChgInfo = {};
let hyoil7pChgInfo = {};
let hyoil11pChgInfo = {};

//초기화 공통 sMethodName.init
function hyoil_init() {  //현대오일뱅크 전체초기화
	setInitHyOil();
	hyOilChgInfo = {};
	hyOil3pChgInfo = {};
	hyOil5pChgInfo = {};
	hyOil7pChgInfo = {};
	hyOilChgInfo11 = {};

	setIntitHyoilRdo();
	$('#hyOilCardNum').val('');
	$('#hyOilCardNum_hid').val('');
	$('#hyOilUseAbleAmt').text('0');
	$('#ho_card_pwd').val('');
}

$(function() {
	//숫자만 입력가능
	$('#hyOilCardNum').megaBoxCardNumberCheck();

	//조회버튼 클릭
	$('#btn_select_hyoil').on('click', function() {
		searchHyOil();
	});

	//gs포인트 적용
	$('#btn_apply_hyoil').on('click', function() {
		applyHyOil();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_hyoil').on('click', function() {
		var sMethodName = "hyoil";
		cancelMbxSellCpInfo(sMethodName);
		setIntitHyoilRdo();

		//닫기버튼 클릭
     	$('#layer_303025 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_hyoil, #btn_close_modal_hyoil').on('click', function() {
		if (!$('#btn_cancel_apply_hyoil').is(':visible')) {
			hyoil_init();
		}
	});
});


//현대오일뱅크 포인트 초기화
function setInitHyOil() {
	$('#selHyOil > option').remove();
	$('#selHyOil').append('<option value="0">선택</option>');
}

function setIntitHyoilRdo() {
	$('#rdo_point_3000_input').attr('disabled', true);
	$('#rdo_point_5000_input').attr('disabled', true);
	$('#rdo_point_7000_input').attr('disabled', true);
	$('#rdo_point_11000_input').attr('disabled', true);
	$('input[name="rdo_point_select"]').removeAttr('checked');
}

//현대오일뱅크 조회
function searchHyOil() {
	var transNo   = $("#transNo").val();
	var cardNo    = $("#hyOilCardNum_hid").val().replaceAll('-', '').nvlNum(0);
	var hyoil3pYn = 'N';
	var hyoil5pYn = 'N';
	var hyoil7pYn = 'N';
	var hyoil11pYn = 'N';

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_hyoil').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo,
		hyoil3pYn:hyoil3pYn, hyoil5pYn:hyoil5pYn,
		hyoil7pYn:hyoil7pYn, hyoil11pYn:hyoil11pYn
	};

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchHyunOilBank.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

		  hyoil3pChgInfo = data.hOilPointInfo.revList[0];
		  hyoil5pChgInfo = data.hOilPointInfo.revList[1];
		  hyoil7pChgInfo = data.hOilPointInfo.revList[2];
		  hyoil11pChgInfo = data.hOilPointInfo.revList[3];

		  let useAbleAmt = hyoil3pChgInfo.useAbleAmt;
		  $('#hyOilUseAbleAmt').text(String(useAbleAmt).maskNumber());
		  if(useAbleAmt >= 3000) {
			  $('#rdo_point_3000_input').attr('disabled', false);
		  }
		  if(useAbleAmt >= 5000) {
			  $('#rdo_point_5000_input').attr('disabled', false);
		  }
		  if(useAbleAmt >= 7000) {
			  $('#rdo_point_7000_input').attr('disabled', false);
		  }
		  if(useAbleAmt >= 11000) {
			  $('#rdo_point_11000_input').attr('disabled', false);
		  }

		  $('input[name="rdo_point_select"]').change(function() {
			  fn_setHyoilPointChg();
		  });

      	//쿠폰 전역변수 세팅
      	//hyOilChgInfo = data.hOilPointInfo;

      	//쿠폰 목록 세팅
      	//setHyOilChg(hyOilChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#btn_select_hyoil').prop("disabled", true);
  		$('#btn_select_hyoil').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#btn_select_hyoil').removeClass('disabled');
     			$('#btn_select_hyoil').prop("disabled", false);
  		},1500);
  	  }
	});
}

//현대오일뱅크 목록 세팅
function setHyOilChg(cponInfo) {
	setInitHyOil();
	var cponListText = "";

	//$('#hyOilUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());

	var cponList = cponInfo.comboList;
	var useAmt   = 0;
	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
		$('#selHyOil').append(cponListText);
	}
}

function fn_setHyoilPointChg() {
	var selPoint = $(':radio[name="rdo_point_select"]:checked').val();

	if(selPoint == '0') {
		setHyOilChg(hyoil3pChgInfo);
	} else if(selPoint == '1') {
		setHyOilChg(hyoil5pChgInfo);
	} else if(selPoint == '2') {
		setHyOilChg(hyoil7pChgInfo);
	} else {
		setHyOilChg(hyoil11pChgInfo);
	}
}

//현대오일뱅크 적용
function applyHyOil() {

	var transNo  = $("#transNo").val();
	var cardNo    = $("#hyOilCardNum_hid").val().replaceAll('-', '').nvlNum(0);
	var useCnt   = $('#selHyOil option:selected').val();
	var password = $("#ho_card_pwd").val();
	var selPoint = $(':radio[name="rdo_point_select"]:checked').val();

	if(selPoint == '' || selPoint == undefined) {
		//적용 포인트를 선택하세요.
		gfn_alertMsgBox('적용 포인트를 선택하세요.');
		return;
	}

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
		$("#gs_card_pwd").focus();
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt, password:password, selPoint:selPoint};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyHyunOilBank.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_hyoil').show(); //취소버튼
      	$('#btn_cancel_apply_hyoil').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_303025 .close-layer').click();
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}
</script>

	<!-- 레이어 : 현대오일뱅크 -->
	<input type="hidden" id="hyOilCardNum_hid">
	<section id="layer_303025" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">HD현대오일뱅크<!-- 현대오일뱅크 --></h3>
			</header>

			<div class="layer-con happType" style="height: auto">
				<div class="reset">
					 HD현대오일뱅크 카드 정보를 입력해주세요.<!-- 현대오일뱅크 카드 정보를 입력해주세요. -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="ho_card_num">카드번호<!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" title="HD현대오일뱅크 카드번호 입력" class="input-text w180px x-small" id="hyOilCardNum" maxlength="20">

								<button type="button" class="button gray x-small ml05" id="btn_select_hyoil">포인트 조회<!-- 포인트 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">사용가능 한포인트<!-- 사용가능 한포인트 --></p>

							<div class="sh-input">
								<em class="font-gblue" id="hyOilUseAbleAmt">0</em> 점<!-- 점 -->
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">적용 포인트 선택</p>

							<div class="sh-input">
								<div class="radios">
									

									

									

									
								</div>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">적용 매수 선택<!-- 적용 매수 선택 --></p>

							<div class="sh-input">
								<select title="HD현대오일뱅크 포인트 적용 매수 선택" class="w100px x-small" id="selHyOil">
									<option value="0">선택<!-- 선택 --></option>
								</select>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="ho_card_pwd">비밀번호<!-- 비밀번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="ho_card_pwd" title="HD현대오일뱅크 카드 비밀번호 입력" class="input-text w100px x-small pwnew">
							</div>
						</div>
					</div>
				</div>

				<div class="box-border v1 use-guide">
					<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list2">
						<li>장당 3,000 / 5,000 / 7,000 / 11,000 포인트 중 선택하여 차감 할인 (1일 최대 4매)<!-- 장당 3,000/5,000/7,000/11,000 포인트 중 선택하여 차감 할인(1일 최대 4매) --></li>
						<li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
						<li>돌비시네마 할인 및 무료관람 적용불가<!-- 돌비시네마 할인 및 무료관람 적용불가 --></li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_hyoil">닫기<!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_hyoil" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_hyoil">적용<!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_hyoil">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : 현대오일뱅크 -->
	<!--// 레이어 : 현대오일뱅크 -->

	<!-- 레이어 : 해피포인트 -->
	





<script type="text/javascript">
let happPointChgInfo = {};		//2,000/3,000/5,000 포인트 정보 객체 생성
let happPointChgInfo5 = {};
let happPointChgInfo3 = {};

//초기화 공통 sMethodName.init
function happ_init() {  //스마트콘 전체초기화
	setInitHappPoint();
	happPointChgInfo = {};
	happPointChgInfo5 = {};
	happPointChgInfo3 = {};

	setIntitHappPointRdo();
	$('#happPointCardNum').val('');
	$('#happPointCardNum_hid').val('');
	$('#happUseAbleAmt').text('0');
}

$(function() {
	//숫자만 입력가능
	$("#happPointCardNum").megaBoxCardNumberCheck();

	//조회버튼 클릭
	$('#btn_select_happ').on('click', function() {
		searchHappPoint();
	});

	//해피포인트 적용
	$('#btn_apply_happ').on('click', function() {
		applyHappPoint();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_happ').on('click', function() {
		var sMethodName = "happ";
		cancelMbxSellCpInfo(sMethodName);
		setIntitHappPointRdo();

		//닫기버튼 클릭
     	$('#layer_303023 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_happ, #btn_close_modal_happ').on('click', function() {
		if (!$('#btn_cancel_apply_happ').is(':visible')) {
			happ_init();
		}
	});
});


//해피포인트 초기화
function setInitHappPoint() {
	$('#selHappPoint > option').remove();
	$('#selHappPoint').append('<option value="0">선택</option>');
}

//해피포인트 포인트 선택 라디오 버튼 초기화
function setIntitHappPointRdo() {
	$('#happ_point_2000_input').attr('disabled', true);
	$('#happ_point_3000_input').attr('disabled', true);
	$('#happ_point_5000_input').attr('disabled', true);
	$('input[name="rdo_point_select"]').removeAttr('checked');
}

//해피포인트 조회
function searchHappPoint() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#happPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);
	var happ5pYn   = 'N';
	var happ3pYn   = 'N';
	var paramData  = {transNo:transNo, cardNo:cardNo, happ5pYn: happ5pYn, happ3pYn: happ3pYn};

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_happ').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchHappyPoint.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//포인트 전역변수 세팅 (2,000/5,000 개별)
		happPointChgInfo = data.happPointInfo.revList[0];
		happPointChgInfo5 = data.happPointInfo.revList[1];
		happPointChgInfo3 = data.happPointInfo.revList[2];
		let useAbleAmt = happPointChgInfo.useAbleAmt;
		$('#happUseAbleAmt').text(String(useAbleAmt).maskNumber());		//사용가능 포인트 설정

		if(useAbleAmt >= 2000) {				//사용 가능 포인트에 따라 라디오 버튼 enable/disable 처리
			$('#happ_point_2000_input').attr('disabled', false);
		}
		if(useAbleAmt >= 3000) {
			$('#happ_point_3000_input').attr('disabled', false);
		}
		if(useAbleAmt >= 5000) {
			$('#happ_point_5000_input').attr('disabled', false);
		}

      	//포인트 선택에 따라 매수,차감포인트 목록 세팅
		$('input[name="rdo_point_select"]').change(function() {
			fn_setHappPointChg();
		});
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#btn_select_happ').prop("disabled", true);
  		$('#btn_select_happ').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#btn_select_happ').removeClass('disabled');
     			$('#btn_select_happ').prop("disabled", false);
  		},1500);
  	  }
	});
}

//포인트 선택에 따라 매수,차감포인트 목록 세팅
function fn_setHappPointChg() {
	var selPoint = $(':radio[name="rdo_point_select"]:checked').val();

	if(selPoint == '0') {
		setHappPointChg(happPointChgInfo);
	} else if(selPoint == '1') {
		setHappPointChg(happPointChgInfo5);
	} else if(selPoint == '2') {
		setHappPointChg(happPointChgInfo3);
	}
}

//해피포인트 목록 세팅
function setHappPointChg(cponInfo) {
	setInitHappPoint();
	var cponListText = "";

	var cponList = cponInfo.comboList;
	var useAmt   = 0;
	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
		$('#selHappPoint').append(cponListText);
	}
}

//해피포인트 적용
function applyHappPoint() {

	var transNo = $("#transNo").val();
	var cardNo  = $("#happPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);
	var useCnt  = $('#selHappPoint option:selected').val();
	var selPoint = $(':radio[name="rdo_point_select"]:checked').val();

	if(selPoint == '' || selPoint == undefined) {
		//적용 포인트를 선택하세요.
		gfn_alertMsgBox('적용 포인트를 선택하세요.');
		return;
	}

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt, selPoint:selPoint};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyHappyPoint.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_happ').show(); //취소버튼
      	$('#btn_cancel_apply_happ').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_303023 .close-layer').click();
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}
</script>

	<!-- 레이어 : 해피포인트 -->
	<input type="hidden" id="happPointCardNum_hid">
	<section id="layer_303023" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">해피포인트<!-- 해피포인트 --></h3>
			</header>

			<div class="layer-con happType" style="height: auto">
				<div class="reset">
					 해피포인트 카드 정보를 입력해주세요.<!-- 해피포인트 카드 정보를 입력해주세요. -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="happy_card_num">카드번호<!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" title="해피포인트 카드번호 입력" class="input-text w180px x-small" id="happPointCardNum" maxlength="20">

								<button type="button" class="button gray x-small ml05" id="btn_select_happ">포인트 조회<!-- 포인트 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">사용가능 한포인트<!-- 사용가능 한포인트 --></p>

							<div class="sh-input">
								<em class="font-gblue" id="happUseAbleAmt">0</em> 포인트<!-- 포인트 -->
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">적용 포인트 선택</p>

							<div class="sh-input">
								<div class="radios">
									<div>
										<input type="radio" name="rdo_point_select" id="happ_point_2000_input" value="0" disabled="disabled">
										<label for="happ_point_2000_input">2,000포인트</label>
									</div>
									
									
								</div>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">적용 매수 선택<!-- 적용 매수 선택 --></p>

							<div class="sh-input">
								<select title="해피포인트 포인트 적용 매수 선택" class="w120px x-small" id="selHappPoint">
									<option value="0">선택<!-- 선택 --></option>
								</select>
							</div>
						</div>
					</div>
				</div>

				<div class="box-border v1 use-guide mt15">
					<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>
							장당 2,000
							
								
								포인트 차감 할인
							
						</li>








						<li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_happ">닫기<!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_happ" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_happ">적용<!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_happ">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : 해피포인트 -->
	<!--// 레이어 : 해피포인트 -->

	<!-- 레이어 : 블루멤버스 포인트 -->
	





<script type="text/javascript">
var hbPointChgInfo = new Object();

//초기화 공통 sMethodName.init
function hbluep_init() {  //현대블루멤버스 전체초기화
	setInitHbPoint();
	hbPointChgInfo = new Object();

	$('#hbPointCardNum').val('');
	$('#hbPointCardNum_hid').val('');
	$('#hbPointUseAbleAmt').text('0');
	$('#bluemembers_card_pwd').val('');
}

$(function() {
	//숫자만 입력가능
	$('#hbPointCardNum').megaBoxCardNumberCheck();

	//조회버튼 클릭
	$('#btn_select_hbluep').on('click', function() {
		searchHbPoint();
	});

	//블루포인트 적용
	$('#btn_apply_hbluep').on('click', function() {
		applyHbPoint();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_hbluep').on('click', function() {
		var sMethodName = "hbluep";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_303005 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_hbluep, #btn_close_modal_hbluep').on('click', function() {
		if (!$('#btn_cancel_apply_hbluep').is(':visible')) {
			hbluep_init();
		}
	});
});


//현대블루멤버스 초기화
function setInitHbPoint() {
	$('#selHbPoint > option').remove();
	$('#selHbPoint').append('<option value="0">선택</option>');
}

//현대블루멤버스 조회
function searchHbPoint() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#hbPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_hbluep').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo };

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchHyunBluePoint.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//쿠폰 전역변수 세팅
      	hbPointChgInfo = data.bluePointInfo;

      	//쿠폰 목록 세팅
      	setHbPointChg(hbPointChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#btn_select_hbluep').prop("disabled", true);
  		$('#btn_select_hbluep').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#btn_select_hbluep').removeClass('disabled');
     			$('#btn_select_hbluep').prop("disabled", false);
  		},1500);
  	  }
	});
}

//현대블루멤버스 목록 세팅
function setHbPointChg(cponInfo) {
	setInitHbPoint();
	var cponListText = "";

	$('#hbPointUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());

	var cponList = cponInfo.comboList;
	var useAmt   = 0;
	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
		$('#selHbPoint').append(cponListText);
	}
}

//현대블루멤버스 적용
function applyHbPoint() {

	var transNo  = $("#transNo").val();
	var cardNo   = $("#hbPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);
	var useCnt   = $('#selHbPoint option:selected').val();
	var password = $("#bluemembers_card_pwd").val();

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if (cardNo == "" || cardNo.length < 10) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
		$("#gs_card_pwd").focus();
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt, password:password};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyHyunBluePoint.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_hbluep').show(); //취소버튼
      	$('#btn_cancel_apply_hbluep').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_303005 .close-layer').click();
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}
</script>

	<!-- 레이어 : 블루멤버스 포인트 -->
	<input type="hidden" id="hbPointCardNum_hid">
	<section id="layer_303005" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">블루멤버스 포인트<!-- 블루멤버스 포인트 --></h3>
			</header>

			<div class="layer-con">
				<div class="reset">
					 블루멤버스 포인트 카드 정보를 입력해주세요.<!-- 블루멤버스 포인트 카드 정보를 입력해주세요. -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="bluemembers_card_num">카드번호<!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" title="블루멤버스 포인트 카드번호 입력" class="input-text w180px x-small" id="hbPointCardNum" maxlength="20">

								<button type="button" class="button gray x-small ml05" id="btn_select_hbluep">포인트 조회<!-- 포인트 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">사용가능 한포인트<!-- 사용가능 한포인트 --></p>

							<div class="sh-input">
								<em class="font-gblue" id="hbPointUseAbleAmt">0</em> 점<!-- 점 -->
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">적용 매수 선택<!-- 적용 매수 선택 --></p>

							<div class="sh-input">
								<select title="블루멤버스 적용 매수 선택" class="w100px x-small" id="selHbPoint">
									<option value="0">선택<!-- 선택 --></option>
								</select>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="bluemembers_card_pwd">비밀번호<!-- 비밀번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="bluemembers_card_pwd" title="블루멤버스 포인트 카드 비밀번호 입력" class="input-text w120px x-small pwnew">
							</div>
						</div>
					</div>
				</div>

				<div class="box-border v1 use-guide mt15">
					<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>장당 4,000포인트 차감 할인(1일 최대 8매)<!-- 장당 4,000포인트 차감 할인(1일 최대 8매) --></li>
						<li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_hbluep">닫기<!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_hbluep" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_hbluep">적용<!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_hbluep">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : 블루멤버스 포인트 -->

	<!--// 레이어 : 블루멤버스 포인트 -->

	<!-- 레이어 : 중앙멤버십 -->
	





<script type="text/javascript">
var joongangChgInfo = new Object();

//초기화 공통 sMethodName.init
function joongang_init() {  //중앙멤버십 전체초기화
	setInitJoongang();
	joongangChgInfo = new Object();

	$('#joongangCardNum').val('');
	$('#joongangCardNum_hid').val('');
	$('#joongangUseAbleAmt').text('0');
	$('#joongangUseAbleText').text('');
}

$(function() {
	//숫자만 입력가능
	$('#joongangCardNum').megaBoxCardNumberCheck();

	//조회버튼 클릭
	$('#btn_select_joongang').on('click', function() {
		searchJoongang();
	});

	//중앙멤버십 적용
	$('#btn_apply_joongang').on('click', function() {
		applyJoongang();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_joongang').on('click', function() {
		var sMethodName = "joongang";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_303007 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_joongang, #btn_close_modal_joongang').on('click', function() {
		if (!$('#btn_cancel_apply_joongang').is(':visible')) {
			joongang_init();
		}
	});
});


//중앙멤버십 포인트 초기화
function setInitJoongang() {
	$('#joongangUseAbleAmt').text('0');
	$('#joongangUseAbleText').text('');

	$('#selJoongang > option').remove();
	$('#selJoongang').append('<option value="0">선택</option>');
}

//중앙멤버십 조회
function searchJoongang() {
	var transNo   = $("#transNo").val();
	var cardNo    = $("#joongangCardNum_hid").val();

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_joongang').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo};

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchJoongAngMem.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//쿠폰 전역변수 세팅
      	joongangChgInfo = data.jjMemInfo;

      	//쿠폰 목록 세팅
      	setJoongangChg(joongangChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#btn_select_joongang').prop("disabled", true);
  		$('#btn_select_joongang').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#btn_select_joongang').removeClass('disabled');
     			$('#btn_select_joongang').prop("disabled", false);
  		},1500);
  	  }
	});
}

//중앙멤버십 목록 세팅
function setJoongangChg(cponInfo) {
	setInitJoongang();
	var cponListText = "";

	$('#joongangUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());

	var availableTxt = '';
	if (String(cponInfo.useAbleAmt) > "0") {
		availableTxt = '사용가능';/* 사용가능 */
	} else {
		availableTxt = '사용불가';/* 사용불가 */
	}

	$('#joongangUseAbleText').text(availableTxt);

	var cponList = cponInfo.comboList;
	var useAmt   = 0;
	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
		$('#selJoongang').append(cponListText);
	}
}

//중앙멤버십 적용
function applyJoongang() {

	var transNo  = $("#transNo").val();
	var cardNo   = $("#joongangCardNum_hid").val();
	var useCnt   = $('#selJoongang option:selected').val();

	if (cardNo == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo,useCnt:useCnt};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyJoongAng.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_joongang').show(); //취소버튼
      	$('#btn_cancel_apply_joongang').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_303007 .close-layer').click();
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}
</script>

<!-- 레이어 : 중앙멤버십 -->
<input type="hidden" id="joongangCardNum_hid">
<section id="layer_303007" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">중앙멤버십<!-- 중앙멤버십 --></h3>
		</header>

		<div class="layer-con">
			<div class="reset">
				멤버십카드 정보를 입력해주세요.<!-- 멤버십카드 정보를 입력해주세요. -->
			</div>

			<div class="popup-gray mid-info-box mb15">
				<div class="pop-search-area">
					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="jmembership_card_num">카드번호<!-- 카드번호 --></label></p>

						<div class="sh-input">
							<input type="text" title="중앙멤버십 카드번호 입력" class="input-text w200px x-small" maxlength="20" id="joongangCardNum">
						</div>

						<div class="sh-btn gray">
							<button type="button" class="button x-small gray" id="btn_select_joongang">조회<!-- 조회 --></button>
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">사용여부<!-- 사용여부 --></p>
						<span class="font-green" id="joongangUseAbleText"></span>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">사용가능금액<!-- 사용가능금액 --></p>
						<span class="font-green" id="joongangUseAbleAmt">0</span> 점<!-- 점 -->
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset vt"><label for="hyundai_m_point_card_ticket_counting">적용 매수 선택</label></p>
						<div class="sh-input mr0">

							<select title="중앙멤버십 선택" class="w120px v1 x-small" id="selJoongang">
								<option value="0">선택<!-- 선택 --></option>
							</select>
						</div>
					</div>
				</div>
			</div>

			<div class="box-border v1">
				<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>장당 1,000원 할인(연 24회)<!-- 장당 1,000원 할인(연 24회) --></li>
						<li>우대/문화의날 및 특별콘텐트 이용불가<!-- 우대/문화의날 및 특별콘텐트 이용불가 --></li>
					</ul>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_joongang">닫기 <!-- 닫기 --></button>
			<button type="button" class="button small purple" id="btn_cancel_apply_joongang" style="display:none;">적용취소 <!-- 적용취소 --></button>
			<button type="button" class="button small purple" id="btn_apply_joongang">적용 <!-- 적용 --></button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_joongang">레이어 닫기<!-- 레이어 닫기 --></button>
	</div>
</section>
<!--// 레이어 : 중앙멤버십 -->

	<!--// 레이어 : 중앙멤버십 -->

	<!-- 레이어 : 중앙패밀리포인트 -->
	





<script type="text/javascript">
var jfamilyChgInfo = new Object();

//초기화 공통 sMethodName.init
function jfamily_init() {  //중앙패밀리 전체초기화
	setInitJfamily();
	jfamilyChgInfo = new Object();

	$('#jfamilyUseAbleAmt').text('0');
}

$(function() {

	//조회버튼 클릭
	$('#btn_select_jfamily').on('click', function() {
		searchJfamily();
	});

	//블루포인트 적용
	$('#btn_apply_jfamily').on('click', function() {
		applyJfamily();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_jfamily').on('click', function() {
		var sMethodName = "jfamily";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_303008 .close-layer').click();
	});
});


//중앙패밀리 초기화
function setInitJfamily() {
	$('#selJfamily > option').remove();
	$('#selJfamily').append('<option>선택</option>');
}

//중앙패밀리 조회
function searchJfamily() {
	var transNo    = $("#transNo").val();

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_jfamily').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	//추후 중앙 그룹ID 적용 필요
	var paramData  = {transNo:transNo, usrId:parent.usrId};

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchJoongAngFamily.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//쿠폰 전역변수 세팅
      	jfamilyChgInfo = data.jfamilyInfo;

      	//쿠폰 목록 세팅
      	setJfamilyChg(jfamilyChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}

//중앙패밀리 목록 세팅
function setJfamilyChg(cponInfo) {
	setInitJfamily();
	var cponListText = "";

	$('#jfamilyUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
	$('#jfamilyTicketCnt').val(String(cponInfo.ticketCnt));

	var cponList = cponInfo.comboList;
	var useAmt   = 0;
	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
		$('#selJfamily').append(cponListText);
	}
	$('#selJfamily').selectpicker('refresh');
}

//중앙패밀리 적용
function applyJfamily() {

	var transNo   = $("#transNo").val();
	var useCnt    = $('#selJfamily option:selected').val();
	var ticketCnt = $('#jfamilyTicketCnt').val();

	if ( useCnt == 0 ) {
		//할인 적용할 매수를 선택하세요.
		gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
		return;
	}

	if (ticketCnt != useCnt) {
		//예매할 티켓 만큼 매수를 선택해주세요.
		gfn_alertMsgBox('예매할 티켓 만큼 매수를 선택해주세요.');
		return;
	}

	//사용건수와 티켓건수 상이시 오류(내용에 전체 건수 포함 전달 필요)
	var paramData  = {transNo:transNo, useCnt:useCnt, usrId:parent.usrId};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyJoongAngFamily.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_jfamily').show(); //취소버튼
      	$('#btn_cancel_apply_jfamily').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_303008 .close-layer').click();

      	//chkLastPayAmt();

      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}
</script>
<input type="hidden" id="jfamilyTicketCnt" name="jfamilyTicketCnt">
	<!-- 레이어 : 중앙 패밀리 포인트 -->
	<section id="layer_303008" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">중앙패밀리 포인트<!-- 중앙멤버십 포인트 --></h3>
			</header>

			<div class="layer-con">
				<div class="reset">
					회원님께서 보유하고 있는 포인트를 조회 및 적용하는 페이지입니다.<!-- 회원님께서 보유하고 있는 포인트를 조회 및 적용하는 페이지입니다. -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line" style="display:none">
							<p class="sh-txt reset">사용가능한 포인트<!-- 사용가능한 포인트 --></p>

							<div class="sh-input">
								<button type="button" class="button gray x-small" id="btn_select_jfamily">조회<!-- 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">사용가능한 포인트<!-- 사용가능 한포인트 --></p>

							<div class="sh-input">
								<em id="jfamilyUseAbleAmt" class="font-gblue">0</em> Point
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="before_sale_card_date">적용 매수 선택<!-- 적용 매수 선택 --></label></p>

							<div class="sh-input">
								<div class="dropdown bootstrap-select x-small bs3"><select title="중앙 패밀리 포인트 매수 선택" class="selectpicker x-small" id="selJfamily" tabindex="-98"><option class="bs-title-option" value=""></option>
									<option>선택<!-- 선택 --></option>
								</select><button type="button" class="btn dropdown-toggle btn-default bs-placeholder" data-toggle="dropdown" role="button" data-id="selJfamily" title="중앙 패밀리 포인트 매수 선택"><div class="filter-option"><div class="filter-option-inner"><div class="filter-option-inner-inner">중앙 패밀리 포인트 매수 선택</div></div> </div><span class="bs-caret"><span class="caret"></span></span></button><div class="dropdown-menu open" role="combobox"><div class="inner open" role="listbox" aria-expanded="false" tabindex="-1"><ul class="dropdown-menu inner "></ul></div></div></div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer">닫기<!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_jfamily" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_jfamily">적용<!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : 중앙 패밀리 포인트 -->

	<!--// 레이어 : 중앙패밀리포인트 -->

	<!-- 레이어 : ok 캐쉬백 -->
	





<script type="text/javascript">

var okCashInfo = new Object();

//초기화 공통 sMethodName.init
function okcb_init() {
	setInitStoreChg();
	okCashInfo = new Object();
	$("#okCashbagCardNum").val('');
	$("#okCashbagCardNum_hid").val('');
	$("#spn_okcb_useable_amt").text('0');
	$("#okcashbagUsePoint").val('');
	$("#okcashbagUsePwd").val('');
	$("#okcashbagPreUsePoint").val('');
	
}


$(function() {
	//숫자만 입력가능
	$("#okCashbagCardNum").megaBoxCardNumberCheck();

	//사용할포인트
	$("#okcashbagUsePoint").megaBoxCommaNumberCheck();

	//조회버튼 클릭
	$('#btn_select_okcb').on('click', function() {
		searchOkCashBag();
	});

	//적용버튼 클릭
	$('#btn_apply_okcb').on('click', function() {
		applyOkCashBag();
	});

	//모두사용 클릭
	$('#btn_all_use_okcb').on('click', function() {
		useAllOkCashBag();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_okcb').on('click', function() {
		var sMethodName = "okcb";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
       	$('#layer_303006 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_okcb, #btn_close_modal_okcb').on('click', function() {
		if (!$('#btn_cancel_apply_okcb').is(':visible')) {
			okcb_init();
		}
	});

});

//ok캐쉬백 모두사용
function useAllOkCashBag() {

	var useAbleAmt = $("#spn_okcb_useable_amt").text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var remainAmt  = $('.receipt .row.total span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);

	if (parseInt(useAbleAmt ) == 0) {
		//조회 후 사용 가능합니다.
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#okCashbagCardNum").focus();
		return;
	}

	var maxAmt = useAbleAmt;
	if (parseInt(useAbleAmt) > parseInt(remainAmt)) {
		maxAmt = remainAmt;
	}

	maxAmt = parseInt(maxAmt /100) * 100;
	$("#okcashbagUsePoint").val(String(maxAmt).maskNumber());
}

//ok캐쉬백 조회
function searchOkCashBag() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#okCashbagCardNum_hid").val();
	var paramData  = {transNo:transNo,cardNo:cardNo };

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_okcb').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#okCashbagCardNum").focus();
		return;
	}

	if (cardNo.length < 15) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#okCashbagCardNum").focus();
		return;
	}

	$.ajax({
        url: "/on/oh/ohz/PayBooking/searchOkCashBag.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//쿠폰 전역변수 세팅
        	okCashInfo = data.okCashInfo;

        	$('#spn_okcb_useable_amt').text( String(okCashInfo.useAbleAmt).maskNumber() );
        	$("#okcashbagPreUsePoint").val('');	//이전사용금액 초기화
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
        , beforeSend : function() {
    		$('#btn_select_okcb').prop("disabled", true);
    		$('#btn_select_okcb').addClass('disabled');
    	}
    	, complete : function() {
    		setTimeout(function(){
       			$('#btn_select_okcb').removeClass('disabled');
       			$('#btn_select_okcb').prop("disabled", false);
    		},1500);
    	}
	});
}


//ok캐쉬백 적용
function applyOkCashBag() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#okCashbagCardNum_hid").val();
	var useAmt     = $("#okcashbagUsePoint").val().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var useAbleAmt = $("#spn_okcb_useable_amt").text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var remainAmt  = $('.receipt .row.total span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var preUseAmt  = $("#okcashbagPreUsePoint").val().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	

	remainAmt = parseInt(remainAmt) + parseInt(preUseAmt);	//이전 사용금액이 있는 경우 잔여금액에 이전 사용금액 포함

	//카드번호 체크
	if (cardNo == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#okCashbagCardNum").focus();
		return;
	}

	if (cardNo.length < 15) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#okCashbagCardNum").focus();
		return;
	}

	if (parseInt(useAbleAmt) == 0) {
		//OK 캐쉬백 사용가능 포인트 조회 후 사용 가능합니다.
		gfn_alertMsgBox('OK 캐쉬백 사용가능 포인트 조회 후 사용 가능합니다.');
		return;
	}


	if (parseInt(useAmt) == 0) {
		//OK 캐쉬백 사용가능 포인트 조회 후 사용 가능합니다.
		gfn_alertMsgBox('사용 포인트를 입력하세요.');
		$("#okcashbagUsePoint").focus();
		return;
	}


	if (parseInt(useAbleAmt) < 1000) {
		//OK 캐쉬백 포인트 1,000점 이상 보유 시 사용 가능합니다.
		gfn_alertMsgBox('OK 캐쉬백 포인트 1,000점 이상 보유 시 사용 가능합니다.');
		return;
	}


	if (parseInt(useAmt) % 100 != 0) {
		//OK 캐쉬백 포인트 100점 단위로 사용 가능합니다.
		gfn_alertMsgBox('OK 캐쉬백 포인트 100점 단위로 사용 가능합니다.');
		$("#okcashbagUsePoint").focus();
		return;
	}

	if (parseInt(useAmt) > parseInt(remainAmt)) {
		//사용 포인트가 결제 금액보다 큽니다.
		gfn_alertMsgBox('사용 포인트가 결제 금액보다 큽니다.');
		$("#okcashbagUsePoint").focus();
		return;
	}

	var password = $("#okcashbagUsePwd").val();

	if (password.length < 6) {
		//비밀번호 6자리 이상 입력하세요
		gfn_alertMsgBox('비밀번호 6자리 이상 입력하세요.');
		$("#okcashbagUsePwd").focus();
		return;
	}

	var paramData = { cardNo:cardNo, password:password, useAmt:useAmt, transNo:transNo};

	$.ajax({
        url: "/on/oh/ohz/PayBooking/applyOkCashBag.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//할인내역 갱신
        	setMovieDcInfo(data.policyList);

        	$('#btn_cancel_okcb').show(); //취소버튼
        	$('#btn_cancel_apply_okcb').show(); //적용취소버튼

        	$('#okcashbagPreUsePoint').val($("#okcashbagUsePoint").val()); //취소버튼

        	//닫기버튼 클릭
        	$('#layer_303006 .close-layer').click();
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
	});

}
</script>

	<!-- 레이어 : ok 캐쉬백 -->
	<input type="hidden" id="okCashbagCardNum_hid">
	<section id="layer_303006" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">OK 캐쉬백 <!-- OK 캐쉬백 --></h3>
			</header>

			<div class="layer-con">

				<div class="reset">
					OK 캐쉬백 카드 정보를 입력해주세요. <!-- OK 캐쉬백 카드 정보를 입력해주세요. -->
				</div>

				<div class="popup-gray mid-info-box mb10">
					<div class="pop-search-area line-wid">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="okCashbagCardNum">카드번호 <!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="okCashbagCardNum" title="OK 캐쉬백 카드번호 입력" class="input-text w200px x-small" maxlength="20"><!-- OK 캐쉬백 카드번호 입력 -->
							</div>

							<div class="sh-btn">
								<button type="button" class="button x-small gray" id="btn_select_okcb">조회 <!-- 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">사용가능한 포인트 <!-- 사용가능한 포인트 --></p>
							<span class="font-green" id="spn_okcb_useable_amt">0</span> Point
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="okcashbagUsePoint">사용할 포인트 <!-- 사용할 포인트 --></label></p>
							<input type="text" id="okcashbagUsePoint" title="사용할 ok 캐쉬백 포인트 입력" class="input-text w120px mr05 x-small" maxlength="10"> Point <!-- 사용할 ok 캐쉬백 포인트 입력 -->
							<input type="hidden" id="okcashbagPreUsePoint">

							<div class="sh-btn ml05">
								<button type="button" class="button gray-line x-small" id="btn_all_use_okcb">모두사용 <!-- 모두사용 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="okcashbagUsePwd">비밀번호 <!-- 비밀번호 --></label></p>
							<input type="text" id="okcashbagUsePwd" title="" class="input-text w120px x-small pwnew" maxlength="15"> <!-- ok 캐쉬백 카드 비밀번호 입력 -->
						</div>

					</div>
				</div>

				

				<div class="box-border v1 use-guide mt10">
					<p class="tit">이용안내 <!-- 이용안내 --></p>

					<ul class="dot-list gray">
						
						<li>OK캐쉬백 1,000점 이상 보유 시 100점 단위로 사용가능 <!-- OK캐쉬백 1,000점 이상 보유 시 100점 단위로 사용가능 --></li>
						<li>OK캐쉬백 적립 : 최종 결제금액의 2% 적립 <!-- OK캐쉬백 적립 : 최종 결제금액의 2% 적립 --></li>
						<li>고객님의 안전한 포인트 사용을 위하여 온라인 비밀번호로 변경하셔야 합니다. <br>(숫자, 문자, 특수문자 조합 6~16자리) <!-- 고객님의 안전한 포인트 사용을 위하여 온라인 비밀번호로 변경하셔야 합니다. <br />(숫자, 문자, 특수문자 조합 6~16자리) --></li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_okcb">닫기 <!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_okcb" style="display:none;">적용취소 <!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_okcb">적용 <!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_okcb">레이어 닫기 <!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : ok 캐쉬백 -->




	<!--// 레이어 : ok 캐쉬백 -->

	<!-- 레이어 : 리아결제 -->
	





<script type="text/javascript">
var tellerChgInfo = new Object();

//초기화 공통 sMethodName.init
function teller_init() {  //상담원결제 전체초기화
	setInitTeller();

	$('#tellerCardNum_1').val('');
	$('#tellerCardNum_2').val('');
	$('#tellerCardNum_3').val('');
	$('#tellerCardNum_4').val('');

	$('#teller_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#teller_card_mm').val('');
	$('#teller_card_yy').val('');
	$('#teller_card_birthday').val('');
	$('#teller_card_password').val('');

	var remainAmt = $('.receipt .row.total span').text().replaceAll(',', '');
	$('.ria-finish-box > .right > b').text(String(remainAmt).maskNumber());
}


$(function() {
	//숫자만 입력가능
	$('#tellerCardNum_1').megaBoxNumberCheck();
	$('#tellerCardNum_2').megaBoxNumberCheck();
	$('#tellerCardNum_3').megaBoxNumberCheck();
	$('#tellerCardNum_4').megaBoxNumberCheck();
	$('#teller_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#teller_card_mm').megaBoxNumberCheck();  //유효기간 숫자만 입력
	$('#teller_card_yy').megaBoxNumberCheck();  //유효기간 숫자만 입력

	//상담원예매 결제 버튼 클릭
	$("#btn_teller_booking").on('click', function() {
		payTeller();
	});

	//상담원예매 초기화 버튼 클릭
	$("#btn_teller_init").on('click', function() {
		teller_init();
	});

	//상담원예매 카드정보 불러오기 버튼 클릭
	$("#btn_teller_Card_Info").on('click', function() {
		tellerCardInfo();
	});

});


//상담원 결제 초기화
function setInitTeller() {
	$('#teller_install > option:eq(0)').attr('selected', 'selected');
}


//상담원예매 카드정보 불러오기 버튼 클릭
function tellerCardInfo(){
	var paramData   = { in_param1:parent.riaParamReciveTime};


	$.ajaxMegaBox({
        url    : "/on/oh/ohz/PayBooking/selectTellerCardInfo.do",
        data   : JSON.stringify(paramData),
        success: function(result){

        	if("0" != result.statCd){
        		gfn_alertMsgBoxSize(result.msg,400,250);    //예매가능한 날짜가 아닙니다.
        	}
        	else {
        		var decBirthDay         = result.resultMap.decBirthDay;
        		var decCardNo           = result.resultMap.decCardNo;
        		var decCardNo1          = decCardNo.substring(0,4);
        		var decCardNo2          = decCardNo.substring(4,8);
        		var decCardNo3          = decCardNo.substring(8,12);
        		var decCardNo4          = decCardNo.substring(12,16);;
        		var decCardExpireDate   = result.resultMap.decCardExpireDate;
        		var decCardExpireDateYy = decCardExpireDate.substring(0,2);
        		var decCardExpireDateMm = decCardExpireDate.substring(2,4);;
        		var decCardAuth         = result.resultMap.decCardAuth;

        		//console.log(decCardNo, decCardExpireDate);

        		$('#tellerCardNum_1').val(decCardNo1);
        		$('#tellerCardNum_2').val(decCardNo2);
        		$('#tellerCardNum_3').val(decCardNo3);
        		$('#tellerCardNum_4').val(decCardNo4);
        		$('#teller_card_birthday').val(decBirthDay);
        		$('#teller_card_mm').val(decCardExpireDateMm);
        		$('#teller_card_yy').val(decCardExpireDateYy);
        		$('#teller_card_password').val(decCardAuth);

        	}

        }
        , beforeSend : function() {
    		$('#btn_teller_Card_Info').prop("disabled", true);
    		$('#btn_teller_Card_Info').addClass('disabled');
    	}
    	, complete : function() {
    		setTimeout(function(){
       			$('#btn_teller_Card_Info').removeClass('disabled');
       			$('#btn_teller_Card_Info').prop("disabled", false);
    		},1500);
    	}

    });

}

//상담원 결제
function payTeller() {
	var cardNo1  = $("#tellerCardNum_1").val();
	var cardNo2  = $("#tellerCardNum_2").val();
	var cardNo3  = $("#tellerCardNum_3").val();
	var cardNo4  = $("#tellerCardNum_4").val();
	var cardNo   = cardNo1 + cardNo2 + cardNo3 + cardNo4;
	var Installment  = $('#teller_install option:selected').val();
	var password = $("#teller_card_password").val();

	var valBirth   = $('#teller_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#teller_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#teller_card_yy').val();  //유효기간 숫자만 입력
	var teller_fee = $('#chk_teller_fee').prop('checked')==true?"Y":"N";

	if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
		$("#teller_card_password").focus();
		return;
	}

	if (valMonth == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#teller_card_mm').focus();
		return;
	}

	if (valYear == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#teller_card_yy').focus();
		return;
	}

	if (valBirth == "") {
		gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
		$('#teller_card_birthday').focus();
		return;
	}

	var option = { cardNo1:cardNo1,cardNo2:cardNo2,cardNo3:cardNo3,cardNo4:cardNo4,cardNo:cardNo,
			       password:password, valMonth:valMonth, valYear:valYear, valBirth:valBirth, Installment:Installment,
			       preDisc:'Y',  discType:'TELLER', tellerFee:teller_fee};

	$('#lastPayMethod').val('credit');
	$('#preDisc').val('Y');
	$('#discType').val('TELLER');
	$('#tellerFee').val(teller_fee);

	//최종결제 금액 유효성 검사 및 결제 처리
	chkLastPayAmt(option);

}
</script>

	<!-- 레이어  : 리아 결제 -->
	<section id="layer_ria" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">신용/체크 카드 <!-- 신용/체크 카드 --></h3>
			</header>

			<div class="layer-con">
				<div class="pop-tit pb30">
					<button type="button" class="button small right mr125" id="btn_teller_init"> <i class="iconset ico-reset-small"></i>새로입력 <!-- 새로입력 --></button>
					<button type="button" class="button small right" id="btn_teller_Card_Info">카드정보 불러오기 <!-- 카드정보 불러오기 --></button>
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="ria_card_num">카드번호 <!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="tellerCardNum_1" title="체크/신용카드 카드번호 첫번째자리 입력" class="input-text x-small w60px" maxlength="4"><!-- 체크/신용카드 카드번호 첫번째자리 입력 --> -
								<input type="text" id="tellerCardNum_2" title="체크/신용카드 카드번호 두번째자리 입력" class="input-text w60px x-small " maxlength="4"> <!-- 체크/신용카드 카드번호 두번째자리 입력 --> -
								<input type="number" id="tellerCardNum_3" title="체크/신용카드 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" maxlength="4" oninput="gfn_numberMaxLength(this);"> <!-- 체크/신용카드 카드번호 세번째자리 입력 --> -
								<input type="text" id="tellerCardNum_4" title="체크/신용카드 카드번호 네번째자리 입력" class="input-text w60px x-small " maxlength="4"><!-- 체크/신용카드 카드번호 네번째자리 입력 -->
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="teller_card_mm">유효기간 <!-- 유효기간 --></label></p>

							<div class="sh-input">
								<input type="text" id="teller_card_mm" title="체크/신용카드 유효기간 월 입력" placeholder="MM" class="input-text w60px  x-small a-c" maxlength="2"><!-- 체크/신용카드 유효기간 월 입력 --> /
								<input type="text" id="teller_card_yy" title="체크/신용카드 유효기간 년 입력" placeholder="YY" class="input-text w60px x-small a-c" maxlength="2"><!-- 체크/신용카드 유효기간 년 입력 -->
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="teller_card_password">비밀번호 <!-- 비밀번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="teller_card_password" title="체크/신용카드 비밀번호 앞 2자리 입력" class="input-text w130px x-small pwnew" maxlength="2"><!-- 체크/신용카드 비밀번호 앞 2자리 입력 -->
								<span class="font-size-13 font-gray ml05">앞 2자리</span><!-- 앞 2자리 -->
							</div>
						</div>

						<div class="pop-search-area-line gray">
							<p class="sh-txt reset vt"><label for="teller_card_birthday">생년월일 <!-- 생년월일 --></label></p>
							<div class="sh-input mr0">
								<input type="text" id="teller_card_birthday" title="체크/신용카드 생년월일 입력" class="input-text w130px x-small pwnew" maxlength="10"><!-- 체크/신용카드 생년월일 입력 -->

								<p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자) / 사업자번호 10자리 <!-- 생년월일 6자리(카드소유자) / 사업자번호 10자리 --></p>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="teller_install">할부 <!-- 할부 --></label></p>

							<div class="sh-input">
								<select name="" id="teller_install" class="small w130px">
									<option value="00">일시불 <!-- 일시불 --></option>
									
										
											
										
										
										<option value="02">2 개월 <!-- 개월 --></option>
									
										
											
										
										
										<option value="03">3 개월 <!-- 개월 --></option>
									
										
											
										
										
										<option value="04">4 개월 <!-- 개월 --></option>
									
										
											
										
										
										<option value="05">5 개월 <!-- 개월 --></option>
									
										
											
										
										
										<option value="06">6 개월 <!-- 개월 --></option>
									
										
											
										
										
										<option value="07">7 개월 <!-- 개월 --></option>
									
										
											
										
										
										<option value="08">8 개월 <!-- 개월 --></option>
									
										
											
										
										
										<option value="09">9 개월 <!-- 개월 --></option>
									
										
										
											
										
										<option value="10">10 개월 <!-- 개월 --></option>
									
										
										
											
										
										<option value="11">11 개월 <!-- 개월 --></option>
									
										
										
											
										
										<option value="12">12 개월 <!-- 개월 --></option>
									
								</select>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="ria_select">수수료 적용 <!-- 수수료 적용 --></label></p>

							<div class="sh-input">
								<input type="checkbox" id="chk_teller_fee">
								<label for="chk_teller_fee">수수료 함께 결제시 체크해주세요 <!-- 수수료 함께 결제시 체크해주세요 --></label>
							</div>
						</div>
					</div>
				</div>

				<div class="ria-finish-box">
					<span class="left">최종결제금액 <!-- 최종결제금액 --></span>
					<span class="right"><b>&nbsp;</b> <em>원 <!-- 원 --></em></span>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_cancel_teller_booking">취소 <!-- 취소 --></button>
				<button type="button" class="button small purple" id="btn_teller_booking">결제 <!-- 결제 --></button>
			</div>

			<button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
		</div>
	</section>

	<!--// 레이어 : 리아결제 -->

	<!-- 레이어 : 현금영수증 -->
	





<script type="text/javascript">

var precash_option;

$(function() {

	//숫자만 입력가능
	$("#cashBillPhoneNo").megaBoxNumberCheck();

	//닫기 클릭 이벤트
	$('#btn_bill_close, #btn_bill_layer_close').on('click', function() {
		$('#cashBillYn').val('Y');
		$('#cashrecIssueCd').val('SELFPRN');	//자진발급

		//예매번호 생성
		payBokdNoProc(precash_option);
	});

	//구분탭 변경
	$(':radio[name=bizmDivCd]').on('change', function() {
		if ($(this).val() == 'PERSON') {
			$('#cashBillPhoneNo').next().html('휴대폰 번호를 입력해 주세요.');
		} else {
			$('#cashBillPhoneNo').next().html('사업자번호를 입력해 주세요.');
		}
	});

	//즉시발급 클릭 이벤트
	$('#btn_bill_print').on('click', function() {

		var msg = '', cashBillNo = $('#cashBillPhoneNo').val();

		if ($(':radio[name=bizmDivCd]:checked').val() == 'PERSON') {
			if (cashBillNo == '') {
				msg = "휴대폰 번호를 입력해 주세요."; //휴대폰 번호를 입력해 주세요.
			} else if (!cashBillNo.isHpPhoneCode()) {
				msg = '011, 016, 017, 019, 010으로 시작하는 휴대폰 번호로 입력해주세요.'; //011, 016, 017, 019, 010으로 시작하는 휴대폰 번호로 입력해주세요.
			} else if (!cashBillNo.isHpPhoneNo()){
				msg = "올바른 휴대폰 번호를 입력해 주세요."; //올바른 휴대폰 번호를 입력해 주세요.
			}
		} else {
			if (cashBillNo == '') {
				msg = "사업자번호를 입력해 주세요."; //사업자번호를 입력해 주세요.
			} else if (!cashBillNo.isBizNo()){
				msg = "올바른 사업자번호를 입력해 주세요."; //올바른 사업자번호를 입력해 주세요.
			}
		}

		if (msg != '') {
			gfn_alertMsgBox(msg);
			$('#cashBillPhoneNo').focus();
			return false;
		}

		$('#cashBillYn').val('Y');
		$('#cashrecIssueCd').val('GERNPRN');	//일반발급

		//예매번호 생성
		payBokdNoProc(precash_option);
	});
});


</script>
	<!-- 레이어 : 현금영수증 -->
	<section id="layer_cash_bill" class="modal-layer layerPop24"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="layerPop w600">
			<div class="hd">
				<div class="tit">현금영수증 발급 <!-- 현금영수증 발급 --></div>
				<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#" class="exit" id="btn_bill_layer_close"> <!-- 레이어 닫기 --></a>
			</div>

			<div class="bd">
				<div class="topLine">
					현금영수증 발행을 위해 아래 정보를 입력해 주세요. <!-- 현금영수증 발행을 위해 아래 정보를 입력해 주세요. -->
				</div>

				<div class="payGrayArea tit140">
					<div class="row">
						<div class="tit">금액 </div>
						<div class="con" id="cashBillAmt">12,000원</div>
					</div>
					<div class="row">
						<div class="tit">거래구분</div>
						<div class="con">
							<div class="radioArea">
								<div class="newRadio_1">
									<input type="radio" id="radio_cash_bill01" name="bizmDivCd" checked="checked" value="PERSON">
									<label for="radio_cash_bill01">개인소득공제용 <!-- 개인소득공제용 --></label>
								</div>
								<div class="newRadio_1">
									<input type="radio" id="radio_cash_bill02" name="bizmDivCd" value="BIZM">
									<label for="radio_cash_bill02">사업자증빙용 <!-- 사업자증빙용 --></label>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="tit"></div>
						<div class="con">
							<div class="newInp w200"><input type="text" title="휴대폰 번호 입력" maxlength="12" id="cashBillPhoneNo" name="cashBillPhoneNo" autocomplete="off"><!-- 휴대폰 번호 입력 --></div>
							<div class="txt">휴대폰 번호를 입력해 주세요.</div>
						</div>
					</div>
					<!--//payGrayArea end -->
					<div class="layerBtnBox juC">
						<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#" class="btnty01" id="btn_bill_close">자진발급 <!-- 자진발급 --></a>
						<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#" class="btnty02" id="btn_bill_print">즉시발급 <!-- 즉시발급 --></a>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--// 레이어 : 현금영수증 -->


	<!--// 레이어 : 현금영수증 -->

	<!-- 레이어 : 즉시할인 -->
	





<script type="text/javascript">
var preDiscChgInfo = new Object();

//초기화 공통 sMethodName.init
function pre_disc_init() {  //선할인 전체초기화
	setInitPreDisc();
	preDiscChgInfo = new Object();

	$('#preDiscCardNum_1').val('');
	$('#preDiscCardNum_2').val('');
	$('#preDiscCardNum_3').val('');
	$('#preDiscCardNum_4').val('');
	$('#preDiscUseAbleAmt').val('0');

	$('#pre_disc_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#pre_disc_card_mm').val('');
	$('#pre_disc_card_yy').val('');
	$('#pre_disc_birthday').val('');
	$('#pre_disc_password').val('');
	$('#chk_pre_disc_agree').prop('checked');
	$('#pre_disc_all_text').text('');
}


$(function() {
	pre_disc_init();

	//숫자만 입력가능
	$('#preDiscCardNum_1').megaBoxNumberCheck();
	$('#preDiscCardNum_2').megaBoxNumberCheck();
	$('#preDiscCardNum_3').megaBoxNumberCheck();
	$('#preDiscCardNum_4').megaBoxNumberCheck();

	$('#pre_disc_birthday').megaBoxNumberCheck();
	$('#pre_disc_card_mm').megaBoxNumberCheck();
	$('#pre_disc_card_yy').megaBoxNumberCheck();

	//조회버튼 클릭
	$('#btn_pre_disc').on('click', function() {
		searchPreDisc();
	});

	//선할인 적용
	$('#btn_pay_pre_disc').on('click', function() {
		applyPreDisc();
	});

});


//선할인 포인트 초기화
function setInitPreDisc() {
	$('#preDiscUseAbleAmt').val('0');
	$('#pre_disc_all_text').text('');
}


//선할인 조회
function searchPreDisc() {
	var transNo    = $("#transNo").val();
	var cardNo1    = $("#preDiscCardNum_1").val();
	var cardNo2    = $("#preDiscCardNum_2").val();
	var cardNo3    = $("#preDiscCardNum_3").val();
	var cardNo4    = $("#preDiscCardNum_4").val();

	var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;

	var valBirth   = $('#pre_disc_birthday').val(); //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#pre_disc_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#pre_disc_card_yy').val();  //유효기간 숫자만 입력

	var preDisc    = $('#preDisc').val();   //선할인여부
	var discType   = $('#discType').val();  //선할인타입(BC)
	var payAmt     = $('.receipt .row.total span').text().replaceAll(',', '');
	var password   = $('#pre_disc_password').val(); // 선할인 비밀번호

	if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (valMonth == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#pre_disc_card_mm').focus();
		return;
	}

	if (valYear == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#pre_disc_card_yy').focus();
		return;
	}

	if (valBirth == "") {
		gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
		$('#pre_disc_birthday').focus();
		return;
	}


	var paramData = {
			          cardNo1:cardNo1,
			          cardNo2:cardNo2,
			          cardNo3:cardNo3,
			          cardNo4:cardNo4,
			          cardNo:cardNo,
			          transNo:transNo,
			          valMonth:valMonth,
			          valYear:valYear,
			          valBirth:valBirth,
			          preDisc:preDisc,
			          discType:discType,
			          payAmt:payAmt,
			          password:password
			        };

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchPreDiscPoint.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//쿠폰 전역변수 세팅
      	preDiscChgInfo = data.preDiscInfo;

      	//쿠폰 목록 세팅
      	setPreDiscChg(preDiscChgInfo);
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#btn_pre_disc').prop("disabled", true);
  		$('#btn_pre_disc').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#btn_pre_disc').removeClass('disabled');
     			$('#btn_pre_disc').prop("disabled", false);
  		},1500);
  	  }
	});
}

//선할인 목록 세팅
function setPreDiscChg(cponInfo) {
	setInitPreDisc();

	var remainAmt = $('.receipt .row.total span').text().replaceAll(',', '');
	var discAmt   = cponInfo.useAbleAmt;

	if (discAmt == 0) {
		//선할인 대상 카드가 아닙니다.
		gfn_alertMsgBox('선할인 대상 카드가 아닙니다.');
		return;
	}

	var payAmt    = parseInt(remainAmt) - parseInt(discAmt);

	var cponListText = "";
	cponListText += String(remainAmt).maskNumber() + '원 - ' + String(discAmt).maskNumber() + '원 = ';
	cponListText += String(payAmt).maskNumber() + '원';

	$('#pre_disc_all_text').text(cponListText);
	$('#preDiscUseAbleAmt').val(cponInfo.useAbleAmt);
}

//선할인 적용
function applyPreDisc() {
	var transNo    = $("#transNo").val();
	var cardNo1    = $("#preDiscCardNum_1").val();
	var cardNo2    = $("#preDiscCardNum_2").val();
	var cardNo3    = $("#preDiscCardNum_3").val();
	var cardNo4    = $("#preDiscCardNum_4").val();
	var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;

	var valBirth   = $('#pre_disc_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#pre_disc_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#pre_disc_card_yy').val();  //유효기간 숫자만 입력
	var password   = $('#pre_disc_password').val(); //비밀번호
	var preDisc    = $('#preDisc').val();   //선할인여부
	var discType   = $('#discType').val();  //선할인타입(BC)
	var DcAmount   = $('#preDiscUseAbleAmt').val();	//할인 금액

	if ($('#pre_disc_all_text').text() == '') {
		gfn_alertMsgBox('선할인 금액 조회 후 결제 가능합니다.');
		return;
	}

	if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
		$("#pre_disc_password").focus();
		return;
	}

	if (valMonth == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#pre_disc_card_mm').focus();
		return;
	}

	if (valYear == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#pre_disc_card_yy').focus();
		return;
	}

	if (valBirth == "") {
		gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
		$('#pre_disc_birthday').focus();
		return;
	}

	if ($('#chk_pre_disc_agree').prop('checked') == false) {
		gfn_alertMsgBox('결제대행서비스 약관에 모두 동의하셔야 결제하실 수 있습니다.');
		$('#chk_pre_disc_agree').focus();
		return;
	}

	var option = {cardNo1:cardNo1  , cardNo2:cardNo2,  cardNo3:cardNo3   , cardNo4:cardNo4  ,
		          cardNo:cardNo    , transNo:transNo,  valMonth:valMonth , valYear:valYear  ,
		          valBirth:valBirth, preDisc:preDisc,  discType:discType ,
		          password:password, DcAmount:DcAmount};

	//최종결제 금액 유효성 검사 및 결제 처리
	chkLastPayAmt(option);

	//닫기버튼 클릭
    $('#layer_before_sale .close-layer').click();
}
</script>
<input type="hidden" name="preDiscUseAbleAmt" id="preDiscUseAbleAmt" value="0">
	<!-- 레이어  : 선 할인카드 -->
	<section id="layer_before_sale" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">즉시할인카드 <!-- 즉시할인카드 --></h3>
			</header>

			<div class="layer-con">
				<div class="pop-tit">
					카드정보 입력 후 [조회] 버튼을 눌러 최종 결제금액을 확인해 주세요. <!-- 카드정보 입력 후 [조회] 버튼을 눌러 최종 결제금액을 확인해 주세요. -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="before_sale_card_num">카드번호 <!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" title="즉시할인카드 카드번호 첫번째자리 입력" class="input-text x-small w60px" id="preDiscCardNum_1" maxlength="4"> - <!-- 즉시할인카드 카드번호 첫번째자리 입력 -->
								<input type="text" title="즉시할인카드 카드번호 두번째자리 입력" class="input-text w60px x-small " id="preDiscCardNum_2" maxlength="4"> - <!-- 즉시할인카드 카드번호 두번째자리 입력 -->
								<input type="number" title="즉시할인카드 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" id="preDiscCardNum_3" maxlength="4" oninput="gfn_numberMaxLength(this);"> - <!-- 즉시할인카드 카드번호 세번째자리 입력 -->
								<input type="text" title="즉시할인카드 카드번호 네번째자리 입력" class="input-text w60px x-small " id="preDiscCardNum_4" maxlength="4"> <!-- 즉시할인카드 카드번호 네번째자리 입력 -->
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="before_sale_card_date">카드유효기간 <!-- 카드유효기간 --></label></p>

							<div class="sh-input">
								<input type="text" id="pre_disc_card_mm" title="즉시할인카드 유효기간 월 입력" placeholder="MM" class="input-text w60px  x-small a-c" maxlength="2"> / <!-- 즉시할인카드 유효기간 월 입력 -->
								<input type="text" id="pre_disc_card_yy" title="즉시할인카드 유효기간 년 입력 " placeholder="YY" class="input-text w60px x-small a-c" maxlength="2"><!-- 즉시할인카드 유효기간 년 입력 -->
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="pre_disc_password">비밀번호 <!-- 비밀번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="pre_disc_password" title="즉시할인카드 비밀번호 앞 2자리 입력" class="input-text w60px x-small pwnew" maxlength="2"><!-- 즉시할인카드 비밀번호 앞 2자리 입력 -->
								<span class="font-size-13 font-gray ml05">앞 2자리 <!-- 앞 2자리 --></span>
							</div>
						</div>

						<div class="pop-search-area-line gray">
							<p class="sh-txt reset vt"><label for="pre_disc_birthday">생년월일 <!-- 생년월일 --></label></p>
							<div class="sh-input mr0">
								<input type="text" id="pre_disc_birthday" title="현대 M포인트 카드 생년월일 입력" class="input-text w80px x-small " maxlength="10">

								<p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자) / 사업자번호 10자리 <!-- 생년월일 6자리(카드소유자) / 사업자번호 10자리 --></p>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"></p>

							<div class="sh-input">
								<button type="button" class="button gray x-small" id="btn_pre_disc">조회 <!-- 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">최종결제금액 <!-- 최종결제금액 --></p>

							<div class="sh-input" id="pre_disc_all_text"></div>
						</div>
					</div>
				</div>

				<div class="mt10">
					<input type="checkbox" id="chk_pre_disc_agree">
					<label for="chk_pre_disc_agree">결제대행 서비스 약관 필수 동의 <!-- 결제대행서비스 약관에 모두 동의 --></label>

					<div class="mt10">
						<a href="https://megabox.kicc.co.kr/html/terms/terms1.html" title="전자금융거래 기본약관" target="_blank" class="a-link ml20">전자금융거래 기본약관 <!-- 전자금융거래 기본약관 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms2.html" title="개인정보 수집 및 이용에 대한 동의" target="_blank" class="a-link ml20">개인정보 수집 및 이용에 대한 동의 <!-- 개인정보 수집 및 이용에 대한 동의 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms3.html" title="개인정보의 제 3자 제공 동의" target="_blank" class="a-link ml20">개인정보의 제 3자 제공 동의 <!-- 개인정보의 제 3자 제공 동의 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms4.html" title="개인정보의 처리 위탁 동의" target="_blank" class="a-link ml20">개인정보의 처리 위탁 동의 <!-- 개인정보의 처리 위탁 동의 --> <i class="iconset ico-arr-right-green"></i></a>
					</div>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer">닫기 <!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_pay_pre_disc">결제 <!-- 결제 --></button>
			</div>

			<button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
		</div>
	</section>

	<!--// 레이어 : 즉시할인 -->

	<!-- 레이어 : 구인증 -->
	





<script type="text/javascript">
var favorCreditChgInfo = new Object();

//초기화 공통 sMethodName.init
function favorCreditCard_init() {  //구인증 전체초기화
	$('#layer_favor_credit h3.tit').text($("#card_select option:selected").text())

	// 초기화
	$('#favorCreditCardNum_1').val('');
	$('#favorCreditCardNum_2').val('');
	$('#favorCreditCardNum_3').val('');
	$('#favorCreditCardNum_4').val('');
	$('#favorCredit_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#favorCredit_card_mm').val('');
	$('#favorCredit_card_yy').val('');
	$('#favorCredit_card_birthday').val('');
	$('#favorCredit_card_password').val('');

	if($("#mbIdntfcDivCd").val() == "MEMID01"){		// 비회원의 경우 조회 필요없음으로 분기처리
		favorCreditCardInfo();
	}

	var remainAmt = $('.receipt .row.total span').text().replaceAll(',', '');
	$('.ria-finish-box > .right > b').text(String(remainAmt).maskNumber());
}


$(function() {
	//숫자만 입력가능
	$('#favorCreditCardNum_1').megaBoxNumberCheck();
	$('#favorCreditCardNum_2').megaBoxNumberCheck();
	$('#favorCreditCardNum_3').megaBoxNumberCheck();
	$('#favorCreditCardNum_4').megaBoxNumberCheck();
	$('#favorCredit_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
	$('#favorCredit_card_mm').megaBoxNumberCheck();  //유효기간 숫자만 입력
	$('#favorCredit_card_yy').megaBoxNumberCheck();  //유효기간 숫자만 입력

	//상담원예매 결제 버튼 클릭
	$("#btn_favorCredit_booking").on('click', function() {
		payfavorCredit();
	});

});


//상담원예매 카드정보 불러오기 버튼 클릭
function favorCreditCardInfo(){
	var cardCd = $("#card_select option:selected").val();

	var paramData = { forwordView : 'false', cardCd : cardCd};

	$.ajax({
        url    : "/on/oh/ohh/PersonInfoMng/selectFavorUseCreditCardLa.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
        data   : JSON.stringify(paramData),
        success: function(result){

        	if("0" != result.statCd){
        		gfn_alertMsgBoxSize(result.msg,400,250);
        	}
        	else {

        		if(result.mbFavorCreditCard.length > 0){
                    $.each(result.mbFavorCreditCard, function (i, item) {
                        if(item.cardCd == cardCd) {
                            var cardNos = item.cardNoFmt.split('-');

                            $('#favorCreditCardNum_1').val(cardNos[0]);
                    		$('#favorCreditCardNum_2').val(cardNos[1]);
                    		$('#favorCreditCardNum_4').val(cardNos[3]);

							return false;
                        }
                    });
				}
        	}

        }
//         , beforeSend : function() {
//     	}
//     	, complete : function() {
//     		setTimeout(function(){
//     		},1500);
//     	}

    });

}

//상담원 결제
function payfavorCredit() {
	var cardNo1  = $("#favorCreditCardNum_1").val();
	var cardNo2  = $("#favorCreditCardNum_2").val();
	var cardNo3  = $("#favorCreditCardNum_3").val();
	var cardNo4  = $("#favorCreditCardNum_4").val();
	var cardNo   = cardNo1 + cardNo2 + cardNo3 + cardNo4;
	var password = $("#favorCredit_card_password").val();

	var valBirth   = $('#favorCredit_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
	var valMonth   = $('#favorCredit_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#favorCredit_card_yy').val();  //유효기간 숫자만 입력
	var preDisc    = 'Y';
	var discType   = '';
// 	var favorCredit_fee = $('#chk_favorCredit_fee').prop('checked')==true?"Y":"N";

	if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (password == "") {
		gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
		$("#favorCredit_card_password").focus();
		return;
	}

	if (valMonth == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#favorCredit_card_mm').focus();
		return;
	}

	if (valYear == "") {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#favorCredit_card_yy').focus();
		return;
	}

	if (valBirth == "") {
		gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
		$('#favorCredit_card_birthday').focus();
		return;
	}

	if($("input:checkbox[id='checkbox']").is(":checked") == false) {
		gfn_alertMsgBox('결제대행서비스 약관에 모두 동의하셔야 결제하실 수 있습니다.');
        $('#allchk').focus();
        return;
    }

	var option = {cardNo1:cardNo1, cardNo2:cardNo2, cardNo3:cardNo3, cardNo4:cardNo4, cardNo:cardNo,
            password:password, valMonth:valMonth, valYear:valYear, preDisc:preDisc,
            discType:discType, valBirth:valBirth, password:password};

	$('#lastPayMethod').val('credit');
	$('#preDisc').val(preDisc);
	$('#discType').val(discType);

	//최종결제 금액 유효성 검사 및 결제 처리
	chkLastPayAmt(option);

}
</script>

<!-- 레이어  : 리아 결제 -->
<section id="layer_favor_credit" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit"></h3>
		</header>

		<div class="layer-con">
			

			<div class="popup-gray mid-info-box">
				<div class="pop-search-area">
					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="ria_card_num">카드번호 <!-- 카드번호 --></label></p>

						<div class="sh-input">
							<input type="text" id="favorCreditCardNum_1" title="체크/신용카드 카드번호 첫번째자리 입력" class="input-text x-small w60px" maxlength="4"><!-- 체크/신용카드 카드번호 첫번째자리 입력 --> -
							<input type="text" id="favorCreditCardNum_2" title="체크/신용카드 카드번호 두번째자리 입력" class="input-text w60px x-small " maxlength="4"> <!-- 체크/신용카드 카드번호 두번째자리 입력 --> -
							<input type="text" id="favorCreditCardNum_3" title="체크/신용카드 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" maxlength="4" oninput="gfn_numberMaxLength(this);"> <!-- 체크/신용카드 카드번호 세번째자리 입력 --> -
							<input type="text" id="favorCreditCardNum_4" title="체크/신용카드 카드번호 네번째자리 입력" class="input-text w60px x-small " maxlength="4"><!-- 체크/신용카드 카드번호 네번째자리 입력 -->
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="favorCredit_card_mm">유효기간 <!-- 유효기간 --></label></p>

						<div class="sh-input">
							<input type="text" id="favorCredit_card_mm" title="체크/신용카드 유효기간 월 입력" placeholder="MM" class="input-text w60px  x-small a-c" maxlength="2"><!-- 체크/신용카드 유효기간 월 입력 --> /
							<input type="text" id="favorCredit_card_yy" title="체크/신용카드 유효기간 년 입력" placeholder="YY" class="input-text w60px x-small a-c" maxlength="2"><!-- 체크/신용카드 유효기간 년 입력 -->
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="favorCredit_card_password">비밀번호 <!-- 비밀번호 --></label></p>

						<div class="sh-input">
							<input type="text" id="favorCredit_card_password" title="체크/신용카드 비밀번호 앞 2자리 입력" class="input-text w130px x-small pwnew" maxlength="2"><!-- 체크/신용카드 비밀번호 앞 2자리 입력 -->
							<span class="font-size-13 font-gray ml05">앞 2자리</span><!-- 앞 2자리 -->
						</div>
					</div>

					<div class="pop-search-area-line gray">
						<p class="sh-txt reset vt"><label for="favorCredit_card_birthday">생년월일 <!-- 생년월일 --></label></p>
						<div class="sh-input mr0">
							<input type="text" id="favorCredit_card_birthday" title="체크/신용카드 생년월일 입력" class="input-text w130px x-small pwnew" maxlength="10"><!-- 체크/신용카드 생년월일 입력 -->

							<p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자) / 사업자번호 10자리 <!-- 생년월일 6자리(카드소유자) / 사업자번호 10자리 --></p>
						</div>
					</div>

					
				</div>
			</div>




			<div class="ria-pro-box">
				<div class="tp">
					<input type="checkbox" id="checkbox">
					<label for="checkbox">결제대행 서비스 약관 필수 동의</label>
				</div>
				<ul class="linklist">
					<li><a href="https://megabox.kicc.co.kr/html/terms/terms1.html" title="전자금융거래 기본약관" target="_blank">전자금융거래 기본약관 &gt;</a></li>
					<li><a href="https://megabox.kicc.co.kr/html/terms/terms2.html" title="개인정보 수집 및 이용에 대한 동의" target="_blank">개인정보 수집 및 이용에 대한 동의 &gt;</a></li>
					<li><a href="https://megabox.kicc.co.kr/html/terms/terms3.html" title="개인정보의 제 3자 제공 동의" target="_blank">개인정보의 제 3자 제공 동의 &gt;</a></li>
					<li><a href="https://megabox.kicc.co.kr/html/terms/terms4.html" title="개인정보의 처리 위탁 동의" target="_blank">개인정보의 처리 위탁 동의 &gt;</a></li>
				</ul>
			</div>


		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_cancel_favorCredit_booking">취소 <!-- 취소 --></button>
			<button type="button" class="button small purple" id="btn_favorCredit_booking">결제 <!-- 결제 --></button>
		</div>

		<button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
	</div>
</section>

	<!--// 레이어 : 구인증 -->

	<!-- 레이어 : 해피머니 - 해피캐시 -->
	





<script type="text/javascript">

var happcashInfo = {};				

function happcash_init() {
	happcashInfo = {};
	$("#happcashId").val("");
	$("#happcashPwd").val("");
	$("#happcashAbleCash").text("0");
	$("#happcashUseCash").val("");
}
var happcash = {
	
	
	fn_post : function(options){
		
		if(!options.url){
			gfn_alertMsgBox("must set options property !");
		}
		
		options.data = options.data || {};
		
		
		if(!options.success){
			options.success = function(data, textStatus, jqXHR){
				gfn_alertMsgBox("must define success callback");
			}
		}
		
		if(!options.error){
			//  jqXHR jqXHR, String textStatus, String errorThrown
			options.error = function(xhr,status,error){
				var err = JSON.parse(xhr.responseText);

				// 메시지 변경처리
				err.msg = err.msg || '';
				if(err.msg.indexOf('회원오류')>=0){
					gfn_alertMsgBox('존재하지 않는 아이디 입니다.');
				}else if(err.msg.indexOf('결제비밀번호')>=0 || err.msg.indexOf('로그인 비밀번호')>=0){ 
					gfn_alertMsgBox('결제비밀번호를 확인 바랍니다.');
				}else{
					gfn_alertMsgBox(err.msg);
				}
			}
		}

		$.ajax({
	      url: options.url,
	      type: "POST",
	      contentType: "application/json;charset=UTF-8",
	      dataType: "json",
		  data: JSON.stringify(options.data),
	      success: options.success,
	      error: options.error,
	      beforeSend : function() {
	  		$(options.block).prop("disabled", true);
	  		$(options.block).addClass('disabled');
	  	  }
	  	  , complete : function() {
			setTimeout(function(){
				$(options.block).removeClass('disabled');
				$(options.block).prop("disabled", false);
			},1500);
	  	  }
		});
	},
	
	fn_searchPoint : function() {

		
		var happcashId = $.trim($("#happcashId").val());
		if (happcashId == "") {
			gfn_alertMsgBox('해피머니 아이디를 입력 바랍니다.');
			$("#happcashId").focus();
			return;
		}

		
		

		
		happcash.fn_post({
			url : "/on/oh/ohz/PayBooking/searchHappcash.do",
			block : "#happcashSearch",
			data : { transNo:$("#transNo").val(), authValue:$("#happcashId").val(), payPwd:$("#happcashPwd").val() },
			success : function(data, textStatus, jqXHR){
				// gfn_alertMsgBox(JSON.stringify(data));

				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}

				
				
				happcashInfo = data.happcashInfo;
				//console.log('data', data);

				$('#happcashAbleCash').text( happcash.get_money_str(happcashInfo.balance) );
				$("#happcashUseCash").val('');	 
			}
		});
	},
	
	get_money_num : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			return 0;
		}
		return _money;
	},
	
	get_money_str : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			_money = 0;
		}
		return String(_money).maskNumber();
	},
	
	fn_applyAbleCash : function () {
		var useAbleAmt = happcash.get_money_num(happcashInfo.balance);		
		var remainAmt = happcash.get_money_num($('.receipt .row.total span').text());	
		var isChecked = $("#happcashUseCashAll").prop("checked");

		
		if (useAbleAmt == 0) {
			gfn_alertMsgBox('사용가능 포인트가 없습니다.');
			return;
		}

		
		var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
		maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
		$("#happcashUseCash").val(happcash.get_money_str(maxAmt));
	},
	
	fn_applyCash : function () {
		var transNo    = $("#transNo").val(); 
		var useAmt     = happcash.get_money_num($("#happcashUseCash").val());	
		var useAbleAmt = happcash.get_money_num(happcashInfo.balance);			
		var remainAmt = happcash.get_money_num($('.receipt .row.total span').text());	

		
		var happcashId = $.trim($("#happcashId").val());
		if (happcashId == "") {
			gfn_alertMsgBox('해피머니 아이디를 입력 바랍니다.');
			return;
		}

		
		
		
		
		
		

		
		var happcashAbleCash = happcash.get_money_num($("#happcashAbleCash").text());	
		if (happcashAbleCash == 0) {
			gfn_alertMsgBox('해피머니 잔액을 조회 바랍니다.');
			return;
		}

		
		if (useAmt == 0) {
			gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
			return;
		}


		
		if ( useAmt > useAbleAmt ) {
			gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',happcash.get_money_str(useAmt)).replace('#2',happcash.get_money_str(useAbleAmt)));
			$("#happcashUseCash").focus();
			return;
		}

		
		if ( parseInt(useAmt) > parseInt(remainAmt) ) {
			gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',happcash.get_money_str(useAmt)).replace('#2',happcash.get_money_str(remainAmt)));
			$("#happcashUseCash").focus();
			return;
		}

		
		if (parseInt(useAmt) % 100 != 0) {
			gfn_alertMsgBox('100원 단위로 사용 가능합니다.');
			$("#happcashUseCash").focus();
			return;
		}

		
		
		happcash.fn_post({
			url : "/on/oh/ohz/PayBooking/applyHappcash.do",
			block : "#btn_apply_happcash",
			data : { transNo:$("#transNo").val(), useAmt:useAmt, authValue:$("#happcashId").val(), payKey:happcashInfo.payKey },
			success : function(data, textStatus, jqXHR){
				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}
				//console.log('data', data);
				
	        	setMovieDcInfo(data.policyList);

	        	$('#btn_cancel_happcash').show(); 					// 취소버튼
	        	$('#btn_cancel_apply_happcash').show(); 			// 버튼 - 적용취소
	        	$('#layer_105011 .close-layer').click();			// 버튼 - 닫기
			}
		});
	}
};


$(function() {
	// 버튼 - 조회
	$('#happcashSearch').on('click', function() {
		happcash.fn_searchPoint();
	});

	// 버튼 - 적용
	$('#btn_apply_happcash').on('click', function() {
		happcash.fn_applyCash();
	});

	// 버튼 - 모두사용
	$('#happcashUseCashAll').on('click', function() {
		happcash.fn_applyAbleCash();
	});

	// 버튼 - 적용취소
	$('#btn_cancel_apply_happcash').on('click', function() {
		cancelMbxSellCpInfo('happcash');
       	$('#layer_105011 .close-layer').click();
	});

	// 버튼 - 닫기
	$('#btn_close_happcash, #btn_close_modal_happcash').on('click', function() {
		if (!$('#btn_cancel_apply_happcash').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
			happcash_init();
		}
	});
});

</script>
<!--// 레이어 : 해피머니 - 해피캐시 (PC) START -->
<section id="layer_105011" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">해피머니상품권 해피캐시 </h3>
		</header>

		<div class="layer-con">

			<div class="reset">
				해피머니 아이디와 비밀번호를 입력 후 조회해주세요. 
			</div>

			<div class="popup-gray mid-info-box mb10">
				<div class="pop-search-area line-wid">

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="happcashId">아이디</label></p>
						<div class="sh-input">
							<input type="text" id="happcashId" title="해피머니 아이디 입력" class="input-text w200px x-small" maxlength="20">
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="happcashPwd">비밀번호</label></p>
						<div class="sh-input">
							<input type="text" id="happcashPwd" title="비밀번호 입력" class="input-text w150px x-small pwnew" maxlength="12" placeholder="비밀번호 입력">
						</div>

						<div class="sh-btn">
							<button type="button" class="button x-small gray" id="happcashSearch">조회</button>
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">보유금액</p>
						<span class="font-green" id="happcashAbleCash">0</span> 원
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="happcashUseCash">사용할금액</label></p>
						<input type="text" id="happcashUseCash" title="사용할 금액을 입력 바랍니다." class="input-text w200px x-small" maxlength="10">

						<div class="sh-btn ml05">
							<button type="button" class="button gray-line x-small" id="happcashUseCashAll">모두사용</button>
						</div>
					</div>

				</div>
			</div>

			<div class="box-border v1 use-guide mt10">
				<p class="tit">이용안내</p>

				<ul class="dot-list gray">
					<li>해피머니 아이디와 비밀번호를 통해 조회 후 사용하실 수 있습니다.</li>
					<li>로그인시 결제 비밀번호를 입력해주세요 (결제비밀번호 미 설정 회원은 일반 비밀번호 입력)</li>
					<li>조회된 보유금액에 한해 100원 단위로 사용 가능합니다.</li>
					
					<li>환불관련 문의 : 1588-5245</li>
				</ul>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_happcash">닫기</button>
			<button type="button" class="button small purple" id="btn_cancel_apply_happcash" style="display:none;">적용취소</button>
			<button type="button" class="button small purple" id="btn_apply_happcash">적용</button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_happcash">레이어 닫기</button>
	</div>
</section>
<!--// 레이어 : 해피머니 - 해피캐시 (PC) END -->
	<!--// 레이어 : 해피머니 - 해피캐시 -->

	<!-- 레이어 : 해피머니 - 해피머니상품권  -->
	





<script type="text/javascript">

var happgiftInfo = {};				

function happgift_init() {
	happgiftInfo = {};
	$("#happgiftId").val("");
	$("#happgiftId_hid").val("");
	$("#happgiftPwd").val("");
	$("#happgiftAbleCash").text("0");
	$("#happgiftUseCash").val("");
}
var happgift = {
	
	
	fn_post : function(options){
		
		if(!options.url){
			gfn_alertMsgBox("must set options property !");
		}
		
		options.data = options.data || {};
		
		
		if(!options.success){
			options.success = function(data, textStatus, jqXHR){
				gfn_alertMsgBox("must define success callback");
			}
		}
		
		if(!options.error){


			//  jqXHR jqXHR, String textStatus, String errorThrown
			options.error = function(xhr,status,error){
				var err = JSON.parse(xhr.responseText);

				// 메시지 변경처리
				err.msg = err.msg || '';
				if(err.msg.indexOf('사용가능 상품권')>=0){
					gfn_alertMsgBox('사용 가능한 상품권이 없습니다.');
				}else{
					gfn_alertMsgBox(err.msg);
				}
			}
		}

		$.ajax({
	      url: options.url,
	      type: "POST",
	      contentType: "application/json;charset=UTF-8",
	      dataType: "json",
		  data: JSON.stringify(options.data),
	      success: options.success,
	      error: options.error,
	      beforeSend : function() {
	  		$(options.block).prop("disabled", true);
	  		$(options.block).addClass('disabled');
	  	  }
	  	  , complete : function() {
			setTimeout(function(){
				$(options.block).removeClass('disabled');
				$(options.block).prop("disabled", false);
			},1500);
	  	  }
		});
	},
	
	fn_searchPoint : function() {

		
		var happgiftId = $.trim($("#happgiftId_hid").val());
		if (happgiftId == "") {
			gfn_alertMsgBox('PIN번호를 입력 바랍니다.');
			return;
		}

		
		var happgiftPwd = $.trim($("#happgiftPwd").val());
		if (happgiftPwd.length != 8) {
			gfn_alertMsgBox('인증번호(발행일) 8자리를 입력 바랍니다.');
			return;
		}

		
		happgift.fn_post({
			url : "/on/oh/ohz/PayBooking/searchHappgift.do",
			block : "#happgiftSearch",
			data : { transNo:$("#transNo").val(), giftInfoCnt:1, giftInfo: happgift.fn_gift_info($("#happgiftId_hid").val(),$("#happgiftPwd").val()) },
			success : function(data, textStatus, jqXHR){
				// gfn_alertMsgBox(JSON.stringify(data));

				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}

				
				
				happgiftInfo = data.happgiftInfo;

				$('#happgiftAbleCash').text( happgift.get_money_str(happgiftInfo.balance) );
				$("#happgiftUseCash").val('');	 
			}
		});
	},
	
	get_money_num : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			return 0;
		}
		return _money;
	},
	
	get_money_str : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			_money = 0;
		}
		return String(_money).maskNumber();
	},
	
	fn_applyAbleCash : function () {
		var useAbleAmt = happgift.get_money_num(happgiftInfo.balance);		
		var remainAmt = happgift.get_money_num($('.pay-area > .pay').eq(0).find('.money').find('em').text());	
		var isChecked = $("#happgiftUseCashAll").prop("checked");

		
		if (useAbleAmt == 0) {
			gfn_alertMsgBox('사용가능 포인트가 없습니다.');
			return;
		}

		
		var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
		maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
		$("#happgiftUseCash").val(happgift.get_money_str(maxAmt));
	},
	
	fn_applyCash : function () {
		var transNo    = $("#transNo").val(); 
		var useAmt     = happgift.get_money_num($("#happgiftUseCash").val());	
		var useAbleAmt = happgift.get_money_num(happgiftInfo.balance);			
		var remainAmt = happgift.get_money_num($('.pay-area > .pay').eq(0).find('.money').find('em').text());	

		
		var happgiftId = $.trim($("#happgiftId_hid").val());
		if (happgiftId == "") {
			gfn_alertMsgBox('PIN번호를 입력 바랍니다.');
			return;
		}

		
		var happgiftPwd = $.trim($("#happgiftPwd").val());
		if (happgiftPwd.length != 8) {
			gfn_alertMsgBox('인증번호(발행일) 8자리를 입력 바랍니다.');
			return;
		}

		
		var happgiftAbleCash = happgift.get_money_num($("#happgiftAbleCash").text());	
		if (happgiftAbleCash == 0) {
			gfn_alertMsgBox('해피머니 잔액을 조회 바랍니다.');
			return;
		}

		
		if (useAmt == 0) {
			gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
			return;
		}


		
		if ( useAmt > useAbleAmt ) {
			gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',happgift.get_money_str(useAmt)).replace('#2',happgift.get_money_str(useAbleAmt)));
			$("#happgiftUseCash").focus();
			return;
		}

		
		if ( parseInt(useAmt) > parseInt(remainAmt) ) {
			gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',happgift.get_money_str(useAmt)).replace('#2',happgift.get_money_str(remainAmt)));
			$("#happgiftUseCash").focus();
			return;
		}

		
		if (parseInt(useAmt) % 100 != 0) {
			gfn_alertMsgBox('100원 단위로 사용 가능합니다.');
			$("#happgiftUseCash").focus();
			return;
		}

		
		
		happgift.fn_post({
			url : "/on/oh/ohz/PayBooking/applyHappgift.do",
			block : "#btn_apply_happgift",
			data : { transNo:$("#transNo").val(), useAmt:useAmt, giftInfoCnt:1, giftInfo: happgift.fn_gift_info($("#happgiftId_hid").val(),$("#happgiftPwd").val()) },
			success : function(data, textStatus, jqXHR){
				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}
				//console.log('data', data);
				
	        	setMovieDcInfo(data.policyList);

	        	$('#btn_cancel_happgift').show(); 					// 취소버튼
	        	$('#btn_cancel_apply_happgift').show(); 			// 버튼 - 적용취소
	        	$('#layer_happgift .close-layer').click();			// 버튼 - 닫기
			}
		});
	},
	
	fn_gift_info : function(pin, issue_date){
		if(!pin || !issue_date){
			return '';
		}
		return pin.rpad(30, " ") + issue_date;
	}
};


$(function() {
	// 버튼 - 조회
	$('#happgiftSearch').on('click', function() {
		happgift.fn_searchPoint();
	});

	// 버튼 - 적용
	$('#btn_apply_happgift').on('click', function() {
		happgift.fn_applyCash();
	});

	// 버튼 - 모두사용
	$('#happgiftUseCashAll').on('click', function() {
		happgift.fn_applyAbleCash();
	});

	// 버튼 - 적용취소
	$('#btn_cancel_apply_happgift').on('click', function() {
		cancelMbxSellCpInfo('happgift');
       	$('#layer_happgift .close-layer').click();
	});

	// 버튼 - 닫기
	$('#btn_close_happgift, #btn_close_modal_happgift').on('click', function() {
		if (!$('#btn_cancel_apply_happgift').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
			happgift_init();
		}
	});

	// 숫자만 입력 가능 - PIN번호, 사용할 금액
	$("#happgiftId").megaBoxCardNumberCheck();
});

</script>
<!--// 레이어 : 해피머니 - 해피머니상품권PIN (PC) START -->
<input type="hidden" id="happgiftId_hid">
<section id="layer_happgift" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">해피머니 모바일 문화상품권 </h3>
		</header>

		<div class="layer-con">

			<div class="reset">
				보유하고 계신 해피머니 모바일 상품권(지류/모바일)의 PIN번호와 인증번호를 입력해주세요. 
			</div>

			<div class="popup-gray mid-info-box mb10">
				<div class="pop-search-area line-wid">

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="happgiftId">PIN번호</label></p>
						<div class="sh-input">
							<input type="text" id="happgiftId" title="핀번호 입력" class="input-text w200px x-small" maxlength="20">
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="happgiftPwd">인증번호</label></p>
						<div class="sh-input">
							<input type="text" id="happgiftPwd" title="인증번호(발행일) 입력" class="input-text w120px x-small pwnew" maxlength="8">
						</div>

						<div class="sh-btn">
							<button type="button" class="button x-small gray" id="happgiftSearch">조회</button>
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">보유금액</p>
						<span class="font-green" id="happgiftAbleCash">0</span> 원
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="happgiftUseCash">사용할금액</label></p>
						<input type="text" id="happgiftUseCash" title="사용할 금액을 입력 바랍니다." class="input-text w200px x-small" maxlength="10">

						<div class="sh-btn ml05">
							<button type="button" class="button gray-line x-small" id="happgiftUseCashAll">모두사용</button>
						</div>
					</div>

				</div>
			</div>

			<div class="box-border v1 use-guide mt10">
				<p class="tit">이용안내</p>

				<ul class="dot-list gray">
					<li>소지하신 지류/모바일 PIN번호 16자리와 인증번호 8자리를 입력 후 이용하실 수 있습니다.</li>
					<li>조회된 보유금액에 한해 100원 단위로 사용 가능합니다.</li>
					<li>예매 취소 시 사용하신 PIN번호는 재확인이 불가하므로 사용하신 상품권은 관람 완료시까지 소지하시기 바랍니다.</li>
					<li>환불관련 문의 : 1588-5245</li>
				</ul>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_happgift">닫기</button>
			<button type="button" class="button small purple" id="btn_cancel_apply_happgift" style="display:none;">적용취소</button>
			<button type="button" class="button small purple" id="btn_apply_happgift">적용</button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_happgift">레이어 닫기</button>
	</div>
</section>
<!--// 레이어 : 해피머니 - 해피머니상품권PIN (PC) END -->
	<!--// 레이어 : 해피머니 - 해피머니상품권 -->

	<!-- 레이어 : 해피머니 - 해피캐시 -->
	





<script type="text/javascript">

var bookcashInfo = {};				

function bookcash_init() {
	bookcashInfo = {};
	$("#bookcashId").val("");
	$("#bookcashPwd").val("");
	$("#bookcashAbleCash").text("0");
	$("#bookcashUseCash").val("");
}
var bookcash = {
	
	
	fn_post : function(options){
		
		if(!options.url){
			gfn_alertMsgBox("must set options property !");
		}
		
		options.data = options.data || {};
		
		
		if(!options.success){
			options.success = function(data, textStatus, jqXHR){
				gfn_alertMsgBox("must define success callback");
			}
		}
		
		if(!options.error){
			//  jqXHR jqXHR, String textStatus, String errorThrown
			options.error = function(xhr,status,error){
				var err = JSON.parse(xhr.responseText);

				// 메시지 변경처리
				err.msg = err.msg || '';
				if(err.msg.indexOf('회원오류')>=0){
					gfn_alertMsgBox('존재하지 않는 아이디 입니다.');
				}else if(err.msg.indexOf('결제비밀번호')>=0 || err.msg.indexOf('로그인 비밀번호')>=0){ 
					gfn_alertMsgBox('결제비밀번호를 확인 바랍니다.');
				}else{
					gfn_alertMsgBox(err.msg);
				}
			}
		}

		$.ajax({
	      url: options.url,
	      type: "POST",
	      contentType: "application/json;charset=UTF-8",
	      dataType: "json",
		  data: JSON.stringify(options.data),
	      success: options.success,
	      error: options.error,
	      beforeSend : function() {
	  		$(options.block).prop("disabled", true);
	  		$(options.block).addClass('disabled');
	  	  }
	  	  , complete : function() {
			setTimeout(function(){
				$(options.block).removeClass('disabled');
				$(options.block).prop("disabled", false);
			},1500);
	  	  }
		});
	},
	
	fn_searchPoint : function() {

		
		var bookcashId = $.trim($("#bookcashId").val());
		if (bookcashId == "") {
			gfn_alertMsgBox('북앤라이프 아이디를 입력 바랍니다.');
			$("#bookcashId").focus();
			return;
		}

		
		var bookcashPwd = $.trim($("#bookcashPwd").val());
		if (bookcashPwd.length < 6 || bookcashPwd.length > 30) {
			gfn_alertMsgBox('비밀번호 6자리~30자리를 입력 바랍니다.');
			$("#bookcashPwd").focus();
			return;
		}

		
		bookcash.fn_post({
			url : "/on/oh/ohz/PayBooking/searchBookcash.do",
			block : "#bookcashSearch",
			data : { transNo:$("#transNo").val(), authValue:$("#bookcashId").val(), payPwd:$("#bookcashPwd").val() },
			success : function(data, textStatus, jqXHR){
				// gfn_alertMsgBox(JSON.stringify(data));

				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}

				
				
				bookcashInfo = data.bookcashInfo;
				//console.log('data', data);

				$('#bookcashAbleCash').text( bookcash.get_money_str(bookcashInfo.balance) );
				$("#bookcashUseCash").val('');	 
			}
		});
	},
	
	get_money_num : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			return 0;
		}
		return _money;
	},
	
	get_money_str : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			_money = 0;
		}
		return String(_money).maskNumber();
	},
	
	fn_applyAbleCash : function () {
		var useAbleAmt = bookcash.get_money_num(bookcashInfo.balance);		
		var remainAmt = bookcash.get_money_num($('.receipt .row.total span').text());	
		var isChecked = $("#bookcashUseCashAll").prop("checked");

		
		if (useAbleAmt == 0) {
			gfn_alertMsgBox('사용가능 포인트가 없습니다.');
			return;
		}

		
		var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
		maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
		$("#bookcashUseCash").val(bookcash.get_money_str(maxAmt));
	},
	
	fn_applyCash : function () {
		var transNo    = $("#transNo").val(); 
		var useAmt     = bookcash.get_money_num($("#bookcashUseCash").val());	
		var useAbleAmt = bookcash.get_money_num(bookcashInfo.balance);			
		var remainAmt = bookcash.get_money_num($('.receipt .row.total span').text());	

		
		var bookcashId = $.trim($("#bookcashId").val());
		if (bookcashId == "") {
			gfn_alertMsgBox('북앤라이프 아이디를 입력 바랍니다.');
			return;
		}

		
		var bookcashPwd = $.trim($("#bookcashPwd").val());
		if (bookcashPwd.length < 6 || bookcashPwd.length > 30) {
			gfn_alertMsgBox('비밀번호 6자리~30자리를 입력 바랍니다.');
			return;
		}

		
		var bookcashAbleCash = bookcash.get_money_num($("#bookcashAbleCash").text());	
		if (bookcashAbleCash == 0) {
			gfn_alertMsgBox('북앤라이프 잔액을 조회 바랍니다.');
			return;
		}

		
		if (useAmt == 0) {
			gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
			return;
		}


		
		if ( useAmt > useAbleAmt ) {
			gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',bookcash.get_money_str(useAmt)).replace('#2',bookcash.get_money_str(useAbleAmt)));
			$("#bookcashUseCash").focus();
			return;
		}

		
		if ( parseInt(useAmt) > parseInt(remainAmt) ) {
			gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',bookcash.get_money_str(useAmt)).replace('#2',bookcash.get_money_str(remainAmt)));
			$("#bookcashUseCash").focus();
			return;
		}

		
		if (parseInt(useAmt) % 100 != 0) {
			gfn_alertMsgBox('100원 단위로 사용 가능합니다.');
			$("#bookcashUseCash").focus();
			return;
		}

		
		
		bookcash.fn_post({
			url : "/on/oh/ohz/PayBooking/applyBookcash.do",
			block : "#btn_apply_bookcash",
			data : { transNo:$("#transNo").val(), useAmt:useAmt, authValue:$("#bookcashId").val(), payPwd:$('#bookcashPwd').val() },
			success : function(data, textStatus, jqXHR){
				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}
				//console.log('data', data);
				
	        	setMovieDcInfo(data.policyList);

	        	$('#btn_cancel_bookcash').show(); 					// 취소버튼
	        	$('#btn_cancel_apply_bookcash').show(); 			// 버튼 - 적용취소
	        	$('#layer_105021 .close-layer').click();			// 버튼 - 닫기
			}
		});
	}
};


$(function() {
	// 버튼 - 조회
	$('#bookcashSearch').on('click', function() {
		bookcash.fn_searchPoint();
	});

	// 버튼 - 적용
	$('#btn_apply_bookcash').on('click', function() {
		bookcash.fn_applyCash();
	});

	// 버튼 - 모두사용
	$('#bookcashUseCashAll').on('click', function() {
		bookcash.fn_applyAbleCash();
	});

	// 버튼 - 적용취소
	$('#btn_cancel_apply_bookcash').on('click', function() {
		cancelMbxSellCpInfo('bookcash');
       	$('#layer_105021 .close-layer').click();
	});

	// 버튼 - 닫기
	$('#btn_close_bookcash, #btn_close_modal_bookcash').on('click', function() {
		if (!$('#btn_cancel_apply_bookcash').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
			bookcash_init();
		}
	});
});

</script>
<!--// 레이어 : 해피머니 - 해피캐시 (PC) START -->
<section id="layer_105021" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">도서상품권 북앤라이프캐시 </h3>
		</header>

		<div class="layer-con">

			<div class="reset">
				북앤라이프 아이디와 비밀번호를 입력 후 조회해주세요. 
			</div>

			<div class="popup-gray mid-info-box mb10">
				<div class="pop-search-area line-wid">

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="bookcashId">아이디</label></p>
						<div class="sh-input">
							<input type="text" id="bookcashId" title="북앤라이프 아이디 입력" class="input-text w200px x-small" maxlength="18">
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="bookcashPwd">비밀번호</label></p>
						<div class="sh-input">
							<input type="text" id="bookcashPwd" title="비밀번호 입력" class="input-text w120px x-small pwnew" minlength="8" maxlength="16">
						</div>

						<div class="sh-btn">
							<button type="button" class="button x-small gray" id="bookcashSearch">조회</button>
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">보유금액</p>
						<span class="font-green" id="bookcashAbleCash">0</span> 원
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="bookcashUseCash">사용할금액</label></p>
						<input type="text" id="bookcashUseCash" title="사용할 금액을 입력 바랍니다." class="input-text w200px x-small" maxlength="10">

						<div class="sh-btn ml05">
							<button type="button" class="button gray-line x-small" id="bookcashUseCashAll">모두사용</button>
						</div>
					</div>

				</div>
			</div>

			<div class="box-border v1 use-guide mt10">
				<p class="tit">이용안내</p>

				<ul class="dot-list gray">
					<li>북앤라이프 아이디와 비밀번호를 통해 조회 후 사용하실 수 있습니다.</li>
					<li>조회된 보유금액에 한해 100원 단위로 사용 가능합니다.</li>
					<li>북앤라이프 탈퇴 후 취소/환불 시 북앤라이프캐시 환급은 불가합니다.</li> 
					<li>환불관련 문의 : 1544-5111(페이즈북앤라이프)</li>
				</ul>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_bookcash">닫기</button>
			<button type="button" class="button small purple" id="btn_cancel_apply_bookcash" style="display:none;">적용취소</button>
			<button type="button" class="button small purple" id="btn_apply_bookcash">적용</button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_bookcash">레이어 닫기</button>
	</div>
</section>
<!--// 레이어 : 해피머니 - 해피캐시 (PC) END -->
	<!--// 레이어 : 해피머니 - 해피캐시 -->

	<!-- 레이어 : 해피머니 - 해피머니상품권  -->
	





<script type="text/javascript">

var bookgiftInfo = {};				

function bookgift_init() {
	bookgiftInfo = {};
	$("#bookgiftId").val("");
	$("#bookgiftId_hid").val("");
	$("#bookgiftPwd").val("");
	$("#bookgiftAbleCash").text("0");
	$("#bookgiftUseCash").val("");
}
var bookgift = {
	
	
	fn_post : function(options){
		
		if(!options.url){
			gfn_alertMsgBox("must set options property !");
		}
		
		options.data = options.data || {};
		
		
		if(!options.success){
			options.success = function(data, textStatus, jqXHR){
				gfn_alertMsgBox("must define success callback");
			}
		}
		
		if(!options.error){


			//  jqXHR jqXHR, String textStatus, String errorThrown
			options.error = function(xhr,status,error){
				var err = JSON.parse(xhr.responseText);

				// 메시지 변경처리
				err.msg = err.msg || '';
				if(err.msg.indexOf('사용가능 상품권')>=0){
					gfn_alertMsgBox('사용 가능한 상품권이 없습니다.');
				}else{
					gfn_alertMsgBox(err.msg);
				}
			}
		}

		$.ajax({
	      url: options.url,
	      type: "POST",
	      contentType: "application/json;charset=UTF-8",
	      dataType: "json",
		  data: JSON.stringify(options.data),
	      success: options.success,
	      error: options.error,
	      beforeSend : function() {
	  		$(options.block).prop("disabled", true);
	  		$(options.block).addClass('disabled');
	  	  }
	  	  , complete : function() {
			setTimeout(function(){
				$(options.block).removeClass('disabled');
				$(options.block).prop("disabled", false);
			},1500);
	  	  }
		});
	},
	
	fn_searchPoint : function() {

		
		var bookgiftId = $.trim($("#bookgiftId_hid").val());
		if (bookgiftId == "") {
			gfn_alertMsgBox('PIN번호를 입력 바랍니다.');
			return;
		}

		
		var bookgiftPwd = $.trim($("#bookgiftPwd").val());
		if (bookgiftPwd.length != 4) {
			gfn_alertMsgBox('인증번호(발행일) 4자리를 입력 바랍니다.');
			return;
		}

		
		bookgift.fn_post({
			url : "/on/oh/ohz/PayBooking/searchBookgift.do",
			block : "#bookgiftSearch",
			data : { transNo:$("#transNo").val(), giftInfoCnt:1, giftInfo: bookgift.fn_gift_info($("#bookgiftId_hid").val(),$("#bookgiftPwd").val()) },
			success : function(data, textStatus, jqXHR){
				// gfn_alertMsgBox(JSON.stringify(data));

				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}

				
				
				bookgiftInfo = data.bookgiftInfo;

				$('#bookgiftAbleCash').text( bookgift.get_money_str(bookgiftInfo.balance) );
				$("#bookgiftUseCash").val('');	 
			}
		});
	},
	
	get_money_num : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			return 0;
		}
		return _money;
	},
	
	get_money_str : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			_money = 0;
		}
		return String(_money).maskNumber();
	},
	
	fn_applyAbleCash : function () {
		var useAbleAmt = bookgift.get_money_num(bookgiftInfo.balance);		
		var remainAmt = bookgift.get_money_num($('.pay-area > .pay').eq(0).find('.money').find('em').text());	
		var isChecked = $("#bookgiftUseCashAll").prop("checked");

		
		if (useAbleAmt == 0) {
			gfn_alertMsgBox('사용가능 포인트가 없습니다.');
			return;
		}

		
		var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
		maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
		$("#bookgiftUseCash").val(bookgift.get_money_str(maxAmt));
	},
	
	fn_applyCash : function () {
		var transNo    = $("#transNo").val(); 
		var useAmt     = bookgift.get_money_num($("#bookgiftUseCash").val());	
		var useAbleAmt = bookgift.get_money_num(bookgiftInfo.balance);			
		var remainAmt = bookgift.get_money_num($('.pay-area > .pay').eq(0).find('.money').find('em').text());	

		
		var bookgiftId = $.trim($("#bookgiftId_hid").val());
		if (bookgiftId == "") {
			gfn_alertMsgBox('PIN번호를 입력 바랍니다.');
			return;
		}

		
		var bookgiftPwd = $.trim($("#bookgiftPwd").val());
		if (bookgiftPwd.length != 4) {
			gfn_alertMsgBox('인증번호(발행일) 4자리를 입력 바랍니다.');
			return;
		}

		
		var bookgiftAbleCash = bookgift.get_money_num($("#bookgiftAbleCash").text());	
		if (bookgiftAbleCash == 0) {
			gfn_alertMsgBox('모바일도서문화상품권 잔액을 조회 바랍니다.');
			return;
		}

		
		if (useAmt == 0) {
			gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
			return;
		}


		
		if ( useAmt > useAbleAmt ) {
			gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',bookgift.get_money_str(useAmt)).replace('#2',bookgift.get_money_str(useAbleAmt)));
			$("#bookgiftUseCash").focus();
			return;
		}

		
		if ( parseInt(useAmt) > parseInt(remainAmt) ) {
			gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',bookgift.get_money_str(useAmt)).replace('#2',bookgift.get_money_str(remainAmt)));
			$("#bookgiftUseCash").focus();
			return;
		}

		
		if (parseInt(useAmt) % 100 != 0) {
			gfn_alertMsgBox('100원 단위로 사용 가능합니다.');
			$("#bookgiftUseCash").focus();
			return;
		}

		
		
		bookgift.fn_post({
			url : "/on/oh/ohz/PayBooking/applyBookgift.do",
			block : "#btn_apply_bookgift",
			data : { transNo:$("#transNo").val(), useAmt:useAmt, giftInfoCnt:1, giftInfo: bookgift.fn_gift_info($("#bookgiftId_hid").val(),$("#bookgiftPwd").val()) },
			success : function(data, textStatus, jqXHR){
				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}
				//console.log('data', data);
				
	        	setMovieDcInfo(data.policyList);

	        	$('#btn_cancel_bookgift').show(); 					// 취소버튼
	        	$('#btn_cancel_apply_bookgift').show(); 			// 버튼 - 적용취소
	        	$('#layer_bookgift .close-layer').click();			// 버튼 - 닫기
			}
		});
	},
	
	fn_gift_info : function(pin, issue_date){
		if(!pin || !issue_date){
			return '';
		}
		return pin.rpad(30, " ") + issue_date;
	}
};


$(function() {
	// 버튼 - 조회
	$('#bookgiftSearch').on('click', function() {
		bookgift.fn_searchPoint();
	});

	// 버튼 - 적용
	$('#btn_apply_bookgift').on('click', function() {
		bookgift.fn_applyCash();
	});

	// 버튼 - 모두사용
	$('#bookgiftUseCashAll').on('click', function() {
		bookgift.fn_applyAbleCash();
	});

	// 버튼 - 적용취소
	$('#btn_cancel_apply_bookgift').on('click', function() {
		cancelMbxSellCpInfo('bookgift');
       	$('#layer_bookgift .close-layer').click();
	});

	// 버튼 - 닫기
	$('#btn_close_bookgift, #btn_close_modal_bookgift').on('click', function() {
		if (!$('#btn_cancel_apply_bookgift').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
			bookgift_init();
		}
	});

	// 숫자만 입력 가능 - PIN번호, 사용할 금액
	$("#bookgiftId").megaBoxCardNumberCheck();
});

</script>
<!--// 레이어 : 해피머니 - 해피머니상품권PIN (PC) START -->
<input type="hidden" id="bookgiftId_hid">
<section id="layer_bookgift" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">도서문화상품권 </h3>
		</header>

		<div class="layer-con">

			<div class="reset">
				보유하고 계신 도서문화상품권(지류/모바일)의 PIN번호와 인증번호를 입력해주세요. 
			</div>

			<div class="popup-gray mid-info-box mb10">
				<div class="pop-search-area line-wid">

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="bookgiftId">PIN번호</label></p>
						<div class="sh-input">
							<input type="text" id="bookgiftId" title="PIN번호 16자리 입력" class="input-text w200px x-small" maxlength="20">
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="bookgiftPwd">인증번호</label></p>
						<div class="sh-input">
							<input type="text" id="bookgiftPwd" title="인증번호 입력" class="input-text w120px x-small pwnew" maxlength="4">
						</div>

						<div class="sh-btn">
							<button type="button" class="button x-small gray" id="bookgiftSearch">조회</button>
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">보유금액</p>
						<span class="font-green" id="bookgiftAbleCash">0</span> 원
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="bookgiftUseCash">사용할금액</label></p>
						<input type="text" id="bookgiftUseCash" title="사용할 금액을 입력 바랍니다." class="input-text w200px x-small" maxlength="10">

						<div class="sh-btn ml05">
							<button type="button" class="button gray-line x-small" id="bookgiftUseCashAll">모두사용</button>
						</div>
					</div>

				</div>
			</div>

			<div class="box-border v1 use-guide mt10">
				<p class="tit">이용안내</p>

				<ul class="dot-list gray">
					<li>소지하신 지류/모바일 PIN번호 16자리와 인증번호 4자리를 입력 후 이용하실 수 있습니다.</li>
					<li>조회된 보유금액에 한해 100원 단위로 사용 가능합니다.</li>
					<li>예매 취소 시 사용하신 PIN번호는 재확인이 불가하므로 사용하신 상품권은 관람 완료시까지 소지하시기 바랍니다.</li>
					<li>환불관련 문의 : 1544-5111(페이즈북앤라이프)</li>
				</ul>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_bookgift">닫기</button>
			<button type="button" class="button small purple" id="btn_cancel_apply_bookgift" style="display:none;">적용취소</button>
			<button type="button" class="button small purple" id="btn_apply_bookgift">적용</button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_bookgift">레이어 닫기</button>
	</div>
</section>
<!--// 레이어 : 북앤라이프 - 도서문화상품권PIN 팝업 (PC) END -->
	<!--// 레이어 : 해피머니 - 해피머니상품권 -->

	<!-- 레이어 : 해피머니 - 해피캐시 -->
	





<script type="text/javascript">

var cultcashInfo = {};				

function cultcash_init() {
	cultcashInfo = {};
	$("#cultcashId").val("");
	$("#cultcashPwd").val("");
	$("#cultcashAbleCash").text("0");
	$("#cultcashUseCash").val("");
}
var cultcash = {
	
	
	fn_post : function(options){
		
		if(!options.url){
			gfn_alertMsgBox("must set options property !");
		}
		
		options.data = options.data || {};
		
		
		if(!options.success){
			options.success = function(data, textStatus, jqXHR){
				gfn_alertMsgBox("must define success callback");
			}
		}
		
		if(!options.error){
			//  jqXHR jqXHR, String textStatus, String errorThrown
			options.error = function(xhr,status,error){
				var err = JSON.parse(xhr.responseText);

				// 메시지 변경처리
				err.msg = err.msg || '';
				if(err.msg.indexOf('회원오류')>=0){
					gfn_alertMsgBox('존재하지 않는 아이디 입니다.');
				}else if(err.msg.indexOf('결제비밀번호')>=0 || err.msg.indexOf('로그인 비밀번호')>=0){ 
					gfn_alertMsgBox('결제비밀번호를 확인 바랍니다.');
				}else{
					gfn_alertMsgBox(err.msg);
				}
			}
		}

		$.ajax({
	      url: options.url,
	      type: "POST",
	      contentType: "application/json;charset=UTF-8",
	      dataType: "json",
		  data: JSON.stringify(options.data),
	      success: options.success,
	      error: options.error,
	      beforeSend : function() {
	  		$(options.block).prop("disabled", true);
	  		$(options.block).addClass('disabled');
	  	  }
	  	  , complete : function() {
			setTimeout(function(){
				$(options.block).removeClass('disabled');
				$(options.block).prop("disabled", false);
			},1500);
	  	  }
		});
	},
	
	fn_searchPoint : function() {

		
		var cultcashId = $.trim($("#cultcashId").val());
		if (cultcashId == "") {
			gfn_alertMsgBox('컬쳐캐쉬 아이디를 입력 바랍니다.');
			$("#cultcashId").focus();
			return;
		}

		
		var cultcashPwd = $.trim($("#cultcashPwd").val());
		if (cultcashPwd.length < 6 || cultcashPwd.length > 20) {
			gfn_alertMsgBox('비밀번호 6자리~12자리를 입력 바랍니다.');
			$("#cultcashPwd").focus();
			return;
		}

		
		cultcash.fn_post({
			url : "/on/oh/ohz/PayBooking/searchCultcash.do",
			block : "#cultcashSearch",
			data : { transNo:$("#transNo").val(), authValue:$("#cultcashId").val(), payPwd:$("#cultcashPwd").val() },
			success : function(data, textStatus, jqXHR){
				// gfn_alertMsgBox(JSON.stringify(data));

				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}

				
				
				cultcashInfo = data.cultcashInfo;
				//console.log('data', data);

				$('#cultcashAbleCash').text( cultcash.get_money_str(cultcashInfo.balance) );
				$("#cultcashUseCash").val('');	 
			}
		});
	},
	
	get_money_num : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			return 0;
		}
		return _money;
	},
	
	get_money_str : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			_money = 0;
		}
		return String(_money).maskNumber();
	},
	
	fn_applyAbleCash : function () {
		var useAbleAmt = cultcash.get_money_num(cultcashInfo.balance);		
		var remainAmt = cultcash.get_money_num($('.receipt .row.total span').text());	
		var isChecked = $("#cultcashUseCashAll").prop("checked");

		
		if (useAbleAmt == 0) {
			gfn_alertMsgBox('사용가능 포인트가 없습니다.');
			return;
		}

		
		var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
		maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
		$("#cultcashUseCash").val(cultcash.get_money_str(maxAmt));
	},
	
	fn_applyCash : function () {
		var transNo    = $("#transNo").val(); 
		var useAmt     = cultcash.get_money_num($("#cultcashUseCash").val());	
		var useAbleAmt = cultcash.get_money_num(cultcashInfo.balance);			
		var remainAmt = cultcash.get_money_num($('.receipt .row.total span').text());	

		
		var cultcashId = $.trim($("#cultcashId").val());
		if (cultcashId == "") {
			gfn_alertMsgBox('컬쳐캐쉬 아이디를 입력 바랍니다.');
			return;
		}

		
		var cultcashPwd = $.trim($("#cultcashPwd").val());
		if (cultcashPwd.length < 6 || cultcashPwd.length > 20) {
			gfn_alertMsgBox('비밀번호 6자리~12자리를 입력 바랍니다.');
			return;
		}

		
		var cultcashAbleCash = cultcash.get_money_num($("#cultcashAbleCash").text());	
		if (cultcashAbleCash == 0) {
			gfn_alertMsgBox('컬쳐캐쉬 잔액을 조회 바랍니다.');
			return;
		}

		
		if (useAmt == 0) {
			gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
			return;
		}


		
		if ( useAmt > useAbleAmt ) {
			gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',cultcash.get_money_str(useAmt)).replace('#2',cultcash.get_money_str(useAbleAmt)));
			$("#cultcashUseCash").focus();
			return;
		}

		
		if ( parseInt(useAmt) > parseInt(remainAmt) ) {
			gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',cultcash.get_money_str(useAmt)).replace('#2',cultcash.get_money_str(remainAmt)));
			$("#cultcashUseCash").focus();
			return;
		}

		
		if (parseInt(useAmt) % 100 != 0) {
			gfn_alertMsgBox('100원 단위로 사용 가능합니다.');
			$("#cultcashUseCash").focus();
			return;
		}

		
		
		cultcash.fn_post({
			url : "/on/oh/ohz/PayBooking/applyCultcash.do",
			block : "#btn_apply_cultcash",
			data : { transNo:$("#transNo").val(), useAmt:useAmt, authValue:$("#cultcashId").val(), payKey:cultcashInfo.payKey, membNm:cultcashInfo.membNm },
			success : function(data, textStatus, jqXHR){
				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}
				//console.log('data', data);
				
	        	setMovieDcInfo(data.policyList);

	        	$('#btn_cancel_cultcash').show(); 					// 취소버튼
	        	$('#btn_cancel_apply_cultcash').show(); 			// 버튼 - 적용취소
	        	$('#layer_105019 .close-layer').click();			// 버튼 - 닫기
			}
		});
	}
};


$(function() {
	// 버튼 - 조회
	$('#cultcashSearch').on('click', function() {
		cultcash.fn_searchPoint();
	});

	// 버튼 - 적용
	$('#btn_apply_cultcash').on('click', function() {
		cultcash.fn_applyCash();
	});

	// 버튼 - 모두사용
	$('#cultcashUseCashAll').on('click', function() {
		cultcash.fn_applyAbleCash();
	});

	// 버튼 - 적용취소
	$('#btn_cancel_apply_cultcash').on('click', function() {
		cancelMbxSellCpInfo('cultcash');
       	$('#layer_105019 .close-layer').click();
	});

	// 버튼 - 닫기
	$('#btn_close_cultcash, #btn_close_modal_cultcash').on('click', function() {
		if (!$('#btn_cancel_apply_cultcash').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
			cultcash_init();
		}
	});
});

</script>
<!--// 레이어 : 문화상품권 - 컬쳐캐쉬 (PC) START -->
<section id="layer_105019" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">컬쳐캐쉬 </h3>
		</header>

		<div class="layer-con">

			<div class="reset">
				컬쳐랜드 아이디와 비밀번호를 입력 후 조회해주세요. 
			</div>

			<div class="popup-gray mid-info-box mb10">
				<div class="pop-search-area line-wid">

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="cultcashId">아이디</label></p>
						<div class="sh-input">
							<input type="text" id="cultcashId" title="컬쳐캐쉬 아이디 입력" class="input-text w200px x-small" maxlength="20">
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="cultcashPwd">비밀번호</label></p>
						<div class="sh-input">
							<input type="text" id="cultcashPwd" title="비밀번호 입력" class="input-text w120px x-small pwnew" minlength="6" maxlength="20">
						</div>

						<div class="sh-btn">
							<button type="button" class="button x-small gray" id="cultcashSearch">조회</button>
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">보유금액</p>
						<span class="font-green" id="cultcashAbleCash">0</span> 원
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="cultcashUseCash">사용할금액</label></p>
						<input type="text" id="cultcashUseCash" title="사용할 금액을 입력 바랍니다." class="input-text w200px x-small" maxlength="10">

						<div class="sh-btn ml05">
							<button type="button" class="button gray-line x-small" id="cultcashUseCashAll">모두사용</button>
						</div>
					</div>

				</div>
			</div>

			<div class="box-border v1 use-guide mt10">
				<p class="tit">이용안내</p>

				<ul class="dot-list gray">
					<li>컬쳐랜드 아이디와 비밀번호를 통해 조회 후 사용하실 수 있습니다.</li>
					<li>조회된 보유금액에 한해 100원 단위로 사용 가능합니다.</li>
					
					<li>환불관련 문의 : 1577-2111</li>
				</ul>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_cultcash">닫기</button>
			<button type="button" class="button small purple" id="btn_cancel_apply_cultcash" style="display:none;">적용취소</button>
			<button type="button" class="button small purple" id="btn_apply_cultcash">적용</button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_cultcash">레이어 닫기</button>
	</div>
</section>
<!--// 레이어 : 해피머니 - 해피캐시 (PC) END -->
	<!--// 레이어 : 해피머니 - 해피캐시 -->

	<!-- 레이어 : 해피머니 - 해피머니상품권  -->
	
	<!--// 레이어 : 해피머니 - 해피머니상품권 -->

	<!-- 레이어 : 페이즈 - 페이즈상품권  -->
	





<script type="text/javascript">

var paysgiftInfo = {};				

function paysgift_init() {
	paysgiftInfo = {};
	$("#paysgiftId").val("");
	$("#paysgiftId_hid").val("");
	$("#paysgiftAbleCash").text("0");
	$("#paysgiftUseCash").val("");
}


$(function() {

	// 숫자만 입력 가능 - PIN번호, 사용할 금액
	$("#paysgiftUseCash").megaBoxCommaNumberCheck();
	$("#paysgiftId").megaBoxCardNumberCheck();

	// 버튼 - 조회
	$('#paysgiftSearch').on('click', function() {
		searchPaysPoint();
	});

	// 버튼 - 적용
	$('#btn_apply_paysgift').on('click', function() {
		fn_pays_applyCash();
	});

	// 버튼 - 모두사용
	$('#paysgiftUseCashAll').on('click', function() {
		fn_pays_applyAbleCash();
	});

	// 버튼 - 적용취소
	$('#btn_cancel_apply_paysgift').on('click', function() {
		cancelMbxSellCpInfo('paysgift');
       	$('#layer_105022 .close-layer').click();
	});

	// 버튼 - 닫기
	$('#btn_close_paysgift, #btn_close_modal_paysgift').on('click', function() {
		if (!$('#btn_cancel_apply_paysgift').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
			paysgift_init();
		}
	});


});


//페이즈 조회
function searchPaysPoint() {
	var transNo     = $("#transNo").val();
	var cardNo      = $("#paysgiftId_hid").val().replaceAll('-', '').nvlNum(0);

	$("#paysgiftAbleCash").text("0");
	$("#paysgiftUseCash").val("");

	//alert("transNo :" + transNo);
	//alert("cardNo :" + cardNo);

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_paysgift').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "" || cardNo.length < 16) {
		gfn_alertMsgBox('금액권번호를 입력 바랍니다.');
		$("#paysgiftId").focus();
		return;
	}


	var paramData  = {transNo:transNo, idntfcNo:cardNo };

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchPaysGift.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	paysgiftInfo = data.paysGiftInfo;

      	$('#paysgiftAbleCash').text( get_money_str(paysgiftInfo.usefulAmt) );
		$("#paygiftUseCash").val('');	 


      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
      , beforeSend : function() {
  		$('#paysgiftSearch').prop("disabled", true);
  		$('#paysgiftSearch').addClass('disabled');
  	  }
  	  , complete : function() {
  		setTimeout(function(){
     			$('#paysgiftSearch').removeClass('disabled');
     			$('#paysgiftSearch').prop("disabled", false);
  		},1500);
  	  }
	});
}


function fn_pays_applyCash() {
	var transNo     = $("#transNo").val(); 
	var useAmt      = get_money_num($("#paysgiftUseCash").val());	    
	var useAbleAmt  = get_money_num(paysgiftInfo.usefulAmt);			    
	var cardNo      = $("#paysgiftId_hid").val().replaceAll('-', '').nvlNum(0);


	var remainAmt = get_money_num($('.receipt .row.total span').text());	

	
	var paysgiftId = $("#paysgiftId_hid").val().replaceAll('-', '').nvlNum(0);
	if (paysgiftId == "" || paysgiftId.length < 16) {
		gfn_alertMsgBox('금액권번호를 입력 바랍니다.');
		return;
	}


	
	var paysgiftAbleCash = get_money_num($("#paysgiftAbleCash").text());	
	if (paysgiftAbleCash == 0) {
		gfn_alertMsgBox('페이즈 금액권 잔액을 조회 바랍니다.');
		return;
	}

	
	if (useAmt == 0) {
		gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
		return;
	}

	
	if ( useAmt > useAbleAmt ) {
		gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',get_money_str(useAmt)).replace('#2',get_money_str(useAbleAmt)));
		$("#paysgiftUseCash").focus();
		return;
	}

	
	if ( parseInt(useAmt) > parseInt(remainAmt) ) {
		gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',get_money_str(useAmt)).replace('#2',get_money_str(remainAmt)));
		$("#paysgiftUseCash").focus();
		return;
	}

	
	if (parseInt(useAmt) % 100 != 0) {
		gfn_alertMsgBox('100원 단위로 사용 가능합니다.');
		$("#paysgiftUseCash").focus();
		return;
	}

	var paramData  = {transNo:transNo, idntfcNo:cardNo, useAmt:useAmt };

	$.ajax({
		  url: "/on/oh/ohz/PayBooking/applyPaysGift.do",
	      type: "POST",
	      contentType: "application/json;charset=UTF-8",
	      dataType: "json",
		  data: JSON.stringify(paramData),
	      success: function (data, textStatus, jqXHR) {
	      	//console.log(data);
	    	if (!msgBookingLoginChk(data)) {
	    		return;
	    	}

	      	//할인내역 갱신
	      	setMovieDcInfo(data.policyList);

	      	$('#btn_cancel_paysgift').show(); //취소버튼
	      	$('#btn_cancel_apply_paysgift').show(); //적용취소버튼

	      	//닫기버튼 클릭
	      	$('#layer_105022 .close-layer').click();
	      },
	      error: function(xhr,status,error){
	      	var err = JSON.parse(xhr.responseText);
	      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
	      	errBookingChk(err.msg);
	      }
		});

}


function fn_pays_applyAbleCash(){
	var useAbleAmt = get_money_num(paysgiftInfo.usefulAmt);		
	var remainAmt = get_money_num($('.receipt .row.total span').text());	
	var isChecked = $("#paysgiftUseCashAll").prop("checked");

	
	if (useAbleAmt == 0) {
		gfn_alertMsgBox('사용가능 포인트가 없습니다.');
		return;
	}

	
	var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
	maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
	$("#paysgiftUseCash").val(get_money_str(maxAmt));
}



function get_money_str (source){
	var _money = parseInt(String(source).replace(/[^0-9]/g,''));
	if(isNaN(_money)){
		_money = 0;
	}
	return String(_money).maskNumber();
}


function get_money_num(source){
	var _money = parseInt(String(source).replace(/[^0-9]/g,''));
	if(isNaN(_money)){
		return 0;
	}
	return _money;
}

</script>
<!--// 페이즈 : 페이즈 - 페이즈상품권 (PC) START -->
<input type="hidden" id="paysgiftId_hid">
<section id="layer_105022" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">페이즈 금액권</h3>
		</header>

		<div class="layer-con">

			<div class="reset">
				보유하신 페이즈 금액권번호를 입력해주세요. 
			</div>

			<div class="popup-gray mid-info-box mb10">
				<div class="pop-search-area line-wid">

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="paysgiftId">금액권 번호</label></p>
						<div class="sh-input">
							<input type="text" id="paysgiftId" placeholder="16자리 입력" title="금액권 번호 16자리 입력" class="input-text w200px x-small" maxlength="20">
						</div>
						<div class="sh-btn">
							<button type="button" class="button x-small gray" id="paysgiftSearch">조회</button>
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">보유금액</p>
						<span class="font-green" id="paysgiftAbleCash">0</span> 원
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="paysgiftUseCash">사용할 금액 </label></p>
						<input type="text" id="paysgiftUseCash" title="사용할 금액 입력" class="input-text w200px x-small" maxlength="10">

						<div class="sh-btn ml05">
							<button type="button" class="button gray-line x-small" id="paysgiftUseCashAll">모두사용</button>
						</div>
					</div>

				</div>
			</div>

			<div class="box-border v1 use-guide mt10">
				<p class="tit">이용안내</p>

				<ul class="dot-list gray">
					<li>보유하신 금액권번호 16자리를 조회해주세요.</li>
					<li>조회된 보유금액에한해 100원 단위로 사용 가능합니다.</li>
				</ul>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_paysgift">닫기</button>
			<button type="button" class="button small purple" id="btn_cancel_apply_paysgift" style="display:none;">적용취소</button>
			<button type="button" class="button small purple" id="btn_apply_paysgift">적용</button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_paysgift">레이어 닫기</button>
	</div>
</section>
<!--// 레이어 : 페이즈 - 페이즈상품권PIN (PC) END -->
	<!--// 레이어 : 페이즈 - 페이즈상품권 -->

	<!-- 레이어 : L.포인트  -->
	





<script type="text/javascript">

var lPoint = new Object();

//초기화 공통 sMethodName.init
function lpoint_init() {
	setInitStoreChg();
	lPoint = new Object();
	$("#lpointCardNum").val('');
	$("#lpointCardNum_hid").val('');
	$("#spn_lpoint_useable_amt").text('0');
	$("#lpointUsePoint").val('');
	$("#lpointUsePwd").val('');
	$("#lpointPreUsePoint").val('');
	
}


$(function() {
	//숫자만 입력가능
	$("#lpointCardNum").megaBoxCardNumberCheck();

	//사용할포인트
	$("#lpointUsePoint").megaBoxCommaNumberCheck();

	//조회버튼 클릭
	$('#btn_select_lpoint').on('click', function() {
		searchLPoint();
	});

	//적용버튼 클릭
	$('#btn_apply_lpoint').on('click', function() {
		applyLPoint();
	});

	//모두사용 클릭
	$('#btn_all_use_lpoint').on('click', function() {
		useAllLPoint();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_lpoint').on('click', function() {
		var sMethodName = "lpoint";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
       	$('#layer_303013 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_lpoint, #btn_close_modal_lpoint').on('click', function() {
		if (!$('#btn_cancel_apply_lpoint').is(':visible')) {
			lpoint_init();
		}
	});

	//L.POINT 비밀번호 변경페이지
	$('#lpoint_href').click(function(){
		window.open('https://m.lpoint.com/app/point/LWPA100100.do');
	});

});

//ok캐쉬백 모두사용
function useAllLPoint() {

	var useAbleAmt = $("#spn_lpoint_useable_amt").text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var remainAmt  = $('.receipt .row.total span').text().replaceAll(',', '');

	if (parseInt(useAbleAmt ) == 0) {
		//조회 후 사용 가능합니다.
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#lpointCardNum").focus();
		return;
	}

	var maxAmt = useAbleAmt;
	if (parseInt(useAbleAmt) > parseInt(remainAmt)) {
		maxAmt = remainAmt;
	}

	maxAmt = parseInt(maxAmt /100) * 100;
	$("#lpointUsePoint").val(String(maxAmt).maskNumber());
}

//ok캐쉬백 조회
function searchLPoint() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#lpointCardNum_hid").val();
	var paramData  = {transNo:transNo,cardNo:cardNo };

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_lpoint').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#lpointCardNum").focus();
		return;
	}

	if (cardNo.length < 15) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#lpointCardNum").focus();
		return;
	}

	$.ajax({
        url: "/on/oh/ohz/PayBooking/searchLPoint.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//쿠폰 전역변수 세팅
        	lPoint = data.lPointInfo;

        	$('#spn_lpoint_useable_amt').text( String(lPoint.useAbleAmt).maskNumber() );
        	$("#lpointPreUsePoint").val('');	//이전사용금액 초기화
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
        , beforeSend : function() {
    		$('#btn_select_lpoint').prop("disabled", true);
    		$('#btn_select_lpoint').addClass('disabled');
    	}
    	, complete : function() {
    		setTimeout(function(){
       			$('#btn_select_lpoint').removeClass('disabled');
       			$('#btn_select_lpoint').prop("disabled", false);
    		},1500);
    	}
	});
}


//ok캐쉬백 적용
function applyLPoint() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#lpointCardNum_hid").val();
	var useAmt     = $("#lpointUsePoint").val().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var useAbleAmt = $("#spn_lpoint_useable_amt").text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var remainAmt  = $('.receipt .row.total span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var preUseAmt  = $("#lpointPreUsePoint").val().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	

	remainAmt = parseInt(remainAmt) + parseInt(preUseAmt);	//이전 사용금액이 있는 경우 잔여금액에 이전 사용금액 포함

	//카드번호 체크
	if (cardNo == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#lpointCardNum").focus();
		return;
	}

	if (cardNo.length < 15) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#lpointCardNum").focus();
		return;
	}

	if (parseInt(useAbleAmt) == 0) {
		//OK 캐쉬백 사용가능 포인트 조회 후 사용 가능합니다.
		gfn_alertMsgBox('L.POINT 사용가능 포인트 조회 후 사용 가능합니다.');
		return;
	}


	if (parseInt(useAmt) == 0) {
		//OK 캐쉬백 사용가능 포인트 조회 후 사용 가능합니다.
		gfn_alertMsgBox('사용 포인트를 입력하세요.');
		$("#lpointUsePoint").focus();
		return;
	}




	if (parseInt(useAmt) % 100 != 0) {
		//OK 캐쉬백 포인트 100점 단위로 사용 가능합니다.
		gfn_alertMsgBox('L.POINT 100점 단위로 사용 가능합니다.');
		$("#lpointUsePoint").focus();
		return;
	}

	if (parseInt(useAmt) > parseInt(remainAmt)) {
		//사용 포인트가 결제 금액보다 큽니다.
		gfn_alertMsgBox('사용 포인트가 결제 금액보다 큽니다.');
		$("#lpointUsePoint").focus();
		return;
	}

	var password = $("#lpointUsePwd").val();

	if (password.length < 6) {
		//비밀번호 6자리 이상 입력하세요
		gfn_alertMsgBox('비밀번호 6자리 이상 입력하세요.');
		$("#lpointUsePwd").focus();
		return;
	}

	var paramData = { cardNo:cardNo, password:password, useAmt:useAmt, transNo:transNo};

	$.ajax({
        url: "/on/oh/ohz/PayBooking/applyLPoint.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//할인내역 갱신
        	setMovieDcInfo(data.policyList);

        	$('#btn_cancel_lpoint').show(); //취소버튼
        	$('#btn_cancel_apply_lpoint').show(); //적용취소버튼

        	$('#lpointPreUsePoint').val($("#lpointUsePoint").val()); //취소버튼

        	//닫기버튼 클릭
        	$('#layer_303013 .close-layer').click();
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
	});

}
</script>

	<!-- 레이어 : L.포인트 -->
	<input type="hidden" id="lpointCardNum_hid">
	<section id="layer_303013" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">L.POINT <!-- L.포인트 --></h3>
			</header>

			<div class="layer-con">

				<div class="reset">
					L.POINT 카드 정보를 입력해주세요. <!-- L.포인트 카드 정보를 입력해주세요. -->
				</div>

				<div class="popup-gray mid-info-box mb10">
					<div class="pop-search-area line-wid">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="lpointCardNum">카드번호 <!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="lpointCardNum" title="L.POINT 카드번호 입력" class="input-text w200px x-small" maxlength="20"><!-- L.포인트 카드번호 입력 -->
							</div>

							<div class="sh-btn">
								<button type="button" class="button x-small gray" id="btn_select_lpoint">조회 <!-- 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">사용가능한 포인트 <!-- 사용가능한 포인트 --></p>
							<span class="font-green" id="spn_lpoint_useable_amt">0</span> Point
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="lpointUsePoint">사용할 포인트 <!-- 사용할 포인트 --></label></p>
							<input type="text" id="lpointUsePoint" title="사용할 L.POINT 포인트 입력" class="input-text w120px mr05 x-small" maxlength="10"> Point <!-- 사용할 L.포인트 입력 -->
							<input type="hidden" id="lpointPreUsePoint">

							<div class="sh-btn ml05">
								<button type="button" class="button gray-line x-small" id="btn_all_use_lpoint">모두사용 <!-- 모두사용 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="lpointUsePwd">비밀번호 <!-- 비밀번호 --></label></p>
							<input type="text" id="lpointUsePwd" title="" class="input-text w120px x-small pwnew" maxlength="15"> <!-- L.포인트 비밀번호 입력 -->
						</div>

					</div>
				</div>

				

				<div class="box-border v1 use-guide mt10">
					<p class="tit">이용안내 <!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>L.POINT는 사용 가능한 포인트내에서 100P단위로 사용 가능합니다. <!-- L.POINT는 사용 가능한 포인트내에서 100P단위로 사용 가능합니다. --></li>
						<li>
							L.POINT 비밀번호는 <a href="javascript:void(0)" id="lpoint_href">https://m.lpoint.com/app/point/LWPA100100.do</a>에서 설정 후 이용하실 수 있습니다.
							<br>(경로: L.PONT 어플 &gt; (오른쪽 상단) 메뉴 &gt; 설정 &gt; 회원정보 및 인증관리 &gt; 포인트 비밀번호 설정)
						</li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_lpoint">닫기 <!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_lpoint" style="display:none;">적용취소 <!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_lpoint">적용 <!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_lpoint">레이어 닫기 <!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : L.포인트 -->




	<!--// 레이어 : L.포인트 -->

	<!-- 레이어 : uplus -->
	





<script type="text/javascript">
var uPlusChgInfo = new Object();	//uplus 일반/VIP 상시할인
var uPlusChgInfo1 = new Object();	//uplus VIP 본인 무료
var uPlusChgInfo2 = new Object();	//uplus VIP 1+1
var uPlusChgInfo3 = new Object();	//uplus VIP 특별관
var uPlusChgInfo4 = new Object();	//uplus VIP 특별관
var today = parseInt("2024092312");
var uplusNewYn = 'N';

//초기화 공통 sMethodName.init
function uplus_init() {  //uplus 전체초기화
	setInitUPlus();
	uPlusChgInfo = new Object();
	uPlusChgInfo1 = new Object();
	uPlusChgInfo2 = new Object();
	uPlusChgInfo3 = new Object();
	uPlusChgInfo4 = new Object();
	retCd = '';
	retMsg = '';

	$('#uplusCardNum_1').val('');
	$('#uplusCardNum_2').val('');
	$('#uplusCardNum_3').val('');
	$('#uplusCardNum_4').val('');
	$('#uplus_card_birthday').val('');

	$('#uplusCardNum_1').megaBoxNumberCheck();
	$('#uplusCardNum_2').megaBoxNumberCheck();
	$('#uplusCardNum_3').megaBoxNumberCheck();
	$('#uplusCardNum_4').megaBoxNumberCheck();
	$('#uplus_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력

	$('#uplusCardNum_hid').val('');
}

$(function() {
	//숫자만 입력가능
	$("#uplusCardNum").megaBoxCardNumberCheck();

	$('#btn_pay_uplus').on('click', function() {
		console.log(today);
		if(today <= 2023092510) {
			gfn_alertMsgBox("LGU+멤버십 시스템 점검으로 인해 아래 작업일시 동안 사용이 어려운 부분에 대해 안내드립니다.\n" +
					"\n" +
					"1. 작업일시 : 2023년 9월 24일(일) 06:00 ~ 2023년 9월 25일(월) 10:00 (28시간)\n" +
					"2. 작업내용 : U+멤버십 시스템 점검\n" +
					"3. 작업영향 : U+멤버십앱 바코드 사용 불가 (멤버십, 나만의콕 등 서비스 사용 불가)");
		}
	});

	//조회버튼 클릭
	$('#btn_select_uplus').on('click', function() {
		searchUPlus();
	});

	//uplus 적용
	$('#btn_apply_uplus').on('click', function() {
		//현재는 일반만 적용가능. 추후 확장 가능있음
		applyUPlus();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_uplus').on('click', function() {
		var sMethodName = "uplus";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
     	$('#layer_302034.close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_uplus, #btn_close_modal_uplus').on('click', function() {
		if (!$('#btn_cancel_apply_uplus').is(':visible')) {
			uplus_init();
		}
	});
});


//uplus 초기화
function setInitUPlus() {
	$("#selUPlusVip").val("0").prop("selected", true);
	$("#selUPlusVip > option:eq(1)").attr("disabled", true);
	$("#selUPlusVip > option:eq(2)").attr("disabled", true);
	$("#selUPlusVip > option:eq(3)").attr("disabled", true);
	$('#selUPlus > option').remove();
	$('#selUPlus').append('<option value="0">선택</option>');
	$("#selUPlus").val("0").prop("selected", true);

	$('input[name="rdo_select"]').removeAttr('checked');
	$("#disc_btn").addClass('display-none');
	$('#rdo_point_vip').attr('disabled', true);
	$('#rdo_point').attr('disabled', true);

	$('#vipLmt').addClass('display-none');
	$('#vipFreeLmt em').removeClass('use');
	$('#vipFreeLmt em').text('0');
	$('#vipPlusLmt em').removeClass('use');
	$('#vipPlusLmt em').text('0');
	$('#vipSpecialLmt em').removeClass('use');
	$('#vipSpecialLmt em').text('0');
}

//uplus 조회
function searchUPlus() {
	var transNo   = $("#transNo").val();

	var cardNo1    = $("#uplusCardNum_1").val();
	var cardNo2    = $("#uplusCardNum_2").val();
	var cardNo3    = $("#uplusCardNum_3").val();
	var cardNo4    = $("#uplusCardNum_4").val();
	var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;

	var valBirth   = $('#uplus_card_birthday').val();  //생년월일/사업자번호 숫자만 입력

	// var cardNo    = $("#uplusCardNum_hid").val().replaceAll('-', '').nvlNum(0);

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_uplus').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "" || cardNo.length < 16) {
		gfn_alertMsgBox('입력하신 카드번호가 맞는 지 확인해주세요.');
		return;
	}

	if (valBirth == "" || valBirth.length != 6) {
		gfn_alertMsgBox('생년월일을 입력하세요.');
		$('#uplus_card_birthday').focus();
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo, valBirth:valBirth };

	$.ajax({
      url: "/on/oh/ohz/PayBooking/searchUPlus.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}
		  let retCd1 = '';
		  let retMsg1 = '';
		  let retCd2 = '';
		  let retMsg2 = '';
		  uplusNewYn = data.uplusNewYn

		  //쿠폰 전역변수 세팅
		  if(uplusNewYn == 'N') {
			  uPlusChgInfo = data.uPlusInfo;
		  } else {
			  uPlusChgInfo = data.uPlusInfo.revList[0];
			  uPlusChgInfo1 = data.uPlusInfo.revList[1];
			  uPlusChgInfo2 = data.uPlusInfo.revList[2];
			  uPlusChgInfo3 = data.uPlusInfo.revList[3];
			  uPlusChgInfo4 = data.uPlusInfo.revList[4];
			  retCd1 = data.uPlusInfo.retCd1;
			  retMsg1 = data.uPlusInfo.retMsg1;
			  retCd2 = data.uPlusInfo.retCd2;
			  retMsg2 = data.uPlusInfo.retMsg2;
		  }

      	//쿠폰 목록 세팅
      	// setUPlusChg(uPlusChgInfo);
		setInitUPlus();
		$('#disc_btn').removeClass('display-none');
		let alertYn = false;

		if(uPlusChgInfo == null || Object.keys(uPlusChgInfo).length < 1) {
			$('#rdo_point').attr('disabled', true);
			// $('#rdo_norm').off('click').on('click', function(e) {
			//     e.preventDefault();
			//     AppHandler.Common.alert(retMsg1);
			// });
			$('#selUPlus > option').remove();
			$('#selUPlus').append('<option value="0">선택</option>');
			alertYn = true;
		} else {
			  // $('#rdo_norm').off('click');
			  $('#rdo_point').attr('disabled', false);
		}

		if((uPlusChgInfo1 == null || Object.keys(uPlusChgInfo1).length < 1) && (uPlusChgInfo2 == null || Object.keys(uPlusChgInfo2).length < 1) &&
				  (uPlusChgInfo3 == null || Object.keys(uPlusChgInfo3).length < 1) && (uPlusChgInfo4 == null || Object.keys(uPlusChgInfo4).length < 1)) {
			  $('#rdo_point_vip').attr('disabled', true);
			  $("#selUPlusVip > option:eq(1)").attr("disabled", true);
			  $("#selUPlusVip > option:eq(2)").attr("disabled", true);
			  $("#selUPlusVip > option:eq(3)").attr("disabled", true);
			  alertYn = true;
		} else {
			  $('#rdo_point_vip').attr('disabled', false);
		}

		  let errCd = ['27', '29', '43', '44', '47', '49', '68', '73']	//오류 메시지 노출 오류코드
		  let retCdArr = [retCd1, retCd2];
		  let retMsgArr = [retMsg1, retMsg2];
		  if(alertYn) {
			  let alertMsg = '';

			  for(let idx = 0; idx < 2 ; idx++) {
				  let retCd = retCdArr[idx];
				  let retMsg = retMsgArr[idx];

				  if(errCd.indexOf(retCd)  > -1 && retMsg != null && retMsg.length > 0) {
					  if(retCd == '27' || retCd == '29') {
						  alertMsg = '카드번호 또는 생년월일이 맞지 않습니다.\n입력 정보를 다시 확인바랍니다.';
					  } else if (retCd == '43') {
						  alertMsg = '1일 사용 횟수가 초과되었습니다.';
					  } else if (retCd == '44') {
						  alertMsg = '월간 사용 횟수가 초과되었습니다.';
					  } else if (retCd == '47') {
						  alertMsg = '연간 사용 횟수가 초과되었습니다.';
					  } else if (retCd == '49') {
						  alertMsg = '월간 사용 횟수가 초과되었습니다.';
					  }
				  }
			  }

			  if(alertMsg.length > 0) gfn_alertMsgBox(alertMsg);
		  }

		$('input[name="rdo_select"]').change(function() {
			fn_setUplusChg();
		});
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }, beforeSend : function() {
		$('#btn_select_uplus').prop("disabled", true);
		$('#btn_select_uplus').addClass('disabled');
	  }
	  , complete : function() {
		setTimeout(function(){
   			$('#btn_select_uplus').removeClass('disabled');
   			$('#btn_select_uplus').prop("disabled", false);
		},1500);
	  }
	});
}

//uplus 목록 세팅
function setUPlusChg(cponInfo) {
	//setInitUPlus();
	$('#selUPlus > option').remove();
	var cponListText = "";

	var cponList = cponInfo.comboList;
	var useAmt   = 0;
	var dcNm = '';
	if(cponList[0].useAmt == 2000) {
		dcNm = '일반';
		$('#selUPlus').append('<option value="0">일반 회원 선택</option>');

	} else if (cponList[0].useAmt == 4000) {
		dcNm = 'VIP';
		$('#selUPlus').append('<option value="0">VIP 이상 회원 선택</option>');
	}

	for(var i=0;i<cponList.length;i++) {
		useAmt += cponList[i].useAmt;
      	cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+' / '+dcNm+')</option>';
		$('#selUPlus').append(cponListText);
	}
}

//uplus 적용
function applyUPlus() {

	var transNo = $("#transNo").val();
	var cardNo1    = $("#uplusCardNum_1").val();
	var cardNo2    = $("#uplusCardNum_2").val();
	var cardNo3    = $("#uplusCardNum_3").val();
	var cardNo4    = $("#uplusCardNum_4").val();
	var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;

	var valBirth   = $('#uplus_card_birthday').val();  //생년월일 숫자만 입력
	var useCnt  = 0;

	var selPoint = $(':radio[name="rdo_select"]:checked').val();
	var methodName = '';

	if(selPoint == '' || selPoint == undefined) {
		gfn_alertMsgBox('적용 멤버십을 선택해주세요.');
		return;
	}

	if(selPoint == '0') {
		useCnt = $('#selUPlusVip option:selected').val();
		if (useCnt == 0) {
			//할인 적용할 매수를 선택하세요.
			gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
			return;
		} else if(useCnt == 1) {
			methodName = 'uplusvipfree';
		} else if (useCnt == 2) {
			methodName = 'uplusvipplus';
		} else if (useCnt == 3) {
			if(uPlusChgInfo3 != null && Object.keys(uPlusChgInfo3).length > 0) {
				methodName = 'uplusvipsp1';
			} else if (uPlusChgInfo4 != null && Object.keys(uPlusChgInfo4).length > 0) {
				methodName = 'uplusvipsp2';
			}
			useCnt = 1;
		}
	} else if (selPoint == '1') {
		useCnt = $('#selUPlus option:selected').val();
		if (useCnt == 0) {
			//할인 적용할 매수를 선택하세요.
			gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
			return;
		}

		if(uPlusChgInfo.comboList[0].useAmt == 2000) {
			methodName = 'uplus';

			if(uplusNewYn == 'Y') {
				methodName = 'uplusnew';
			}
		} else if (uPlusChgInfo.comboList[0].useAmt == 4000) {
			methodName = 'uplusvip';
		}
	}

	if (cardNo == "" || cardNo.length < 16) {
		gfn_alertMsgBox('입력하신 카드번호가 맞는 지 확인해주세요.');
		return;
	}

	if (valBirth == "" || valBirth.length != 6) {
		gfn_alertMsgBox('생년월일을 입력하세요.');
		$('#uplus_card_birthday').focus();
		return;
	}

	var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt, valBirth:valBirth, methodName:methodName};

	$.ajax({
	  url: "/on/oh/ohz/PayBooking/applyUPlus.do",
      type: "POST",
      contentType: "application/json;charset=UTF-8",
      dataType: "json",
	  data: JSON.stringify(paramData),
      success: function (data, textStatus, jqXHR) {
      	//console.log(data);
    	if (!msgBookingLoginChk(data)) {
    		return;
    	}

      	//할인내역 갱신
      	setMovieDcInfo(data.policyList);

      	$('#btn_cancel_uplus').show(); //취소버튼
      	$('#btn_cancel_apply_uplus').show(); //적용취소버튼

      	//닫기버튼 클릭
      	$('#layer_302034 .close-layer').click();
      },
      error: function(xhr,status,error){
      	var err = JSON.parse(xhr.responseText);
      	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
      	errBookingChk(err.msg);
      }
	});
}

function fn_setUplusChg() {
	var selPoint = $(':radio[name="rdo_select"]:checked').val();

	if(selPoint == '0') {
		$("#selUPlus").val("0").prop("selected", true);
		$('#selUPlusDivVip').removeClass('display-none');
		$('#selUPlusDiv').addClass('display-none');
		$('#vipLmt').removeClass('display-none');

		if(uPlusChgInfo1 == null || Object.keys(uPlusChgInfo1).length == 0) {
			$("#selUPlusVip > option:eq(1)").attr("disabled", true);
			$('#vipFreeLmt em').removeClass('use');
			$('#vipFreeLmt em').text('0');
		} else {
			$("#selUPlusVip > option:eq(1)").attr("disabled", false);
			$('#vipFreeLmt em').addClass('use');
			$('#vipFreeLmt em').text('1');
		}
		if(uPlusChgInfo2 == null || Object.keys(uPlusChgInfo2).length == 0) {
			$("#selUPlusVip > option:eq(2)").attr("disabled", true);
			$('#vipPlusLmt em').removeClass('use');
			$('#vipPlusLmt em').text('0');
		} else {
			$("#selUPlusVip > option:eq(2)").attr("disabled", false);
			$('#vipPlusLmt em').addClass('use');
			$('#vipPlusLmt em').text('1');
		}
		if((uPlusChgInfo3 == null || Object.keys(uPlusChgInfo3).length == 0) && (uPlusChgInfo4 == null || Object.keys(uPlusChgInfo4).length == 0)) {
			$("#selUPlusVip > option:eq(3)").attr("disabled", true);
			$('#vipSpecialLmt em').removeClass('use');
			$('#vipSpecialLmt em').text('0');
		} else {
			$("#selUPlusVip > option:eq(3)").attr("disabled", false);
			$('#vipSpecialLmt em').addClass('use');
			$('#vipSpecialLmt em').text('1');
		}
	} else if(selPoint == '1') {
		$("#selUPlusVip").val("0").prop("selected", true);
		$('#selUPlusDiv').removeClass('display-none');
		$('#selUPlusDivVip').addClass('display-none');
		$('#vipLmt').addClass('display-none');

		if(uPlusChgInfo != null && Object.keys(uPlusChgInfo).length > 0) {
			setUPlusChg(uPlusChgInfo);
		}
	}
}
</script>

	<!-- 레이어 : uplus -->
	<input type="hidden" id="uplusCardNum_hid">
	<section id="layer_302034" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">U+ 멤버십<!-- uplus --></h3>
			</header>

			<div class="layer-con">
				<div class="reset">
					U+ 멤버십 카드 정보를 입력해주세요<!-- uplus 카드 정보를 입력해주세요 -->
				</div>

				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><span class="uplusCardNum">카드번호<!-- 카드번호 --></span></p>

							<div class="sh-input">
								<input type="text" title="U+ 멤버십 카드번호 첫번째자리 입력" class="input-text w60px x-small" id="uplusCardNum_1" maxlength="4"> -
								<input type="text" title="U+ 멤버십 카드번호 두번째자리 입력" class="input-text w60px x-small" id="uplusCardNum_2" maxlength="4"> -
								<input type="number" title="U+ 멤버십 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" id="uplusCardNum_3" maxlength="4" oninput="gfn_numberMaxLength(this);"> -
								<input type="text" title="U+ 멤버십 카드번호 네번째자리 입력" class="input-text w60px x-small" id="uplusCardNum_4" maxlength="4">
							</div>
						</div>

						<div class="pop-search-area-line gray">
							<p class="sh-txt reset vt"><label for="uplus_card_birthday">생년월일<!-- 생년월일 --></label></p>
							<div class="sh-input mr0">
								<input type="text" id="uplus_card_birthday" title="현대 M포인트 카드 생년월일 입력" class="input-text w80px x-small" maxlength="10">
								<button type="button" class="button gray x-small ml07" id="btn_select_uplus">조회<!-- 조회 --></button>

								<p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자)<!-- 생년월일 6자리(카드소유자) --></p>

							</div>
						</div>

					</div>
				</div>

				<div class="table-wrap display-none" id="disc_btn">
					<table class="board-form">
						<caption>U+ 멤버십, 할인 방식 선택</caption>
						<colgroup>
							<col style="width:125px;">
							<col>
						</colgroup>
						<tbody>
							<tr>
								<th scope="row">U+ 멤버십<!-- uplus --></th>
								<td>
									<input type="radio" name="rdo_select" id="rdo_point_vip" class="radioTy2" value="0"> <!--disabled 임시로 처리한것-->
									<label for="rdo_point_vip" id="rdo_vip">VIP콕</label>
									<input type="radio" name="rdo_select" id="rdo_point" class="radioTy2" value="1">
									<label class="ml10" for="rdo_point" id="rdo_norm">상시할인</label>
								</td>
							</tr>
							<tr>
								<th scope="row">할인 방식 선택</th>
								<td id="selUPlusDivVip" class="display-none">
									<select class="w180px v1 x-small" id="selUPlusVip">
										<option value="0">선택</option>
										<option value="1">영화 무료 예매: 1매 무료</option>
										<option value="2">영화 1+1 예매: 2매 이상 예매하면 1장 무료</option>
										<option value="3">특별관 6천원 할인: 1매 할인</option>
									</select>
								</td>
								<td id="selUPlusDiv" class="">
									<select class="w180px v1 x-small" id="selUPlus">
										<option value="0">선택<!-- 선택 --></option>
									</select>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="pattern_Box mt20 display-none" id="vipLmt">
					<div class="item" id="vipFreeLmt"><span>영화 무료 예매 (1매 무료)</span>이번달 사용 가능 <em>0</em>회</div>
					<div class="item" id="vipPlusLmt"><span>영화 1+1 예매</span>이번달 사용 가능 <em>0</em>회</div> <!--횟수가 있을때 use 사용-->
					<div class="item" id="vipSpecialLmt"><span>특별관 6천원 할인 (1매 할인)</span>이번달 사용 가능 <em>0</em>회</div>
				</div>

				<div class="box-border v1 use-guide mt15">
					<p class="tit">이용안내<!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>U+VIP콕 혜택은 월 1회 사용 가능하며, 당월 다른 VIP콕 서비스 이용 시 적용 불가합니다.<br>* 무료(연 3회), 1+1(연 9회) 혜택은 타 극장사에서 동일 혜택을 이용한 실적이 있는 경우 적용이 불가합니다.<br>예시) 무료 3회를 메가박스에서 이용 시 타 극장사에서 동일 혜택으로 적용 불가<!-- 타 브랜드 이용 시 메가박스 혜택 적용 불가 --></li>
						<li>VIP 본인 무료 및 1+1혜택은 일반관, 컴포트관에 한하여 적용 가능하며, 특별관 6천원 할인은 더 부티크, 더 부티크 스위트, Dolby Atmos, Dolby Cinema, MX4D에 한하여 적용가능합니다.<!-- VIP콕 본인 무료 및 1+1 혜택은 --></li>
						<li>VIP콕 할인은 경로, 어린이, 특별콘텐트, 3D, 로얄석, 커플석, 발코니석 적용은 불가합니다.<!-- 경로, 어린이 특별콘텐트 적용이 불가 --></li>
						<li>상시할인 서비스는 전 회원 모두 적용 가능하며, VIP 이상 등급은 티켓당 4,000원, 일반 등급은 티켓당 2,000원 할인이 적용됩니다.(동반 3인까지, 일1회)<!-- 상시할인 서비스는 전 회원 모두 적용 가능 --></li>
						<li>상시할인 서비스는 조조, 우대, 경로, 어린이, 문화의 날 및 특별콘텐트 적용이 불가합니다.<!-- 상시할인 서비스는 조조, 우대, 경로, 어린이, 문화의 날 및 특별콘텐트 --></li>
						<li>상시할인 서비스는 일반관, 컴포트관, 일반석, 스페셜석에 한하여 적용 가능합니다.<!-- 상시할인 서비스는 일반관, 컴포트관, 일반석, 스페셜석 --></li>
						<li>타 제휴할인 및 쿠폰 적용은 중복 불가합니다.<!-- 타 제휴할인 및 쿠폰 적용은 중복 불가 --></li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_uplus">닫기<!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_uplus" style="display:none;">적용취소<!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_uplus">적용<!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_uplus">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : uplus -->

	<!--// 레이어 : uplus -->

	<!-- 레이어 : 베네피아 -->
	





<script type="text/javascript">

var benepiaInfo = {};				

function benepia_init() {
	benepiaInfo = {};
	$("#benepiaId").val("");
	$("#benepiaPwd").val("");
	$("#benepiaAbleCash").text("0");
	$("#benepiaUseCash").val("");
	$("#benepiaUseCashText").text("");
}
var benepia = {
	
	
	fn_post : function(options){
		
		if(!options.url){
			gfn_alertMsgBox("must set options property !");
		}
		
		options.data = options.data || {};
		
		
		if(!options.success){
			options.success = function(data, textStatus, jqXHR){
				gfn_alertMsgBox("must define success callback");
			}
		}
		
		if(!options.error){
			//  jqXHR jqXHR, String textStatus, String errorThrown
			options.error = function(xhr,status,error){
				var err = JSON.parse(xhr.responseText);

				// 메시지 변경처리
				/*err.msg = err.msg || '';
				if(err.msg.indexOf('회원오류')>=0){
					gfn_alertMsgBox('존재하지 않는 아이디 입니다.');
				}else if(err.msg.indexOf('결제비밀번호')>=0 || err.msg.indexOf('로그인 비밀번호')>=0){ 
					gfn_alertMsgBox('결제비밀번호를 확인 바랍니다.');
				}else{
					gfn_alertMsgBox(err.msg);
				}*/
			}
		}

		$.ajax({
	      	url: options.url,
	      	type: "POST",
	      	contentType: "application/json;charset=UTF-8",
	      	dataType: "json",
		  	data: JSON.stringify(options.data),
	      	success: options.success,
	      	error: options.error,
	      	beforeSend : function() {
	  			$(options.block).prop("disabled", true);
	  			$(options.block).addClass('disabled');
	  	  	}
	  	  	, complete : function() {
				setTimeout(function(){
					$(options.block).removeClass('disabled');
					$(options.block).prop("disabled", false);
				},1500);
	  	  	}
		});
	},
	
	fn_searchPoint : function() {

		
		var benepiaId = $.trim($("#benepiaId").val());
		if (benepiaId == "") {
			gfn_alertMsgBox('베네피아 아이디를 입력 바랍니다.');
			$("#benepiaId").focus();
			return;
		}

		
		var benepiaPwd = $.trim($("#benepiaPwd").val());
		if (benepiaPwd == "") {
			gfn_alertMsgBox('베네피아 비밀번호를 입력 바랍니다.');
			$("#benepiaPwd").focus();
			return;
		}

		
		benepia.fn_post({
			url : "/on/oh/ohz/PayBooking/searchBenepia.do",
			block : "#benepiaSearch",
			data : { transNo:$("#transNo").val(), payId:$("#benepiaId").val(), payPwd:$("#benepiaPwd").val() },
			success : function(data, textStatus, jqXHR){
				// gfn_alertMsgBox(JSON.stringify(data));

				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}

				
				
				benepiaInfo = data.benepiaInfo;
				//console.log('data', data);

				var useAbleAmt = benepia.get_money_num(benepiaInfo.balance);		
				var remainAmt = benepia.get_money_num($('#payForm').find('#benepiaTotalAmt').val());	

				$('#benepiaAbleCash').text(benepia.get_money_str(useAbleAmt));

				if (useAbleAmt < remainAmt) {
					gfn_alertMsgBox('사용가능 포인트가 없습니다.');
					return;
				}

				var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
				maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
				$("#benepiaUseCash").val(benepia.get_money_str(maxAmt));
				$("#benepiaUseCashText").text(benepia.get_money_str(maxAmt));
			},
			error: function(xhr,status,error){
				var err = JSON.parse(xhr.responseText);
				//err.statCd 에 따라서 이전화면으로 리턴 가능토록
				errBookingChk(err.msg);
			}
		});
	},
	
	get_money_num : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			return 0;
		}
		return _money;
	},
	
	get_money_str : function(source){
		var _money = parseInt(String(source).replace(/[^0-9]/g,''));
		if(isNaN(_money)){
			_money = 0;
		}
		return String(_money).maskNumber();
	},
	
	fn_applyCash : function () {
		var transNo    = $("#transNo").val(); 
		var useAmt     = benepia.get_money_num($("#benepiaUseCash").val());	
		var useAbleAmt = benepia.get_money_num(benepiaInfo.balance);			
		var remainAmt = benepia.get_money_num($('#payForm').find('#benepiaTotalAmt').val());	

		
		var benepiaId = $.trim($("#benepiaId").val());
		if (benepiaId == "") {
			gfn_alertMsgBox('베네피아 아이디를 입력 바랍니다.');
			return;
		}

		
		var benepiaPwd = $.trim($("#benepiaPwd").val());
		if (benepiaPwd == "") {
			gfn_alertMsgBox('베네피아 비밀번호를 입력 바랍니다.');
			return;
		}

		
		var benepiaAbleCash = benepia.get_money_num($("#benepiaAbleCash").text());	
		if (benepiaAbleCash == 0) {
			gfn_alertMsgBox('베네피아 잔액을 조회 바랍니다.');
			return;
		}

		
		if ( useAmt > useAbleAmt ) {
			gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',benepia.get_money_str(useAmt)).replace('#2',benepia.get_money_str(useAbleAmt)));
			return;
		}

		
		if(parseInt(remainAmt) > parseInt(useAmt)){
			gfn_alertMsgBox('베네피아 잔액이 부족합니다.');
			return;
		}

		
		if ( parseInt(useAmt) > parseInt(remainAmt) ) {
			gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',benepia.get_money_str(useAmt)).replace('#2',benepia.get_money_str(remainAmt)));
			return;
		}

		
		
		benepia.fn_post({
			url : "/on/oh/ohz/PayBooking/applyBenepia.do",
			block : "#btn_apply_benepia",
			data : { transNo:$("#transNo").val(), useAmt:useAmt, payId:benepiaId, payPwd:$("#benepiaPwd").val()  },
			success : function(data, textStatus, jqXHR){
				
				if (!msgBookingLoginChk(data)) {
        			return;
        		}
				//console.log('data', data);
				
				setTicketInfo(data.ticketList);
	        	setMovieDcInfo(data.policyList);

	        	$('#btn_cancel_benepia').show(); 					// 취소버튼
	        	$('#btn_cancel_apply_benepia').show(); 			// 버튼 - 적용취소
	        	$('#layer_303014 .close-layer').click();			// 버튼 - 닫기
			},
			error: function(xhr,status,error){
				var err = JSON.parse(xhr.responseText);
				//err.statCd 에 따라서 이전화면으로 리턴 가능토록
				errBookingChk(err.msg);
			}
		});
	}
};


$(function() {
	// 버튼 - 조회
	$('#benepiaSearch').on('click', function() {
		benepia.fn_searchPoint();
	});

	// 버튼 - 적용
	$('#btn_apply_benepia').on('click', function() {
		benepia.fn_applyCash();
	});

	// 버튼 - 적용취소
	$('#btn_cancel_apply_benepia').on('click', function() {
		cancelMbxSellCpInfo('benepia');
       	$('#layer_303014 .close-layer').click();
	});

	// 버튼 - 닫기
	$('#btn_close_benepia, #btn_close_modal_benepia').on('click', function() {
		if (!$('#btn_cancel_apply_benepia').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
			benepia_init();
		}
	});
});

</script>
<!--// 레이어 : 베네피아 - 베네피아 (PC) START -->
<section id="layer_303014" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">SK베네피아 </h3>
		</header>

		<div class="layer-con">

			<div class="reset">
				베네피아 아이디와 비밀번호를 입력 후 조회해주세요. 
			</div>

			<div class="popup-gray mid-info-box mb10">
				<div class="pop-search-area line-wid">

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="benepiaId">아이디</label></p>
						<div class="sh-input">
							<input type="text" id="benepiaId" title="베네피아 아이디 입력" class="input-text w200px x-small" maxlength="20">
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset"><label for="benepiaPwd">비밀번호</label></p>
						<div class="sh-input">
							<input type="text" id="benepiaPwd" title="비밀번호 입력" class="input-text w120px x-small pwnew" maxlength="30">
						</div>

						<div class="sh-btn">
							<button type="button" class="button x-small gray" id="benepiaSearch">조회</button>
						</div>
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">보유금액</p>
						<span class="font-green" id="benepiaAbleCash">0</span> 원
					</div>

					<div class="pop-search-area-line">
						<p class="sh-txt reset">사용할금액</p>
						<span class="font-green" id="benepiaUseCashText">0</span> 원
						<input type="hidden" id="benepiaUseCash" value="">
					</div>

				</div>
			</div>

			<div class="box-border v1 use-guide mt10">
				<p class="tit">복지포인트 사용안내</p>

				<ul class="dot-list gray">
					<li>베네피아 아이디와 비밀번호를 통해 조회 후 사용하실 수 있습니다.</li>
					<li>전액결제만 가능하며, 최종결제금액보다 보유 포인트가 부족한 경우 사용이 불가합니다.</li>


					<li>복지포인트로 예매 시 청소년, 우대 구분 없이 성인금액 기준으로 예매가 가능합니다.</li>
					<li>기타 특별관 및 특별 컨텐츠는 포인트 결제 및 사용이 불가합니다.</li>
				</ul>
			</div>
		</div>

		<div class="btn-group-fixed">
			<button type="button" class="button small close-layer" id="btn_close_benepia">닫기</button>
			<button type="button" class="button small purple" id="btn_cancel_apply_benepia" style="display:none;">적용취소</button>
			<button type="button" class="button small purple" id="btn_apply_benepia">적용</button>
		</div>

		<button type="button" class="btn-modal-close" id="btn_close_modal_benepia">레이어 닫기</button>
	</div>
</section>
<!--// 레이어 : 해피머니 - 해피캐시 (PC) END -->
	<!--// 레이어 : 베네피아 -->

	<!-- 레이어 : 메가박스 모바일상품권 -->
	





<script type="text/javascript">
    var mGfCardChgList = new Array();

    //초기화 공통 sMethodName.init
    function mgfcard_init() {  //모바일 상품권 전체초기화
        setInitMgfCard();
        mGfCardChgList = new Array();
        $('#mgfcardCardNum').val('');
    }

    $(function() {

        //숫자만 입력가능
        $("#mgfcardCardNum").megaBoxNumberCheck();

        //조회버튼 클릭
        $('#btn_select_mgfcard').on('click', function() {
            searchMgfCard();
        });

        //모바일 상품권 적용
        $('#btn_apply_mgfcard').on('click', function() {
            applyMobileGiftCard();
        });

        //적용취소버튼 클릭
        $('#btn_cancel_apply_mgfcard').on('click', function() {
            var sMethodName = "mgfcard";
            cancelMbxSellCpInfo(sMethodName);

            //닫기버튼 클릭
            $('#layer_301001 .close-layer').click();
        });


        //모바일 상품권 닫기
        $('#btn_close_mgfcard, #btn_close_modal_mgfcard').on('click', function() {
            $('#mgfcardCardNum').val('');
        });
    });


    //모바일 상품권 초기화
    function setInitMgfCard() {
        //$('#layer_mgfcard .table-wrap > table > tbody> tr').remove();
        $('#layer_301001 .table-wrap > .scroll > table > tbody> tr').remove();
    }

    //모바일 상품권 조회
    function searchMgfCard() {
        var transNo    = $("#transNo").val();
        var cardNo     = $("#mgfcardCardNum").val();
        var paramData  = {transNo:transNo, cardNo:cardNo};

        //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
        if ($('#btn_cancel_apply_mgfcard').is(':visible')) {
            //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
            gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
            return;
        }

        if (cardNo == "") {
            gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
            return;
        }

        //기 조회여부 체크
        for(var i=0;i<mGfCardChgList.length;i++) {
            if (cardNo == mGfCardChgList[i].cardNo) {
                gfn_alertMsgBox('이미 조회된 상품권입니다. \n동일한 상품권은 중복해서 등록하실 수 없습니다.');
                return;
            }
        }

        $.ajax({
            url: "/on/oh/ohz/PayBooking/searchMobileGiftCard.do",
            type: "POST",
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            data: JSON.stringify(paramData),
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }

                //쿠폰 전역변수 세팅
                var mgfCardList = data.mgfCardList;
                for(var i=0;i<mgfCardList.length;i++){
                    var sameYn = false;
                    //이중조회 방지
                    for(var j=0;j<mGfCardChgList.length;j++){
                        if (mGfCardChgList[j].cardNo == mgfCardList[i].cardNo) {
                            sameYn = true;
                            break;
                        }
                    }
                    if (!sameYn) {
                        mGfCardChgList.push(mgfCardList[i]);
                    }
                }

                //쿠폰 목록 세팅
                setMgfCardChg(mGfCardChgList);
            },
            error: function(xhr,status,error){
                var err = JSON.parse(xhr.responseText);
                //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                errBookingChk(err.msg);
            }	  , beforeSend : function() {
                $('#btn_select_mgfcard').prop("disabled", true);
                $('#btn_select_mgfcard').addClass('disabled');
            }
            , complete : function() {
                setTimeout(function(){
                    $('#btn_select_mgfcard').removeClass('disabled');
                    $('#btn_select_mgfcard').prop("disabled", false);
                },1500);
            }
        });
    }

    //모바일 상품권 쿠폰 목록 세팅
    function setMgfCardChg(cponList) {
        setInitMgfCard();
        var cponListText = "";
        for(var i=0;i<cponList.length;i++) {
            cponListText =  '<tr> ';
            cponListText += '	<td class="a-l">'+cponList[i].cponName+'</td>  ';
            cponListText += '	<td>'+cponList[i].cardNo+'</td>  ';
            cponListText += '	<td><input type="checkbox" title="모바일 관람권 사용여부 체크" name="chkMGfCardChg" idx="'+i+'"/></td>  '; //msg_모바일 상품권 사용여부 체크
            cponListText += '</tr>  ';

            //$('#layer_mgfcard .table-wrap > table > tbody').append(cponListText);
            $('#layer_301001 .table-wrap > .scroll > table > tbody').append(cponListText);
            if($('#layer_301001 .table-wrap > .scroll > table > tbody').height() > $('#layer_301001 .table-wrap > .scroll').height()) {
                $('#layer_301001 .table-wrap > .scroll').css("margin-right", "-17px");
            }

            $('#mgfcardCardNum').val('');
            setChkMgfCardEvent();
        }
    }

    //체크박스 이벤트
    function setChkMgfCardEvent() {
        $(":checkbox[name='chkMGfCardChg']").off().on('click', function() {
            if (!$(this).prop('checked')) {
                return;
            }
            var transNo    = $("#transNo").val();
            var cmbndNo    = mGfCardChgList[$(this).attr('idx')].cmbndNo;
            var idntfcNo   = mGfCardChgList[$(this).attr('idx')].cardNo;
            var paramData  = {transNo:transNo, cmbndNo:cmbndNo, idntfcNo:idntfcNo, innerType:'cmbnd'};
            var idx        = $(this).attr('idx');

            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyAbleMgfCardChk.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);

                    //추후 order 변경 등 고려 foreach 로 처리
                    $(":checkbox[name='chkMGfCardChg']").each(function() {
                        if ($(this).attr('idx') == idx) {
                            $(this).prop('checked', false);
                        }
                    });
                }
            });

        });
    }

    //모바일 상품권 쿠폰 적용
    function applyMobileGiftCard() {
        var chkCnt = $(":checkbox[name='chkMGfCardChg']:checked").length;

        if ( chkCnt == 0 ) {
            gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
            return;
        }

        var transNo   = $("#transNo").val();
        var paramCpon = new Array();

        $(":checkbox[name='chkMGfCardChg']:checked").each(function(idx) {
            mGfCardChgList[$(this).attr('idx')].transNo = transNo;
            paramCpon.push(mGfCardChgList[$(this).attr('idx')]);
        });

        ////console.log(paramCpon);

        var paramData = {transNo:transNo, cponList:paramCpon, methodName:'mgfcard'};

        $.ajax({
            url: "/on/oh/ohz/PayBooking/applyMobileGiftCard.do",
            type: "POST",
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            data: JSON.stringify(paramData),
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }

                //할인내역 갱신
                setMovieDcInfo(data.policyList);

                $('#btn_cancel_mgfcard').show(); //취소버튼
                $('#btn_cancel_apply_mgfcard').show(); //적용취소버튼

                //닫기버튼 클릭
                $('#layer_301001 .close-layer').click();
            },
            error: function(xhr,status,error){
                var err = JSON.parse(xhr.responseText);
                //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                errBookingChk(err.msg);
            }
        });
    }
</script>
<!-- 레이어 : 모바일 상품권 -->
<section id="layer_301001" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
    <div class="wrap">
        <header class="layer-header">
            <h3 class="tit">모바일 관람권<!-- 모바일 관람권 --></h3>
        </header>

        <div class="layer-con">
            <div class="popup-gray mid-info-box mt0">
                <div class="pop-search-area">
                    <p class="sh-txt reset mr08"><span class="label">관람권번호<!-- 관람권번호 --></span></p>

                    <div class="sh-input"><input type="text" title="모바일 상품권 예매권 번호입력" class="input-text w200px" id="mgfcardCardNum" maxlength="20"></div> <!-- 모바일 상품권 예매권 번호입력 -->

                    <div class="sh-btn gray">
                        <button type="button" class="button small gray" id="btn_select_mgfcard">조회<!-- 조회 --></button>
                    </div>
                </div>
            </div>

            <div class="table-wrap divide">
                <table class="board-list line">
                    <caption>모바일 관람권 관람권 명, 관람권번호, 사용여부 항목을 가진 모바일 상품권 목록의 제목 표<!-- 모바일 상품권 예매권 명, 예매권번호, 사용여부 항목을 가진 모바일 상품권 목록의 제목 표 --></caption>
                    <colgroup>
                        <col>
                        <col style="width:150px;">
                        <col style="width:60px;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th scope="col">관람권 명<!-- 관람권 명 --></th>
                        <th scope="col">관람권번호<!-- 관람권번호 --></th>
                        <th scope="col">사용<!-- 사용 --></th>
                    </tr>
                    </thead>
                </table>

                <!--
                    상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
                 -->
                <div class="scroll" style="min-height:281px; max-height:281px;">
                    <table class="board-list line">
                        <caption>관람권 명, 관람권번호, 사용여부 항목을 가진 모바일 상품권 목록의 내용 표<!-- 관람권 명, 관람권번호, 사용여부 항목을 가진 모바일 상품권 목록의 내용 표 --></caption>
                        <colgroup>
                            <col>
                            <col style="width:150px;">
                            <col style="width:60px;">
                        </colgroup>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="btn-group-fixed">
            <button type="button" class="button small close-layer" id="btn_close_mgfcard">닫기<!-- 닫기 --></button>
            <button type="button" class="button small purple" id="btn_cancel_apply_mgfcard" style="display:none;">적용취소<!-- 적용취소 --></button>
            <button type="button" class="button small purple" id="btn_apply_mgfcard">적용<!-- 적용 --></button>
        </div>

        <button type="button" class="btn-modal-close" id="btn_close_modal_mgfcard">레이어 닫기<!-- 레이어 닫기 --></button>
    </div>
</section>
<!--// 레이어 : 모바일 상품권 -->

	<!--// 레이어 : 메가박스 모바일상품권 -->

	<!-- 레이어 : 신한 조조 -->
	





<script type="text/javascript">
var shinhanDiscChgInfo = new Object();

//초기화 공통 sMethodName.init
function shinhan_disc_init() {  //선할인 전체초기화
	shinhanDiscChgInfo = new Object();

	$('#shinhanDiscCardNum_1').val('');
	$('#shinhanDiscCardNum_2').val('');
	$('#shinhanDiscCardNum_3').val('');
	$('#shinhanDiscCardNum_4').val('');

	$('#shinhan_disc_card_mm').val('');
	$('#shinhan_disc_card_yy').val('');
	$('#chk_shinhan_disc_agree').prop('checked', false);
}


$(function() {
	shinhan_disc_init();

	//숫자만 입력가능
	$('#shinhanDiscCardNum_1').megaBoxNumberCheck();
	$('#shinhanDiscCardNum_2').megaBoxNumberCheck();
	$('#shinhanDiscCardNum_3').megaBoxNumberCheck();
	$('#shinhanDiscCardNum_4').megaBoxNumberCheck();

	// $('#shinhan_disc_birthday').megaBoxNumberCheck();
	$('#shinhan_disc_card_mm').megaBoxNumberCheck();
	$('#shinhan_disc_card_yy').megaBoxNumberCheck();

	//선할인 적용
	$('#btn_pay_shinhan_disc').on('click', function() {
		applyShinhanDisc();
	});

});

//선할인 적용
function applyShinhanDisc() {
	var transNo    = $("#transNo").val();
	var cardNo1    = $("#shinhanDiscCardNum_1").val();
	var cardNo2    = $("#shinhanDiscCardNum_2").val();
	var cardNo3    = $("#shinhanDiscCardNum_3").val();
	var cardNo4    = $("#shinhanDiscCardNum_4").val();
	var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;

	var valMonth   = $('#shinhan_disc_card_mm').val();  //유효기간 숫자만 입력
	var valYear    = $('#shinhan_disc_card_yy').val();  //유효기간 숫자만 입력
	var preDisc    = $('#preDisc').val();   //선할인여부
	var discType   = $('#discType').val();  //선할인타입(BC)

	if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		return;
	}

	if (valMonth == "" || valMonth.length < 2) {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#shinhan_disc_card_mm').focus();
		return;
	}

	if (valYear == ""  || valYear.length < 2) {
		gfn_alertMsgBox('카드 유효기간 4자리를 입력하세요. \n(ex. 2025년 1월 -> 0125)');
		$('#shinhan_disc_card_yy').focus();
		return;
	}

	if ($('#chk_shinhan_disc_agree').prop('checked') == false) {
		gfn_alertMsgBox('결제대행서비스 약관에 모두 동의하셔야 결제하실 수 있습니다.');
		$('#chk_shinhan_disc_agree').focus();
		return;
	}

	var option = {cardNo1:cardNo1  , cardNo2:cardNo2,  cardNo3:cardNo3   , cardNo4:cardNo4  ,
		          cardNo:cardNo    , transNo:transNo,  valMonth:valMonth , valYear:valYear  ,
		          preDisc:preDisc,  discType:discType};

	$('#lastPayMethod').val('shinhan');

	//최종결제 금액 유효성 검사 및 결제 처리
	chkLastPayAmt(option);

	//닫기버튼 클릭
    $('#layer_shinhan_sale .close-layer').click();
}
</script>

	<!-- 레이어  : 선 할인카드 -->
	<section id="layer_shinhan_sale" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">아침愛 카드 조조할인 <!-- 즉시할인카드 --></h3>
			</header>

			<div class="layer-con">
				<div class="popup-gray mid-info-box">
					<div class="pop-search-area">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="before_sale_card_num">카드번호 <!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" title="카드번호 첫번째자리 입력" class="input-text x-small w60px" id="shinhanDiscCardNum_1" maxlength="4"> - <!-- 즉시할인카드 카드번호 첫번째자리 입력 -->
								<input type="text" title="카드번호 두번째자리 입력" class="input-text w60px x-small " id="shinhanDiscCardNum_2" maxlength="4"> - <!-- 즉시할인카드 카드번호 두번째자리 입력 -->
								<input type="number" title="카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" id="shinhanDiscCardNum_3" maxlength="4" oninput="gfn_numberMaxLength(this);"> - <!-- 즉시할인카드 카드번호 세번째자리 입력 -->
								<input type="text" title="카드번호 네번째자리 입력" class="input-text w60px x-small " id="shinhanDiscCardNum_4" maxlength="4"> <!-- 즉시할인카드 카드번호 네번째자리 입력 -->
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="before_sale_card_date">카드유효기간 <!-- 카드유효기간 --></label></p>

							<div class="sh-input">
								<input type="text" id="shinhan_disc_card_mm" title="유효기간 월 입력" placeholder="MM" class="input-text w60px  x-small a-c" maxlength="2"> / <!-- 즉시할인카드 유효기간 월 입력 -->
								<input type="text" id="shinhan_disc_card_yy" title="유효기간 년 입력 " placeholder="YY" class="input-text w60px x-small a-c" maxlength="2"><!-- 즉시할인카드 유효기간 년 입력 -->
							</div>
						</div>

					</div>
				</div>

				<div class="combo-text-wrap">
					<p class="tit">아침愛 카드 프로모션 안내</p>
					<ul class="dot-list gray">
						<li>신한카드 (아침愛 카드)에 한하여 할인 서비스가 제공됩니다.</li>
						<li>쿠폰 및 타 할인수단 적용 시 신한 아침愛 카드 할인 서비스 적용이 불가합니다.</li>
						<li>최대2인 예매 시 사용 가능하며 3인 이상 예매 시 신한 아침愛 카드 할인 서비스 적용이 불가합니다.</li>
						<li>신한카드 조조무료 서비스는 '아침愛 조조할인' 선택 시에만 적용되며, 실적 및 조건 충족 시 월 1회, 최대 2인까지 무료로 관람하실 수 있습니다.</li>
					</ul>
				</div>

				<div class="mt20">
					<input type="checkbox" id="chk_shinhan_disc_agree">
					<label for="chk_shinhan_disc_agree">결제대행 서비스 약관 필수 동의 <!-- 결제대행서비스 약관에 모두 동의 --></label>

					<div class="mt10">
						<a href="https://megabox.kicc.co.kr/html/terms/terms1.html" title="전자금융거래 기본약관" target="_blank" class="a-link ml20">전자금융거래 기본약관 <!-- 전자금융거래 기본약관 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms2.html" title="개인정보 수집 및 이용에 대한 동의" target="_blank" class="a-link ml20">개인정보 수집 및 이용에 대한 동의 <!-- 개인정보 수집 및 이용에 대한 동의 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms3.html" title="개인정보의 제 3자 제공 동의" target="_blank" class="a-link ml20">개인정보의 제 3자 제공 동의 <!-- 개인정보의 제 3자 제공 동의 --> <i class="iconset ico-arr-right-green"></i></a>
						<a href="https://megabox.kicc.co.kr/html/terms/terms4.html" title="개인정보의 처리 위탁 동의" target="_blank" class="a-link ml20">개인정보의 처리 위탁 동의 <!-- 개인정보의 처리 위탁 동의 --> <i class="iconset ico-arr-right-green"></i></a>
					</div>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer">닫기 <!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_pay_shinhan_disc">결제 <!-- 결제 --></button>
			</div>

			<button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
		</div>
	</section>

	<!--// 레이어 : 신한 조조 -->

	<!-- 레이어 : 기아 레드 멤버스 -->
	





<script type="text/javascript">

var kiaMembersInfo = new Object();

//초기화 공통 sMethodName.init
function kiaMembers_init() {
	setInitStoreChg();
	kiaMembersInfo = new Object();
	$("#kiaMembersCardNum").val('');
	$("#kiaMembersCardNum_hid").val('');
	$("#spn_kia_useable_amt").text('0');
	$("#kiaMembersUsePoint").val('');
	$("#kiaMembersUsePwd").val('');
	$("#kiaMembersPreUsePoint").val('');
	
}


$(function() {
	//숫자만 입력가능
	$("#kiaMembersCardNum").megaBoxCardNumberCheck();

	//사용할포인트
	$("#kiaMembersUsePoint").megaBoxCommaNumberCheck();

	//조회버튼 클릭
	$('#btn_select_kiamembers').on('click', function() {
		searchkiaMembers();
	});

	//적용버튼 클릭
	$('#btn_apply_kiamembers').on('click', function() {
		applykiaMembers();
	});

	//모두사용 클릭
	$('#btn_all_use_kiamembers').on('click', function() {
		useAllkiaMembers();
	});

	//적용취소버튼 클릭
	$('#btn_cancel_apply_kiamembers').on('click', function() {
		var sMethodName = "kiaMembers";
		cancelMbxSellCpInfo(sMethodName);

		//닫기버튼 클릭
       	$('#layer_303022 .close-layer').click();
	});

	//닫기버튼 클릭
	$('#btn_close_kiamembers, #btn_close_modal_kiamembers').on('click', function() {
		if (!$('#btn_cancel_apply_kiamembers').is(':visible')) {
			kiaMembers_init();
		}
	});

});

//기아멤버스 모두사용
function useAllkiaMembers() {

	var useAbleAmt = $("#spn_kia_useable_amt").text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var remainAmt  = $('.receipt .row.total span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);

	if (parseInt(useAbleAmt ) == 0 || parseInt(useAbleAmt) < 1000) {
		//조회 후 사용 가능합니다.
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#kiaMembersCardNum").focus();
		return;
	}

	var maxAmt = useAbleAmt;
	if (parseInt(useAbleAmt) > parseInt(remainAmt)) {
		maxAmt = remainAmt;
	}

	maxAmt = parseInt(maxAmt /1000) * 1000;
	$("#kiaMembersUsePoint").val(String(maxAmt).maskNumber());
}

//기아멤버스 조회
function searchkiaMembers() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#kiaMembersCardNum_hid").val();
	var password = $("#kiaMembersUsePwd").val();
	var paramData  = {transNo:transNo, cardNo:cardNo, password:password};

	//기존에 적용된 동일 수단이 있으면 초기화 후 재조회
	if ($('#btn_cancel_apply_kiamembers').is(':visible')) {
		//이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
		gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
		return;
	}

	if (cardNo == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#kiaMembersCardNum").focus();
		return;
	}

	if (cardNo.length < 15) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#kiaMembersCardNum").focus();
		return;
	}


	if (password.length < 4) {
		//비밀번호 4자리 이상 입력하세요
		gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
		$("#kiaMembersUsePwd").focus();
		return;
	}

	$.ajax({
        url: "/on/oh/ohz/PayBooking/searchKiaMembers.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//쿠폰 전역변수 세팅
        	kiaMembersInfo = data.kiaMembersInfo;

        	$('#spn_kia_useable_amt').text( String(kiaMembersInfo.useAbleAmt).maskNumber() );
        	$("#kiaMembersPreUsePoint").val('');	//이전사용금액 초기화
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
        , beforeSend : function() {
    		$('#btn_select_kiamembers').prop("disabled", true);
    		$('#btn_select_kiamembers').addClass('disabled');
    	}
    	, complete : function() {
    		setTimeout(function(){
       			$('#btn_select_kiamembers').removeClass('disabled');
       			$('#btn_select_kiamembers').prop("disabled", false);
    		},1500);
    	}
	});
}


//기아멤버스 적용
function applykiaMembers() {
	var transNo    = $("#transNo").val();
	var cardNo     = $("#kiaMembersCardNum_hid").val();
	var useAmt     = $("#kiaMembersUsePoint").val().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var useAbleAmt = $("#spn_kia_useable_amt").text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var remainAmt  = $('.receipt .row.total span').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	var preUseAmt  = $("#kiaMembersPreUsePoint").val().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
	

	remainAmt = parseInt(remainAmt) + parseInt(preUseAmt);	//이전 사용금액이 있는 경우 잔여금액에 이전 사용금액 포함

	//카드번호 체크
	if (cardNo == "") {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#kiaMembersCardNum").focus();
		return;
	}

	if (cardNo.length < 15) {
		gfn_alertMsgBox('카드 번호를 입력하세요.');
		$("#kiaMembersCardNum").focus();
		return;
	}

	if (parseInt(useAbleAmt) == 0) {
		//기아멤버스 사용가능 포인트 조회 후 사용 가능합니다.
		gfn_alertMsgBox('기아멤버스 사용가능 포인트 조회 후 사용 가능합니다.');
		return;
	}


	if (parseInt(useAmt) == 0) {
		//기아멤버스 사용가능 포인트 조회 후 사용 가능합니다.
		gfn_alertMsgBox('사용 포인트를 입력하세요.');
		$("#kiaMembersUsePoint").focus();
		return;
	}


	if (parseInt(useAbleAmt) < 1000) {
		//사용가능한 포인트가 없습니다.
		gfn_alertMsgBox('사용가능한 포인트가 없습니다.');
		return;
	}


	if (parseInt(useAmt) % 1000 != 0) {
		//1000 포인트 단위로 입력해주세요.
		gfn_alertMsgBox('1,000 포인트 단위로 입력해주세요.');
		$("#kiaMembersUsePoint").focus();
		return;
	}

	if (parseInt(useAmt) > 20000) {
		//기아멤버스 포인트 1000점 단위로 사용 가능합니다.
		gfn_alertMsgBox('포인트 적용시 1일 최대 2만 포인트 사용가능합니다');
		$("#kiaMembersUsePoint").focus();
		return;
	}

	if (parseInt(useAmt) > parseInt(remainAmt)) {
		//사용 포인트가 결제 금액보다 큽니다.
		gfn_alertMsgBox('사용 포인트가 결제 금액보다 큽니다.');
		$("#kiaMembersUsePoint").focus();
		return;
	}

	var password = $("#kiaMembersUsePwd").val();

	if (password.length < 4) {
		//비밀번호 4자리 이상 입력하세요
		gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
		$("#kiaMembersUsePwd").focus();
		return;
	}

	var paramData = { cardNo:cardNo, password:password, useAmt:useAmt, transNo:transNo};

	$.ajax({
        url: "/on/oh/ohz/PayBooking/applyKiaMembers.do",
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
		data: JSON.stringify(paramData),
        success: function (data, textStatus, jqXHR) {
        	//console.log(data);
        	if (!msgBookingLoginChk(data)) {
        		return;
        	}

        	//할인내역 갱신
        	setMovieDcInfo(data.policyList);

        	$('#btn_cancel_kiamembers').show(); //취소버튼
        	$('#btn_cancel_apply_kiamembers').show(); //적용취소버튼

        	$('#kiaMembersPreUsePoint').val($("#kiaMembersUsePoint").val()); //취소버튼

        	//닫기버튼 클릭
        	$('#layer_303022 .close-layer').click();
        },
        error: function(xhr,status,error){
        	var err = JSON.parse(xhr.responseText);
        	//err.statCd 에 따라서 이전화면으로 리턴 가능토록
        	errBookingChk(err.msg);
        }
	});

}
</script>

	<!-- 레이어 : 기아멤버스 -->
	<input type="hidden" id="kiaMembersCardNum_hid">
	<section id="layer_303022" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">기아멤버스 포인트 <!-- 기아멤버스 포인트 --></h3>
			</header>

			<div class="layer-con">

				<div class="reset">
					기아멤버스 포인트 카드 정보를 입력해주세요. <!-- 기아멤버스 포인트 카드 정보를 입력해주세요. -->
				</div>

				<div class="popup-gray mid-info-box mb10">
					<div class="pop-search-area line-wid">
						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="kiaMembersCardNum">카드번호 <!-- 카드번호 --></label></p>

							<div class="sh-input">
								<input type="text" id="kiaMembersCardNum" title="기아멤버스 카드번호 입력" class="input-text w200px x-small" maxlength="20"><!-- 기아멤버스 포인트 카드번호 입력 -->
							</div>

							<div class="sh-btn">
								<button type="button" class="button x-small gray" id="btn_select_kiamembers">조회 <!-- 조회 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset">사용가능한 포인트 <!-- 사용가능한 포인트 --></p>
							<span class="font-green" id="spn_kia_useable_amt">0</span> Point
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="kiaMembersUsePoint">사용할 포인트 <!-- 사용할 포인트 --></label></p>
							<input type="text" id="kiaMembersUsePoint" title="사용할 포인트 입력" class="input-text w120px mr05 x-small" maxlength="10"> Point <!-- 사용할 포인트 입력 -->
							<input type="hidden" id="kiaMembersPreUsePoint">

							<div class="sh-btn ml05">
								<button type="button" class="button gray-line x-small" id="btn_all_use_kiamembers">모두사용 <!-- 모두사용 --></button>
							</div>
						</div>

						<div class="pop-search-area-line">
							<p class="sh-txt reset"><label for="kiaMembersUsePwd">비밀번호 <!-- 비밀번호 --></label></p>
							<input type="text" id="kiaMembersUsePwd" title="" class="input-text w120px x-small pwnew" maxlength="4"> <!-- 기아멤버스 카드 비밀번호 입력 -->
						</div>

					</div>
				</div>

				<div class="box-border v1 use-guide mt10">
					<p class="tit">이용안내 <!-- 이용안내 --></p>

					<ul class="dot-list gray">
						<li>1,000포인트 이상 보유시 1,000포인트 단위로 사용가능 <!-- 1,000포인트 이상 보유시 1,000포인트 단위로 사용가능 --></li>
						<li>1일 최대 20,000 포인트 사용가능, 월 사용횟수 1회로 제한 <!-- 1일 최대 20,000 포인트 사용가능, 월 사용횟수 1회로 제한 --></li>
						<li>우대, 문화의날 및 특별콘텐트 이용불가 <!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
					</ul>
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button small close-layer" id="btn_close_kiamembers">닫기 <!-- 닫기 --></button>
				<button type="button" class="button small purple" id="btn_cancel_apply_kiamembers" style="display:none;">적용취소 <!-- 적용취소 --></button>
				<button type="button" class="button small purple" id="btn_apply_kiamembers">적용 <!-- 적용 --></button>
			</div>

			<button type="button" class="btn-modal-close" id="btn_close_modal_kiamembers">레이어 닫기 <!-- 레이어 닫기 --></button>
		</div>
	</section>
	<!--// 레이어 : 기아멤버스 -->




	<!--// 레이어 : 기아 레드 멤버스 -->

	<!-- 레이어 : 중앙페이 관리 -->
	





<script type="text/javascript">
	$(document).ready(function() {
		fn_joongAngPayMngList();

		//닫기버튼 클릭
		$('#btn_close_modal_joongAngPayMng').on('click', function() {
			if(url.indexOf('privatebooking') > -1){
				fn_privateJoongAngPayList();
			}else{
				fn_joongAngPayList();

			}
		});
	});
	var objPopup;
	var popInterval;
	// 카드 리스트 조회
	function fn_joongAngPayMngList(){

		$.ajax({
	        url: "/on/oh/ohz/PayEasyPay/joongAngPayList.do",
	        type: "POST",
	        contentType: "application/json;charset=UTF-8",
	        dataType: "json",
	        data: null,
	        success: function (data, textStatus, jqXHR) {

	        	var joongAngPayMngStat = data.joongAngPay.joongAngPayStat;
	        	var joongAngPayMngList = data.joongAngPay.joongAngPayList;
	        	var listHtml = '';
	        	$('#joongAngPayMngList').empty();

	        	if(joongAngPayMngStat == "Y"){
	        		// 중앙페이 가입자
	        		// 중앙페이 결제수단 존재
	        		if(joongAngPayMngList != null){

	        			// 상단 SET
	        			$('#payCnt').text(joongAngPayMngList.length);
						$('#pasPay').attr("onclick", "fn_joongAngPayMngLink(\'PAS\');");
						$('#regPay').attr("onclick", "fn_joongAngPayMngLink(\'REG\');");
						$('#pasPay').show();
						$('#regPay').show();

        				$.each(joongAngPayMngList, function(i, param){
        					var checkText = "신용";
        					if(param.checkCardFlag == "Y"){
        						checkText = "체크"
        					}
	        				listHtml += '<tr>';
	        				// 카드 11, 계좌 21
	        				if(param.payMethodTypeCode == '11'){
		        				listHtml += '	<td>'+param.displayName+'카드<span>·</span>'+checkText+'</td>';
		        				listHtml += '	<td>'+param.maskingNo.cardFormat()+'</td>';
	        				}else{
		        				listHtml += '	<td>'+param.displayName+'</td>';
		        				listHtml += '	<td>'+param.maskingNo+'</td>';
	        				}
	        				listHtml += '	<td><button type="button" class="button x-small gray-line ml10" onclick="fn_joongAngPayDel(\''+param.easypayVirtualNo+'\');">삭제</button></td>';
	        				listHtml += '</tr>';
        				});

	        		}else{
	        			// 상단 SET
						$('#pasPay').attr("onclick", "fn_joongAngPayMngLink(\'PAS\');");
						$('#regPay').attr("onclick", "fn_joongAngPayMngLink(\'REG\');");
						$('#pasPay').show();
						$('#regPay').show();

	        			// 중앙페이 가입되었지만 수단이 미 등록
        				listHtml += '<tr>';
        				listHtml += '	<td colspan="3" class="a-c">등록된 결제수단이 없습니다.</br>자주 쓰는 카드를 등록해주세요!</td>';
        				listHtml += '</tr>';
	        		}
	        	}else{
        			// 상단 SET
					$('#regPay').attr("onclick", "fn_joongAngPayMngLink(\'NEW\');");
					$('#regPay').show();

	        		// 중앙페이 미 가입자
    				listHtml += '<tr>';
    				listHtml += '	<td colspan="3" class="a-c">등록된 결제수단이 없습니다.</br>자주 쓰는 카드를 등록해주세요!</td>';
    				listHtml += '</tr>';
	        	}

    			$('#joongAngPayMngList').append(listHtml);

	        },
	        error: function(xhr,status,error){
	        	var err = JSON.parse(xhr.responseText);
	        	gfn_alertMsgBox(err.msg);
	        }
		});
	}
	// 중앙페이 결제수단 삭제
	function fn_joongAngPayDel(easypayVirtualNo){

        var paramData = { easypayVirtualNo : easypayVirtualNo };

        gfn_confirmMsgBox('선택하신 결제수단을 삭제하시겠어요?', function() {
            $.ajaxMegaBox({
                url      : '/on/oh/ohz/PayEasyPay/joongAngPayDelete.do',
                data     : JSON.stringify(paramData),
                success  : function (data, textStatus, jqXHR) {

    	        	if(data.revMap.resCd == '0000'){
    	        		gfn_alertMsgBox("선택하신 결제수단이 삭제되었습니다.");
    	        		fn_joongAngPayMngList();
    				}else{
    					gfn_alertMsgBox(data.revMap.resMsg);
    				}
                }
            });
        }, "", 400, 350);

	}

	// 중앙페이 가입 및 카드 등록 호출
	function fn_joongAngPayMngLink(arg){
		var url;
		if(arg == "NEW"){
			url = "/on/oh/ohz/PayEasyPay/userCertReg.do?arg="+arg;
		}else if(arg == "REG"){
			url = "/on/oh/ohz/PayEasyPay/mngManagement.do?arg="+arg;
		}else{
			url = "/on/oh/ohz/PayEasyPay/passwordModification.do?arg="+arg;
		}

		fn_openJAMngPayPop(url, arg);
	}

	function fn_openJAMngPayPop(popSrc, arg){

	    var popupWidth = 440;
	    var popupHeight = 900;
	    var popupX = (window.screen.width / 2) - (popupWidth / 2);
	    var popupY = (window.screen.height / 2) - (popupHeight / 2);

	    objPopup = window.open(popSrc,'japay_pop','width=' + popupWidth +', height=' + popupHeight + ',left=' + popupX + ',top=' + popupY);

        popInterval = setInterval(function(){
            if(typeof(objPopup) === 'undefined' || (objPopup && objPopup.closed)){	//typeof : 선언하지 않았거나 초기화하지 않았으면 undefined
            	fn_initMngObjPop();
            }
        }, 500);

	}

	function fn_closeMng(resultData){
		if(resultData.resCd != '0000' && resultData.Msg != ''){
			gfn_alertMsgBox(resultData.Msg);
		}
		fn_initMngObjPop();
	}

	//팝업호출 이전상태로 초기화
	function fn_initMngObjPop(){
	    fn_popIntervalClear();
	    fn_joongAngPayMngList();
	}

	// popInterval 클리어
	function fn_popIntervalClear(){
        clearInterval(popInterval);
	}
</script>

<!-- 레이어 : 중앙페이 관리 -->
<section id="layer_joongAngPayMng" class="modal-layer"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
	<div class="wrap">
		<header class="layer-header">
			<h3 class="tit">중앙페이 결제수단 관리</h3>
		</header>

		<div class="layer-con">
			<div class="board-list-util mt0">
				<p class="result-count mg00 pd00"><strong>등록된 결제수단 <b id="payCnt">0</b></strong></p>

				<div class="btn-group right pd00">
					<a href="javascript:void(0);" class="button btn-modal-open" w-data="600" h-data="440" id="pasPay" style="display: none;">비밀번호 변경하기</a>
					<a href="javascript:void(0);" class="button btn-modal-open" w-data="600" h-data="440" id="regPay" style="" onclick="fn_joongAngPayMngLink(&#39;NEW&#39;);">결제수단 추가하기</a>
				</div>
			</div>
			<div class="table-wrap divide">
				<table class="board-list line">
					<caption>구분, 카드 번호 해더</caption>
					<colgroup>
							<col style="width:200px;">
							<col>
							<col style="width:100px;">
					</colgroup>
					<thead>
						<tr>
							<th scope="col">구분</th>
							<th scope="col">카드 번호</th>
							<th scope="col"></th>
						</tr>
					</thead>
				</table>
				<!--
					상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
				 -->
				<div class="scroll" style="min-height:340px; max-height:340px;">
					<table class="board-list line">
						<caption>구분, 카드 / 계좌 번호 표<!-- 메가박스 VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 내용 표 --></caption>
						<colgroup>
							<col style="width:200px;">
							<col>
							<col style="width:100px;">
						</colgroup>
						<tbody id="joongAngPayMngList"><tr>	<td colspan="3" class="a-c">등록된 결제수단이 없습니다.<br>자주 쓰는 카드를 등록해주세요!</td></tr></tbody>
					</table>
				</div>
			</div>
		</div>
		<button type="button" class="btn-modal-close" id="btn_close_modal_joongAngPayMng">레이어 닫기<!-- 레이어 닫기 --></button>
	</div>
</section>
<!--// 레이어 : 중앙페이 관리 -->

	<!--// 레이어 : 중앙페이 관리 -->

	<!-- 레이어 : 5분연장 -->
	<section id="layer_time_delay" class="modal-layer" style="z-index:4000;"><a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr" class="focus">레이어로 포커스 이동 됨</a>
		<div class="wrap">
			<header class="layer-header">
				<h3 class="tit">알림<!-- 알림 --></h3>
			</header>

			<div class="layer-con">
				<div class="pop-tit">
					예매가능시간이 1분 남았습니다.<br>연장하시겠습니까? (1회만 가능)
					<!-- 예매가능시간이 1분 남았습니다.<br />
					연장하시겠습니까? (1회만 가능) -->
				</div>
			</div>

			<div class="btn-group-fixed">
				<button type="button" class="button purple" id="delayFiveMin">5분연장하기<!-- 5분연장하기 --></button>
				<button type="button" class="button close-layer" id="delayFiveMinClose">취소<!-- 취소 --></button>
			</div>

			<button type="button" class="btn-modal-close">레이어 닫기<!-- 레이어 닫기 --></button>
		</div>
	</section>

	<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#layer_cash_bill" w-data="600" h-data="400" class="button active btn-modal-open target" id="cash_pop" style="display:none;" title="현금영수증">현금영수증<!-- 현금영수증 --></a>
	<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#layer_before_sale" w-data="600" h-data="550" class="button active btn-modal-open target" id="pre_disc_pop" style="display:none;" title="선할인">선할인</a>
	<a href="https://www.megabox.co.kr/on/oh/ohz/PayBooking/completeSeat.do?megaboxLanguage=kr#layer_shinhan_sale" w-data="600" h-data="550" class="button active btn-modal-open target" id="shinhan_pop" style="display:none;" title="아침愛">아침愛</a>
	<!--// 레이어 : 5분연장 -->


<div class="normalStyle" style="display:none;position:fixed;top:0;left:0;background:#000;opacity:0.7;text-indent:-9999px;width:100%;height:100%;z-index:100;">닫기</div><div class="alertStyle" style="display:none;position:fixed;top:0px;left:0px;background:#000;opacity:0.7;width:100%;height:100%;z-index:5005;"></div></body></html>